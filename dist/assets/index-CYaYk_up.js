var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{j as n,u as r,Q as i,a}from"./query-vendor-BdC1AEk3.js";import{r as s,a as o,b as l,u as c,d as u,L as h,e as d,c as p,R as f,B as m,f as g,h as y}from"./react-vendor-kATgzW93.js";import{M as _}from"./medusa-vendor-DTz3o9qh.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var x={exports:{}},b={},w={exports:{}},S={};
/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,s=a>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();e.unstable_now=function(){return s.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,m=!1,g=!1,y="function"==typeof setTimeout?setTimeout:null,_="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function b(e){if(m=!1,x(e),!f)if(null!==n(l))f=!0,S||(S=!0,w());else{var t=n(c);null!==t&&A(b,t.startTime-e)}}var w,S=!1,k=-1,T=5,C=-1;function E(){return!!g||!(e.unstable_now()-C<T)}function I(){if(g=!1,S){var t=e.unstable_now();C=t;var i=!0;try{e:{f=!1,m&&(m=!1,_(k),k=-1),p=!0;var a=d;try{t:{for(x(t),h=n(l);null!==h&&!(h.expirationTime>t&&E());){var s=h.callback;if("function"==typeof s){h.callback=null,d=h.priorityLevel;var o=s(h.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof o){h.callback=o,x(t),i=!0;break t}h===n(l)&&r(l),x(t)}else r(l);h=n(l)}if(null!==h)i=!0;else{var u=n(c);null!==u&&A(b,u.startTime-t),i=!1}}break e}finally{h=null,d=a,p=!1}i=void 0}}finally{i?w():S=!1}}}if("function"==typeof v)w=function(){v(I)};else if("undefined"!=typeof MessageChannel){var P=new MessageChannel,M=P.port2;P.port1.onmessage=I,w=function(){M.postMessage(null)}}else w=function(){y(I,0)};function A(t,n){k=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(T=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_requestPaint=function(){g=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,i,a){var s=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?s+a:s:a=s,r){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(m?(_(k),k=-1):m=!0,A(b,a-s))):(r.sortIndex=o,t(l,r),f||p||(f=!0,S||(S=!0,w()))),r},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(S),w.exports=S;var k=w.exports,T=s,C=o;
/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function E(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function I(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function P(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function M(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function A(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function z(e){if(P(e)!==e)throw Error(E(188))}function D(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=D(e)))return t;e=e.sibling}return null}var R=Object.assign,L=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),j=Symbol.for("react.portal"),F=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),V=Symbol.for("react.consumer"),U=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),W=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),Y=Symbol.iterator;function K(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Y&&e[Y]||e["@@iterator"])?e:null}var Q=Symbol.for("react.client.reference");function J(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===Q?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case F:return"Fragment";case B:return"Profiler";case O:return"StrictMode";case $:return"Suspense";case G:return"SuspenseList";case W:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case j:return"Portal";case U:return e.displayName||"Context";case V:return(e._context.displayName||"Context")+".Consumer";case q:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case H:return null!==(t=e.displayName||null)?t:J(e.type)||"Memo";case Z:t=e._payload,e=e._init;try{return J(e(t))}catch(n){}}return null}var ee=Array.isArray,te=T.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=C.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},ie=[],ae=-1;function se(e){return{current:e}}function oe(e){0>ae||(e.current=ie[ae],ie[ae]=null,ae--)}function le(e,t){ae++,ie[ae]=e.current,e.current=t}var ce,ue,he=se(null),de=se(null),pe=se(null),fe=se(null);function me(e,t){switch(le(pe,t),le(de,e),le(he,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Fh(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=Oh(t=Fh(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}oe(he),le(he,e)}function ge(){oe(he),oe(de),oe(pe)}function ye(e){null!==e.memoizedState&&le(fe,e);var t=he.current,n=Oh(t,e.type);t!==n&&(le(de,e),le(he,n))}function _e(e){de.current===e&&(oe(he),oe(de)),fe.current===e&&(oe(fe),Ad._currentValue=re)}function ve(e){if(void 0===ce)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);ce=t&&t[1]||"",ue=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+ce+e+ue}var xe=!1;function be(e,t){if(!e||xe)return"";xe=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(s){r=s}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(o){if(o&&r&&"string"==typeof o.stack)return[o.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),s=a[0],o=a[1];if(s&&o){var l=s.split("\n"),c=o.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{xe=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?ve(n):""}function we(e,t){switch(e.tag){case 26:case 27:case 5:return ve(e.type);case 16:return ve("Lazy");case 13:return e.child!==t&&null!==t?ve("Suspense Fallback"):ve("Suspense");case 19:return ve("SuspenseList");case 0:case 15:return be(e.type,!1);case 11:return be(e.type.render,!1);case 1:return be(e.type,!0);case 31:return ve("Activity");default:return""}}function Se(e){try{var t="",n=null;do{t+=we(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}var ke=Object.prototype.hasOwnProperty,Te=k.unstable_scheduleCallback,Ce=k.unstable_cancelCallback,Ee=k.unstable_shouldYield,Ie=k.unstable_requestPaint,Pe=k.unstable_now,Me=k.unstable_getCurrentPriorityLevel,Ae=k.unstable_ImmediatePriority,ze=k.unstable_UserBlockingPriority,De=k.unstable_NormalPriority,Re=k.unstable_LowPriority,Le=k.unstable_IdlePriority,Ne=k.log,je=k.unstable_setDisableYieldValue,Fe=null,Oe=null;function Be(e){if("function"==typeof Ne&&je(e),Oe&&"function"==typeof Oe.setStrictMode)try{Oe.setStrictMode(Fe,e)}catch(t){}}var Ve=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(Ue(e)/qe|0)|0},Ue=Math.log,qe=Math.LN2;var $e=256,Ge=262144,He=4194304;function Ze(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function We(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,a=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var o=134217727&r;return 0!==o?0!==(r=o&~a)?i=Ze(r):0!==(s&=o)?i=Ze(s):n||0!==(n=o&~e)&&(i=Ze(n)):0!==(o=r&~a)?i=Ze(o):0!==s?i=Ze(s):n||0!==(n=r&~e)&&(i=Ze(n)),0===i?0:0!==t&&t!==i&&0===(t&a)&&((a=i&-i)>=(n=t&-t)||32===a&&4194048&n)?t:i}function Xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ye(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ke(){var e=He;return!(62914560&(He<<=1))&&(He=4194304),e}function Qe(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Je(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function et(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Ve(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function tt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Ve(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function nt(e,t){var n=t&-t;return 0!==((n=42&n?1:rt(n))&(e.suspendedLanes|t))?0:n}function rt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function it(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function at(){var e=ne.p;return 0!==e?e:void 0===(e=window.event)?32:Zd(e.type)}function st(e,t){var n=ne.p;try{return ne.p=e,t()}finally{ne.p=n}}var ot=Math.random().toString(36).slice(2),lt="__reactFiber$"+ot,ct="__reactProps$"+ot,ut="__reactContainer$"+ot,ht="__reactEvents$"+ot,dt="__reactListeners$"+ot,pt="__reactHandles$"+ot,ft="__reactResources$"+ot,mt="__reactMarker$"+ot;function gt(e){delete e[lt],delete e[ct],delete e[ht],delete e[dt],delete e[pt]}function yt(e){var t=e[lt];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ut]||n[lt]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=rd(e);null!==e;){if(n=e[lt])return n;e=rd(e)}return t}n=(e=n).parentNode}return null}function _t(e){if(e=e[lt]||e[ut]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function vt(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(E(33))}function xt(e){var t=e[ft];return t||(t=e[ft]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function bt(e){e[mt]=!0}var wt=new Set,St={};function kt(e,t){Tt(e,t),Tt(e+"Capture",t)}function Tt(e,t){for(St[e]=t,e=0;e<t.length;e++)wt.add(t[e])}var Ct=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Et={},It={};function Pt(e,t,n){if(i=t,ke.call(It,i)||!ke.call(Et,i)&&(Ct.test(i)?It[i]=!0:(Et[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function Mt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function At(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function zt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Rt(e){if(!e._valueTracker){var t=Dt(e)?"checked":"value";e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function Lt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Dt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Nt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(WI){return e.body}}var jt=/[\n"\\]/g;function Ft(e){return e.replace(jt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Ot(e,t,n,r,i,a,s,o){e.name="",null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+zt(t)):e.value!==""+zt(t)&&(e.value=""+zt(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?Vt(e,s,zt(t)):null!=n?Vt(e,s,zt(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=a&&(e.defaultChecked=!!a),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+zt(o):e.removeAttribute("name")}function Bt(e,t,n,r,i,a,s,o){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=n){if(("submit"===a||"reset"===a)&&null==t)return void Rt(e);n=null!=n?""+zt(n):"",t=null!=t?""+zt(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=o?e.checked:!!r,e.defaultChecked=!!r,null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.name=s),Rt(e)}function Vt(e,t,n){"number"===t&&Nt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function Ut(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+zt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function qt(e,t,n){null==t||((t=""+zt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+zt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function $t(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(E(92));if(ee(r)){if(1<r.length)throw Error(E(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=zt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),Rt(e)}function Gt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ht=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||Ht.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Wt(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(E(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&Zt(e,i,r)}else for(var a in t)t.hasOwnProperty(a)&&Zt(e,a,t[a])}function Xt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Kt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qt(e){return Kt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Jt(){}var en=null;function tn(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var nn=null,rn=null;function an(e){var t=_t(e);if(t&&(e=t.stateNode)){var n=e[ct]||null;e:switch(e=t.stateNode,t.type){case"input":if(Ot(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Ft(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[ct]||null;if(!i)throw Error(E(90));Ot(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&Lt(r)}break e;case"textarea":qt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&Ut(e,!!n.multiple,t,!1)}}}var sn=!1;function on(e,t,n){if(sn)return e(t,n);sn=!0;try{return e(t)}finally{if(sn=!1,(null!==nn||null!==rn)&&(xu(),nn&&(t=nn,e=rn,rn=nn=null,an(t),e)))for(t=0;t<e.length;t++)an(e[t])}}function ln(e,t){var n=e.stateNode;if(null===n)return null;var r=n[ct]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(E(231,t,typeof n));return n}var cn=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),un=!1;if(cn)try{var hn={};Object.defineProperty(hn,"passive",{get:function(){un=!0}}),window.addEventListener("test",hn,hn),window.removeEventListener("test",hn,hn)}catch(WI){un=!1}var dn=null,pn=null,fn=null;function mn(){if(fn)return fn;var e,t,n=pn,r=n.length,i="value"in dn?dn.value:dn.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return fn=i.slice(e,1<t?1-t:void 0)}function gn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function yn(){return!0}function _n(){return!1}function vn(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?yn:_n,this.isPropagationStopped=_n,this}return R(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=yn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=yn)},persist:function(){},isPersistent:yn}),t}var xn,bn,wn,Sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kn=vn(Sn),Tn=R({},Sn,{view:0,detail:0}),Cn=vn(Tn),En=R({},Tn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==wn&&(wn&&"mousemove"===e.type?(xn=e.screenX-wn.screenX,bn=e.screenY-wn.screenY):bn=xn=0,wn=e),xn)},movementY:function(e){return"movementY"in e?e.movementY:bn}}),In=vn(En),Pn=vn(R({},En,{dataTransfer:0})),Mn=vn(R({},Tn,{relatedTarget:0})),An=vn(R({},Sn,{animationName:0,elapsedTime:0,pseudoElement:0})),zn=vn(R({},Sn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Dn=vn(R({},Sn,{data:0})),Rn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ln={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Nn[e])&&!!t[e]}function Fn(){return jn}var On=vn(R({},Tn,{key:function(e){if(e.key){var t=Rn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=gn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Ln[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fn,charCode:function(e){return"keypress"===e.type?gn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?gn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Bn=vn(R({},En,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Vn=vn(R({},Tn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fn})),Un=vn(R({},Sn,{propertyName:0,elapsedTime:0,pseudoElement:0})),qn=vn(R({},En,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),$n=vn(R({},Sn,{newState:0,oldState:0})),Gn=[9,13,27,32],Hn=cn&&"CompositionEvent"in window,Zn=null;cn&&"documentMode"in document&&(Zn=document.documentMode);var Wn=cn&&"TextEvent"in window&&!Zn,Xn=cn&&(!Hn||Zn&&8<Zn&&11>=Zn),Yn=String.fromCharCode(32),Kn=!1;function Qn(e,t){switch(e){case"keyup":return-1!==Gn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var er=!1;var tr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!tr[e.type]:"textarea"===t}function rr(e,t,n,r){nn?rn?rn.push(r):rn=[r]:nn=r,0<(t=kh(t,"onChange")).length&&(n=new kn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var ir=null,ar=null;function sr(e){gh(e,0)}function or(e){if(Lt(vt(e)))return e}function lr(e,t){if("change"===e)return t}var cr=!1;if(cn){var ur;if(cn){var hr="oninput"in document;if(!hr){var dr=document.createElement("div");dr.setAttribute("oninput","return;"),hr="function"==typeof dr.oninput}ur=hr}else ur=!1;cr=ur&&(!document.documentMode||9<document.documentMode)}function pr(){ir&&(ir.detachEvent("onpropertychange",fr),ar=ir=null)}function fr(e){if("value"===e.propertyName&&or(ar)){var t=[];rr(t,ar,e,tn(e)),on(sr,t)}}function mr(e,t,n){"focusin"===e?(pr(),ar=n,(ir=t).attachEvent("onpropertychange",fr)):"focusout"===e&&pr()}function gr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return or(ar)}function yr(e,t){if("click"===e)return or(t)}function _r(e,t){if("input"===e||"change"===e)return or(t)}var vr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function xr(e,t){if(vr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!ke.call(t,i)||!vr(e[i],t[i]))return!1}return!0}function br(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function wr(e,t){var n,r=br(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=br(r)}}function Sr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Sr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function kr(e){for(var t=Nt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Nt((e=t.contentWindow).document)}return t}function Tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Cr=cn&&"documentMode"in document&&11>=document.documentMode,Er=null,Ir=null,Pr=null,Mr=!1;function Ar(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Mr||null==Er||Er!==Nt(r)||("selectionStart"in(r=Er)&&Tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Pr&&xr(Pr,r)||(Pr=r,0<(r=kh(Ir,"onSelect")).length&&(t=new kn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Er)))}function zr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Dr={animationend:zr("Animation","AnimationEnd"),animationiteration:zr("Animation","AnimationIteration"),animationstart:zr("Animation","AnimationStart"),transitionrun:zr("Transition","TransitionRun"),transitionstart:zr("Transition","TransitionStart"),transitioncancel:zr("Transition","TransitionCancel"),transitionend:zr("Transition","TransitionEnd")},Rr={},Lr={};function Nr(e){if(Rr[e])return Rr[e];if(!Dr[e])return e;var t,n=Dr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Lr)return Rr[e]=n[t];return e}cn&&(Lr=document.createElement("div").style,"AnimationEvent"in window||(delete Dr.animationend.animation,delete Dr.animationiteration.animation,delete Dr.animationstart.animation),"TransitionEvent"in window||delete Dr.transitionend.transition);var jr=Nr("animationend"),Fr=Nr("animationiteration"),Or=Nr("animationstart"),Br=Nr("transitionrun"),Vr=Nr("transitionstart"),Ur=Nr("transitioncancel"),qr=Nr("transitionend"),$r=new Map,Gr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hr(e,t){$r.set(e,t),kt(t,[e])}Gr.push("scrollEnd");var Zr="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},Wr=[],Xr=0,Yr=0;function Kr(){for(var e=Xr,t=Yr=Xr=0;t<e;){var n=Wr[t];Wr[t++]=null;var r=Wr[t];Wr[t++]=null;var i=Wr[t];Wr[t++]=null;var a=Wr[t];if(Wr[t++]=null,null!==r&&null!==i){var s=r.pending;null===s?i.next=i:(i.next=s.next,s.next=i),r.pending=i}0!==a&&ti(n,i,a)}}function Qr(e,t,n,r){Wr[Xr++]=e,Wr[Xr++]=t,Wr[Xr++]=n,Wr[Xr++]=r,Yr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Jr(e,t,n,r){return Qr(e,t,n,r),ni(e)}function ei(e,t){return Qr(e,null,null,t),ni(e)}function ti(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,i&&null!==t&&(i=31-Ve(n),null===(r=(e=a.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),a):null}function ni(e){if(50<hu)throw hu=0,du=null,Error(E(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var ri={};function ii(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(e,t,n,r){return new ii(e,t,n,r)}function si(e){return!(!(e=e.prototype)||!e.isReactComponent)}function oi(e,t){var n=e.alternate;return null===n?((n=ai(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function li(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function ci(e,t,n,r,i,a){var s=0;if(r=e,"function"==typeof e)si(e)&&(s=1);else if("string"==typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,he.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case W:return(e=ai(31,n,t,i)).elementType=W,e.lanes=a,e;case F:return ui(n.children,i,a,t);case O:s=8,i|=24;break;case B:return(e=ai(12,n,t,2|i)).elementType=B,e.lanes=a,e;case $:return(e=ai(13,n,t,i)).elementType=$,e.lanes=a,e;case G:return(e=ai(19,n,t,i)).elementType=G,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case U:s=10;break e;case V:s=9;break e;case q:s=11;break e;case H:s=14;break e;case Z:s=16,r=null;break e}s=29,n=Error(E(130,null===e?"null":typeof e,"")),r=null}return(t=ai(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function ui(e,t,n,r){return(e=ai(7,e,r,t)).lanes=n,e}function hi(e,t,n){return(e=ai(6,e,null,t)).lanes=n,e}function di(e){var t=ai(18,null,null,0);return t.stateNode=e,t}function pi(e,t,n){return(t=ai(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var fi=new WeakMap;function mi(e,t){if("object"==typeof e&&null!==e){var n=fi.get(e);return void 0!==n?n:(t={value:e,source:t,stack:Se(t)},fi.set(e,t),t)}return{value:e,source:t,stack:Se(t)}}var gi=[],yi=0,_i=null,vi=0,xi=[],bi=0,wi=null,Si=1,ki="";function Ti(e,t){gi[yi++]=vi,gi[yi++]=_i,_i=e,vi=t}function Ci(e,t,n){xi[bi++]=Si,xi[bi++]=ki,xi[bi++]=wi,wi=e;var r=Si;e=ki;var i=32-Ve(r)-1;r&=~(1<<i),n+=1;var a=32-Ve(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Si=1<<32-Ve(t)+i|n<<i|r,ki=a+e}else Si=1<<a|n<<i|r,ki=e}function Ei(e){null!==e.return&&(Ti(e,1),Ci(e,1,0))}function Ii(e){for(;e===_i;)_i=gi[--yi],gi[yi]=null,vi=gi[--yi],gi[yi]=null;for(;e===wi;)wi=xi[--bi],xi[bi]=null,ki=xi[--bi],xi[bi]=null,Si=xi[--bi],xi[bi]=null}function Pi(e,t){xi[bi++]=Si,xi[bi++]=ki,xi[bi++]=wi,Si=t.id,ki=t.overflow,wi=e}var Mi=null,Ai=null,zi=!1,Di=null,Ri=!1,Li=Error(E(519));function Ni(e){throw Ui(mi(Error(E(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),Li}function ji(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[lt]=e,t[ct]=r,n){case"dialog":yh("cancel",t),yh("close",t);break;case"iframe":case"object":case"embed":yh("load",t);break;case"video":case"audio":for(n=0;n<fh.length;n++)yh(fh[n],t);break;case"source":yh("error",t);break;case"img":case"image":case"link":yh("error",t),yh("load",t);break;case"details":yh("toggle",t);break;case"input":yh("invalid",t),Bt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":yh("invalid",t);break;case"textarea":yh("invalid",t),$t(t,r.value,r.defaultValue,r.children)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Mh(t.textContent,n)?(null!=r.popover&&(yh("beforetoggle",t),yh("toggle",t)),null!=r.onScroll&&yh("scroll",t),null!=r.onScrollEnd&&yh("scrollend",t),null!=r.onClick&&(t.onclick=Jt),t=!0):t=!1,t||Ni(e,!0)}function Fi(e){for(Mi=e.return;Mi;)switch(Mi.tag){case 5:case 31:case 13:return void(Ri=!1);case 27:case 3:return void(Ri=!0);default:Mi=Mi.return}}function Oi(e){if(e!==Mi)return!1;if(!zi)return Fi(e),zi=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Bh(e.type,e.memoizedProps)),t=!t),t&&Ai&&Ni(e),Fi(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(E(317));Ai=nd(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(E(317));Ai=nd(e)}else 27===n?(n=Ai,Zh(e.type)?(e=td,td=null,Ai=e):Ai=n):Ai=Mi?ed(e.stateNode.nextSibling):null;return!0}function Bi(){Ai=Mi=null,zi=!1}function Vi(){var e=Di;return null!==e&&(null===Kc?Kc=e:Kc.push.apply(Kc,e),Di=null),e}function Ui(e){null===Di?Di=[e]:Di.push(e)}var qi=se(null),$i=null,Gi=null;function Hi(e,t,n){le(qi,t._currentValue),t._currentValue=n}function Zi(e){e._currentValue=qi.current,oe(qi)}function Wi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Xi(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var a=i.dependencies;if(null!==a){var s=i.child;a=a.firstContext;e:for(;null!==a;){var o=a;a=i;for(var l=0;l<t.length;l++)if(o.context===t[l]){a.lanes|=n,null!==(o=a.alternate)&&(o.lanes|=n),Wi(a.return,n,e),r||(s=null);break e}a=o.next}}else if(18===i.tag){if(null===(s=i.return))throw Error(E(341));s.lanes|=n,null!==(a=s.alternate)&&(a.lanes|=n),Wi(s,n,e),s=null}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===e){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}}function Yi(e,t,n,r){e=null;for(var i=t,a=!1;null!==i;){if(!a)if(524288&i.flags)a=!0;else if(262144&i.flags)break;if(10===i.tag){var s=i.alternate;if(null===s)throw Error(E(387));if(null!==(s=s.memoizedProps)){var o=i.type;vr(i.pendingProps.value,s.value)||(null!==e?e.push(o):e=[o])}}else if(i===fe.current){if(null===(s=i.alternate))throw Error(E(387));s.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(Ad):e=[Ad])}i=i.return}null!==e&&Xi(t,e,n,r),t.flags|=262144}function Ki(e){for(e=e.firstContext;null!==e;){if(!vr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Qi(e){$i=e,Gi=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ji(e){return ta($i,e)}function ea(e,t){return null===$i&&Qi(e),ta(e,t)}function ta(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Gi){if(null===e)throw Error(E(308));Gi=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Gi=Gi.next=t;return n}var na="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ra=k.unstable_scheduleCallback,ia=k.unstable_NormalPriority,aa={$$typeof:U,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sa(){return{controller:new na,data:new Map,refCount:0}}function oa(e){e.refCount--,0===e.refCount&&ra(ia,function(){e.controller.abort()})}var la=null,ca=0,ua=0,ha=null;function da(){if(0===--ca&&null!==la){null!==ha&&(ha.status="fulfilled");var e=la;la=null,ua=0,ha=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var pa=te.S;te.S=function(e,t){eu=Pe(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===la){var n=la=[];ca=0,ua=ch(),ha={status:"pending",value:void 0,then:function(e){n.push(e)}}}ca++,t.then(da,da)}(0,t),null!==pa&&pa(e,t)};var fa=se(null);function ma(){var e=fa.current;return null!==e?e:Lc.pooledCache}function ga(e,t){le(fa,null===t?fa.current:t.pool)}function ya(){var e=ma();return null===e?null:{parent:aa._currentValue,pool:e}}var _a=Error(E(460)),va=Error(E(474)),xa=Error(E(542)),ba={then:function(){}};function wa(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Sa(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Jt,Jt),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw Ea(e=t.reason),e;default:if("string"==typeof t.status)t.then(Jt,Jt);else{if(null!==(e=Lc)&&100<e.shellSuspendCounter)throw Error(E(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Ea(e=t.reason),e}throw Ta=t,_a}}function ka(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw Ta=t,_a;throw t}}var Ta=null;function Ca(){if(null===Ta)throw Error(E(459));var e=Ta;return Ta=null,e}function Ea(e){if(e===_a||e===xa)throw Error(E(483))}var Ia=null,Pa=0;function Ma(e){var t=Pa;return Pa+=1,null===Ia&&(Ia=[]),Sa(Ia,e,t)}function Aa(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function za(e,t){if(t.$$typeof===L)throw Error(E(525));throw e=Object.prototype.toString.call(t),Error(E(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Da(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=oi(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function o(e,t,n,r){return null===t||6!==t.tag?((t=hi(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===F?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===Z&&ka(a)===t.type)?(Aa(t=i(t,n.props),n),t.return=e,t):(Aa(t=ci(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=pi(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=ui(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=hi(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case N:return Aa(n=ci(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case j:return(t=pi(t,e.mode,n)).return=e,t;case Z:return h(e,t=ka(t),n)}if(ee(t)||K(t))return(t=ui(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return h(e,Ma(t),n);if(t.$$typeof===U)return h(e,ea(e,t),n);za(e,t)}return null}function d(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:o(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case N:return n.key===i?l(e,t,n,r):null;case j:return n.key===i?c(e,t,n,r):null;case Z:return d(e,t,n=ka(n),r)}if(ee(n)||K(n))return null!==i?null:u(e,t,n,r,null);if("function"==typeof n.then)return d(e,t,Ma(n),r);if(n.$$typeof===U)return d(e,t,ea(e,n),r);za(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return o(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case N:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case j:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case Z:return p(e,t,n,r=ka(r),i)}if(ee(r)||K(r))return u(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return p(e,t,n,Ma(r),i);if(r.$$typeof===U)return p(e,t,n,ea(t,r),i);za(t,r)}return null}function f(o,l,c,u){if("object"==typeof c&&null!==c&&c.type===F&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case N:e:{for(var m=c.key;null!==l;){if(l.key===m){if((m=c.type)===F){if(7===l.tag){n(o,l.sibling),(u=i(l,c.props.children)).return=o,o=u;break e}}else if(l.elementType===m||"object"==typeof m&&null!==m&&m.$$typeof===Z&&ka(m)===l.type){n(o,l.sibling),Aa(u=i(l,c.props),c),u.return=o,o=u;break e}n(o,l);break}t(o,l),l=l.sibling}c.type===F?((u=ui(c.props.children,o.mode,u,c.key)).return=o,o=u):(Aa(u=ci(c.type,c.key,c.props,null,o.mode,u),c),u.return=o,o=u)}return s(o);case j:e:{for(m=c.key;null!==l;){if(l.key===m){if(4===l.tag&&l.stateNode.containerInfo===c.containerInfo&&l.stateNode.implementation===c.implementation){n(o,l.sibling),(u=i(l,c.children||[])).return=o,o=u;break e}n(o,l);break}t(o,l),l=l.sibling}(u=pi(c,o.mode,u)).return=o,o=u}return s(o);case Z:return f(o,l,c=ka(c),u)}if(ee(c))return function(i,s,o,l){for(var c=null,u=null,f=s,m=s=0,g=null;null!==f&&m<o.length;m++){f.index>m?(g=f,f=null):g=f.sibling;var y=d(i,f,o[m],l);if(null===y){null===f&&(f=g);break}e&&f&&null===y.alternate&&t(i,f),s=a(y,s,m),null===u?c=y:u.sibling=y,u=y,f=g}if(m===o.length)return n(i,f),zi&&Ti(i,m),c;if(null===f){for(;m<o.length;m++)null!==(f=h(i,o[m],l))&&(s=a(f,s,m),null===u?c=f:u.sibling=f,u=f);return zi&&Ti(i,m),c}for(f=r(f);m<o.length;m++)null!==(g=p(f,i,m,o[m],l))&&(e&&null!==g.alternate&&f.delete(null===g.key?m:g.key),s=a(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&f.forEach(function(e){return t(i,e)}),zi&&Ti(i,m),c}(o,l,c,u);if(K(c)){if("function"!=typeof(m=K(c)))throw Error(E(150));return function(i,s,o,l){if(null==o)throw Error(E(151));for(var c=null,u=null,f=s,m=s=0,g=null,y=o.next();null!==f&&!y.done;m++,y=o.next()){f.index>m?(g=f,f=null):g=f.sibling;var _=d(i,f,y.value,l);if(null===_){null===f&&(f=g);break}e&&f&&null===_.alternate&&t(i,f),s=a(_,s,m),null===u?c=_:u.sibling=_,u=_,f=g}if(y.done)return n(i,f),zi&&Ti(i,m),c;if(null===f){for(;!y.done;m++,y=o.next())null!==(y=h(i,y.value,l))&&(s=a(y,s,m),null===u?c=y:u.sibling=y,u=y);return zi&&Ti(i,m),c}for(f=r(f);!y.done;m++,y=o.next())null!==(y=p(f,i,m,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?m:y.key),s=a(y,s,m),null===u?c=y:u.sibling=y,u=y);return e&&f.forEach(function(e){return t(i,e)}),zi&&Ti(i,m),c}(o,l,c=m.call(c),u)}if("function"==typeof c.then)return f(o,l,Ma(c),u);if(c.$$typeof===U)return f(o,l,ea(o,c),u);za(o,c)}return"string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c?(c=""+c,null!==l&&6===l.tag?(n(o,l.sibling),(u=i(l,c)).return=o,o=u):(n(o,l),(u=hi(c,o.mode,u)).return=o,o=u),s(o)):n(o,l)}return function(e,t,n,r){try{Pa=0;var i=f(e,t,n,r);return Ia=null,i}catch(s){if(s===_a||s===xa)throw s;var a=ai(29,s,null,e.mode);return a.lanes=r,a.return=e,a}}}var Ra=Da(!0),La=Da(!1),Na=!1;function ja(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Fa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Oa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ba(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Rc){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=ni(e),ti(e,null,n),t}return Qr(e,r,t,n),ni(e)}function Va(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,tt(e,n)}}function Ua(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var qa=!1;function $a(){if(qa){if(null!==ha)throw ha}}function Ga(e,t,n,r){qa=!1;var i=e.updateQueue;Na=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==a){var h=i.baseState;for(s=0,u=c=l=null,o=a;;){var d=-536870913&o.lane,p=d!==o.lane;if(p?(jc&d)===d:(r&d)===d){0!==d&&d===ua&&(qa=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,m=o;d=t;var g=n;switch(m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(g,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(g,h,d):f))break e;h=R({},h,d);break e;case 2:Na=!0}}null!==(d=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[d]:p.push(d))}else p={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(p=o).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===a&&(i.shared.lanes=0),Gc|=s,e.lanes=s,e.memoizedState=h}}function Ha(e,t){if("function"!=typeof e)throw Error(E(191,e));e.call(t)}function Za(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ha(n[e],t)}var Wa=se(null),Xa=se(0);function Ya(e,t){le(Xa,e=qc),le(Wa,t),qc=e|t.baseLanes}function Ka(){le(Xa,qc),le(Wa,Wa.current)}function Qa(){qc=Xa.current,oe(Wa),oe(Xa)}var Ja=se(null),es=null;function ts(e){var t=e.alternate;le(ss,1&ss.current),le(Ja,e),null===es&&(null===t||null!==Wa.current||null!==t.memoizedState)&&(es=e)}function ns(e){le(ss,ss.current),le(Ja,e),null===es&&(es=e)}function rs(e){22===e.tag?(le(ss,ss.current),le(Ja,e),null===es&&(es=e)):is()}function is(){le(ss,ss.current),le(Ja,Ja.current)}function as(e){oe(Ja),es===e&&(es=null),oe(ss)}var ss=se(0);function os(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Qh(n)||Jh(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ls=0,cs=null,us=null,hs=null,ds=!1,ps=!1,fs=!1,ms=0,gs=0,ys=null,_s=0;function vs(){throw Error(E(321))}function xs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!vr(e[n],t[n]))return!1;return!0}function bs(e,t,n,r,i,a){return ls=a,cs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,te.H=null===e||null===e.memoizedState?jo:Fo,fs=!1,a=n(r,i),fs=!1,ps&&(a=Ss(t,n,r,i)),ws(e),a}function ws(e){te.H=No;var t=null!==us&&null!==us.next;if(ls=0,hs=us=cs=null,ds=!1,gs=0,ys=null,t)throw Error(E(300));null===e||el||null!==(e=e.dependencies)&&Ki(e)&&(el=!0)}function Ss(e,t,n,r){cs=e;var i=0;do{if(ps&&(ys=null),gs=0,ps=!1,25<=i)throw Error(E(301));if(i+=1,hs=us=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}te.H=Oo,a=t(n,r)}while(ps);return a}function ks(){var e=te.H,t=e.useState()[0];return t="function"==typeof t.then?Ms(t):t,e=e.useState()[0],(null!==us?us.memoizedState:null)!==e&&(cs.flags|=1024),t}function Ts(){var e=0!==ms;return ms=0,e}function Cs(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Es(e){if(ds){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}ds=!1}ls=0,hs=us=cs=null,ps=!1,gs=ms=0,ys=null}function Is(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===hs?cs.memoizedState=hs=e:hs=hs.next=e,hs}function Ps(){if(null===us){var e=cs.alternate;e=null!==e?e.memoizedState:null}else e=us.next;var t=null===hs?cs.memoizedState:hs.next;if(null!==t)hs=t,us=e;else{if(null===e){if(null===cs.alternate)throw Error(E(467));throw Error(E(310))}e={memoizedState:(us=e).memoizedState,baseState:us.baseState,baseQueue:us.baseQueue,queue:us.queue,next:null},null===hs?cs.memoizedState=hs=e:hs=hs.next=e}return hs}function Ms(e){var t=gs;return gs+=1,null===ys&&(ys=[]),e=Sa(ys,e,t),t=cs,null===(null===hs?t.memoizedState:hs.next)&&(t=t.alternate,te.H=null===t||null===t.memoizedState?jo:Fo),e}function As(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return Ms(e);if(e.$$typeof===U)return Ji(e)}throw Error(E(438,String(e)))}function zs(e){var t=null,n=cs.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=cs.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},cs.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=X;return t.index++,n}function Ds(e,t){return"function"==typeof t?t(e):t}function Rs(e){return Ls(Ps(),us,e)}function Ls(e,t,n){var r=e.queue;if(null===r)throw Error(E(311));r.lastRenderedReducer=n;var i=e.baseQueue,a=r.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}t.baseQueue=i=a,r.pending=null}if(a=e.baseState,null===i)e.memoizedState=a;else{var o=s=null,l=null,c=t=i.next,u=!1;do{var h=-536870913&c.lane;if(h!==c.lane?(jc&h)===h:(ls&h)===h){var d=c.revertLane;if(0===d)null!==l&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),h===ua&&(u=!0);else{if((ls&d)===d){c=c.next,d===ua&&(u=!0);continue}h={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(o=l=h,s=a):l=l.next=h,cs.lanes|=d,Gc|=d}h=c.action,fs&&n(a,h),a=c.hasEagerState?c.eagerState:n(a,h)}else d={lane:h,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(o=l=d,s=a):l=l.next=d,cs.lanes|=h,Gc|=h;c=c.next}while(null!==c&&c!==t);if(null===l?s=a:l.next=o,!vr(a,e.memoizedState)&&(el=!0,u&&null!==(n=ha)))throw n;e.memoizedState=a,e.baseState=s,e.baseQueue=l,r.lastRenderedState=a}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Ns(e){var t=Ps(),n=t.queue;if(null===n)throw Error(E(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);vr(a,t.memoizedState)||(el=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function js(e,t,n){var r=cs,i=Ps(),a=zi;if(a){if(void 0===n)throw Error(E(407));n=n()}else n=t();var s=!vr((us||i).memoizedState,n);if(s&&(i.memoizedState=n,el=!0),i=i.queue,lo(Bs.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==hs&&1&hs.memoizedState.tag){if(r.flags|=2048,ro(9,{destroy:void 0},Os.bind(null,r,i,n,t),null),null===Lc)throw Error(E(349));a||127&ls||Fs(r,t,n)}return n}function Fs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=cs.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},cs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Os(e,t,n,r){t.value=n,t.getSnapshot=r,Vs(t)&&Us(e)}function Bs(e,t,n){return n(function(){Vs(t)&&Us(e)})}function Vs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!vr(e,n)}catch(r){return!0}}function Us(e){var t=ei(e,2);null!==t&&mu(t,e,2)}function qs(e){var t=Is();if("function"==typeof e){var n=e;if(e=n(),fs){Be(!0);try{n()}finally{Be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:e},t}function $s(e,t,n,r){return e.baseState=n,Ls(e,us,"function"==typeof r?r:Ds)}function Gs(e,t,n,r,i){if(Do(e))throw Error(E(485));if(null!==(e=t.action)){var a={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==te.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,Hs(t,a)):(a.next=n.next,t.pending=n.next=a)}}function Hs(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=te.T,s={};te.T=s;try{var o=n(i,r),l=te.S;null!==l&&l(s,o),Zs(e,t,o)}catch(c){Xs(e,t,c)}finally{null!==a&&null!==s.types&&(a.types=s.types),te.T=a}}else try{Zs(e,t,a=n(i,r))}catch(u){Xs(e,t,u)}}function Zs(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Ws(e,t,n)},function(n){return Xs(e,t,n)}):Ws(e,t,n)}function Ws(e,t,n){t.status="fulfilled",t.value=n,Ys(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Hs(e,n)))}function Xs(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Ys(t),t=t.next}while(t!==r)}e.action=null}function Ys(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ks(e,t){return t}function Qs(e,t){if(zi){var n=Lc.formState;if(null!==n){e:{var r=cs;if(zi){if(Ai){t:{for(var i=Ai,a=Ri;8!==i.nodeType;){if(!a){i=null;break t}if(null===(i=ed(i.nextSibling))){i=null;break t}}i="F!"===(a=i.data)||"F"===a?i:null}if(i){Ai=ed(i.nextSibling),r="F!"===i.data;break e}}Ni(r)}r=!1}r&&(t=n[0])}}return(n=Is()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:t},n.queue=r,n=Mo.bind(null,cs,r),r.dispatch=n,r=qs(!1),a=zo.bind(null,cs,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=Is()).queue=i,n=Gs.bind(null,cs,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Js(e){return eo(Ps(),us,e)}function eo(e,t,n){if(t=Ls(e,t,Ks)[0],e=Rs(Ds)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=Ms(t)}catch(s){if(s===_a)throw xa;throw s}else r=t;var i=(t=Ps()).queue,a=i.dispatch;return n!==t.memoizedState&&(cs.flags|=2048,ro(9,{destroy:void 0},to.bind(null,i,n),null)),[r,a,e]}function to(e,t){e.action=t}function no(e){var t=Ps(),n=us;if(null!==n)return eo(t,n,e);Ps(),t=t.memoizedState;var r=(n=Ps()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ro(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=cs.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},cs.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function io(){return Ps().memoizedState}function ao(e,t,n,r){var i=Is();cs.flags|=e,i.memoizedState=ro(1|t,{destroy:void 0},n,void 0===r?null:r)}function so(e,t,n,r){var i=Ps();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==us&&null!==r&&xs(r,us.memoizedState.deps)?i.memoizedState=ro(t,a,n,r):(cs.flags|=e,i.memoizedState=ro(1|t,a,n,r))}function oo(e,t){ao(8390656,8,e,t)}function lo(e,t){so(2048,8,e,t)}function co(e){var t=Ps().memoizedState;return function(e){cs.flags|=4;var t=cs.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},cs.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&Rc)throw Error(E(440));return t.impl.apply(void 0,arguments)}}function uo(e,t){return so(4,2,e,t)}function ho(e,t){return so(4,4,e,t)}function po(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function fo(e,t,n){n=null!=n?n.concat([e]):null,so(4,4,po.bind(null,t,e),n)}function mo(){}function go(e,t){var n=Ps();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&xs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function yo(e,t){var n=Ps();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&xs(t,r[1]))return r[0];if(r=e(),fs){Be(!0);try{e()}finally{Be(!1)}}return n.memoizedState=[r,t],r}function _o(e,t,n){return void 0===n||1073741824&ls&&!(261930&jc)?e.memoizedState=t:(e.memoizedState=n,e=fu(),cs.lanes|=e,Gc|=e,n)}function vo(e,t,n,r){return vr(n,t)?n:null!==Wa.current?(e=_o(e,n,r),vr(e,t)||(el=!0),e):42&ls&&(!(1073741824&ls)||261930&jc)?(e=fu(),cs.lanes|=e,Gc|=e,t):(el=!0,e.memoizedState=n)}function xo(e,t,n,r,i){var a=ne.p;ne.p=0!==a&&8>a?a:8;var s,o,l,c=te.T,u={};te.T=u,zo(e,!1,t,n);try{var h=i(),d=te.S;if(null!==d&&d(u,h),null!==h&&"object"==typeof h&&"function"==typeof h.then)Ao(e,t,(s=r,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},h.then(function(){l.status="fulfilled",l.value=s;for(var e=0;e<o.length;e++)(0,o[e])(s)},function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)}),l),pu());else Ao(e,t,r,pu())}catch(p){Ao(e,t,{then:function(){},status:"rejected",reason:p},pu())}finally{ne.p=a,null!==c&&null!==u.types&&(c.types=u.types),te.T=c}}function bo(){}function wo(e,t,n,r){if(5!==e.tag)throw Error(E(476));var i=So(e).queue;xo(e,i,t,re,null===n?bo:function(){return ko(e),n(r)})}function So(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:re},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ko(e){var t=So(e);null===t.next&&(t=e.alternate.memoizedState),Ao(e,t.next.queue,{},pu())}function To(){return Ji(Ad)}function Co(){return Ps().memoizedState}function Eo(){return Ps().memoizedState}function Io(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=pu(),r=Ba(t,e=Oa(n),n);return null!==r&&(mu(r,t,n),Va(r,t,n)),t={cache:sa()},void(e.payload=t)}t=t.return}}function Po(e,t,n){var r=pu();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Do(e)?Ro(t,n):null!==(n=Jr(e,t,n,r))&&(mu(n,e,r),Lo(n,t,r))}function Mo(e,t,n){Ao(e,t,n,pu())}function Ao(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Do(e))Ro(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,vr(o,s))return Qr(e,t,i,0),null===Lc&&Kr(),!1}catch(l){}if(null!==(n=Jr(e,t,i,r)))return mu(n,e,r),Lo(n,t,r),!0}return!1}function zo(e,t,n,r){if(r={lane:2,revertLane:ch(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Do(e)){if(t)throw Error(E(479))}else null!==(t=Jr(e,n,r,2))&&mu(t,e,2)}function Do(e){var t=e.alternate;return e===cs||null!==t&&t===cs}function Ro(e,t){ps=ds=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Lo(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,tt(e,n)}}var No={readContext:Ji,use:As,useCallback:vs,useContext:vs,useEffect:vs,useImperativeHandle:vs,useLayoutEffect:vs,useInsertionEffect:vs,useMemo:vs,useReducer:vs,useRef:vs,useState:vs,useDebugValue:vs,useDeferredValue:vs,useTransition:vs,useSyncExternalStore:vs,useId:vs,useHostTransitionStatus:vs,useFormState:vs,useActionState:vs,useOptimistic:vs,useMemoCache:vs,useCacheRefresh:vs};No.useEffectEvent=vs;var jo={readContext:Ji,use:As,useCallback:function(e,t){return Is().memoizedState=[e,void 0===t?null:t],e},useContext:Ji,useEffect:oo,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,ao(4194308,4,po.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ao(4194308,4,e,t)},useInsertionEffect:function(e,t){ao(4,2,e,t)},useMemo:function(e,t){var n=Is();t=void 0===t?null:t;var r=e();if(fs){Be(!0);try{e()}finally{Be(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Is();if(void 0!==n){var i=n(t);if(fs){Be(!0);try{n(t)}finally{Be(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Po.bind(null,cs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Is().memoizedState=e},useState:function(e){var t=(e=qs(e)).queue,n=Mo.bind(null,cs,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:mo,useDeferredValue:function(e,t){return _o(Is(),e,t)},useTransition:function(){var e=qs(!1);return e=xo.bind(null,cs,e.queue,!0,!1),Is().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=cs,i=Is();if(zi){if(void 0===n)throw Error(E(407));n=n()}else{if(n=t(),null===Lc)throw Error(E(349));127&jc||Fs(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,oo(Bs.bind(null,r,a,e),[e]),r.flags|=2048,ro(9,{destroy:void 0},Os.bind(null,r,a,n,t),null),n},useId:function(){var e=Is(),t=Lc.identifierPrefix;if(zi){var n=ki;t="_"+t+"R_"+(n=(Si&~(1<<32-Ve(Si)-1)).toString(32)+n),0<(n=ms++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=_s++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:To,useFormState:Qs,useActionState:Qs,useOptimistic:function(e){var t=Is();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=zo.bind(null,cs,!0,n),n.dispatch=t,[e,t]},useMemoCache:zs,useCacheRefresh:function(){return Is().memoizedState=Io.bind(null,cs)},useEffectEvent:function(e){var t=Is(),n={impl:e};return t.memoizedState=n,function(){if(2&Rc)throw Error(E(440));return n.impl.apply(void 0,arguments)}}},Fo={readContext:Ji,use:As,useCallback:go,useContext:Ji,useEffect:lo,useImperativeHandle:fo,useInsertionEffect:uo,useLayoutEffect:ho,useMemo:yo,useReducer:Rs,useRef:io,useState:function(){return Rs(Ds)},useDebugValue:mo,useDeferredValue:function(e,t){return vo(Ps(),us.memoizedState,e,t)},useTransition:function(){var e=Rs(Ds)[0],t=Ps().memoizedState;return["boolean"==typeof e?e:Ms(e),t]},useSyncExternalStore:js,useId:Co,useHostTransitionStatus:To,useFormState:Js,useActionState:Js,useOptimistic:function(e,t){return $s(Ps(),0,e,t)},useMemoCache:zs,useCacheRefresh:Eo};Fo.useEffectEvent=co;var Oo={readContext:Ji,use:As,useCallback:go,useContext:Ji,useEffect:lo,useImperativeHandle:fo,useInsertionEffect:uo,useLayoutEffect:ho,useMemo:yo,useReducer:Ns,useRef:io,useState:function(){return Ns(Ds)},useDebugValue:mo,useDeferredValue:function(e,t){var n=Ps();return null===us?_o(n,e,t):vo(n,us.memoizedState,e,t)},useTransition:function(){var e=Ns(Ds)[0],t=Ps().memoizedState;return["boolean"==typeof e?e:Ms(e),t]},useSyncExternalStore:js,useId:Co,useHostTransitionStatus:To,useFormState:no,useActionState:no,useOptimistic:function(e,t){var n=Ps();return null!==us?$s(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:zs,useCacheRefresh:Eo};function Bo(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:R({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}Oo.useEffectEvent=co;var Vo={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=pu(),i=Oa(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=Ba(e,i,r))&&(mu(t,e,r),Va(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=pu(),i=Oa(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=Ba(e,i,r))&&(mu(t,e,r),Va(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=pu(),r=Oa(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Ba(e,r,n))&&(mu(t,e,n),Va(t,e,n))}};function Uo(e,t,n,r,i,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!xr(n,r)||!xr(i,a))}function qo(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Vo.enqueueReplaceState(t,t.state,null)}function $o(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=R({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}function Go(e){Zr(e)}function Ho(e){}function Zo(e){Zr(e)}function Wo(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Xo(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Yo(e,t,n){return(n=Oa(n)).tag=3,n.payload={element:null},n.callback=function(){Wo(e,t)},n}function Ko(e){return(e=Oa(e)).tag=3,e}function Qo(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){Xo(t,n,r)}}var s=n.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){Xo(t,n,r),"function"!=typeof i&&(null===ru?ru=new Set([this]):ru.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Jo=Error(E(461)),el=!1;function tl(e,t,n,r){t.child=null===e?La(t,null,n,r):Ra(t,e.child,n,r)}function nl(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var s={};for(var o in r)"ref"!==o&&(s[o]=r[o])}else s=r;return Qi(t),r=bs(e,t,n,s,a,i),o=Ts(),null===e||el?(zi&&o&&Ei(t),t.flags|=1,tl(e,t,r,i),t.child):(Cs(e,t,i),Tl(e,t,i))}function rl(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||si(a)||void 0!==a.defaultProps||null!==n.compare?((e=ci(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,il(e,t,a,r,i))}if(a=e.child,!Cl(e,i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:xr)(s,r)&&e.ref===t.ref)return Tl(e,t,i)}return t.flags|=1,(e=oi(a,r)).ref=t.ref,e.return=t,t.child=e}function il(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(xr(a,r)&&e.ref===t.ref){if(el=!1,t.pendingProps=r=a,!Cl(e,i))return t.lanes=e.lanes,Tl(e,t,i);131072&e.flags&&(el=!0)}}return hl(e,t,n,r,i)}function al(e,t,n,r){var i=r.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(128&t.flags){if(a=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~a}else r=0,t.child=null;return ol(e,t,a,n,r)}if(!(536870912&n))return r=t.lanes=536870912,ol(e,t,null!==a?a.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&ga(0,null!==a?a.cachePool:null),null!==a?Ya(t,a):Ka(),rs(t)}else null!==a?(ga(0,a.cachePool),Ya(t,a),is(),t.memoizedState=null):(null!==e&&ga(0,null),Ka(),is());return tl(e,t,i,n),t.child}function sl(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function ol(e,t,n,r,i){var a=ma();return a=null===a?null:{parent:aa._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&ga(0,null),Ka(),rs(t),null!==e&&Yi(e,t,r,!0),t.childLanes=i,null}function ll(e,t){return(t=xl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function cl(e,t,n){return Ra(t,e.child,null,n),(e=ll(t,t.pendingProps)).flags|=2,as(t),t.memoizedState=null,e}function ul(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(E(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function hl(e,t,n,r,i){return Qi(t),n=bs(e,t,n,r,void 0,i),r=Ts(),null===e||el?(zi&&r&&Ei(t),t.flags|=1,tl(e,t,n,i),t.child):(Cs(e,t,i),Tl(e,t,i))}function dl(e,t,n,r,i,a){return Qi(t),t.updateQueue=null,n=Ss(t,r,n,i),ws(e),r=Ts(),null===e||el?(zi&&r&&Ei(t),t.flags|=1,tl(e,t,n,a),t.child):(Cs(e,t,a),Tl(e,t,a))}function pl(e,t,n,r,i){if(Qi(t),null===t.stateNode){var a=ri,s=n.contextType;"object"==typeof s&&null!==s&&(a=Ji(s)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=Vo,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},ja(t),s=n.contextType,a.context="object"==typeof s&&null!==s?Ji(s):ri,a.state=t.memoizedState,"function"==typeof(s=n.getDerivedStateFromProps)&&(Bo(t,n,s,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(s=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),s!==a.state&&Vo.enqueueReplaceState(a,a.state,null),Ga(t,r,a,i),$a(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var o=t.memoizedProps,l=$o(n,o);a.props=l;var c=a.context,u=n.contextType;s=ri,"object"==typeof u&&null!==u&&(s=Ji(u));var h=n.getDerivedStateFromProps;u="function"==typeof h||"function"==typeof a.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o||c!==s)&&qo(t,a,r,s),Na=!1;var d=t.memoizedState;a.state=d,Ga(t,r,a,i),$a(),c=t.memoizedState,o||d!==c||Na?("function"==typeof h&&(Bo(t,n,h,r),c=t.memoizedState),(l=Na||Uo(t,n,l,r,d,c,s))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=s,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Fa(e,t),u=$o(n,s=t.memoizedProps),a.props=u,h=t.pendingProps,d=a.context,c=n.contextType,l=ri,"object"==typeof c&&null!==c&&(l=Ji(c)),(c="function"==typeof(o=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==h||d!==l)&&qo(t,a,r,l),Na=!1,d=t.memoizedState,a.state=d,Ga(t,r,a,i),$a();var p=t.memoizedState;s!==h||d!==p||Na||null!==e&&null!==e.dependencies&&Ki(e.dependencies)?("function"==typeof o&&(Bo(t,n,o,r),p=t.memoizedState),(u=Na||Uo(t,n,u,r,d,p,l)||null!==e&&null!==e.dependencies&&Ki(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,ul(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=Ra(t,e.child,null,i),t.child=Ra(t,null,n,i)):tl(e,t,n,i),t.memoizedState=a.state,e=t.child):e=Tl(e,t,i),e}function fl(e,t,n,r){return Bi(),t.flags|=256,tl(e,t,n,r),t.child}var ml={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function gl(e){return{baseLanes:e,cachePool:ya()}}function yl(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Wc),e}function _l(e,t,n){var r,i=t.pendingProps,a=!1,s=!!(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&!!(2&ss.current)),r&&(a=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(zi){if(a?ts(t):is(),(e=Ai)?null!==(e=null!==(e=Kh(e,Ri))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==wi?{id:Si,overflow:ki}:null,retryLane:536870912,hydrationErrors:null},(n=di(e)).return=t,t.child=n,Mi=t,Ai=null):e=null,null===e)throw Ni(t);return Jh(e)?t.lanes=32:t.lanes=536870912,null}var o=i.children;return i=i.fallback,a?(is(),o=xl({mode:"hidden",children:o},a=t.mode),i=ui(i,a,n,null),o.return=t,i.return=t,o.sibling=i,t.child=o,(i=t.child).memoizedState=gl(n),i.childLanes=yl(e,r,n),t.memoizedState=ml,sl(null,i)):(ts(t),vl(t,o))}var l=e.memoizedState;if(null!==l&&null!==(o=l.dehydrated)){if(s)256&t.flags?(ts(t),t.flags&=-257,t=bl(e,t,n)):null!==t.memoizedState?(is(),t.child=e.child,t.flags|=128,t=null):(is(),o=i.fallback,a=t.mode,i=xl({mode:"visible",children:i.children},a),(o=ui(o,a,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,Ra(t,e.child,null,n),(i=t.child).memoizedState=gl(n),i.childLanes=yl(e,r,n),t.memoizedState=ml,t=sl(null,i));else if(ts(t),Jh(o)){if(r=o.nextSibling&&o.nextSibling.dataset)var c=r.dgst;r=c,(i=Error(E(419))).stack="",i.digest=r,Ui({value:i,source:null,stack:null}),t=bl(e,t,n)}else if(el||Yi(e,t,n,!1),r=0!==(n&e.childLanes),el||r){if(null!==(r=Lc)&&(0!==(i=nt(r,n))&&i!==l.retryLane))throw l.retryLane=i,ei(e,i),mu(r,e,i),Jo;Qh(o)||Eu(),t=bl(e,t,n)}else Qh(o)?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,Ai=ed(o.nextSibling),Mi=t,zi=!0,Di=null,Ri=!1,null!==e&&Pi(t,e),(t=vl(t,i.children)).flags|=4096);return t}return a?(is(),o=i.fallback,a=t.mode,c=(l=e.child).sibling,(i=oi(l,{mode:"hidden",children:i.children})).subtreeFlags=65011712&l.subtreeFlags,null!==c?o=oi(c,o):(o=ui(o,a,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,sl(null,i),i=t.child,null===(o=e.child.memoizedState)?o=gl(n):(null!==(a=o.cachePool)?(l=aa._currentValue,a=a.parent!==l?{parent:l,pool:l}:a):a=ya(),o={baseLanes:o.baseLanes|n,cachePool:a}),i.memoizedState=o,i.childLanes=yl(e,r,n),t.memoizedState=ml,sl(e.child,i)):(ts(t),e=(n=e.child).sibling,(n=oi(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function vl(e,t){return(t=xl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function xl(e,t){return(e=ai(22,e,null,t)).lanes=0,e}function bl(e,t,n){return Ra(t,e.child,null,n),(e=vl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function wl(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Wi(e.return,t,n)}function Sl(e,t,n,r,i,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.treeForkCount=a)}function kl(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;r=r.children;var s=ss.current,o=!!(2&s);if(o?(s=1&s|2,t.flags|=128):s&=1,le(ss,s),tl(e,t,r,n),r=zi?vi:0,!o&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&wl(e,n,t);else if(19===e.tag)wl(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===os(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Sl(t,!1,i,n,a,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===os(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Sl(t,!0,n,null,a,r);break;case"together":Sl(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function Tl(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Gc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Yi(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(E(153));if(null!==t.child){for(n=oi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=oi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Cl(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ki(e))}function El(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)el=!0;else{if(!(Cl(e,n)||128&t.flags))return el=!1,function(e,t,n){switch(t.tag){case 3:me(t,t.stateNode.containerInfo),Hi(0,aa,e.memoizedState.cache),Bi();break;case 27:case 5:ye(t);break;case 4:me(t,t.stateNode.containerInfo);break;case 10:Hi(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,ns(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ts(t),t.flags|=128,null):0!==(n&t.child.childLanes)?_l(e,t,n):(ts(t),null!==(e=Tl(e,t,n))?e.sibling:null);ts(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(Yi(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return kl(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),le(ss,ss.current),r)break;return null;case 22:return t.lanes=0,al(e,t,n,t.pendingProps);case 24:Hi(0,aa,e.memoizedState.cache)}return Tl(e,t,n)}(e,t,n);el=!!(131072&e.flags)}else el=!1,zi&&1048576&t.flags&&Ci(t,vi,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=ka(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var i=e.$$typeof;if(i===q){t.tag=11,t=nl(null,t,e,r,n);break e}if(i===H){t.tag=14,t=rl(null,t,e,r,n);break e}}throw t=J(e)||e,Error(E(306,t,""))}si(e)?(r=$o(e,r),t.tag=1,t=pl(null,t,e,r,n)):(t.tag=0,t=hl(null,t,e,r,n))}return t;case 0:return hl(e,t,t.type,t.pendingProps,n);case 1:return pl(e,t,r=t.type,i=$o(r,t.pendingProps),n);case 3:e:{if(me(t,t.stateNode.containerInfo),null===e)throw Error(E(387));r=t.pendingProps;var a=t.memoizedState;i=a.element,Fa(e,t),Ga(t,r,null,n);var s=t.memoizedState;if(r=s.cache,Hi(0,aa,r),r!==a.cache&&Xi(t,[aa],n,!0),$a(),r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=fl(e,t,r,n);break e}if(r!==i){Ui(i=mi(Error(E(424)),t)),t=fl(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(Ai=ed(e.firstChild),Mi=t,zi=!0,Di=null,Ri=!0,n=La(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Bi(),r===i){t=Tl(e,t,n);break e}tl(e,t,r,n)}t=t.child}return t;case 26:return ul(e,t),null===e?(n=dd(t.type,null,t.pendingProps,null))?t.memoizedState=n:zi||(n=t.type,e=t.pendingProps,(r=jh(pe.current).createElement(n))[lt]=t,r[ct]=e,Dh(r,n,e),bt(r),t.stateNode=r):t.memoizedState=dd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return ye(t),null===e&&zi&&(r=t.stateNode=id(t.type,t.pendingProps,pe.current),Mi=t,Ri=!0,i=Ai,Zh(t.type)?(td=i,Ai=ed(r.firstChild)):Ai=i),tl(e,t,t.pendingProps.children,n),ul(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&zi&&((i=r=Ai)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[mt])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===a)return e}if(null===(e=ed(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,Ri))?(t.stateNode=r,Mi=t,Ai=ed(r.firstChild),Ri=!1,i=!0):i=!1),i||Ni(t)),ye(t),i=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,r=a.children,Bh(i,a)?r=null:null!==s&&Bh(i,s)&&(t.flags|=32),null!==t.memoizedState&&(i=bs(e,t,ks,null,null,n),Ad._currentValue=i),ul(e,t),tl(e,t,r,n),t.child;case 6:return null===e&&zi&&((e=n=Ai)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=ed(e.nextSibling)))return null}return e}(n,t.pendingProps,Ri))?(t.stateNode=n,Mi=t,Ai=null,e=!0):e=!1),e||Ni(t)),null;case 13:return _l(e,t,n);case 4:return me(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ra(t,null,r,n):tl(e,t,r,n),t.child;case 11:return nl(e,t,t.type,t.pendingProps,n);case 7:return tl(e,t,t.pendingProps,n),t.child;case 8:case 12:return tl(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Hi(0,t.type,r.value),tl(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,Qi(t),r=r(i=Ji(i)),t.flags|=1,tl(e,t,r,n),t.child;case 14:return rl(e,t,t.type,t.pendingProps,n);case 15:return il(e,t,t.type,t.pendingProps,n);case 19:return kl(e,t,n);case 31:return function(e,t,n){var r=t.pendingProps,i=!!(128&t.flags);if(t.flags&=-129,null===e){if(zi){if("hidden"===r.mode)return e=ll(t,r),t.lanes=536870912,sl(null,e);if(ns(t),(e=Ai)?null!==(e=null!==(e=Kh(e,Ri))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==wi?{id:Si,overflow:ki}:null,retryLane:536870912,hydrationErrors:null},(n=di(e)).return=t,t.child=n,Mi=t,Ai=null):e=null,null===e)throw Ni(t);return t.lanes=536870912,null}return ll(t,r)}var a=e.memoizedState;if(null!==a){var s=a.dehydrated;if(ns(t),i)if(256&t.flags)t.flags&=-257,t=cl(e,t,n);else{if(null===t.memoizedState)throw Error(E(558));t.child=e.child,t.flags|=128,t=null}else if(el||Yi(e,t,n,!1),i=0!==(n&e.childLanes),el||i){if(null!==(r=Lc)&&0!==(s=nt(r,n))&&s!==a.retryLane)throw a.retryLane=s,ei(e,s),mu(r,e,s),Jo;Eu(),t=cl(e,t,n)}else e=a.treeContext,Ai=ed(s.nextSibling),Mi=t,zi=!0,Di=null,Ri=!1,null!==e&&Pi(t,e),(t=ll(t,r)).flags|=4096;return t}return(e=oi(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return al(e,t,n,t.pendingProps);case 24:return Qi(t),r=Ji(aa),null===e?(null===(i=ma())&&(i=Lc,a=sa(),i.pooledCache=a,a.refCount++,null!==a&&(i.pooledCacheLanes|=n),i=a),t.memoizedState={parent:r,cache:i},ja(t),Hi(0,aa,i)):(0!==(e.lanes&n)&&(Fa(e,t),Ga(t,null,null,n),$a()),i=e.memoizedState,a=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),Hi(0,aa,r)):(r=a.cache,Hi(0,aa,r),r!==i.cache&&Xi(t,[aa],n,!0))),tl(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(E(156,t.tag))}function Il(e){e.flags|=4}function Pl(e,t,n,r,i){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&i)===i)if(e.stateNode.complete)e.flags|=8192;else{if(!ku())throw Ta=ba,va;e.flags|=8192}}else e.flags&=-16777217}function Ml(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!Td(t)){if(!ku())throw Ta=ba,va;e.flags|=8192}}function Al(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ke():536870912,e.lanes|=t,Xc|=t)}function zl(e,t){if(!zi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Dl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Rl(e,t,n){var r=t.pendingProps;switch(Ii(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Dl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Zi(aa),ge(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Oi(t)?Il(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Vi())),Dl(t),null;case 26:var i=t.type,a=t.memoizedState;return null===e?(Il(t),null!==a?(Dl(t),Ml(t,a)):(Dl(t),Pl(t,i,0,0,n))):a?a!==e.memoizedState?(Il(t),Dl(t),Ml(t,a)):(Dl(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&Il(t),Dl(t),Pl(t,i,0,0,n)),null;case 27:if(_e(t),n=pe.current,i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Il(t);else{if(!r){if(null===t.stateNode)throw Error(E(166));return Dl(t),null}e=he.current,Oi(t)?ji(t):(e=id(i,r,n),t.stateNode=e,Il(t))}return Dl(t),null;case 5:if(_e(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Il(t);else{if(!r){if(null===t.stateNode)throw Error(E(166));return Dl(t),null}if(a=he.current,Oi(t))ji(t);else{var s=jh(pe.current);switch(a){case 1:a=s.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:a=s.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":a=s.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":a=s.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(a=s.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a="string"==typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?a.multiple=!0:r.size&&(a.size=r.size);break;default:a="string"==typeof r.is?s.createElement(i,{is:r.is}):s.createElement(i)}}a[lt]=t,a[ct]=r;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)a.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=a;e:switch(Dh(a,i,r),i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Il(t)}}return Dl(t),Pl(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Il(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(E(166));if(e=pe.current,Oi(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=Mi))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[lt]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Mh(e.nodeValue,n)))||Ni(t,!0)}else(e=jh(e).createTextNode(r))[lt]=t,t.stateNode=e}return Dl(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=Oi(t),null!==n){if(null===e){if(!r)throw Error(E(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(E(557));e[lt]=t}else Bi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Dl(t),e=!1}else n=Vi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(as(t),t):(as(t),null);if(128&t.flags)throw Error(E(558))}return Dl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=Oi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(E(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(E(317));i[lt]=t}else Bi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Dl(t),i=!1}else i=Vi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(as(t),t):(as(t),null)}return as(t),128&t.flags?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool),a=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==i&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),Al(t,t.updateQueue),Dl(t),null);case 4:return ge(),null===e&&xh(t.stateNode.containerInfo),Dl(t),null;case 10:return Zi(t.type),Dl(t),null;case 19:if(oe(ss),null===(r=t.memoizedState))return Dl(t),null;if(i=!!(128&t.flags),null===(a=r.rendering))if(i)zl(r,!1);else{if(0!==$c||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(a=os(e))){for(t.flags|=128,zl(r,!1),e=a.updateQueue,t.updateQueue=e,Al(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)li(n,e),n=n.sibling;return le(ss,1&ss.current|2),zi&&Ti(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&Pe()>tu&&(t.flags|=128,i=!0,zl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=os(a))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,Al(t,e),zl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!zi)return Dl(t),null}else 2*Pe()-r.renderingStartTime>tu&&536870912!==n&&(t.flags|=128,i=!0,zl(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Pe(),e.sibling=null,n=ss.current,le(ss,i?1&n|2:1&n),zi&&Ti(t,r.treeForkCount),e):(Dl(t),null);case 22:case 23:return as(t),Qa(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(Dl(t),6&t.subtreeFlags&&(t.flags|=8192)):Dl(t),null!==(n=t.updateQueue)&&Al(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&oe(fa),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Zi(aa),Dl(t),null;case 25:case 30:return null}throw Error(E(156,t.tag))}function Ll(e,t){switch(Ii(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Zi(aa),ge(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return _e(t),null;case 31:if(null!==t.memoizedState){if(as(t),null===t.alternate)throw Error(E(340));Bi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(as(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(E(340));Bi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return oe(ss),null;case 4:return ge(),null;case 10:return Zi(t.type),null;case 22:case 23:return as(t),Qa(),null!==e&&oe(fa),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Zi(aa),null;default:return null}}function Nl(e,t){switch(Ii(t),t.tag){case 3:Zi(aa),ge();break;case 26:case 27:case 5:_e(t);break;case 4:ge();break;case 31:null!==t.memoizedState&&as(t);break;case 13:as(t);break;case 19:oe(ss);break;case 10:Zi(t.type);break;case 22:case 23:as(t),Qa(),null!==e&&oe(fa);break;case 24:Zi(aa)}}function jl(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,s=n.inst;r=a(),s.destroy=r}n=n.next}while(n!==i)}}catch(o){$u(t,t.return,o)}}function Fl(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var s=r.inst,o=s.destroy;if(void 0!==o){s.destroy=void 0,i=t;var l=n,c=o;try{c()}catch(u){$u(i,l,u)}}}r=r.next}while(r!==a)}}catch(u){$u(t,t.return,u)}}function Ol(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Za(t,n)}catch(r){$u(e,e.return,r)}}}function Bl(e,t,n){n.props=$o(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){$u(e,t,r)}}function Vl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(i){$u(e,t,i)}}function Ul(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(i){$u(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(a){$u(e,t,a)}else n.current=null}function ql(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){$u(e,e.return,i)}}function $l(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,a=null,s=null,o=null,l=null,c=null,u=null;for(p in n){var h=n[p];if(n.hasOwnProperty(p)&&null!=h)switch(p){case"checked":case"value":break;case"defaultValue":l=h;default:r.hasOwnProperty(p)||Ah(e,t,p,null,r,h)}}for(var d in r){var p=r[d];if(h=n[d],r.hasOwnProperty(d)&&(null!=p||null!=h))switch(d){case"type":a=p;break;case"name":i=p;break;case"checked":c=p;break;case"defaultChecked":u=p;break;case"value":s=p;break;case"defaultValue":o=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(E(137,t));break;default:p!==h&&Ah(e,t,d,p,r,h)}}return void Ot(e,s,o,l,c,u,a,i);case"select":for(a in p=s=o=d=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":p=l;default:r.hasOwnProperty(a)||Ah(e,t,a,null,r,l)}for(i in r)if(a=r[i],l=n[i],r.hasOwnProperty(i)&&(null!=a||null!=l))switch(i){case"value":d=a;break;case"defaultValue":o=a;break;case"multiple":s=a;default:a!==l&&Ah(e,t,i,a,r,l)}return t=o,n=s,r=p,void(null!=d?Ut(e,!!n,d,!1):!!r!=!!n&&(null!=t?Ut(e,!!n,t,!0):Ut(e,!!n,n?[]:"",!1)));case"textarea":for(o in p=d=null,n)if(i=n[o],n.hasOwnProperty(o)&&null!=i&&!r.hasOwnProperty(o))switch(o){case"value":case"children":break;default:Ah(e,t,o,null,r,i)}for(s in r)if(i=r[s],a=n[s],r.hasOwnProperty(s)&&(null!=i||null!=a))switch(s){case"value":d=i;break;case"defaultValue":p=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(E(91));break;default:i!==a&&Ah(e,t,s,i,r,a)}return void qt(e,d,p);case"option":for(var f in n)if(d=n[f],n.hasOwnProperty(f)&&null!=d&&!r.hasOwnProperty(f))if("selected"===f)e.selected=!1;else Ah(e,t,f,null,r,d);for(l in r)if(d=r[l],p=n[l],r.hasOwnProperty(l)&&d!==p&&(null!=d||null!=p))if("selected"===l)e.selected=d&&"function"!=typeof d&&"symbol"!=typeof d;else Ah(e,t,l,d,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)d=n[m],n.hasOwnProperty(m)&&null!=d&&!r.hasOwnProperty(m)&&Ah(e,t,m,null,r,d);for(c in r)if(d=r[c],p=n[c],r.hasOwnProperty(c)&&d!==p&&(null!=d||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(E(137,t));break;default:Ah(e,t,c,d,r,p)}return;default:if(Xt(t)){for(var g in n)d=n[g],n.hasOwnProperty(g)&&void 0!==d&&!r.hasOwnProperty(g)&&zh(e,t,g,void 0,r,d);for(u in r)d=r[u],p=n[u],!r.hasOwnProperty(u)||d===p||void 0===d&&void 0===p||zh(e,t,u,d,r,p);return}}for(var y in n)d=n[y],n.hasOwnProperty(y)&&null!=d&&!r.hasOwnProperty(y)&&Ah(e,t,y,null,r,d);for(h in r)d=r[h],p=n[h],!r.hasOwnProperty(h)||d===p||null==d&&null==p||Ah(e,t,h,d,r,p)}(r,e.type,n,t),r[ct]=t}catch(i){$u(e,e.return,i)}}function Gl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Zh(e.type)||4===e.tag}function Hl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Gl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Zh(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Zl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Jt));else if(4!==r&&(27===r&&Zh(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Zl(e,t,n),e=e.sibling;null!==e;)Zl(e,t,n),e=e.sibling}function Wl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&Zh(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Wl(e,t,n),e=e.sibling;null!==e;)Wl(e,t,n),e=e.sibling}function Xl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);Dh(t,r,n),t[lt]=e,t[ct]=n}catch(a){$u(e,e.return,a)}}var Yl=!1,Kl=!1,Ql=!1,Jl="function"==typeof WeakSet?WeakSet:Set,ec=null;function tc(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:mc(e,n),4&r&&jl(5,n);break;case 1:if(mc(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){$u(n,n.return,s)}else{var i=$o(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){$u(n,n.return,o)}}64&r&&Ol(n),512&r&&Vl(n,n.return);break;case 3:if(mc(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Za(e,t)}catch(s){$u(n,n.return,s)}}break;case 27:null===t&&4&r&&Xl(n);case 26:case 5:mc(e,n),null===t&&4&r&&ql(n),512&r&&Vl(n,n.return);break;case 12:mc(e,n);break;case 31:mc(e,n),4&r&&oc(e,n);break;case 13:mc(e,n),4&r&&lc(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Wu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||Yl)){t=null!==t&&null!==t.memoizedState||Kl,i=Yl;var a=Kl;Yl=r,(Kl=t)&&!a?yc(e,n,!!(8772&n.subtreeFlags)):mc(e,n),Yl=i,Kl=a}break;case 30:break;default:mc(e,n)}}function nc(e){var t=e.alternate;null!==t&&(e.alternate=null,nc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&gt(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var rc=null,ic=!1;function ac(e,t,n){for(n=n.child;null!==n;)sc(e,t,n),n=n.sibling}function sc(e,t,n){if(Oe&&"function"==typeof Oe.onCommitFiberUnmount)try{Oe.onCommitFiberUnmount(Fe,n)}catch(a){}switch(n.tag){case 26:Kl||Ul(n,t),ac(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Kl||Ul(n,t);var r=rc,i=ic;Zh(n.type)&&(rc=n.stateNode,ic=!1),ac(e,t,n),ad(n.stateNode),rc=r,ic=i;break;case 5:Kl||Ul(n,t);case 6:if(r=rc,i=ic,rc=null,ac(e,t,n),ic=i,null!==(rc=r))if(ic)try{(9===rc.nodeType?rc.body:"HTML"===rc.nodeName?rc.ownerDocument.body:rc).removeChild(n.stateNode)}catch(s){$u(n,t,s)}else try{rc.removeChild(n.stateNode)}catch(s){$u(n,t,s)}break;case 18:null!==rc&&(ic?(Wh(9===(e=rc).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),hp(e)):Wh(rc,n.stateNode));break;case 4:r=rc,i=ic,rc=n.stateNode.containerInfo,ic=!0,ac(e,t,n),rc=r,ic=i;break;case 0:case 11:case 14:case 15:Fl(2,n,t),Kl||Fl(4,n,t),ac(e,t,n);break;case 1:Kl||(Ul(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&Bl(n,t,r)),ac(e,t,n);break;case 21:ac(e,t,n);break;case 22:Kl=(r=Kl)||null!==n.memoizedState,ac(e,t,n),Kl=r;break;default:ac(e,t,n)}}function oc(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{hp(e)}catch(n){$u(t,t.return,n)}}}function lc(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{hp(e)}catch(n){$u(t,t.return,n)}}function cc(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Jl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Jl),t;default:throw Error(E(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Xu.bind(null,e,t);t.then(r,r)}})}function uc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],a=e,s=t,o=s;e:for(;null!==o;){switch(o.tag){case 27:if(Zh(o.type)){rc=o.stateNode,ic=!1;break e}break;case 5:rc=o.stateNode,ic=!1;break e;case 3:case 4:rc=o.stateNode.containerInfo,ic=!0;break e}o=o.return}if(null===rc)throw Error(E(160));sc(a,s,i),rc=null,ic=!1,null!==(a=i.alternate)&&(a.return=null),i.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)dc(t,e),t=t.sibling}var hc=null;function dc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:uc(t,e),pc(e),4&r&&(Fl(3,e,e.return),jl(3,e),Fl(5,e,e.return));break;case 1:uc(t,e),pc(e),512&r&&(Kl||null===n||Ul(n,n.return)),64&r&&Yl&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var i=hc;if(uc(t,e),pc(e),512&r&&(Kl||null===n||Ul(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(a=i.getElementsByTagName("title")[0])||a[mt]||a[lt]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=i.createElement(r),i.head.insertBefore(a,i.querySelector("head > title"))),Dh(a,r,n),a[lt]=e,bt(a),r=a;break e;case"link":var s=Sd("link","href",i).get(r+(n.href||""));if(s)for(var o=0;o<s.length;o++)if((a=s[o]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(o,1);break t}Dh(a=i.createElement(r),r,n),i.head.appendChild(a);break;case"meta":if(s=Sd("meta","content",i).get(r+(n.content||"")))for(o=0;o<s.length;o++)if((a=s[o]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(o,1);break t}Dh(a=i.createElement(r),r,n),i.head.appendChild(a);break;default:throw Error(E(468,r))}a[lt]=e,bt(a),r=a}e.stateNode=r}else kd(i,e.type,e.stateNode);else e.stateNode=_d(i,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?kd(i,e.type,e.stateNode):_d(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&$l(e,e.memoizedProps,n.memoizedProps)}break;case 27:uc(t,e),pc(e),512&r&&(Kl||null===n||Ul(n,n.return)),null!==n&&4&r&&$l(e,e.memoizedProps,n.memoizedProps);break;case 5:if(uc(t,e),pc(e),512&r&&(Kl||null===n||Ul(n,n.return)),32&e.flags){i=e.stateNode;try{Gt(i,"")}catch(f){$u(e,e.return,f)}}4&r&&null!=e.stateNode&&$l(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(Ql=!0);break;case 6:if(uc(t,e),pc(e),4&r){if(null===e.stateNode)throw Error(E(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(f){$u(e,e.return,f)}}break;case 3:if(wd=null,i=hc,hc=ld(t.containerInfo),uc(t,e),hc=i,pc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{hp(t.containerInfo)}catch(f){$u(e,e.return,f)}Ql&&(Ql=!1,fc(e));break;case 4:r=hc,hc=ld(e.stateNode.containerInfo),uc(t,e),pc(e),hc=r;break;case 12:default:uc(t,e),pc(e);break;case 31:case 19:uc(t,e),pc(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,cc(e,r)));break;case 13:uc(t,e),pc(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Jc=Pe()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,cc(e,r)));break;case 22:i=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,c=Yl,u=Kl;if(Yl=c||i,Kl=u||l,uc(t,e),Kl=u,Yl=c,pc(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||l||Yl||Kl||gc(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,i)"function"==typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{o=l.stateNode;var h=l.memoizedProps.style,d=null!=h&&h.hasOwnProperty("display")?h.display:null;o.style.display=null==d||"boolean"==typeof d?"":(""+d).trim()}}catch(f){$u(l,l.return,f)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=i?"":l.memoizedProps}catch(f){$u(l,l.return,f)}}}else if(18===t.tag){if(null===n){l=t;try{var p=l.stateNode;i?Xh(p,!0):Xh(l.stateNode,!1)}catch(f){$u(l,l.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,cc(e,n))));case 30:case 21:}}function pc(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(Gl(r)){n=r;break}r=r.return}if(null==n)throw Error(E(160));switch(n.tag){case 27:var i=n.stateNode;Wl(e,Hl(e),i);break;case 5:var a=n.stateNode;32&n.flags&&(Gt(a,""),n.flags&=-33),Wl(e,Hl(e),a);break;case 3:case 4:var s=n.stateNode.containerInfo;Zl(e,Hl(e),s);break;default:throw Error(E(161))}}catch(o){$u(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function fc(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;fc(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function mc(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)tc(e,t.alternate,t),t=t.sibling}function gc(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Fl(4,t,t.return),gc(t);break;case 1:Ul(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&Bl(t,t.return,n),gc(t);break;case 27:ad(t.stateNode);case 26:case 5:Ul(t,t.return),gc(t);break;case 22:null===t.memoizedState&&gc(t);break;default:gc(t)}e=e.sibling}}function yc(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,s=a.flags;switch(a.tag){case 0:case 11:case 15:yc(i,a,n),jl(4,a);break;case 1:if(yc(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){$u(r,r.return,c)}if(null!==(i=(r=a).updateQueue)){var o=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)Ha(l[i],o)}catch(c){$u(r,r.return,c)}}n&&64&s&&Ol(a),Vl(a,a.return);break;case 27:Xl(a);case 26:case 5:yc(i,a,n),n&&null===r&&4&s&&ql(a),Vl(a,a.return);break;case 12:yc(i,a,n);break;case 31:yc(i,a,n),n&&4&s&&oc(i,a);break;case 13:yc(i,a,n),n&&4&s&&lc(i,a);break;case 22:null===a.memoizedState&&yc(i,a,n),Vl(a,a.return);break;case 30:break;default:yc(i,a,n)}t=t.sibling}}function _c(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&oa(n))}function vc(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&oa(e))}function xc(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)bc(e,t,n,r),t=t.sibling}function bc(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:xc(e,t,n,r),2048&i&&jl(9,t);break;case 1:case 31:case 13:default:xc(e,t,n,r);break;case 3:xc(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&oa(e)));break;case 12:if(2048&i){xc(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,s=a.id,o=a.onPostCommit;"function"==typeof o&&o(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){$u(t,t.return,l)}}else xc(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,s=t.alternate,null!==t.memoizedState?2&a._visibility?xc(e,t,n,r):Sc(e,t):2&a._visibility?xc(e,t,n,r):(a._visibility|=2,wc(e,t,n,r,!!(10256&t.subtreeFlags)||!1)),2048&i&&_c(s,t);break;case 24:xc(e,t,n,r),2048&i&&vc(t.alternate,t)}}function wc(e,t,n,r,i){for(i=i&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,s=t,o=n,l=r,c=s.flags;switch(s.tag){case 0:case 11:case 15:wc(a,s,o,l,i),jl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?wc(a,s,o,l,i):Sc(a,s):(u._visibility|=2,wc(a,s,o,l,i)),i&&2048&c&&_c(s.alternate,s);break;case 24:wc(a,s,o,l,i),i&&2048&c&&vc(s.alternate,s);break;default:wc(a,s,o,l,i)}t=t.sibling}}function Sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Sc(n,r),2048&i&&_c(r.alternate,r);break;case 24:Sc(n,r),2048&i&&vc(r.alternate,r);break;default:Sc(n,r)}t=t.sibling}}var kc=8192;function Tc(e,t,n){if(e.subtreeFlags&kc)for(e=e.child;null!==e;)Cc(e,t,n),e=e.sibling}function Cc(e,t,n){switch(e.tag){case 26:Tc(e,t,n),e.flags&kc&&null!==e.memoizedState&&function(e,t,n,r){if(!("stylesheet"!==n.type||"string"==typeof r.media&&!1===matchMedia(r.media).matches||4&n.state.loading)){if(null===n.instance){var i=pd(r.href),a=t.querySelector(fd(i));if(a)return null!==(t=a._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=Ed.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,void bt(a);a=t.ownerDocument||t,r=md(r),(i=sd.get(i))&&xd(r,i),bt(a=a.createElement("link"));var s=a;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),Dh(a,"link",r),n.instance=a}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=Ed.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,hc,e.memoizedState,e.memoizedProps);break;case 5:default:Tc(e,t,n);break;case 3:case 4:var r=hc;hc=ld(e.stateNode.containerInfo),Tc(e,t,n),hc=r;break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=kc,kc=16777216,Tc(e,t,n),kc=r):Tc(e,t,n))}}function Ec(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Ic(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];ec=r,Ac(r,e)}Ec(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Pc(e),e=e.sibling}function Pc(e){switch(e.tag){case 0:case 11:case 15:Ic(e),2048&e.flags&&Fl(9,e,e.return);break;case 3:case 12:default:Ic(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Mc(e)):Ic(e)}}function Mc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];ec=r,Ac(r,e)}Ec(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Fl(8,t,t.return),Mc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Mc(t));break;default:Mc(t)}e=e.sibling}}function Ac(e,t){for(;null!==ec;){var n=ec;switch(n.tag){case 0:case 11:case 15:Fl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:oa(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,ec=r;else e:for(n=e;null!==ec;){var i=(r=ec).sibling,a=r.return;if(nc(r),r===n){ec=null;break e}if(null!==i){i.return=a,ec=i;break e}ec=a}}}var zc={getCacheForType:function(e){var t=Ji(aa),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Ji(aa).controller.signal}},Dc="function"==typeof WeakMap?WeakMap:Map,Rc=0,Lc=null,Nc=null,jc=0,Fc=0,Oc=null,Bc=!1,Vc=!1,Uc=!1,qc=0,$c=0,Gc=0,Hc=0,Zc=0,Wc=0,Xc=0,Yc=null,Kc=null,Qc=!1,Jc=0,eu=0,tu=1/0,nu=null,ru=null,iu=0,au=null,su=null,ou=0,lu=0,cu=null,uu=null,hu=0,du=null;function pu(){return 2&Rc&&0!==jc?jc&-jc:null!==te.T?ch():at()}function fu(){if(0===Wc)if(536870912&jc&&!zi)Wc=536870912;else{var e=Ge;!(3932160&(Ge<<=1))&&(Ge=262144),Wc=e}return null!==(e=Ja.current)&&(e.flags|=32),Wc}function mu(e,t,n){(e!==Lc||2!==Fc&&9!==Fc)&&null===e.cancelPendingCommit||(wu(e,0),vu(e,jc,Wc,!1)),Je(e,n),2&Rc&&e===Lc||(e===Lc&&(!(2&Rc)&&(Hc|=n),4===$c&&vu(e,jc,Wc,!1)),nh(e))}function gu(e,t,n){if(6&Rc)throw Error(E(327));for(var r=!n&&!(127&t)&&0===(t&e.expiredLanes)||Xe(e,t),i=r?function(e,t){var n=Rc;Rc|=2;var r=Tu(),i=Cu();Lc!==e||jc!==t?(nu=null,tu=Pe()+500,wu(e,t)):Vc=Xe(e,t);e:for(;;)try{if(0!==Fc&&null!==Nc){t=Nc;var a=Oc;t:switch(Fc){case 1:Fc=0,Oc=null,Du(e,t,a,1);break;case 2:case 9:if(wa(a)){Fc=0,Oc=null,zu(t);break}t=function(){2!==Fc&&9!==Fc||Lc!==e||(Fc=7),nh(e)},a.then(t,t);break e;case 3:Fc=7;break e;case 4:Fc=5;break e;case 7:wa(a)?(Fc=0,Oc=null,zu(t)):(Fc=0,Oc=null,Du(e,t,a,7));break;case 5:var s=null;switch(Nc.tag){case 26:s=Nc.memoizedState;case 5:case 27:var o=Nc;if(s?Td(s):o.stateNode.complete){Fc=0,Oc=null;var l=o.sibling;if(null!==l)Nc=l;else{var c=o.return;null!==c?(Nc=c,Ru(c)):Nc=null}break t}}Fc=0,Oc=null,Du(e,t,a,5);break;case 6:Fc=0,Oc=null,Du(e,t,a,6);break;case 8:bu(),$c=6;break e;default:throw Error(E(462))}}Mu();break}catch(u){Su(e,u)}return Gi=$i=null,te.H=r,te.A=i,Rc=n,null!==Nc?0:(Lc=null,jc=0,Kr(),$c)}(e,t):Iu(e,t,!0),a=r;;){if(0===i){Vc&&!r&&vu(e,t,0,!1);break}if(n=e.current.alternate,!a||_u(n)){if(2===i){if(a=t,e.errorRecoveryDisabledLanes&a)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var o=e;i=Yc;var l=o.current.memoizedState.isDehydrated;if(l&&(wu(o,s).flags|=256),2!==(s=Iu(o,s,!1))){if(Uc&&!l){o.errorRecoveryDisabledLanes|=a,Hc|=a,i=4;break e}a=Kc,Kc=i,null!==a&&(null===Kc?Kc=a:Kc.push.apply(Kc,a))}i=s}if(a=!1,2!==i)continue}}if(1===i){wu(e,0),vu(e,t,0,!0);break}e:{switch(r=e,a=i){case 0:case 1:throw Error(E(345));case 4:if((4194048&t)!==t)break;case 6:vu(r,t,Wc,!Bc);break e;case 2:Kc=null;break;case 3:case 5:break;default:throw Error(E(329))}if((62914560&t)===t&&10<(i=Jc+300-Pe())){if(vu(r,t,Wc,!Bc),0!==We(r,0,!0))break e;ou=t,r.timeoutHandle=Uh(yu.bind(null,r,n,Kc,nu,Qc,t,Wc,Hc,Xc,Bc,a,"Throttled",-0,0),i)}else yu(r,n,Kc,nu,Qc,t,Wc,Hc,Xc,Bc,a,null,-0,0)}break}i=Iu(e,t,!1),a=!1}nh(e)}function yu(e,t,n,r,i,a,s,o,l,c,u,h,d,p){if(e.timeoutHandle=-1,8192&(h=t.subtreeFlags)||!(16785408&~h)){Cc(t,a,h={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Jt});var f=(62914560&a)===a?Jc-Pe():(4194048&a)===a?eu-Pe():0;if(null!==(f=function(e,t){return e.stylesheets&&0===e.count&&Pd(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&Pd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===Cd&&(Cd=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var i=n[r],a=i.transferSize,s=i.initiatorType,o=i.duration;if(a&&o&&Rh(s)){for(s=0,o=i.responseEnd,r+=1;r<n.length;r++){var l=n[r],c=l.startTime;if(c>o)break;var u=l.transferSize,h=l.initiatorType;u&&Rh(h)&&(s+=u*((l=l.responseEnd)<o?1:(o-c)/(l-c)))}if(--r,t+=8*(a+s)/(i.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var i=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&Pd(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>Cd?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}(h,f)))return ou=a,e.cancelPendingCommit=f(Nu.bind(null,e,t,a,n,r,i,s,o,l,u,h,null,d,p)),void vu(e,a,s,!c)}Nu(e,t,a,n,r,i,s,o,l)}function _u(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!vr(a(),i))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function vu(e,t,n,r){t&=~Zc,t&=~Hc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Ve(i),s=1<<a;r[a]=-1,i&=~s}0!==n&&et(e,n,t)}function xu(){return!!(6&Rc)||(rh(0),!1)}function bu(){if(null!==Nc){if(0===Fc)var e=Nc.return;else Gi=$i=null,Es(e=Nc),Ia=null,Pa=0,e=Nc;for(;null!==e;)Nl(e.alternate,e),e=e.return;Nc=null}}function wu(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,qh(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),ou=0,bu(),Lc=e,Nc=n=oi(e.current,null),jc=t,Fc=0,Oc=null,Bc=!1,Vc=Xe(e,t),Uc=!1,Xc=Wc=Zc=Hc=Gc=$c=0,Kc=Yc=null,Qc=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-Ve(r),a=1<<i;t|=e[i],r&=~a}return qc=t,Kr(),n}function Su(e,t){cs=null,te.H=No,t===_a||t===xa?(t=Ca(),Fc=3):t===va?(t=Ca(),Fc=4):Fc=t===Jo?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,Oc=t,null===Nc&&($c=1,Wo(e,mi(t,e.current)))}function ku(){var e=Ja.current;return null===e||((4194048&jc)===jc?null===es:!!((62914560&jc)===jc||536870912&jc)&&e===es)}function Tu(){var e=te.H;return te.H=No,null===e?No:e}function Cu(){var e=te.A;return te.A=zc,e}function Eu(){$c=4,Bc||(4194048&jc)!==jc&&null!==Ja.current||(Vc=!0),!(134217727&Gc)&&!(134217727&Hc)||null===Lc||vu(Lc,jc,Wc,!1)}function Iu(e,t,n){var r=Rc;Rc|=2;var i=Tu(),a=Cu();Lc===e&&jc===t||(nu=null,wu(e,t)),t=!1;var s=$c;e:for(;;)try{if(0!==Fc&&null!==Nc){var o=Nc,l=Oc;switch(Fc){case 8:bu(),s=6;break e;case 3:case 2:case 9:case 6:null===Ja.current&&(t=!0);var c=Fc;if(Fc=0,Oc=null,Du(e,o,l,c),n&&Vc){s=0;break e}break;default:c=Fc,Fc=0,Oc=null,Du(e,o,l,c)}}Pu(),s=$c;break}catch(u){Su(e,u)}return t&&e.shellSuspendCounter++,Gi=$i=null,Rc=r,te.H=i,te.A=a,null===Nc&&(Lc=null,jc=0,Kr()),s}function Pu(){for(;null!==Nc;)Au(Nc)}function Mu(){for(;null!==Nc&&!Ee();)Au(Nc)}function Au(e){var t=El(e.alternate,e,qc);e.memoizedProps=e.pendingProps,null===t?Ru(e):Nc=t}function zu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=dl(n,t,t.pendingProps,t.type,void 0,jc);break;case 11:t=dl(n,t,t.pendingProps,t.type.render,t.ref,jc);break;case 5:Es(t);default:Nl(n,t),t=El(n,t=Nc=li(t,qc),qc)}e.memoizedProps=e.pendingProps,null===t?Ru(e):Nc=t}function Du(e,t,n,r){Gi=$i=null,Es(t),Ia=null,Pa=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&Yi(t,n,i,!0),null!==(n=Ja.current)){switch(n.tag){case 31:case 13:return null===es?Eu():null===n.alternate&&0===$c&&($c=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===ba?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Gu(e,r,i)),!1;case 22:return n.flags|=65536,r===ba?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Gu(e,r,i)),!1}throw Error(E(435,n.tag))}return Gu(e,r,i),Eu(),!1}if(zi)return null!==(t=Ja.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==Li&&Ui(mi(e=Error(E(422),{cause:r}),n))):(r!==Li&&Ui(mi(t=Error(E(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=mi(r,n),Ua(e,i=Yo(e.stateNode,r,i)),4!==$c&&($c=2)),!1;var a=Error(E(520),{cause:r});if(a=mi(a,n),null===Yc?Yc=[a]:Yc.push(a),4!==$c&&($c=2),null===t)return!0;r=mi(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,Ua(n,e=Yo(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===a||"function"!=typeof a.componentDidCatch||null!==ru&&ru.has(a))))return n.flags|=65536,i&=-i,n.lanes|=i,Qo(i=Ko(i),e,n,r),Ua(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,jc))return $c=1,Wo(e,mi(n,e.current)),void(Nc=null)}catch(a){if(null!==i)throw Nc=i,a;return $c=1,Wo(e,mi(n,e.current)),void(Nc=null)}32768&t.flags?(zi||1===r?e=!0:Vc||536870912&jc?e=!1:(Bc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=Ja.current)&&13===r.tag&&(r.flags|=16384))),Lu(t,e)):Ru(t)}function Ru(e){var t=e;do{if(32768&t.flags)return void Lu(t,Bc);e=t.return;var n=Rl(t.alternate,t,qc);if(null!==n)return void(Nc=n);if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===$c&&($c=5)}function Lu(e,t){do{var n=Ll(e.alternate,e);if(null!==n)return n.flags&=32767,void(Nc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(Nc=e);Nc=e=n}while(null!==e);$c=6,Nc=null}function Nu(e,t,n,r,i,a,s,o,l){e.cancelPendingCommit=null;do{Vu()}while(0!==iu);if(6&Rc)throw Error(E(327));if(null!==t){if(t===e.current)throw Error(E(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,i,a){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-Ve(n),h=1<<u;o[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var p=d[u];null!==p&&(p.lane&=-536870913)}n&=~h}0!==r&&et(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(s&~t))}(e,n,a|=Yr,s,o,l),e===Lc&&(Nc=Lc=null,jc=0),su=t,au=e,ou=n,lu=a,cu=i,uu=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,Te(De,function(){return Uu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=te.T,te.T=null,i=ne.p,ne.p=2,s=Rc,Rc|=4;try{!function(e,t){if(e=e.containerInfo,Lh=Bd,Tr(e=kr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(m){n=null;break e}var s=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==n||0!==i&&3!==h.nodeType||(o=s+i),h!==a||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)d=h,h=p;for(;;){if(h===e)break t;if(d===n&&++c===i&&(o=s),d===a&&++u===r&&(l=s),null!==(p=h.nextSibling))break;d=(h=d).parentNode}h=p}n=-1===o||-1===l?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Nh={focusedElem:e,selectionRange:n},Bd=!1,ec=t;null!==ec;)if(e=(t=ec).child,1028&t.subtreeFlags&&null!==e)e.return=t,ec=e;else for(;null!==ec;){switch(a=(t=ec).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(i=e[n]).ref.impl=i.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==a){e=void 0,n=t,i=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var f=$o(n.type,i);e=r.getSnapshotBeforeUpdate(f,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(g){$u(n,n.return,g)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Yh(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Yh(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(E(163))}if(null!==(e=t.sibling)){e.return=t.return,ec=e;break}ec=t.return}}(e,t)}finally{Rc=s,ne.p=i,te.T=r}}iu=1,ju(),Fu(),Ou()}}function ju(){if(1===iu){iu=0;var e=au,t=su,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=te.T,te.T=null;var r=ne.p;ne.p=2;var i=Rc;Rc|=4;try{dc(t,e);var a=Nh,s=kr(e.containerInfo),o=a.focusedElem,l=a.selectionRange;if(s!==o&&o&&o.ownerDocument&&Sr(o.ownerDocument.documentElement,o)){if(null!==l&&Tr(o)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var h=o.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var p=d.getSelection(),f=o.textContent.length,m=Math.min(l.start,f),g=void 0===l.end?m:Math.min(l.end,f);!p.extend&&m>g&&(s=g,g=m,m=s);var y=wr(o,m),_=wr(o,g);if(y&&_&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==_.node||p.focusOffset!==_.offset)){var v=h.createRange();v.setStart(y.node,y.offset),p.removeAllRanges(),m>g?(p.addRange(v),p.extend(_.node,_.offset)):(v.setEnd(_.node,_.offset),p.addRange(v))}}}}for(h=[],p=o;p=p.parentNode;)1===p.nodeType&&h.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"==typeof o.focus&&o.focus(),o=0;o<h.length;o++){var x=h[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}Bd=!!Lh,Nh=Lh=null}finally{Rc=i,ne.p=r,te.T=n}}e.current=t,iu=2}}function Fu(){if(2===iu){iu=0;var e=au,t=su,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=te.T,te.T=null;var r=ne.p;ne.p=2;var i=Rc;Rc|=4;try{tc(e,t.alternate,t)}finally{Rc=i,ne.p=r,te.T=n}}iu=3}}function Ou(){if(4===iu||3===iu){iu=0,Ie();var e=au,t=su,n=ou,r=uu;10256&t.subtreeFlags||10256&t.flags?iu=5:(iu=0,su=au=null,Bu(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(ru=null),it(n),t=t.stateNode,Oe&&"function"==typeof Oe.onCommitFiberRoot)try{Oe.onCommitFiberRoot(Fe,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==r){t=te.T,i=ne.p,ne.p=2,te.T=null;try{for(var a=e.onRecoverableError,s=0;s<r.length;s++){var o=r[s];a(o.value,{componentStack:o.stack})}}finally{te.T=t,ne.p=i}}3&ou&&Vu(),nh(e),i=e.pendingLanes,261930&n&&42&i?e===du?hu++:(hu=0,du=e):hu=0,rh(0)}}function Bu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,oa(t)))}function Vu(){return ju(),Fu(),Ou(),Uu()}function Uu(){if(5!==iu)return!1;var e=au,t=lu;lu=0;var n=it(ou),r=te.T,i=ne.p;try{ne.p=32>n?32:n,te.T=null,n=cu,cu=null;var a=au,s=ou;if(iu=0,su=au=null,ou=0,6&Rc)throw Error(E(331));var o=Rc;if(Rc|=4,Pc(a.current),bc(a,a.current,s,n),Rc=o,rh(0,!1),Oe&&"function"==typeof Oe.onPostCommitFiberRoot)try{Oe.onPostCommitFiberRoot(Fe,a)}catch(l){}return!0}finally{ne.p=i,te.T=r,Bu(e,t)}}function qu(e,t,n){t=mi(n,t),null!==(e=Ba(e,t=Yo(e.stateNode,t,2),2))&&(Je(e,2),nh(e))}function $u(e,t,n){if(3===e.tag)qu(e,e,n);else for(;null!==t;){if(3===t.tag){qu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===ru||!ru.has(r))){e=mi(n,e),null!==(r=Ba(t,n=Ko(2),2))&&(Qo(n,r,t,e),Je(r,2),nh(r));break}}t=t.return}}function Gu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Dc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(Uc=!0,i.add(n),e=Hu.bind(null,e,t,n),t.then(e,e))}function Hu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,Lc===e&&(jc&n)===n&&(4===$c||3===$c&&(62914560&jc)===jc&&300>Pe()-Jc?!(2&Rc)&&wu(e,0):Zc|=n,Xc===jc&&(Xc=0)),nh(e)}function Zu(e,t){0===t&&(t=Ke()),null!==(e=ei(e,t))&&(Je(e,t),nh(e))}function Wu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Zu(e,n)}function Xu(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(E(314))}null!==r&&r.delete(t),Zu(e,n)}var Yu=null,Ku=null,Qu=!1,Ju=!1,eh=!1,th=0;function nh(e){e!==Ku&&null===e.next&&(null===Ku?Yu=Ku=e:Ku=Ku.next=e),Ju=!0,Qu||(Qu=!0,Gh(function(){6&Rc?Te(Ae,ih):ah()}))}function rh(e,t){if(!eh&&Ju){eh=!0;do{for(var n=!1,r=Yu;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var s=r.suspendedLanes,o=r.pingedLanes;a=(1<<31-Ve(42|e)+1)-1,a=201326741&(a&=i&~(s&~o))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,lh(r,a))}else a=jc,!(3&(a=We(r,r===Lc?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Xe(r,a)||(n=!0,lh(r,a));r=r.next}}while(n);eh=!1}}function ih(){ah()}function ah(){Ju=Qu=!1;var e=0;0!==th&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==Vh&&(Vh=e,!0);return Vh=null,!1}()&&(e=th);for(var t=Pe(),n=null,r=Yu;null!==r;){var i=r.next,a=sh(r,t);0===a?(r.next=null,null===n?Yu=i:n.next=i,null===i&&(Ku=n)):(n=r,(0!==e||3&a)&&(Ju=!0)),r=i}0!==iu&&5!==iu||rh(e),0!==th&&(th=0)}function sh(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var s=31-Ve(a),o=1<<s,l=i[s];-1===l?0!==(o&n)&&0===(o&r)||(i[s]=Ye(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}if(n=jc,n=We(e,e===(t=Lc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===Fc||9===Fc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&Ce(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&Ce(r),it(n)){case 2:case 8:n=ze;break;case 32:default:n=De;break;case 268435456:n=Le}return r=oh.bind(null,e),n=Te(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&Ce(r),e.callbackPriority=2,e.callbackNode=null,2}function oh(e,t){if(0!==iu&&5!==iu)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Vu()&&e.callbackNode!==n)return null;var r=jc;return 0===(r=We(e,e===Lc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(gu(e,r,t),sh(e,Pe()),null!=e.callbackNode&&e.callbackNode===n?oh.bind(null,e):null)}function lh(e,t){if(Vu())return null;gu(e,t,!0)}function ch(){if(0===th){var e=ua;0===e&&(e=$e,!(261888&($e<<=1))&&($e=256)),th=e}return th}function uh(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Qt(""+e)}function hh(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var dh=0;dh<Gr.length;dh++){var ph=Gr[dh];Hr(ph.toLowerCase(),"on"+(ph[0].toUpperCase()+ph.slice(1)))}Hr(jr,"onAnimationEnd"),Hr(Fr,"onAnimationIteration"),Hr(Or,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(Br,"onTransitionRun"),Hr(Vr,"onTransitionStart"),Hr(Ur,"onTransitionCancel"),Hr(qr,"onTransitionEnd"),Tt("onMouseEnter",["mouseout","mouseover"]),Tt("onMouseLeave",["mouseout","mouseover"]),Tt("onPointerEnter",["pointerout","pointerover"]),Tt("onPointerLeave",["pointerout","pointerover"]),kt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),kt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),kt("onBeforeInput",["compositionend","keypress","textInput","paste"]),kt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),kt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),kt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fh));function gh(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&i.isPropagationStopped())break e;a=o,i.currentTarget=c;try{a(i)}catch(u){Zr(u)}i.currentTarget=null,a=l}else for(s=0;s<r.length;s++){if(l=(o=r[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&i.isPropagationStopped())break e;a=o,i.currentTarget=c;try{a(i)}catch(u){Zr(u)}i.currentTarget=null,a=l}}}}function yh(e,t){var n=t[ht];void 0===n&&(n=t[ht]=new Set);var r=e+"__bubble";n.has(r)||(bh(t,e,2,!1),n.add(r))}function _h(e,t,n){var r=0;t&&(r|=4),bh(n,e,r,t)}var vh="_reactListening"+Math.random().toString(36).slice(2);function xh(e){if(!e[vh]){e[vh]=!0,wt.forEach(function(t){"selectionchange"!==t&&(mh.has(t)||_h(t,!1,e),_h(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[vh]||(t[vh]=!0,_h("selectionchange",!1,t))}}function bh(e,t,n,r){switch(Zd(t)){case 2:var i=Vd;break;case 8:i=Ud;break;default:i=qd}n=i.bind(null,t,n,e),i=void 0,!un||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function wh(e,t,n,r,i){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&s.stateNode.containerInfo===i)return;s=s.return}for(;null!==o;){if(null===(s=yt(o)))return;if(5===(l=s.tag)||6===l||26===l||27===l){r=a=s;continue e}o=o.parentNode}}r=r.return}on(function(){var r=a,i=tn(n),s=[];e:{var o=$r.get(e);if(void 0!==o){var l=kn,c=e;switch(e){case"keypress":if(0===gn(n))break e;case"keydown":case"keyup":l=On;break;case"focusin":c="focus",l=Mn;break;case"focusout":c="blur",l=Mn;break;case"beforeblur":case"afterblur":l=Mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=In;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Vn;break;case jr:case Fr:case Or:l=An;break;case qr:l=Un;break;case"scroll":case"scrollend":l=Cn;break;case"wheel":l=qn;break;case"copy":case"cut":case"paste":l=zn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Bn;break;case"toggle":case"beforetoggle":l=$n}var u=!!(4&t),h=!u&&("scroll"===e||"scrollend"===e),d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=r;null!==f;){var m=f;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===d||null!=(m=ln(f,d))&&u.push(Sh(f,m,p)),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,i),s.push({event:o,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===en||!(c=n.relatedTarget||n.fromElement)||!yt(c)&&!c[ut])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?yt(c):null)&&(h=P(c),u=c.tag,c!==h||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=r),l!==c)){if(u=In,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Bn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:vt(l),p=null==c?o:vt(c),(o=new u(m,f+"leave",l,n,i)).target=h,o.relatedTarget=p,m=null,yt(i)===r&&((u=new u(d,f+"enter",c,n,i)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(u=Th,f=c,p=0,m=d=l;m;m=u(m))p++;m=0;for(var g=f;g;g=u(g))m++;for(;0<p-m;)d=u(d),p--;for(;0<m-p;)f=u(f),m--;for(;p--;){if(d===f||null!==f&&d===f.alternate){u=d;break e}d=u(d),f=u(f)}u=null}else u=null;null!==l&&Ch(s,o,l,u,!1),null!==c&&null!==h&&Ch(s,h,c,u,!0)}if("select"===(l=(o=r?vt(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var y=lr;else if(nr(o))if(cr)y=_r;else{y=gr;var _=mr}else!(l=o.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?r&&Xt(r.elementType)&&(y=lr):y=yr;switch(y&&(y=y(e,r))?rr(s,y,n,i):(_&&_(e,o,r),"focusout"===e&&r&&"number"===o.type&&null!=r.memoizedProps.value&&Vt(o,"number",o.value)),_=r?vt(r):window,e){case"focusin":(nr(_)||"true"===_.contentEditable)&&(Er=_,Ir=r,Pr=null);break;case"focusout":Pr=Ir=Er=null;break;case"mousedown":Mr=!0;break;case"contextmenu":case"mouseup":case"dragend":Mr=!1,Ar(s,n,i);break;case"selectionchange":if(Cr)break;case"keydown":case"keyup":Ar(s,n,i)}var v;if(Hn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else er?Qn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Xn&&"ko"!==n.locale&&(er||"onCompositionStart"!==x?"onCompositionEnd"===x&&er&&(v=mn()):(pn="value"in(dn=i)?dn.value:dn.textContent,er=!0)),0<(_=kh(r,x)).length&&(x=new Dn(x,e,null,n,i),s.push({event:x,listeners:_}),v?x.data=v:null!==(v=Jn(n))&&(x.data=v))),(v=Wn?function(e,t){switch(e){case"compositionend":return Jn(t);case"keypress":return 32!==t.which?null:(Kn=!0,Yn);case"textInput":return(e=t.data)===Yn&&Kn?null:e;default:return null}}(e,n):function(e,t){if(er)return"compositionend"===e||!Hn&&Qn(e,t)?(e=mn(),fn=pn=dn=null,er=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Xn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=kh(r,"onBeforeInput")).length&&(_=new Dn("onBeforeInput","beforeinput",null,n,i),s.push({event:_,listeners:x}),_.data=v)),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var a=uh((i[ct]||null).action),s=r.submitter;s&&null!==(t=(t=s[ct]||null)?uh(t.formAction):s.getAttribute("formAction"))&&(a=t,s=null);var o=new kn("action","action",null,r,i);e.push({event:o,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==th){var e=s?hh(i,s):new FormData(i);wo(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else"function"==typeof a&&(o.preventDefault(),e=s?hh(i,s):new FormData(i),wo(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}(s,e,r,n,i)}gh(s,t)})}function Sh(e,t,n){return{instance:e,listener:t,currentTarget:n}}function kh(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===a||(null!=(i=ln(e,n))&&r.unshift(Sh(e,i,a)),null!=(i=ln(e,t))&&r.push(Sh(e,i,a))),3===e.tag)return r;e=e.return}return[]}function Th(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Ch(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===r)break;5!==o&&26!==o&&27!==o||null===c||(l=c,i?null!=(c=ln(n,a))&&s.unshift(Sh(n,c,l)):i||null!=(c=ln(n,a))&&s.push(Sh(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Eh=/\r\n?/g,Ih=/\u0000|\uFFFD/g;function Ph(e){return("string"==typeof e?e:""+e).replace(Eh,"\n").replace(Ih,"")}function Mh(e,t){return t=Ph(t),Ph(e)===t}function Ah(e,t,n,r,i,a){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||Gt(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&Gt(e,""+r);break;case"className":Mt(e,"class",r);break;case"tabIndex":Mt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Mt(e,n,r);break;case"style":Wt(e,r,a);break;case"data":if("object"!==t){Mt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Qt(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof a&&("formAction"===n?("input"!==t&&Ah(e,t,"name",i.name,i,null),Ah(e,t,"formEncType",i.formEncType,i,null),Ah(e,t,"formMethod",i.formMethod,i,null),Ah(e,t,"formTarget",i.formTarget,i,null)):(Ah(e,t,"encType",i.encType,i,null),Ah(e,t,"method",i.method,i,null),Ah(e,t,"target",i.target,i,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Qt(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Jt);break;case"onScroll":null!=r&&yh("scroll",e);break;case"onScrollEnd":null!=r&&yh("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(E(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(E(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=Qt(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":yh("beforetoggle",e),yh("toggle",e),Pt(e,"popover",r);break;case"xlinkActuate":At(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":At(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":At(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":At(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":At(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":At(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":At(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":At(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":At(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":Pt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&Pt(e,n=Yt.get(n)||n,r)}}function zh(e,t,n,r,i,a){switch(n){case"style":Wt(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(E(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(E(60));e.innerHTML=n}}break;case"children":"string"==typeof r?Gt(e,r):("number"==typeof r||"bigint"==typeof r)&&Gt(e,""+r);break;case"onScroll":null!=r&&yh("scroll",e);break;case"onScrollEnd":null!=r&&yh("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Jt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:St.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"==typeof(a=null!=(a=e[ct]||null)?a[n]:null)&&e.removeEventListener(t,a,i),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):Pt(e,n,r):("function"!=typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function Dh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yh("error",e),yh("load",e);var r,i=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(E(137,t));default:Ah(e,t,r,s,n,null)}}return a&&Ah(e,t,"srcSet",n.srcSet,n,null),void(i&&Ah(e,t,"src",n.src,n,null));case"input":yh("invalid",e);var o=r=s=a=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":a=u;break;case"type":s=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":r=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(E(137,t));break;default:Ah(e,t,i,u,n,null)}}return void Bt(e,r,o,l,c,s,a,!1);case"select":for(a in yh("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(a)&&null!=(o=n[a]))switch(a){case"value":r=o;break;case"defaultValue":s=o;break;case"multiple":i=o;default:Ah(e,t,a,o,n,null)}return t=r,n=s,e.multiple=!!i,void(null!=t?Ut(e,!!i,t,!1):null!=n&&Ut(e,!!i,n,!0));case"textarea":for(s in yh("invalid",e),r=a=i=null,n)if(n.hasOwnProperty(s)&&null!=(o=n[s]))switch(s){case"value":i=o;break;case"defaultValue":a=o;break;case"children":r=o;break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(E(91));break;default:Ah(e,t,s,o,n,null)}return void $t(e,i,a,r);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(i=n[l]))if("selected"===l)e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i;else Ah(e,t,l,i,n,null);return;case"dialog":yh("beforetoggle",e),yh("toggle",e),yh("cancel",e),yh("close",e);break;case"iframe":case"object":yh("load",e);break;case"video":case"audio":for(i=0;i<fh.length;i++)yh(fh[i],e);break;case"image":yh("error",e),yh("load",e);break;case"details":yh("toggle",e);break;case"embed":case"source":case"link":yh("error",e),yh("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(E(137,t));default:Ah(e,t,c,i,n,null)}return;default:if(Xt(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(i=n[u])&&zh(e,t,u,i,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(null!=(i=n[o])&&Ah(e,t,o,i,n,null))}function Rh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var Lh=null,Nh=null;function jh(e){return 9===e.nodeType?e:e.ownerDocument}function Fh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Oh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Bh(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Vh=null;var Uh="function"==typeof setTimeout?setTimeout:void 0,qh="function"==typeof clearTimeout?clearTimeout:void 0,$h="function"==typeof Promise?Promise:void 0,Gh="function"==typeof queueMicrotask?queueMicrotask:void 0!==$h?function(e){return $h.resolve(null).then(e).catch(Hh)}:Uh;function Hh(e){setTimeout(function(){throw e})}function Zh(e){return"head"===e}function Wh(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)||"/&"===n){if(0===r)return e.removeChild(i),void hp(t);r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++;else if("html"===n)ad(e.ownerDocument.documentElement);else if("head"===n){ad(n=e.ownerDocument.head);for(var a=n.firstChild;a;){var s=a.nextSibling,o=a.nodeName;a[mt]||"SCRIPT"===o||"STYLE"===o||"LINK"===o&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=s}}else"body"===n&&ad(e.ownerDocument.body);n=i}while(n);hp(t)}function Xh(e,t){var n=e;e=0;do{var r=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=r}while(n)}function Yh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Yh(n),gt(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Kh(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=ed(e.nextSibling)))return null}return e}function Qh(e){return"$?"===e.data||"$~"===e.data}function Jh(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function ed(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var td=null;function nd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return ed(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function rd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function id(e,t,n){switch(t=jh(n),e){case"html":if(!(e=t.documentElement))throw Error(E(452));return e;case"head":if(!(e=t.head))throw Error(E(453));return e;case"body":if(!(e=t.body))throw Error(E(454));return e;default:throw Error(E(451))}}function ad(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);gt(e)}var sd=new Map,od=new Set;function ld(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var cd=ne.d;ne.d={f:function(){var e=cd.f(),t=xu();return e||t},r:function(e){var t=_t(e);null!==t&&5===t.tag&&"form"===t.type?ko(t):cd.r(e)},D:function(e){cd.D(e),hd("dns-prefetch",e,null)},C:function(e,t){cd.C(e,t),hd("preconnect",e,t)},L:function(e,t,n){cd.L(e,t,n);var r=ud;if(r&&e&&t){var i='link[rel="preload"][as="'+Ft(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+Ft(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+Ft(n.imageSizes)+'"]')):i+='[href="'+Ft(e)+'"]';var a=i;switch(t){case"style":a=pd(e);break;case"script":a=gd(e)}sd.has(a)||(e=R({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),sd.set(a,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(fd(a))||"script"===t&&r.querySelector(yd(a))||(Dh(t=r.createElement("link"),"link",e),bt(t),r.head.appendChild(t)))}},m:function(e,t){cd.m(e,t);var n=ud;if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+Ft(r)+'"][href="'+Ft(e)+'"]',a=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=gd(e)}if(!sd.has(a)&&(e=R({rel:"modulepreload",href:e},t),sd.set(a,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(yd(a)))return}Dh(r=n.createElement("link"),"link",e),bt(r),n.head.appendChild(r)}}},X:function(e,t){cd.X(e,t);var n=ud;if(n&&e){var r=xt(n).hoistableScripts,i=gd(e),a=r.get(i);a||((a=n.querySelector(yd(i)))||(e=R({src:e,async:!0},t),(t=sd.get(i))&&bd(e,t),bt(a=n.createElement("script")),Dh(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}},S:function(e,t,n){cd.S(e,t,n);var r=ud;if(r&&e){var i=xt(r).hoistableStyles,a=pd(e);t=t||"default";var s=i.get(a);if(!s){var o={loading:0,preload:null};if(s=r.querySelector(fd(a)))o.loading=5;else{e=R({rel:"stylesheet",href:e,"data-precedence":t},n),(n=sd.get(a))&&xd(e,n);var l=s=r.createElement("link");bt(l),Dh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,vd(s,t,r)}s={type:"stylesheet",instance:s,count:1,state:o},i.set(a,s)}}},M:function(e,t){cd.M(e,t);var n=ud;if(n&&e){var r=xt(n).hoistableScripts,i=gd(e),a=r.get(i);a||((a=n.querySelector(yd(i)))||(e=R({src:e,async:!0,type:"module"},t),(t=sd.get(i))&&bd(e,t),bt(a=n.createElement("script")),Dh(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}}};var ud="undefined"==typeof document?null:document;function hd(e,t,n){var r=ud;if(r&&"string"==typeof t&&t){var i=Ft(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),od.has(i)||(od.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(Dh(t=r.createElement("link"),"link",e),bt(t),r.head.appendChild(t)))}}function dd(e,t,n,r){var i,a,s,o,l=(l=pe.current)?ld(l):null;if(!l)throw Error(E(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=pd(n.href),(r=(n=xt(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=pd(n.href);var c=xt(l).hoistableStyles,u=c.get(e);if(u||(l=l.ownerDocument||l,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,u),(c=l.querySelector(fd(e)))&&!c._p&&(u.instance=c,u.state.loading=5),sd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},sd.set(e,n),c||(i=l,a=e,s=n,o=u.state,i.querySelector('link[rel="preload"][as="style"]['+a+"]")?o.loading=1:(a=i.createElement("link"),o.preload=a,a.addEventListener("load",function(){return o.loading|=1}),a.addEventListener("error",function(){return o.loading|=2}),Dh(a,"link",s),bt(a),i.head.appendChild(a))))),t&&null===r)throw Error(E(528,""));return u}if(t&&null!==r)throw Error(E(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=gd(n),(r=(n=xt(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(E(444,e))}}function pd(e){return'href="'+Ft(e)+'"'}function fd(e){return'link[rel="stylesheet"]['+e+"]"}function md(e){return R({},e,{"data-precedence":e.precedence,precedence:null})}function gd(e){return'[src="'+Ft(e)+'"]'}function yd(e){return"script[async]"+e}function _d(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+Ft(n.href)+'"]');if(r)return t.instance=r,bt(r),r;var i=R({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return bt(r=(e.ownerDocument||e).createElement("style")),Dh(r,"style",i),vd(r,n.precedence,e),t.instance=r;case"stylesheet":i=pd(n.href);var a=e.querySelector(fd(i));if(a)return t.state.loading|=4,t.instance=a,bt(a),a;r=md(n),(i=sd.get(i))&&xd(r,i),bt(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),Dh(a,"link",r),t.state.loading|=4,vd(a,n.precedence,e),t.instance=a;case"script":return a=gd(n.src),(i=e.querySelector(yd(a)))?(t.instance=i,bt(i),i):(r=n,(i=sd.get(a))&&bd(r=R({},n),i),bt(i=(e=e.ownerDocument||e).createElement("script")),Dh(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(E(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,vd(r,n.precedence,e));return t.instance}function vd(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,a=i,s=0;s<r.length;s++){var o=r[s];if(o.dataset.precedence===t)a=o;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function xd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function bd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var wd=null;function Sd(e,t,n){if(null===wd){var r=new Map,i=wd=new Map;i.set(n,r)}else(r=(i=wd).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[mt]||a[lt]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var s=a.getAttribute(t)||"";s=e+s;var o=r.get(s);o?o.push(a):r.set(s,[a])}}return r}function kd(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Td(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var Cd=0;function Ed(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)Pd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Id=null;function Pd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Id=new Map,t.forEach(Md,e),Id=null,Ed.call(e))}function Md(e,t){if(!(4&t.state.loading)){var n=Id.get(e);if(n)var r=n.get(null);else{n=new Map,Id.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<i.length;a++){var s=i[a];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}s=(i=t.instance).getAttribute("data-precedence"),(a=n.get(s)||r)===r&&n.set(null,i),n.set(s,i),this.count++,r=Ed.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var Ad={$$typeof:U,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function zd(e,t,n,r,i,a,s,o,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qe(0),this.hiddenUpdates=Qe(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function Dd(e,t,n,r,i,a,s,o,l,c,u,h){return e=new zd(e,t,n,s,l,c,u,h,o),t=1,!0===a&&(t|=24),a=ai(3,null,null,t),e.current=a,a.stateNode=e,(t=sa()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},ja(a),e}function Rd(e){return e?e=ri:ri}function Ld(e,t,n,r,i,a){i=Rd(i),null===r.context?r.context=i:r.pendingContext=i,(r=Oa(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=Ba(e,r,t))&&(mu(n,0,t),Va(n,e,t))}function Nd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function jd(e,t){Nd(e,t),(e=e.alternate)&&Nd(e,t)}function Fd(e){if(13===e.tag||31===e.tag){var t=ei(e,67108864);null!==t&&mu(t,0,67108864),jd(e,67108864)}}function Od(e){if(13===e.tag||31===e.tag){var t=pu(),n=ei(e,t=rt(t));null!==n&&mu(n,0,t),jd(e,t)}}var Bd=!0;function Vd(e,t,n,r){var i=te.T;te.T=null;var a=ne.p;try{ne.p=2,qd(e,t,n,r)}finally{ne.p=a,te.T=i}}function Ud(e,t,n,r){var i=te.T;te.T=null;var a=ne.p;try{ne.p=8,qd(e,t,n,r)}finally{ne.p=a,te.T=i}}function qd(e,t,n,r){if(Bd){var i=$d(r);if(null===i)wh(e,t,r,Gd,n),np(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Xd=rp(Xd,e,t,n,r,i),!0;case"dragenter":return Yd=rp(Yd,e,t,n,r,i),!0;case"mouseover":return Kd=rp(Kd,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Qd.set(a,rp(Qd.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Jd.set(a,rp(Jd.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(np(e,r),4&t&&-1<tp.indexOf(e)){for(;null!==i;){var a=_t(i);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var s=Ze(a.pendingLanes);if(0!==s){var o=a;for(o.pendingLanes|=2,o.entangledLanes|=2;s;){var l=1<<31-Ve(s);o.entanglements[1]|=l,s&=~l}nh(a),!(6&Rc)&&(tu=Pe()+500,rh(0))}}break;case 31:case 13:null!==(o=ei(a,2))&&mu(o,0,2),xu(),jd(a,2)}if(null===(a=$d(r))&&wh(e,t,r,Gd,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else wh(e,t,r,null,n)}}function $d(e){return Hd(e=tn(e))}var Gd=null;function Hd(e){if(Gd=null,null!==(e=yt(e))){var t=P(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=M(t)))return e;e=null}else if(31===n){if(null!==(e=A(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Gd=e,null}function Zd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Me()){case Ae:return 2;case ze:return 8;case De:case Re:return 32;case Le:return 268435456;default:return 32}default:return 32}}var Wd=!1,Xd=null,Yd=null,Kd=null,Qd=new Map,Jd=new Map,ep=[],tp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function np(e,t){switch(e){case"focusin":case"focusout":Xd=null;break;case"dragenter":case"dragleave":Yd=null;break;case"mouseover":case"mouseout":Kd=null;break;case"pointerover":case"pointerout":Qd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jd.delete(t.pointerId)}}function rp(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=_t(t))&&Fd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function ip(e){var t=yt(e.target);if(null!==t){var n=P(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=M(n)))return e.blockedOn=t,void st(e.priority,function(){Od(n)})}else if(31===t){if(null!==(t=A(n)))return e.blockedOn=t,void st(e.priority,function(){Od(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function ap(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$d(e.nativeEvent);if(null!==n)return null!==(t=_t(n))&&Fd(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);en=r,n.target.dispatchEvent(r),en=null,t.shift()}return!0}function sp(e,t,n){ap(e)&&n.delete(t)}function op(){Wd=!1,null!==Xd&&ap(Xd)&&(Xd=null),null!==Yd&&ap(Yd)&&(Yd=null),null!==Kd&&ap(Kd)&&(Kd=null),Qd.forEach(sp),Jd.forEach(sp)}function lp(e,t){e.blockedOn===t&&(e.blockedOn=null,Wd||(Wd=!0,k.unstable_scheduleCallback(k.unstable_NormalPriority,op)))}var cp=null;function up(e){cp!==e&&(cp=e,k.unstable_scheduleCallback(k.unstable_NormalPriority,function(){cp===e&&(cp=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!=typeof r){if(null===Hd(r||n))continue;break}var a=_t(n);null!==a&&(e.splice(t,3),t-=3,wo(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function hp(e){function t(t){return lp(t,e)}null!==Xd&&lp(Xd,e),null!==Yd&&lp(Yd,e),null!==Kd&&lp(Kd,e),Qd.forEach(t),Jd.forEach(t);for(var n=0;n<ep.length;n++){var r=ep[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<ep.length&&null===(n=ep[0]).blockedOn;)ip(n),null===n.blockedOn&&ep.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],s=i[ct]||null;if("function"==typeof a)s||up(n);else if(s){var o=null;if(a&&a.hasAttribute("formAction")){if(i=a,s=a[ct]||null)o=s.formAction;else if(null!==Hd(i))continue}else o=s.action;"function"==typeof o?n[r+1]=o:(n.splice(r,3),r-=3),up(n)}}}function dp(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==i&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var r=!1,i=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==i&&(i(),i=null)}}}function pp(e){this._internalRoot=e}function fp(e){this._internalRoot=e}fp.prototype.render=pp.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(E(409));Ld(t.current,pu(),e,t,null,null)},fp.prototype.unmount=pp.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Ld(e.current,2,null,e,null,null),xu(),t[ut]=null}},fp.prototype.unstable_scheduleHydration=function(e){if(e){var t=at();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ep.length&&0!==t&&t<ep[n].priority;n++);ep.splice(n,0,e),0===n&&ip(e)}};var mp=T.version;if("19.2.4"!==mp)throw Error(E(527,mp,"19.2.4"));ne.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(E(188));throw e=Object.keys(e).join(","),Error(E(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=P(e)))throw Error(E(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return z(i),e;if(a===r)return z(i),t;a=a.sibling}throw Error(E(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,o=i.child;o;){if(o===n){s=!0,n=i,r=a;break}if(o===r){s=!0,r=i,n=a;break}o=o.sibling}if(!s){for(o=a.child;o;){if(o===n){s=!0,n=a,r=i;break}if(o===r){s=!0,r=a,n=i;break}o=o.sibling}if(!s)throw Error(E(189))}}if(n.alternate!==r)throw Error(E(190))}if(3!==n.tag)throw Error(E(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?D(e):null)?null:e.stateNode};var gp={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:te,reconcilerVersion:"19.2.4"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var yp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yp.isDisabled&&yp.supportsFiber)try{Fe=yp.inject(gp),Oe=yp}catch(fP){}}b.createRoot=function(e,t){if(!I(e))throw Error(E(299));var n=!1,r="",i=Go,a=Ho,s=Zo;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Dd(e,1,!1,null,0,n,r,null,i,a,s,dp),e[ut]=t.current,xh(e),new pp(t)},b.hydrateRoot=function(e,t,n){if(!I(e))throw Error(E(299));var r=!1,i="",a=Go,s=Ho,o=Zo,l=null;return null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(s=n.onCaughtError),void 0!==n.onRecoverableError&&(o=n.onRecoverableError),void 0!==n.formState&&(l=n.formState)),(t=Dd(e,1,!0,t,0,r,i,l,a,s,o,dp)).context=Rd(null),n=t.current,(i=Oa(r=rt(r=pu()))).callback=null,Ba(n,i,r),n=r,t.current.lanes=n,Je(t,n),nh(t),e[ut]=t.current,xh(e),new fp(t)},b.version="19.2.4",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(fP){}}(),x.exports=b;const _p=l(x.exports),vp="http://localhost:9000",xp="pk_52dfcb8b887c9eeb18da29d5db8e68d906a702a917a2955e743fa68d44834541",bp=new _({baseUrl:vp,publishableKey:xp,debug:!1}),wp=async(e,t={})=>{const n=new Headers(t.headers);n.set("x-publishable-api-key",xp),n.set("Content-Type","application/json");const r=await fetch(`${vp}${e}`,{...t,headers:n,credentials:"include"});if(!r.ok){const e=await r.json().catch(()=>({message:"Request failed"}));throw new Error(e.message||`HTTP ${r.status}`)}return r.json()},Sp=s.createContext(void 0),kp="medusa_cart_id",Tp=({children:e})=>{const[t,r]=s.useState(null),[i,a]=s.useState(!0),[o,l]=s.useState(null),[c,u]=s.useState([]),h=s.useCallback(async()=>{a(!0),l(null);try{const e=localStorage.getItem(kp);if(e)try{const{cart:t}=await bp.store.cart.retrieve(e);if(t&&!t.completed_at)return r(p(t)),t.region_id&&d(t.id),void a(!1)}catch(WI){localStorage.removeItem(kp)}const{regions:t}=await bp.store.region.list();if(!t||0===t.length)throw new Error("No regions configured in Medusa");const{cart:n}=await bp.store.cart.create({region_id:t[0].id});localStorage.setItem(kp,n.id),r(p(n)),d(n.id)}catch(fP){l(fP.message||"Failed to initialize cart")}finally{a(!1)}},[]),d=async e=>{try{const{shipping_options:t}=await bp.store.fulfillment.listCartOptions({cart_id:e});u(t||[])}catch(fP){try{const e=await wp("/store/shipping-options");u(e.shipping_options||[])}catch(t){}}};s.useEffect(()=>{h()},[h]);const p=e=>({id:e.id,items:(e.items||[]).map(e=>({id:e.id,title:e.title||e.product_title||"",description:e.description||e.product_description||"",thumbnail:e.thumbnail||e.product?.thumbnail||null,variant:{id:e.variant_id,title:e.variant?.title||e.variant_title||""},quantity:e.quantity,unit_price:e.unit_price,total:e.total||e.subtotal||e.unit_price*e.quantity})),subtotal:e.subtotal||e.item_subtotal||0,total:e.total||0,region_id:e.region_id,currency_code:e.currency_code||e.region?.currency_code||"usd",email:e.email}),f=s.useCallback(async()=>{if(t?.id)try{const{cart:e}=await bp.store.cart.retrieve(t.id);r(p(e))}catch(fP){l(fP.message)}},[t?.id]),m=s.useCallback(async(e,n=1)=>{t?.id||await h();const i=t?.id||localStorage.getItem(kp);if(i){a(!0);try{const{cart:t}=await bp.store.cart.createLineItem(i,{variant_id:e,quantity:n});r(p(t))}catch(fP){throw l(fP.message||"Failed to add item to cart"),fP}finally{a(!1)}}else l("No cart available")},[t?.id,h]),g=s.useCallback(async(e,n)=>{if(t?.id){a(!0);try{if(n<=0)return void(await y(e));const{cart:i}=await bp.store.cart.updateLineItem(t.id,e,{quantity:n});r(p(i))}catch(fP){throw l(fP.message||"Failed to update item"),fP}finally{a(!1)}}},[t?.id]),y=s.useCallback(async e=>{if(t?.id){a(!0);try{const{cart:n}=await bp.store.cart.deleteLineItem(t.id,e);r(p(n))}catch(fP){throw l(fP.message||"Failed to remove item"),fP}finally{a(!1)}}},[t?.id]),_=s.useCallback(async e=>{if(t?.id){a(!0);try{const{cart:n}=await bp.store.cart.update(t.id,{email:e});r(p(n))}catch(fP){throw l(fP.message||"Failed to update email"),fP}finally{a(!1)}}},[t?.id]),v=s.useCallback(async e=>{if(t?.id){a(!0);try{const{cart:n}=await bp.store.cart.update(t.id,{shipping_address:e,billing_address:e});r(p(n))}catch(fP){throw l(fP.message||"Failed to update address"),fP}finally{a(!1)}}},[t?.id]),x=s.useCallback(async e=>{if(t?.id){a(!0);try{const{cart:n}=await bp.store.cart.addShippingMethod(t.id,{option_id:e});r(p(n))}catch(fP){throw l(fP.message||"Failed to select shipping method"),fP}finally{a(!1)}}},[t?.id]),b=s.useCallback(async e=>{if(!t?.id)throw new Error("No cart available");a(!0);try{let n;t.email!==e&&await _(e);try{n=(await wp("/store/payment-collections",{method:"POST",body:JSON.stringify({cart_id:t.id})})).payment_collection}catch(WI){const{cart:r}=await bp.store.cart.retrieve(t.id);n=r.payment_collection}if(!n)throw new Error("Failed to create payment collection");const i=await wp(`/store/payment-collections/${n.id}/payment-sessions`,{method:"POST",body:JSON.stringify({provider_id:"pp_system_default"})}),{cart:a}=await bp.store.cart.retrieve(t.id);return r(p(a)),i.payment_session||i}catch(fP){throw l(fP.message||"Failed to initiate payment"),fP}finally{a(!1)}},[t?.id,t?.email,_]),w=s.useCallback(async()=>{if(!t?.id)throw new Error("No cart available");a(!0);try{const{order:e}=await bp.store.cart.complete(t.id);return localStorage.removeItem(kp),r(null),await h(),e}catch(fP){throw l(fP.message||"Failed to complete order"),fP}finally{a(!1)}},[t?.id,h]),S=t?.items.reduce((e,t)=>e+t.quantity,0)||0;return n.jsx(Sp.Provider,{value:{cart:t,isLoading:i,error:o,addItem:m,updateItem:g,removeItem:y,refreshCart:f,updateEmail:_,updateAddress:v,addShippingMethod:x,initiatePaymentSession:b,completeCart:w,itemCount:S,shippingOptions:c},children:e})},Cp=()=>{const e=s.useContext(Sp);if(!e)throw new Error("useCart must be used within a CartProvider");return e},Ep=s.createContext(void 0),Ip="medusa_auth_token",Pp=({children:e})=>{const[t,r]=s.useState(null),[i,a]=s.useState(!0),o=async()=>{try{const{customer:e}=await bp.store.customer.retrieve();r(e)}catch(e){r(null),localStorage.removeItem(Ip)}finally{a(!1)}};s.useEffect(()=>{o()},[]);return n.jsx(Ep.Provider,{value:{customer:t,isLoading:i,login:async(e,t)=>{a(!0);try{const n=await wp("/auth/customer/emailpass",{method:"POST",body:JSON.stringify({email:e,password:t})});n.token&&localStorage.setItem(Ip,n.token),await o()}catch(n){throw n}finally{a(!1)}},register:async e=>{a(!0);try{await wp("/auth/customer/emailpass/register",{method:"POST",body:JSON.stringify({email:e.email,password:e.password})});const t=await wp("/auth/customer/emailpass",{method:"POST",body:JSON.stringify({email:e.email,password:e.password})});t.token&&localStorage.setItem(Ip,t.token),(e.first_name||e.last_name||e.phone)&&await bp.store.customer.update({first_name:e.first_name,last_name:e.last_name,phone:e.phone}),await o()}catch(t){throw t}finally{a(!1)}},logout:async()=>{a(!0);try{await wp("/auth/session",{method:"DELETE"}),localStorage.removeItem(Ip),r(null)}catch(e){localStorage.removeItem(Ip),r(null)}finally{a(!1)}},refetchCustomer:o,updateCustomer:async e=>{a(!0);try{await bp.store.customer.update(e),await o()}catch(t){throw t}finally{a(!1)}},addAddress:async e=>{a(!0);try{await bp.store.customer.createAddress(e),await o()}catch(t){throw t}finally{a(!1)}},updateAddress:async(e,t)=>{a(!0);try{await bp.store.customer.updateAddress(e,t),await o()}catch(n){throw n}finally{a(!1)}},deleteAddress:async e=>{a(!0);try{await bp.store.customer.deleteAddress(e),await o()}catch(t){throw t}finally{a(!1)}}},children:e})},Mp=()=>{const e=s.useContext(Ep);if(void 0===e)throw new Error("useAccount must be used within an AccountProvider");return e},Ap="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,zp=globalThis,Dp="10.38.0";function Rp(){return Lp(zp),zp}function Lp(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||Dp,t[Dp]=t[Dp]||{}}function Np(e,t,n=zp){const r=n.__SENTRY__=n.__SENTRY__||{},i=r[Dp]=r[Dp]||{};return i[e]||(i[e]=t())}const jp=["debug","info","warn","error","log","assert","trace"],Fp={};function Op(e){if(!("console"in zp))return e();const t=zp.console,n={},r=Object.keys(Fp);r.forEach(e=>{const r=Fp[e];n[e]=t[e],t[e]=r});try{return e()}finally{r.forEach(e=>{t[e]=n[e]})}}function Bp(){return Up().enabled}function Vp(e,...t){Ap&&Bp()&&Op(()=>{zp.console[e](`Sentry Logger [${e}]:`,...t)})}function Up(){return Ap?Np("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const qp={enable:function(){Up().enabled=!0},disable:function(){Up().enabled=!1},isEnabled:Bp,log:function(...e){Vp("log",...e)},warn:function(...e){Vp("warn",...e)},error:function(...e){Vp("error",...e)}},$p="?",Gp=/\(error: (.*)\)/,Hp=/captureMessage|captureException/;function Zp(...e){const t=e.sort((e,t)=>e[0]-t[0]).map(e=>e[1]);return(e,n=0,r=0)=>{const i=[],a=e.split("\n");for(let s=n;s<a.length;s++){let e=a[s];e.length>1024&&(e=e.slice(0,1024));const n=Gp.test(e)?e.replace(Gp,"$1"):e;if(!n.match(/\S*Error: /)){for(const e of t){const t=e(n);if(t){i.push(t);break}}if(i.length>=50+r)break}}return function(e){if(!e.length)return[];const t=Array.from(e);/sentryWrapped/.test(Wp(t).function||"")&&t.pop();t.reverse(),Hp.test(Wp(t).function||"")&&(t.pop(),Hp.test(Wp(t).function||"")&&t.pop());return t.slice(0,50).map(e=>({...e,filename:e.filename||Wp(t).filename,function:e.function||$p}))}(i.slice(r))}}function Wp(e){return e[e.length-1]||{}}const Xp="<anonymous>";function Yp(e){try{return e&&"function"==typeof e&&e.name||Xp}catch{return Xp}}function Kp(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach(t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)}),e}catch{return}}}function Qp(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const Jp={},ef={};function tf(e,t){Jp[e]=Jp[e]||[],Jp[e].push(t)}function nf(e,t){if(!ef[e]){ef[e]=!0;try{t()}catch(WI){Ap&&qp.error(`Error while instrumenting ${e}`,WI)}}}function rf(e,t){const n=e&&Jp[e];if(n)for(const r of n)try{r(t)}catch(WI){Ap&&qp.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Yp(r)}\nError:`,WI)}}let af=null;function sf(e){const t="error";tf(t,e),nf(t,of)}function of(){af=zp.onerror,zp.onerror=function(e,t,n,r,i){return rf("error",{column:r,error:i,line:n,msg:e,url:t}),!!af&&af.apply(this,arguments)},zp.onerror.__SENTRY_INSTRUMENTED__=!0}let lf=null;function cf(e){const t="unhandledrejection";tf(t,e),nf(t,uf)}function uf(){lf=zp.onunhandledrejection,zp.onunhandledrejection=function(e){return rf("unhandledrejection",e),!lf||lf.apply(this,arguments)},zp.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const hf=Object.prototype.toString;function df(e){switch(hf.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return wf(e,Error)}}function pf(e,t){return hf.call(e)===`[object ${t}]`}function ff(e){return pf(e,"ErrorEvent")}function mf(e){return pf(e,"DOMError")}function gf(e){return pf(e,"String")}function yf(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function _f(e){return null===e||yf(e)||"object"!=typeof e&&"function"!=typeof e}function vf(e){return pf(e,"Object")}function xf(e){return"undefined"!=typeof Event&&wf(e,Event)}function bf(e){return Boolean(e?.then&&"function"==typeof e.then)}function wf(e,t){try{return e instanceof t}catch{return!1}}function Sf(e){return!("object"!=typeof e||null===e||!(e.__isVue||e._isVue||e.__v_isVNode))}function kf(e){return"undefined"!=typeof Request&&wf(e,Request)}const Tf=zp;function Cf(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,i=[];let a=0,s=0;const o=" > ",l=o.length;let c;const u=Array.isArray(t)?t:t.keyAttrs,h=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&a++<r&&(c=Ef(n,u),!("html"===c||a>1&&s+i.length*l+c.length>=h));)i.push(c),s+=c.length,n=n.parentNode;return i.reverse().join(o)}catch{return"<unknown>"}}function Ef(e,t){const n=e,r=[];if(!n?.tagName)return"";if(Tf.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=t?.length?t.filter(e=>n.getAttribute(e)).map(e=>[e,n.getAttribute(e)]):null;if(i?.length)i.forEach(e=>{r.push(`[${e[0]}="${e[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&gf(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const a=["aria-label","type","name","title","alt"];for(const s of a){const e=n.getAttribute(s);e&&r.push(`[${s}="${e}"]`)}return r.join("")}function If(){try{return Tf.document.location.href}catch{return""}}function Pf(e){if(!Tf.HTMLElement)return null;let t=e;for(let n=0;n<5;n++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}function Mf(e,t,n){if(!(t in e))return;const r=e[t];if("function"!=typeof r)return;const i=n(r);"function"==typeof i&&zf(i,r);try{e[t]=i}catch{Ap&&qp.log(`Failed to replace method "${t}" in object`,e)}}function Af(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{Ap&&qp.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function zf(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,Af(e,"__sentry_original__",t)}catch{}}function Df(e){return e.__sentry_original__}function Rf(e){if(df(e))return{message:e.message,name:e.name,stack:e.stack,...Nf(e)};if(xf(e)){const t={type:e.type,target:Lf(e.target),currentTarget:Lf(e.currentTarget),...Nf(e)};return"undefined"!=typeof CustomEvent&&wf(e,CustomEvent)&&(t.detail=e.detail),t}return e}function Lf(e){try{return t=e,"undefined"!=typeof Element&&wf(t,Element)?Cf(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}var t}function Nf(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}let jf,Ff;function Of(e){if(void 0!==jf)return jf?jf(e):e();const t=Symbol.for("__SENTRY_SAFE_RANDOM_ID_WRAPPER__"),n=zp;return t in n&&"function"==typeof n[t]?(jf=n[t],jf(e)):(jf=null,e())}function Bf(){return Of(()=>Math.random())}function Vf(){return Of(()=>Date.now())}function Uf(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function qf(e,t){if(!Array.isArray(e))return"";const n=[];for(let r=0;r<e.length;r++){const t=e[r];try{Sf(t)?n.push(Qp(t)):n.push(String(t))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function $f(e,t,n=!1){return!!gf(e)&&(pf(t,"RegExp")?t.test(e):!!gf(t)&&(n?e===t:e.includes(t)))}function Gf(e,t=[],n=!1){return t.some(t=>$f(e,t,n))}function Hf(e=function(){const e=zp;return e.crypto||e.msCrypto}()){try{if(e?.randomUUID)return Of(()=>e.randomUUID()).replace(/-/g,"")}catch{}return Ff||(Ff="10000000100040008000100000000000"),Ff.replace(/[018]/g,e=>(e^(16*Bf()&15)>>e/4).toString(16))}function Zf(e){return e.exception?.values?.[0]}function Wf(e){const{message:t,event_id:n}=e;if(t)return t;const r=Zf(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function Xf(e,t,n){const r=e.exception=e.exception||{},i=r.values=r.values||[],a=i[0]=i[0]||{};a.value||(a.value=t||""),a.type||(a.type="Error")}function Yf(e,t){const n=Zf(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r?.data,...t.data};n.mechanism.data=e}}function Kf(e){if(function(e){try{return e.__sentry_captured__}catch{}}(e))return!0;try{Af(e,"__sentry_captured__",!0)}catch{}return!1}function Qf(){return Vf()/1e3}let Jf;function em(){return(Jf??(Jf=function(){const{performance:e}=zp;if(!e?.now||!e.timeOrigin)return Qf;const t=e.timeOrigin;return()=>(t+Of(()=>e.now()))/1e3}()))()}let tm=null;function nm(){return null===tm&&(tm=function(){const{performance:e}=zp;if(!e?.now)return;const t=3e5,n=Of(()=>e.now()),r=Vf(),i=e.timeOrigin;if("number"==typeof i&&Math.abs(i+n-r)<t)return i;const a=e.timing?.navigationStart;if("number"==typeof a&&Math.abs(a+n-r)<t)return a;return r-n}()),tm}function rm(e){const t=em(),n={sid:Hf(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(e){return{sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}(n)};return e&&im(n,e),n}function im(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||em(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:Hf()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function am(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&0===Object.keys(t).length)return e;const r={...e};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=am(r[i],t[i],n-1));return r}function sm(){return Hf()}function om(){return Hf().substring(16)}const lm="_sentrySpan";function cm(e,t){t?Af(e,lm,t):delete e[lm]}function um(e){return e[lm]}class hm{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:sm(),sampleRand:Bf()}}clone(){const e=new hm;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._attributes={...this._attributes},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,e._conversationId=this._conversationId,cm(e,um(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&im(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setConversationId(e){return this._conversationId=e||void 0,this._notifyScopeListeners(),this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes={...this._attributes,...e},this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,n=t instanceof hm?t.getScopeData():vf(t)?e:void 0,{tags:r,attributes:i,extra:a,user:s,contexts:o,level:l,fingerprint:c=[],propagationContext:u,conversationId:h}=n||{};return this._tags={...this._tags,...r},this._attributes={...this._attributes,...i},this._extra={...this._extra,...a},this._contexts={...this._contexts,...o},s&&Object.keys(s).length&&(this._user=s),l&&(this._level=l),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),h&&(this._conversationId=h),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,this._conversationId=void 0,cm(this,void 0),this._attachments=[],this.setPropagationContext({traceId:sm(),sampleRand:Bf()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:Qf(),...e,message:e.message?Uf(e.message,2048):e.message};return this._breadcrumbs.push(r),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:um(this),conversationId:this._conversationId}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=am(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t?.event_id||Hf();if(!this._client)return Ap&&qp.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n?.event_id||Hf();if(!this._client)return Ap&&qp.warn("No client configured on scope - will not capture message!"),r;const i=n?.syntheticException??new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureEvent(e,t){const n=t?.event_id||Hf();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(Ap&&qp.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}class dm{constructor(e,t){let n,r;n=e||new hm,r=t||new hm,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(WI){throw this._popScope(),WI}return bf(n)?n.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function pm(){const e=Lp(Rp());return e.stack=e.stack||new dm(Np("defaultCurrentScope",()=>new hm),Np("defaultIsolationScope",()=>new hm))}function fm(e){return pm().withScope(e)}function mm(e,t){const n=pm();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function gm(e){return pm().withScope(()=>e(pm().getIsolationScope()))}function ym(e){const t=Lp(e);return t.acs?t.acs:{withIsolationScope:gm,withScope:fm,withSetScope:mm,withSetIsolationScope:(e,t)=>gm(t),getCurrentScope:()=>pm().getScope(),getIsolationScope:()=>pm().getIsolationScope()}}function _m(){return ym(Rp()).getCurrentScope()}function vm(){return ym(Rp()).getIsolationScope()}function xm(...e){const t=ym(Rp());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function bm(){return _m().getClient()}function wm(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:i}=t,a={trace_id:n,span_id:i||om()};return r&&(a.parent_span_id=r),a}const Sm="sentry.source",km="sentry.sample_rate",Tm="sentry.previous_trace_sample_rate",Cm="sentry.op",Em="sentry.origin",Im="sentry.idle_span_finish_reason",Pm="sentry.measurement_unit",Mm="sentry.measurement_value",Am="sentry.custom_span_name",zm="sentry.profile_id",Dm="sentry.exclusive_time",Rm="sentry.link.type";function Lm(e,t){e.setAttribute("http.response.status_code",t);const n=function(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"internal_error"}}(t);"unknown_error"!==n.message&&e.setStatus(n)}const Nm="_sentryScope",jm="_sentryIsolationScope";function Fm(e){if(e){if("object"==typeof e&&"deref"in e&&"function"==typeof e.deref)try{return e.deref()}catch{return}return e}}function Om(e,t,n){e&&(Af(e,jm,function(e){try{const t=zp.WeakRef;if("function"==typeof t)return new t(e)}catch{}return e}(n)),Af(e,Nm,t))}function Bm(e){const t=e;return{scope:t[Nm],isolationScope:Fm(t[jm])}}const Vm="sentry-",Um=/^sentry-/;function qm(e){const t=function(e){if(!e||!gf(e)&&!Array.isArray(e))return;if(Array.isArray(e))return e.reduce((e,t)=>{const n=Gm(t);return Object.entries(n).forEach(([t,n])=>{e[t]=n}),e},{});return Gm(e)}(e);if(!t)return;const n=Object.entries(t).reduce((e,[t,n])=>{if(t.match(Um)){e[t.slice(7)]=n}return e},{});return Object.keys(n).length>0?n:void 0}function $m(e){if(!e)return;return function(e){if(0===Object.keys(e).length)return;return Object.entries(e).reduce((e,[t,n],r)=>{const i=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,a=0===r?i:`${e},${i}`;return a.length>8192?(Ap&&qp.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):a},"")}(Object.entries(e).reduce((e,[t,n])=>(n&&(e[`${Vm}${t}`]=n),e),{}))}function Gm(e){return e.split(",").map(e=>{const t=e.indexOf("=");if(-1===t)return[];return[e.slice(0,t),e.slice(t+1)].map(e=>{try{return decodeURIComponent(e.trim())}catch{return}})}).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{})}const Hm=/^o(\d+)\./,Zm=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)((?:\[[:.%\w]+\]|[\w.-]+))(?::(\d+))?\/(.+)/;function Wm(e,t=!1){const{host:n,path:r,pass:i,port:a,projectId:s,protocol:o,publicKey:l}=e;return`${o}://${l}${t&&i?`:${i}`:""}@${n}${a?`:${a}`:""}/${r?`${r}/`:r}${s}`}function Xm(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function Ym(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=function(e){const t=e.match(Hm);return t?.[1]}(n)),r}function Km(e){const t="string"==typeof e?function(e){const t=Zm.exec(e);if(!t)return void Op(()=>{});const[n,r,i="",a="",s="",o=""]=t.slice(1);let l="",c=o;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const e=c.match(/^\d+/);e&&(c=e[0])}return Xm({host:a,pass:i,path:l,projectId:c,port:s,protocol:n,publicKey:r})}(e):Xm(e);if(t&&function(e){if(!Ap)return!0;const{port:t,projectId:n,protocol:r}=e;return!(["protocol","publicKey","host","projectId"].find(t=>!e[t]&&(qp.error(`Invalid Sentry Dsn: ${t} missing`),!0))||(n.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(r)?t&&isNaN(parseInt(t,10))&&(qp.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(qp.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(qp.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(t))return t}function Qm(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;return"number"!=typeof t||isNaN(t)||t<0||t>1?void 0:t}const Jm=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function eg(e,t){const n=function(e){if(!e)return;const t=e.match(Jm);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}(e),r=qm(t);if(!n?.traceId)return{traceId:sm(),sampleRand:Bf()};const i=function(e,t){const n=Qm(t?.sample_rand);if(void 0!==n)return n;const r=Qm(t?.sample_rate);return r&&void 0!==e?.parentSampled?e.parentSampled?Bf()*r:r+Bf()*(1-r):Bf()}(n,r);r&&(r.sample_rand=i.toString());const{traceId:a,parentSpanId:s,parentSampled:o}=n;return{traceId:a,parentSpanId:s,sampled:o,dsc:r||{},sampleRand:i}}function tg(e=sm(),t=om(),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function ng(e=sm(),t=om(),n){return`00-${e}-${t}-${n?"01":"00"}`}let rg=!1;function ig(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:i,parent_span_id:a,status:s,origin:o,links:l}=cg(e);return{parent_span_id:a,span_id:t,trace_id:n,data:r,op:i,status:s,origin:o,links:l}}function ag(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),i=r?t:cg(e).parent_span_id,a=Bm(e).scope;return{parent_span_id:i,span_id:r?a?.getPropagationContext().propagationSpanId||om():t,trace_id:n}}function sg(e){return e&&e.length>0?e.map(({context:{spanId:e,traceId:t,traceFlags:n,...r},attributes:i})=>({span_id:e,trace_id:t,sampled:1===n,attributes:i,...r})):void 0}function og(e){return"number"==typeof e?lg(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?lg(e.getTime()):em()}function lg(e){return e>9999999999?e/1e3:e}function cg(e){if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:r,startTime:i,name:a,endTime:s,status:o,links:l}=e;return{span_id:t,trace_id:n,data:r,description:a,parent_span_id:"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0,start_timestamp:og(i),timestamp:og(s)||void 0,status:hg(o),op:r[Cm],origin:r[Em],links:sg(l)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function ug(e){const{traceFlags:t}=e.spanContext();return 1===t}function hg(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"internal_error"}const dg="_sentryChildSpans",pg="_sentryRootSpan";function fg(e,t){const n=e[pg]||e;Af(t,pg,n),e[dg]?e[dg].add(t):Af(e,dg,new Set([t]))}function mg(e){const t=new Set;return function e(n){if(!t.has(n)&&ug(n)){t.add(n);const r=n[dg]?Array.from(n[dg]):[];for(const t of r)e(t)}}(e),Array.from(t)}function gg(e){return e[pg]||e}function yg(){const e=ym(Rp());return e.getActiveSpan?e.getActiveSpan():um(_m())}function _g(){rg||(Op(()=>{}),rg=!0)}let vg=!1;function xg(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=e||bm()?.getOptions();return!(!t||null==t.tracesSampleRate&&!t.tracesSampler)}function bg(e){qp.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function wg(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(kg(n)){if($f(e.description,n))return Ap&&bg(e),!0;continue}if(!n.name&&!n.op)continue;const t=!n.name||$f(e.description,n.name),r=!n.op||e.op&&$f(e.op,n.op);if(t&&r)return Ap&&bg(e),!0}return!1}function Sg(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const i of e)i.parent_span_id===r&&(i.parent_span_id=n)}function kg(e){return"string"==typeof e||e instanceof RegExp}const Tg="production",Cg="_frozenDsc";function Eg(e,t){Af(e,Cg,t)}function Ig(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},i={environment:n.environment||Tg,release:n.release,public_key:r,trace_id:e,org_id:Ym(t)};return t.emit("createDsc",i),i}function Pg(e,t){const n=t.getPropagationContext();return n.dsc||Ig(n.traceId,e)}function Mg(e){const t=bm();if(!t)return{};const n=gg(e),r=cg(n),i=r.data,a=n.spanContext().traceState,s=a?.get("sentry.sample_rate")??i[km]??i[Tm];function o(e){return"number"!=typeof s&&"string"!=typeof s||(e.sample_rate=`${s}`),e}const l=n[Cg];if(l)return o(l);const c=a?.get("sentry.dsc"),u=c&&qm(c);if(u)return o(u);const h=Ig(e.spanContext().traceId,t),d=i[Sm],p=r.description;return"url"!==d&&p&&(h.transaction=p),xg()&&(h.sampled=String(ug(n)),h.sample_rand=a?.get("sentry.sample_rand")??Bm(n).scope?.getPropagationContext().sampleRand.toString()),o(h),t.emit("createDsc",h,n),h}class Ag{constructor(e={}){this._traceId=e.traceId||sm(),this._spanId=e.spanId||om()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function zg(e,t=100,n=1/0){try{return Rg("",e,t,n)}catch(fP){return{ERROR:`**non-serializable** (${fP})`}}}function Dg(e,t=3,n=102400){const r=zg(e,t);return i=r,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(i))>n?Dg(e,t-1,n):r;var i}function Rg(e,t,n=1/0,r=1/0,i=function(){const e=new WeakSet;function t(t){return!!e.has(t)||(e.add(t),!1)}function n(t){e.delete(t)}return[t,n]}()){const[a,s]=i;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const o=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(Sf(t))return Qp(t);if(vf(n=t)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${Yp(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const r=function(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(fP){return`**non-serializable** (${fP})`}var n}(e,t);if(!o.startsWith("[object "))return o;if(t.__sentry_skip_normalization__)return t;const l="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===l)return o.replace("object ","");if(a(t))return"[Circular ~]";const c=t;if(c&&"function"==typeof c.toJSON)try{return Rg("",c.toJSON(),l-1,r,i)}catch{}const u=Array.isArray(t)?[]:{};let h=0;const d=Rf(t);for(const p in d){if(!Object.prototype.hasOwnProperty.call(d,p))continue;if(h>=r){u[p]="[MaxProperties ~]";break}const e=d[p];u[p]=Rg(p,e,l-1,r,i),h++}return s(t),u}function Lg(e,t=[]){return[e,t]}function Ng(e,t){const[n,r]=e;return[n,[...r,t]]}function jg(e,t){const n=e[1];for(const r of n){if(t(r,r[0].type))return!0}return!1}function Fg(e){const t=Lp(zp);return t.encodePolyfill?t.encodePolyfill(e):(new TextEncoder).encode(e)}function Og(e){const[t,n]=e;let r=JSON.stringify(t);function i(e){"string"==typeof r?r="string"==typeof e?r+e:[Fg(r),e]:r.push("string"==typeof e?Fg(e):e)}for(const a of n){const[e,t]=a;if(i(`\n${JSON.stringify(e)}\n`),"string"==typeof t||t instanceof Uint8Array)i(t);else{let e;try{e=JSON.stringify(t)}catch{e=JSON.stringify(zg(t))}i(e)}}return"string"==typeof r?r:function(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return n}(r)}function Bg(e){return[{type:"span"},e]}function Vg(e){const t="string"==typeof e.data?Fg(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const Ug={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function qg(e){return Ug[e]}function $g(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function Gg(e,t,n,r){const i=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:Wm(r)},...i&&{trace:i}}}function Hg(e){if(!e||0===e.length)return;const t={};return e.forEach(e=>{const n=e.attributes||{},r=n[Pm],i=n[Mm];"string"==typeof r&&"number"==typeof i&&(t[e.name]={value:i,unit:r})}),t}class Zg{constructor(e={}){this._traceId=e.traceId||sm(),this._spanId=e.spanId||om(),this._startTime=e.startTimestamp||em(),this._links=e.links,this._attributes={},this.setAttributes({[Em]:"manual",[Cm]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this._links?this._links.push(e):this._links=[e],this}addLinks(e){return this._links?this._links.push(...e):this._links=e,this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=og(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Sm,"custom"),this}end(e){this._endTime||(this._endTime=og(e),function(e){if(!Ap)return;const{description:t="< unknown name >",op:n="< unknown op >"}=cg(e),{spanId:r}=e.spanContext(),i=`[Tracing] Finishing "${n}" ${gg(e)===e?"root ":""}span "${t}" with ID ${r}`;qp.log(i)}(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[Cm],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:hg(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Em],profile_id:this._attributes[zm],exclusive_time:this._attributes[Dm],measurements:Hg(this._events),is_segment:this._isStandaloneSpan&&gg(this)===this||void 0,segment_id:this._isStandaloneSpan?gg(this).spanContext().spanId:void 0,links:sg(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){Ap&&qp.log("[Tracing] Adding an event to span:",e);const r=Wg(t)?t:n||em(),i=Wg(t)?{}:t||{},a={name:e,time:og(r),attributes:i};return this._events.push(a),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=bm();e&&e.emit("spanEnd",this);if(!(this._isStandaloneSpan||this===gg(this)))return;if(this._isStandaloneSpan)return void(this._sampled?function(e){const t=bm();if(!t)return;const n=e[1];if(!n||0===n.length)return void t.recordDroppedEvent("before_send","span");t.sendEnvelope(e)}(function(e,t){const n=Mg(e[0]),r=t?.getDsn(),i=t?.getOptions().tunnel,a={sent_at:(new Date).toISOString(),...(s=n,!!s.trace_id&&!!s.public_key&&{trace:n}),...!!i&&r&&{dsn:Wm(r)}};var s;const{beforeSendSpan:o,ignoreSpans:l}=t?.getOptions()||{},c=l?.length?e.filter(e=>!wg(cg(e),l)):e,u=e.length-c.length;u&&t?.recordDroppedEvent("before_send","span",u);const h=o?e=>{const t=cg(e);return o(t)||(_g(),t)}:cg,d=[];for(const p of c){const e=h(p);e&&d.push(Bg(e))}return Lg(a,d)}([this],e)):(Ap&&qp.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();if(t){(Bm(this).scope||_m()).captureEvent(t)}}_convertSpanToTransaction(){if(!Xg(cg(this)))return;this._name||(Ap&&qp.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=Bm(this),n=e?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(!0!==this._sampled)return;const r=mg(this).filter(e=>e!==this&&!function(e){return e instanceof Zg&&e.isStandaloneSpan()}(e)).map(e=>cg(e)).filter(Xg),i=this._attributes[Sm];delete this._attributes[Am],r.forEach(e=>{delete e.data[Am]});const a={contexts:{trace:ig(this)},spans:r.length>1e3?r.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,1e3):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,dynamicSamplingContext:Mg(this)},request:n,...i&&{transaction_info:{source:i}}},s=Hg(this._events);return s&&Object.keys(s).length&&(Ap&&qp.log("[Measurements] Adding measurements to transaction event",JSON.stringify(s,void 0,2)),a.measurements=s),a}}function Wg(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function Xg(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function Yg(e,t,n=()=>{},r=()=>{}){let i;try{i=e()}catch(WI){throw t(WI),n(),WI}return function(e,t,n,r){if(bf(e))return e.then(e=>(n(),r(e),e),e=>{throw t(e),n(),e});return n(),r(e),e}(i,t,n,r)}const Kg="__SENTRY_SUPPRESS_TRACING__";function Qg(e,t){const n=ry();if(n.startSpan)return n.startSpan(e,t);const r=ny(e),{forceTransaction:i,parentSpan:a,scope:s}=e,o=s?.clone();return xm(o,()=>{const n=void 0!==(s=a)?e=>ey(s,e):e=>e();var s;return n(()=>{const n=_m(),s=ay(n,a),o=e.onlyIfParent&&!s?new Ag:ty({parentSpan:s,spanArguments:r,forceTransaction:i,scope:n});return cm(n,o),Yg(()=>t(o),()=>{const{status:e}=cg(o);!o.isRecording()||e&&"ok"!==e||o.setStatus({code:2,message:"internal_error"})},()=>{o.end()})})})}function Jg(e){const t=ry();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=ny(e),{forceTransaction:r,parentSpan:i}=e;return(e.scope?t=>xm(e.scope,t):void 0!==i?e=>ey(i,e):e=>e())(()=>{const t=_m(),a=ay(t,i);return e.onlyIfParent&&!a?new Ag:ty({parentSpan:a,spanArguments:n,forceTransaction:r,scope:t})})}function ey(e,t){const n=ry();return n.withActiveSpan?n.withActiveSpan(e,t):xm(n=>(cm(n,e||void 0),t(n)))}function ty({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!xg()){const r=new Ag;if(n||!e){Eg(r,{sampled:"false",sample_rate:"0",transaction:t.name,...Mg(r)})}return r}const i=vm();let a;if(e&&!n)a=function(e,t,n){const{spanId:r,traceId:i}=e.spanContext(),a=!t.getScopeData().sdkProcessingMetadata[Kg]&&ug(e),s=a?new Zg({...n,parentSpanId:r,traceId:i,sampled:a}):new Ag({traceId:i});fg(e,s);const o=bm();o&&(o.emit("spanStart",s),n.endTimestamp&&o.emit("spanEnd",s));return s}(e,r,t),fg(e,a);else if(e){const n=Mg(e),{traceId:i,spanId:s}=e.spanContext(),o=ug(e);a=iy({traceId:i,parentSpanId:s,...t},r,o),Eg(a,n)}else{const{traceId:e,dsc:n,parentSpanId:s,sampled:o}={...i.getPropagationContext(),...r.getPropagationContext()};a=iy({traceId:e,parentSpanId:s,...t},r,o),n&&Eg(a,n)}return function(e){if(!Ap)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=cg(e),{spanId:i}=e.spanContext(),a=ug(e),s=gg(e),o=s===e,l=`[Tracing] Starting ${a?"sampled":"unsampled"} ${o?"root ":""}span`,c=[`op: ${n}`,`name: ${t}`,`ID: ${i}`];if(r&&c.push(`parent ID: ${r}`),!o){const{op:e,description:t}=cg(s);c.push(`root ID: ${s.spanContext().spanId}`),e&&c.push(`root op: ${e}`),t&&c.push(`root description: ${t}`)}qp.log(`${l}\n  ${c.join("\n  ")}`)}(a),Om(a,r,i),a}function ny(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=og(e.startTime),delete n.startTime,n}return t}function ry(){return ym(Rp())}function iy(e,t,n){const r=bm(),i=r?.getOptions()||{},{name:a=""}=e,s={spanAttributes:{...e.attributes},spanName:a,parentSampled:n};r?.emit("beforeSampling",s,{decision:!1});const o=s.parentSampled??n,l=s.spanAttributes,c=t.getPropagationContext(),[u,h,d]=t.getScopeData().sdkProcessingMetadata[Kg]?[!1]:function(e,t,n){if(!xg(e))return[!1];let r,i;"function"==typeof e.tracesSampler?(i=e.tracesSampler({...t,inheritOrSampleWith:e=>"number"==typeof t.parentSampleRate?t.parentSampleRate:"boolean"==typeof t.parentSampled?Number(t.parentSampled):e}),r=!0):void 0!==t.parentSampled?i=t.parentSampled:void 0!==e.tracesSampleRate&&(i=e.tracesSampleRate,r=!0);const a=Qm(i);if(void 0===a)return Ap&&qp.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(i)} of type ${JSON.stringify(typeof i)}.`),[!1];if(!a)return Ap&&qp.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,a,r];const s=n<a;return s||Ap&&qp.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[s,a,r]}(i,{name:a,parentSampled:o,attributes:l,parentSampleRate:Qm(c.dsc?.sample_rate)},c.sampleRand),p=new Zg({...e,attributes:{[Sm]:"custom",[km]:void 0!==h&&d?h:void 0,...l},sampled:u});return!u&&r&&(Ap&&qp.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",p),p}function ay(e,t){if(t)return t;if(null===t)return;const n=um(e);if(!n)return;const r=bm();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?gg(n):n}const sy={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3};function oy(e,t={}){const n=new Map;let r,i=!1,a="externalFinish",s=!t.disableAutoFinish;const o=[],{idleTimeout:l=sy.idleTimeout,finalTimeout:c=sy.finalTimeout,childSpanTimeout:u=sy.childSpanTimeout,beforeSpanEnd:h,trimIdleSpanEndTimestamp:d=!0}=t,p=bm();if(!p||!xg()){const e=new Ag;return Eg(e,{sample_rate:"0",sampled:"false",...Mg(e)}),e}const f=_m(),m=yg(),g=function(e){const t=Jg(e);return cm(_m(),t),Ap&&qp.log("[Tracing] Started span is an idle span"),t}(e);function y(){r&&(clearTimeout(r),r=void 0)}function _(e){y(),r=setTimeout(()=>{!i&&0===n.size&&s&&(a="idleTimeout",g.end(e))},l)}function v(e){r=setTimeout(()=>{!i&&s&&(a="heartbeatFailed",g.end(e))},u)}function x(e){i=!0,n.clear(),o.forEach(e=>e()),cm(f,m);const t=cg(g),{start_timestamp:r}=t;if(!r)return;t.data[Im]||g.setAttribute(Im,a);const s=t.status;s&&"unknown"!==s||g.setStatus({code:1}),qp.log(`[Tracing] Idle span "${t.op}" finished`);const u=mg(g).filter(e=>e!==g);let h=0;u.forEach(t=>{t.isRecording()&&(t.setStatus({code:2,message:"cancelled"}),t.end(e),Ap&&qp.log("[Tracing] Cancelling span since span ended early",JSON.stringify(t,void 0,2)));const n=cg(t),{timestamp:r=0,start_timestamp:i=0}=n,a=i<=e,s=r-i<=(c+l)/1e3;if(Ap){const e=JSON.stringify(t,void 0,2);a?s||qp.log("[Tracing] Discarding span since it finished after idle span final timeout",e):qp.log("[Tracing] Discarding span since it happened after idle span was finished",e)}s&&a||(!function(e,t){e[dg]&&e[dg].delete(t)}(g,t),h++)}),h>0&&g.setAttribute("sentry.idle_span_discarded_spans",h)}return g.end=new Proxy(g.end,{apply(e,t,n){if(h&&h(g),t instanceof Ag)return;const[r,...i]=n,a=og(r||em()),s=mg(g).filter(e=>e!==g),o=cg(g);if(!s.length||!d)return x(a),Reflect.apply(e,t,[a,...i]);const l=p.getOptions().ignoreSpans,u=s?.reduce((e,t)=>{const n=cg(t);return n.timestamp?l&&wg(n,l)?e:e?Math.max(e,n.timestamp):n.timestamp:e},void 0),f=o.start_timestamp,m=Math.min(f?f+c/1e3:1/0,Math.max(f||-1/0,Math.min(a,u||1/0)));return x(m),Reflect.apply(e,t,[m,...i])}}),o.push(p.on("spanStart",e=>{if(i||e===g||cg(e).timestamp||e instanceof Zg&&e.isStandaloneSpan())return;var t;mg(g).includes(e)&&(t=e.spanContext().spanId,y(),n.set(t,!0),v(em()+u/1e3))})),o.push(p.on("spanEnd",e=>{var t;i||(t=e.spanContext().spanId,n.has(t)&&n.delete(t),0===n.size&&_(em()+l/1e3))})),o.push(p.on("idleSpanEnableAutoFinish",e=>{e===g&&(s=!0,_(),n.size&&v())})),t.disableAutoFinish||_(),setTimeout(()=>{i||(g.setStatus({code:2,message:"deadline_exceeded"}),a="finalTimeout",g.end())},c),g}function ly(e){return new uy(t=>{t(e)})}function cy(e){return new uy((t,n)=>{n(e)})}class uy{constructor(e){this._state=0,this._handlers=[],this._runExecutor(e)}then(e,t){return new uy((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(WI){r(WI)}else n(t)},e=>{if(t)try{n(t(e))}catch(WI){r(WI)}else r(e)}]),this._executeHandlers()})}catch(e){return this.then(e=>e,e)}finally(e){return new uy((t,n)=>{let r,i;return this.then(t=>{i=!1,r=t,e&&e()},t=>{i=!0,r=t,e&&e()}).then(()=>{i?n(r):t(r)})})}_executeHandlers(){if(0===this._state)return;const e=this._handlers.slice();this._handlers=[],e.forEach(e=>{e[0]||(1===this._state&&e[1](this._value),2===this._state&&e[2](this._value),e[0]=!0)})}_runExecutor(e){const t=(e,t)=>{0===this._state&&(bf(t)?t.then(n,r):(this._state=e,this._value=t,this._executeHandlers()))},n=e=>{t(1,e)},r=e=>{t(2,e)};try{e(n,r)}catch(WI){r(WI)}}}function hy(e,t,n,r=0){try{const i=dy(t,n,e,r);return bf(i)?i:ly(i)}catch(i){return cy(i)}}function dy(e,t,n,r){const i=n[r];if(!e||!i)return e;const a=i({...e},t);return Ap&&null===a&&qp.log(`Event processor "${i.id||"?"}" dropped event`),bf(a)?a.then(e=>dy(e,t,n,r+1)):dy(a,t,n,r+1)}let py,fy,my,gy;function yy(e,t){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:a}=t;!function(e,t){const{extra:n,tags:r,user:i,contexts:a,level:s,transactionName:o}=t;Object.keys(n).length&&(e.extra={...n,...e.extra});Object.keys(r).length&&(e.tags={...r,...e.tags});Object.keys(i).length&&(e.user={...i,...e.user});Object.keys(a).length&&(e.contexts={...a,...e.contexts});s&&(e.level=s);o&&"transaction"!==e.type&&(e.transaction=o)}(e,t),r&&function(e,t){e.contexts={trace:ag(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Mg(t),...e.sdkProcessingMetadata};const n=gg(t),r=cg(n).description;r&&!e.transaction&&"transaction"===e.type&&(e.transaction=r)}(e,r),function(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t));e.fingerprint.length||delete e.fingerprint}(e,n),function(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}(e,i),function(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}(e,a)}function _y(e,t){const{extra:n,tags:r,attributes:i,user:a,contexts:s,level:o,sdkProcessingMetadata:l,breadcrumbs:c,fingerprint:u,eventProcessors:h,attachments:d,propagationContext:p,transactionName:f,span:m}=t;vy(e,"extra",n),vy(e,"tags",r),vy(e,"attributes",i),vy(e,"user",a),vy(e,"contexts",s),e.sdkProcessingMetadata=am(e.sdkProcessingMetadata,l,2),o&&(e.level=o),f&&(e.transactionName=f),m&&(e.span=m),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),u.length&&(e.fingerprint=[...e.fingerprint,...u]),h.length&&(e.eventProcessors=[...e.eventProcessors,...h]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...p}}function vy(e,t,n){e[t]=am(e[t],n,1)}function xy(e,t){const n=Np("globalScope",()=>new hm).getScopeData();return e&&_y(n,e.getScopeData()),t&&_y(n,t.getScopeData()),n}function by(e,t,n,r,i,a){const{normalizeDepth:s=3,normalizeMaxBreadth:o=1e3}=e,l={...t,event_id:t.event_id||n.event_id||Hf(),timestamp:t.timestamp||Qf()},c=n.integrations||e.integrations.map(e=>e.name);!function(e,t){const{environment:n,release:r,dist:i,maxValueLength:a}=t;e.environment=e.environment||n||Tg,!e.release&&r&&(e.release=r);!e.dist&&i&&(e.dist=i);const s=e.request;s?.url&&a&&(s.url=Uf(s.url,a));a&&e.exception?.values?.forEach(e=>{e.value&&(e.value=Uf(e.value,a))})}(l,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(l,c),i&&i.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){const n=function(e){const t=zp._sentryDebugIds,n=zp._debugIds;if(!t&&!n)return{};const r=t?Object.keys(t):[],i=n?Object.keys(n):[];if(gy&&r.length===fy&&i.length===my)return gy;fy=r.length,my=i.length,gy={},py||(py={});const a=(t,n)=>{for(const r of t){const t=n[r],i=py?.[r];if(i&&gy&&t)gy[i[0]]=t,py&&(py[r]=[i[0],t]);else if(t){const n=e(r);for(let e=n.length-1;e>=0;e--){const i=n[e],a=i?.filename;if(a&&gy&&py){gy[a]=t,py[r]=[a,t];break}}}}};return t&&a(r,t),n&&a(i,n),gy}(t);e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.filename&&(e.debug_id=n[e.filename])})})}(l,e.stackParser);const u=function(e,t){if(!t)return e;const n=e?e.clone():new hm;return n.update(t),n}(r,n.captureContext);n.mechanism&&Yf(l,n.mechanism);const h=i?i.getEventProcessors():[],d=xy(a,u),p=[...n.attachments||[],...d.attachments];p.length&&(n.attachments=p),yy(l,d);return hy([...h,...d.eventProcessors],l,n).then(e=>(e&&function(e){const t={};if(e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)})}),0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})})}(e),"number"==typeof s&&s>0?function(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(e=>({...e,...e.data&&{data:zg(e.data,t,n)}}))},...e.user&&{user:zg(e.user,t,n)},...e.contexts&&{contexts:zg(e.contexts,t,n)},...e.extra&&{extra:zg(e.extra,t,n)}};e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=zg(e.contexts.trace.data,t,n)));e.spans&&(r.spans=e.spans.map(e=>({...e,...e.data&&{data:zg(e.data,t,n)}})));e.contexts?.flags&&r.contexts&&(r.contexts.flags=zg(e.contexts.flags,3,n));return r}(e,s,o):e))}function wy(e){if(e)return function(e){return e instanceof hm||"function"==typeof e}(e)||function(e){return Object.keys(e).some(e=>Sy.includes(e))}(e)?{captureContext:e}:e}const Sy=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function ky(e,t){return _m().captureException(e,wy(t))}function Ty(e,t){return _m().captureEvent(e,t)}function Cy(e,t){vm().setContext(e,t)}function Ey(e){const t=vm(),n=_m(),{userAgent:r}=zp.navigator||{},i=rm({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),a=t.getSession();return"ok"===a?.status&&im(a,{status:"exited"}),Iy(),t.setSession(i),i}function Iy(){const e=vm(),t=_m().getSession()||e.getSession();t&&function(e){let t={};"ok"===e.status&&(t={status:"exited"}),im(e,t)}(t),Py(),e.setSession()}function Py(){const e=vm(),t=bm(),n=e.getSession();n&&t&&t.captureSession(n)}function My(e=!1){e?Iy():Py()}function Ay(e,t,n){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}(e,n)}`}const zy=[];function Dy(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;if(t.forEach(e=>{e.isDefaultInstance=!0}),Array.isArray(n))r=[...t,...n];else if("function"==typeof n){const e=n(t);r=Array.isArray(e)?e:[e]}else r=t;return function(e){const t={};return e.forEach(e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)}),Object.values(t)}(r)}function Ry(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function Ly(e,t,n){if(n[t.name])Ap&&qp.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,zy.includes(t.name)||"function"!=typeof t.setupOnce||(t.setupOnce(),zy.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",(t,r)=>n(t,r,e))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign((t,r)=>n(t,r,e),{id:t.name});e.addEventProcessor(r)}Ap&&qp.log(`Integration installed: ${t.name}`)}}function Ny(e,t){const n=t??function(e){return jy().get(e)}(e)??[];if(0===n.length)return;const r=e.getOptions(),i=function(e,t,n,r){const i={};return t?.sdk&&(i.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(i.dsn=Wm(r)),Lg(i,[(a=e,[{type:"log",item_count:a.length,content_type:"application/vnd.sentry.items.log+json"},{items:a}])]);var a}(n,r._metadata,r.tunnel,e.getDsn());jy().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(i)}function jy(){return Np("clientToLogBufferMap",()=>new WeakMap)}function Fy(e,t){const n=t??function(e){return Oy().get(e)}(e)??[];if(0===n.length)return;const r=e.getOptions(),i=function(e,t,n,r){const i={};return t?.sdk&&(i.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(i.dsn=Wm(r)),Lg(i,[(a=e,[{type:"trace_metric",item_count:a.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:a}])]);var a}(n,r._metadata,r.tunnel,e.getDsn());Oy().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(i)}function Oy(){return Np("clientToMetricBufferMap",()=>new WeakMap)}const By=Symbol.for("SentryBufferFullError");function Vy(e=100){const t=new Set;function n(e){t.delete(e)}return{get $(){return Array.from(t)},add:function(r){if(!(t.size<e))return cy(By);const i=r();return t.add(i),i.then(()=>n(i),()=>n(i)),i},drain:function(e){if(!t.size)return ly(!0);const n=Promise.allSettled(Array.from(t)).then(()=>!0);if(!e)return n;const r=[n,new Promise(t=>setTimeout(()=>t(!1),e))];return Promise.race(r)}}}function Uy(e,t,n=Vf()){return function(e,t){return e[t]||e.all||0}(e,t)>n}function qy(e,{statusCode:t,headers:n},r=Vf()){const i={...e},a=n?.["x-sentry-rate-limits"],s=n?.["retry-after"];if(a)for(const o of a.trim().split(",")){const[e,t,,,n]=o.split(":",5),a=parseInt(e,10),s=1e3*(isNaN(a)?60:a);if(t)for(const o of t.split(";"))"metric_bucket"===o&&n&&!n.split(";").includes("custom")||(i[o]=r+s);else i.all=r+s}else s?i.all=r+function(e,t=Vf()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?6e4:r-t}(s,r):429===t&&(i.all=r+6e4);return i}function $y(e,t,n=Vy(e.bufferSize||64)){let r={};return{send:function(i){const a=[];if(jg(i,(t,n)=>{const i=qg(n);Uy(r,i)?e.recordDroppedEvent("ratelimit_backoff",i):a.push(t)}),0===a.length)return Promise.resolve({});const s=Lg(i[0],a),o=t=>{!function(e,t){return jg(e,(e,n)=>t.includes(n))}(s,["client_report"])?jg(s,(n,r)=>{e.recordDroppedEvent(t,qg(r))}):Ap&&qp.warn(`Dropping client report. Will not send outcomes (reason: ${t}).`)};return n.add(()=>t({body:Og(s)}).then(e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&Ap&&qp.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=qy(r,e),e),e=>{throw o("network_error"),Ap&&qp.error("Encountered error running transport request:",e),e})).then(e=>e,e=>{if(e===By)return Ap&&qp.error("Skipped sending event because buffer is full."),o("queue_overflow"),Promise.resolve({});throw e})},flush:e=>n.drain(e)}}function Gy(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}const Hy="Not capturing exception because it's already been captured.",Zy="Discarded session because of missing or non-string release",Wy=Symbol.for("SentryInternalError"),Xy=Symbol.for("SentryDoNotSendEventError");function Yy(e){return{message:e,[Wy]:!0}}function Ky(e){return{message:e,[Xy]:!0}}function Qy(e){return!!e&&"object"==typeof e&&Wy in e}function Jy(e){return!!e&&"object"==typeof e&&Xy in e}function e_(e,t,n,r,i){let a,s=0,o=!1;e.on(n,()=>{s=0,clearTimeout(a),o=!1}),e.on(t,t=>{s+=r(t),s>=8e5?i(e):o||(o=!0,a=setTimeout(()=>{i(e)},5e3))}),e.on("flush",()=>{i(e)})}class t_{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=Vy(e.transportOptions?.bufferSize??64),e.dsn?this._dsn=Km(e.dsn):Ap&&qp.warn("No DSN provided, client will not send events."),this._dsn){const t=Ay(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}this._options.enableLogs=this._options.enableLogs??this._options._experiments?.enableLogs,this._options.enableLogs&&e_(this,"afterCaptureLog","flushLogs",s_,Ny);(this._options.enableMetrics??this._options._experiments?.enableMetrics??!0)&&e_(this,"afterCaptureMetric","flushMetrics",a_,Fy)}captureException(e,t,n){const r=Hf();if(Kf(e))return Ap&&qp.log(Hy),r;const i={event_id:r,...t};return this._process(()=>this.eventFromException(e,i).then(e=>this._captureEvent(e,i,n)).then(e=>e),"error"),i.event_id}captureMessage(e,t,n,r){const i={event_id:Hf(),...n},a=yf(e)?e:String(e),s=_f(e),o=s?this.eventFromMessage(a,t,i):this.eventFromException(e,i);return this._process(()=>o.then(e=>this._captureEvent(e,i,r)),s?"unknown":"error"),i.event_id}captureEvent(e,t,n){const r=Hf();if(t?.originalException&&Kf(t.originalException))return Ap&&qp.log(Hy),r;const i={event_id:r,...t},a=e.sdkProcessingMetadata||{},s=a.capturedSpanScope,o=a.capturedSpanIsolationScope,l=n_(e.type);return this._process(()=>this._captureEvent(e,i,s||n,o),l),i.event_id}captureSession(e){this.sendSession(e),im(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}async flush(e){const t=this._transport;if(!t)return!0;this.emit("flush");const n=await this._isClientDoneProcessing(e),r=await t.flush(e);return n&&r}async close(e){const t=await this.flush(e);return this.getOptions().enabled=!1,this.emit("close"),t}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Ly(this,e,this._integrations),t||Ry(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=function(e,t,n,r){const i=$g(n),a=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){if(!t)return e;const n=e.sdk||{};e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0}}(e,n?.sdk);const s=Gg(e,i,r,t);return delete e.sdkProcessingMetadata,Lg(s,[[{type:a},e]])}(e,this._dsn,this._options._metadata,this._options.tunnel);for(const r of t.attachments||[])n=Ng(n,Vg(r));this.sendEnvelope(n).then(t=>this.emit("afterSendEvent",e,t))}sendSession(e){const{release:t,environment:n=Tg}=this._options;if("aggregates"in e){const r=e.attrs||{};if(!r.release&&!t)return void(Ap&&qp.warn(Zy));r.release=r.release||t,r.environment=r.environment||n,e.attrs=r}else{if(!e.release&&!t)return void(Ap&&qp.warn(Zy));e.release=e.release||t,e.environment=e.environment||n}this.emit("beforeSendSession",e);const r=function(e,t,n,r){const i=$g(n);return Lg({sent_at:(new Date).toISOString(),...i&&{sdk:i},...!!r&&t&&{dsn:Wm(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,t,n=1){if(this._options.sendClientReports){const r=`${e}:${t}`;Ap&&qp.log(`Recording outcome: "${r}"${n>1?` (${n} times)`:""}`),this._outcomes[r]=(this._outcomes[r]||0)+n}}on(e,t){const n=this._hooks[e]=this._hooks[e]||new Set,r=(...e)=>t(...e);return n.add(r),()=>{n.delete(r)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach(e=>e(...t))}async sendEnvelope(e){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)try{return await this._transport.send(e)}catch(t){return Ap&&qp.error("Error while sending envelope:",t),{}}return Ap&&qp.error("Transport disabled"),{}}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const n={};return t.forEach(t=>{t&&Ly(e,t,n)}),n}(this,e),Ry(this,e)}_updateSessionFromEvent(e,t){let n="fatal"===t.level,r=!1;const i=t.exception?.values;if(i){r=!0,n=!1;for(const e of i)if(!1===e.mechanism?.handled){n=!0;break}}const a="ok"===e.status;(a&&0===e.errors||a&&n)&&(im(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}async _isClientDoneProcessing(e){let t=0;for(;!e||t<e;){if(await new Promise(e=>setTimeout(e,1)),!this._numProcessing)return!0;t++}return!1}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r){const i=this.getOptions(),a=Object.keys(this._integrations);return!t.integrations&&a?.length&&(t.integrations=a),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),by(i,e,t,n,this,r).then(e=>{if(null===e)return e;this.emit("postprocessEvent",e,t),e.contexts={trace:wm(n),...e.contexts};const r=Pg(this,n);return e.sdkProcessingMetadata={dynamicSamplingContext:r,...e.sdkProcessingMetadata},e})}_captureEvent(e,t={},n=_m(),r=vm()){return Ap&&r_(e)&&qp.log(`Captured error event \`${Gy(e)[0]||"<unknown>"}\``),this._processEvent(e,t,n,r).then(e=>e.event_id,e=>{Ap&&(Jy(e)?qp.log(e.message):Qy(e)?qp.warn(e.message):qp.warn(e))})}_processEvent(e,t,n,r){const i=this.getOptions(),{sampleRate:a}=i,s=i_(e),o=r_(e),l=`before send for type \`${e.type||"error"}\``,c=void 0===a?void 0:Qm(a);if(o&&"number"==typeof c&&Bf()>c)return this.recordDroppedEvent("sample_rate","error"),cy(Ky(`Discarding event because it's not included in the random sample (sampling rate = ${a})`));const u=n_(e.type);return this._prepareEvent(e,t,n,r).then(e=>{if(null===e)throw this.recordDroppedEvent("event_processor",u),Ky("An event processor returned `null`, will not send event.");if(t.data&&!0===t.data.__sentry__)return e;const n=function(e,t,n,r){const{beforeSend:i,beforeSendTransaction:a,beforeSendSpan:s,ignoreSpans:o}=t;let l=n;if(r_(l)&&i)return i(l,r);if(i_(l)){if(s||o){const t=function(e){const{trace_id:t,parent_span_id:n,span_id:r,status:i,origin:a,data:s,op:o}=e.contexts?.trace??{};return{data:s??{},description:e.transaction,op:o,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:i,timestamp:e.timestamp,trace_id:t??"",origin:a,profile_id:s?.[zm],exclusive_time:s?.[Dm],measurements:e.measurements,is_segment:!0}}(l);if(o?.length&&wg(t,o))return null;if(s){const e=s(t);e?l=am(n,{type:"transaction",timestamp:(c=e).timestamp,start_timestamp:c.start_timestamp,transaction:c.description,contexts:{trace:{trace_id:c.trace_id,span_id:c.span_id,parent_span_id:c.parent_span_id,op:c.op,status:c.status,origin:c.origin,data:{...c.data,...c.profile_id&&{[zm]:c.profile_id},...c.exclusive_time&&{[Dm]:c.exclusive_time}}}},measurements:c.measurements}):_g()}if(l.spans){const t=[],n=l.spans;for(const e of n)if(o?.length&&wg(e,o))Sg(n,e);else if(s){const n=s(e);n?t.push(n):(_g(),t.push(e))}else t.push(e);const r=l.spans.length-t.length;r&&e.recordDroppedEvent("before_send","span",r),l.spans=t}}if(a){if(l.spans){const e=l.spans.length;l.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return a(l,r)}}var c;return l}(this,i,e,t);return function(e,t){const n=`${t} must return \`null\` or a valid event.`;if(bf(e))return e.then(e=>{if(!vf(e)&&null!==e)throw Yy(n);return e},e=>{throw Yy(`${t} rejected with ${e}`)});if(!vf(e)&&null!==e)throw Yy(n);return e}(n,l)}).then(i=>{if(null===i){if(this.recordDroppedEvent("before_send",u),s){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw Ky(`${l} returned \`null\`, will not send event.`)}const a=n.getSession()||r.getSession();if(o&&a&&this._updateSessionFromEvent(a,i),s){const e=(i.sdkProcessingMetadata?.spanCountBeforeProcessing||0)-(i.spans?i.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const c=i.transaction_info;if(s&&c&&i.transaction!==e.transaction){const e="custom";i.transaction_info={...c,source:e}}return this.sendEvent(i,t),i}).then(null,e=>{if(Jy(e)||Qy(e))throw e;throw this.captureException(e,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:e}),Yy(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)})}_process(e,t){this._numProcessing++,this._promiseBuffer.add(e).then(e=>(this._numProcessing--,e),e=>(this._numProcessing--,e===By&&this.recordDroppedEvent("queue_overflow",t),e))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}})}_flushOutcomes(){Ap&&qp.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(Ap&&qp.log("No outcomes to send"));if(!this._dsn)return void(Ap&&qp.log("No dsn provided, will not send outcomes"));Ap&&qp.log("Sending outcomes:",e);const t=(n=e,Lg((r=this._options.tunnel&&Wm(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:Qf(),discarded_events:n}]]));var n,r;this.sendEnvelope(t)}}function n_(e){return"replay_event"===e?"replay":e||"error"}function r_(e){return void 0===e.type}function i_(e){return"transaction"===e.type}function a_(e){let t=0;return e.name&&(t+=2*e.name.length),t+=8,t+o_(e.attributes)}function s_(e){let t=0;return e.message&&(t+=2*e.message.length),t+o_(e.attributes)}function o_(e){if(!e)return 0;let t=0;return Object.values(e).forEach(e=>{Array.isArray(e)?t+=e.length*l_(e[0]):_f(e)?t+=l_(e):t+=100}),t}function l_(e){return"string"==typeof e?2*e.length:"number"==typeof e?8:"boolean"==typeof e?4:0}function c_(e){return function(e){return df(e)&&"__sentry_fetch_url_host__"in e&&"string"==typeof e.__sentry_fetch_url_host__}(e)?`${e.message} (${e.__sentry_fetch_url_host__})`:e.message}function u_(e,t){!0===t.debug&&(Ap?qp.enable():Op(()=>{}));_m().update(t.initialScope);const n=new e(t);return function(e){_m().setClient(e)}(n),n.init(),n}function h_(e){return"isRelative"in e}function d_(e,t){const n=e.indexOf("://")<=0&&0!==e.indexOf("//"),r=n?"thismessage:/":void 0;try{if("canParse"in URL&&!URL.canParse(e,r))return;const t=new URL(e,r);return n?{isRelative:n,pathname:t.pathname,search:t.search,hash:t.hash}:t}catch{}}function p_(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function f_(e,t=!0){if(e.startsWith("data:")){const n=e.match(/^data:([^;,]+)/),r=n?n[1]:"text/plain",i=e.includes(";base64,"),a=e.indexOf(",");let s="";if(t&&-1!==a){const t=e.slice(a+1);s=t.length>10?`${t.slice(0,10)}... [truncated]`:t}return`data:${r}${i?",base64":""}${s?`,${s}`:""}`}return e}function m_(e,t){const n=t?.getDsn(),r=t?.getOptions().tunnel;return function(e,t){const n=d_(e);if(!n||h_(n))return!1;return!!t&&(n.host.includes(t.host)&&/(^|&|\?)sentry_key=/.test(n.search))}(e,n)||function(e,t){if(!t)return!1;return g_(e)===g_(t)}(e,r)}function g_(e){return"/"===e[e.length-1]?e.slice(0,-1):e}function y_(e){"aggregates"in e?void 0===e.attrs?.ip_address&&(e.attrs={...e.attrs,ip_address:"{{auto}}"}):void 0===e.ipAddress&&(e.ipAddress="{{auto}}")}function __(e,t,n=[t],r="npm"){const i=e._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${t}`,packages:n.map(e=>({name:`${r}:@sentry/${e}`,version:Dp})),version:Dp}),e._metadata=i}function v_(e={}){const t=e.client||bm();if(!function(){const e=bm();return!1!==e?.getOptions().enabled&&!!e?.getTransport()}()||!t)return{};const n=ym(Rp());if(n.getTraceData)return n.getTraceData(e);const r=e.scope||_m(),i=e.span||yg(),a=i?function(e){const{traceId:t,spanId:n}=e.spanContext();return tg(t,n,ug(e))}(i):function(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return tg(t,r,n)}(r),s=$m(i?Mg(i):Pg(t,r));if(!Jm.test(a))return qp.warn("Invalid sentry-trace data. Cannot generate trace data"),{};const o={"sentry-trace":a,baggage:s};return e.propagateTraceparent&&(o.traceparent=i?function(e){const{traceId:t,spanId:n}=e.spanContext();return ng(t,n,ug(e))}(i):function(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return ng(t,r,n)}(r)),o}const x_=100;function b_(e,t){const n=bm(),r=vm();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:a=x_}=n.getOptions();if(a<=0)return;const s={timestamp:Qf(),...e},o=i?Op(()=>i(s,t)):s;null!==o&&(n.emit&&n.emit("beforeAddBreadcrumb",o,t),r.addBreadcrumb(o,a))}let w_;const S_=new WeakMap,k_=()=>({name:"FunctionToString",setupOnce(){w_=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=Df(this),n=S_.has(bm())&&void 0!==t?t:this;return w_.apply(n,e)}}catch{}},setup(e){S_.set(e,!0)}}),T_=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],C_=(e={})=>{let t;return{name:"EventFilters",setup(n){const r=n.getOptions();t=I_(e,r)},processEvent(n,r,i){if(!t){const n=i.getOptions();t=I_(e,n)}return function(e,t){if(e.type){if("transaction"===e.type&&function(e,t){if(!t?.length)return!1;const n=e.transaction;return!!n&&Gf(n,t)}(e,t.ignoreTransactions))return Ap&&qp.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${Wf(e)}`),!0}else{if(function(e,t){if(!t?.length)return!1;return Gy(e).some(e=>Gf(e,t))}(e,t.ignoreErrors))return Ap&&qp.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${Wf(e)}`),!0;if(function(e){if(!e.exception?.values?.length)return!1;return!e.message&&!e.exception.values.some(e=>e.stacktrace||e.type&&"Error"!==e.type||e.value)}(e))return Ap&&qp.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${Wf(e)}`),!0;if(function(e,t){if(!t?.length)return!1;const n=P_(e);return!!n&&Gf(n,t)}(e,t.denyUrls))return Ap&&qp.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${Wf(e)}.\nUrl: ${P_(e)}`),!0;if(!function(e,t){if(!t?.length)return!0;const n=P_(e);return!n||Gf(n,t)}(e,t.allowUrls))return Ap&&qp.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${Wf(e)}.\nUrl: ${P_(e)}`),!0}return!1}(n,t)?null:n}}},E_=(e={})=>({...C_(e),name:"InboundFilters"});function I_(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:T_],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function P_(e){try{const t=[...e.exception?.values??[]].reverse().find(e=>void 0===e.mechanism?.parent_id&&e.stacktrace?.frames?.length),n=t?.stacktrace?.frames;return n?function(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(n):null}catch{return Ap&&qp.error(`Cannot extract url for event ${Wf(e)}`),null}}function M_(e,t,n,r,i,a){if(!i.exception?.values||!a||!wf(a.originalException,Error))return;const s=i.exception.values.length>0?i.exception.values[i.exception.values.length-1]:void 0;s&&(i.exception.values=A_(e,t,r,a.originalException,n,i.exception.values,s,0))}function A_(e,t,n,r,i,a,s,o){if(a.length>=n+1)return a;let l=[...a];if(wf(r[i],Error)){D_(s,o,r);const a=e(t,r[i]),c=l.length;R_(a,i,c,o),l=A_(e,t,n,r[i],i,[a,...l],a,c)}return z_(r)&&r.errors.forEach((a,c)=>{if(wf(a,Error)){D_(s,o,r);const u=e(t,a),h=l.length;R_(u,`errors[${c}]`,h,o),l=A_(e,t,n,a,i,[u,...l],u,h)}}),l}function z_(e){return Array.isArray(e.errors)}function D_(e,t,n){e.mechanism={handled:!0,type:"auto.core.linked_errors",...z_(n)&&{is_exception_group:!0},...e.mechanism,exception_id:t}}function R_(e,t,n,r){e.mechanism={handled:!0,...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function L_(){"console"in zp&&jp.forEach(function(e){e in zp.console&&Mf(zp.console,e,function(t){return Fp[e]=t,function(...t){rf("console",{args:t,level:e});const n=Fp[e];n?.apply(zp.console,t)}})})}function N_(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const j_=()=>{let e;return{name:"Dedupe",processEvent(t){if(t.type)return t;try{if(function(e,t){if(!t)return!1;if(function(e,t){const n=e.message,r=t.message;if(!n&&!r)return!1;if(n&&!r||!n&&r)return!1;if(n!==r)return!1;if(!O_(e,t))return!1;if(!F_(e,t))return!1;return!0}(e,t))return!0;if(function(e,t){const n=B_(t),r=B_(e);if(!n||!r)return!1;if(n.type!==r.type||n.value!==r.value)return!1;if(!O_(e,t))return!1;if(!F_(e,t))return!1;return!0}(e,t))return!0;return!1}(t,e))return Ap&&qp.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}};function F_(e,t){let n=Kp(e),r=Kp(t);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let i=0;i<r.length;i++){const e=r[i],t=n[i];if(e.filename!==t.filename||e.lineno!==t.lineno||e.colno!==t.colno||e.function!==t.function)return!1}return!0}function O_(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch{return!1}}function B_(e){return e.exception?.values?.[0]}const V_=()=>({name:"ConversationId",setup(e){e.on("spanStart",e=>{const t=_m().getScopeData(),n=vm().getScopeData(),r=t.conversationId||n.conversationId;r&&e.setAttribute("gen_ai.conversation.id",r)})}});function U_(e,t,n,r,i){if(!e.fetchData)return;const{method:a,url:s}=e.fetchData,o=xg()&&t(s);if(e.endTimestamp&&o){const t=e.fetchData.__span;if(!t)return;const n=r[t];return void(n&&(!function(e,t){if(t.response){Lm(e,t.response.status);const n=t.response?.headers?.get("content-length");if(n){const t=parseInt(n);t>0&&e.setAttribute("http.response_content_length",t)}}else t.error&&e.setStatus({code:2,message:"internal_error"});e.end()}(n,e),function(e,t,n){const r="object"==typeof n&&null!==n?n.onRequestSpanEnd:void 0;r?.(e,{headers:t.response?.headers,error:t.error})}(n,e,i),delete r[t]))}const{spanOrigin:l="auto.http.browser",propagateTraceparent:c=!1}="object"==typeof i?i:{spanOrigin:i},u=!!yg(),h=o&&u?Jg(function(e,t,n){if(e.startsWith("data:")){return{name:`${t} ${f_(e)}`,attributes:$_(e,void 0,t,n)}}const r=d_(e),i=r?function(e){if(h_(e))return e.pathname;const t=new URL(e);return t.search="",t.hash="",["80","443"].includes(t.port)&&(t.port=""),t.password&&(t.password="%filtered%"),t.username&&(t.username="%filtered%"),t.toString()}(r):e;return{name:`${t} ${i}`,attributes:$_(e,r,t,n)}}(s,a,l)):new Ag;if(e.fetchData.__span=h.spanContext().spanId,r[h.spanContext().spanId]=h,n(e.fetchData.url)){const t=e.args[0],n={...e.args[1]||{}},r=function(e,t,n,r){const i=v_({span:n,propagateTraceparent:r}),a=i["sentry-trace"],s=i.baggage,o=i.traceparent;if(!a)return;const l=t.headers||(kf(e)?e.headers:void 0);if(l){if(function(e){return"undefined"!=typeof Headers&&wf(e,Headers)}(l)){const e=new Headers(l);if(e.get("sentry-trace")||e.set("sentry-trace",a),r&&o&&!e.get("traceparent")&&e.set("traceparent",o),s){const t=e.get("baggage");t?q_(t)||e.set("baggage",`${t},${s}`):e.set("baggage",s)}return e}if(Array.isArray(l)){const e=[...l];l.find(e=>"sentry-trace"===e[0])||e.push(["sentry-trace",a]),r&&o&&!l.find(e=>"traceparent"===e[0])&&e.push(["traceparent",o]);const t=l.find(e=>"baggage"===e[0]&&q_(e[1]));return s&&!t&&e.push(["baggage",s]),e}{const e="sentry-trace"in l?l["sentry-trace"]:void 0,t="traceparent"in l?l.traceparent:void 0,n="baggage"in l?l.baggage:void 0,i=n?Array.isArray(n)?[...n]:[n]:[],c=n&&(Array.isArray(n)?n.find(e=>q_(e)):q_(n));s&&!c&&i.push(s);const u={...l,"sentry-trace":e??a,baggage:i.length>0?i.join(","):void 0};return r&&o&&!t&&(u.traceparent=o),u}}return{...i}}(t,n,xg()&&u?h:void 0,c);r&&(e.args[1]=n,n.headers=r)}const d=bm();if(d){const t={input:e.args,response:e.response,startTimestamp:e.startTimestamp,endTimestamp:e.endTimestamp};d.emit("beforeOutgoingRequestSpan",h,t)}return h}function q_(e){return e.split(",").some(e=>e.trim().startsWith(Vm))}function $_(e,t,n,r){const i={url:f_(e),type:"fetch","http.method":n,[Em]:r,[Cm]:"http.client"};return t&&(h_(t)||(i["http.url"]=f_(t.href),i["server.address"]=t.host),t.search&&(i["http.query"]=t.search),t.hash&&(i["http.fragment"]=t.hash)),i}function G_(e){return void 0===e?void 0:e>=400&&e<500?"warning":e>=500?"error":void 0}const H_=zp;function Z_(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function W_(){if("string"==typeof EdgeRuntime)return!0;if(!function(){if(!("fetch"in H_))return!1;try{return new Headers,new Request("data:,"),new Response,!0}catch{return!1}}())return!1;if(Z_(H_.fetch))return!0;let e=!1;const t=H_.document;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow?.fetch&&(e=Z_(n.contentWindow.fetch)),t.head.removeChild(n)}catch(fP){Ap&&qp.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",fP)}return e}function X_(e,t){const n="fetch";tf(n,e),nf(n,()=>Y_(void 0,t))}function Y_(e,t=!1){t&&!W_()||Mf(zp,"fetch",function(t){return function(...n){const r=new Error,{method:i,url:a}=function(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,n]=e;return{url:J_(t),method:Q_(n,"method")?String(n.method).toUpperCase():kf(t)&&Q_(t,"method")?String(t.method).toUpperCase():"GET"}}const t=e[0];return{url:J_(t),method:Q_(t,"method")?String(t.method).toUpperCase():"GET"}}(n),s={args:n,fetchData:{method:i,url:a},startTimestamp:1e3*em(),virtualError:r,headers:ev(n)};return e||rf("fetch",{...s}),t.apply(zp,n).then(async t=>(e?e(t):rf("fetch",{...s,endTimestamp:1e3*em(),response:t}),t),e=>{rf("fetch",{...s,endTimestamp:1e3*em(),error:e}),df(e)&&void 0===e.stack&&(e.stack=r.stack,Af(e,"framesToPop",1));const t=bm(),n=t?.getOptions().enhanceFetchErrorMessages??"always";if(!1!==n&&e instanceof TypeError&&("Failed to fetch"===e.message||"Load failed"===e.message||"NetworkError when attempting to fetch resource."===e.message))try{const t=new URL(s.fetchData.url).host;"always"===n?e.message=`${e.message} (${t})`:Af(e,"__sentry_fetch_url_host__",t)}catch{}throw e})}})}function K_(e){let t;try{t=e.clone()}catch{return}!async function(e,t){if(e?.body){const n=e.body,r=n.getReader(),i=setTimeout(()=>{n.cancel().then(null,()=>{})},9e4);let a=!0;for(;a;){let e;try{e=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:i}=await r.read();clearTimeout(e),i&&(t(),a=!1)}catch{a=!1}finally{clearTimeout(e)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,()=>{})}}(t,()=>{rf("fetch-body-resolved",{endTimestamp:1e3*em(),response:e})})}function Q_(e,t){return!!e&&"object"==typeof e&&!!e[t]}function J_(e){return"string"==typeof e?e:e?Q_(e,"url")?e.url:e.toString?e.toString():"":""}function ev(e){const[t,n]=e;try{if("object"==typeof n&&null!==n&&"headers"in n&&n.headers)return new Headers(n.headers);if(kf(t))return new Headers(t.headers)}catch{}}function tv(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function nv(){return"undefined"!=typeof window&&(!tv()||function(){const e=zp.process;return"renderer"===e?.type}())}const rv=zp;let iv=0;function av(){return iv>0}function sv(e,t={}){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return"function"==typeof t?t:e;if(Df(e))return e}catch{return e}const n=function(...n){try{const r=n.map(e=>sv(e,t));return e.apply(this,r)}catch(r){throw iv++,setTimeout(()=>{iv--}),xm(e=>{e.addEventProcessor(e=>(t.mechanism&&(Xf(e,void 0),Yf(e,t.mechanism)),e.extra={...e.extra,arguments:n},e)),ky(r)}),r}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}catch{}zf(n,e),Af(e,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:()=>e.name})}catch{}return n}function ov(){const e=If(),{referrer:t}=rv.document||{},{userAgent:n}=rv.navigator||{};return{url:e,headers:{...t&&{Referer:t},...n&&{"User-Agent":n}}}}function lv(e,t){const n=hv(e,t),r={type:fv(t),value:mv(t)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function cv(e,t,n,r){const i=bm(),a=i?.getOptions().normalizeDepth,s=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}return}(t),o={__serialized__:Dg(t,a)};if(s)return{exception:{values:[lv(e,s)]},extra:o};const l={exception:{values:[{type:xf(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:_v(t,{isUnhandledRejection:r})}]},extra:o};if(n){const t=hv(e,n);t.length&&(l.exception.values[0].stacktrace={frames:t})}return l}function uv(e,t){return{exception:{values:[lv(e,t)]}}}function hv(e,t){const n=t.stacktrace||t.stack||"",r=function(e){if(e&&dv.test(e.message))return 1;return 0}(t),i=function(e){if("number"==typeof e.framesToPop)return e.framesToPop;return 0}(t);try{return e(n,r,i)}catch{}return[]}const dv=/Minified React error #\d+;/i;function pv(e){return"undefined"!=typeof WebAssembly&&void 0!==WebAssembly.Exception&&e instanceof WebAssembly.Exception}function fv(e){const t=e?.name;if(!t&&pv(e)){return e.message&&Array.isArray(e.message)&&2==e.message.length?e.message[0]:"WebAssembly.Exception"}return t}function mv(e){const t=e?.message;return pv(e)?Array.isArray(e.message)&&2==e.message.length?e.message[1]:"wasm exception":t?t.error&&"string"==typeof t.error.message?c_(t.error):c_(e):"No error message"}function gv(e,t,n,r,i){let a;if(ff(t)&&t.error){return uv(e,t.error)}if(mf(t)||pf(t,"DOMException")){const i=t;if("stack"in t)a=uv(e,t);else{const t=i.name||(mf(i)?"DOMError":"DOMException"),s=i.message?`${t}: ${i.message}`:t;a=yv(e,s,n,r),Xf(a,s)}return"code"in i&&(a.tags={...a.tags,"DOMException.code":`${i.code}`}),a}if(df(t))return uv(e,t);if(vf(t)||xf(t)){return a=cv(e,t,n,i),Yf(a,{synthetic:!0}),a}return a=yv(e,t,n,r),Xf(a,`${t}`),Yf(a,{synthetic:!0}),a}function yv(e,t,n,r){const i={};if(r&&n){const r=hv(e,n);r.length&&(i.exception={values:[{value:t,stacktrace:{frames:r}}]}),Yf(i,{synthetic:!0})}if(yf(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return i.logentry={message:e,params:n},i}return i.message=t,i}function _v(e,{isUnhandledRejection:t}){const n=function(e){const t=Object.keys(Rf(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}(e),r=t?"promise rejection":"exception";if(ff(e))return`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``;if(xf(e)){return`Event \`${function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}(e)}\` (type=${e.type}) captured as ${r}`}return`Object captured as ${r} with keys: ${n}`}class vv extends t_{constructor(e){const t=(n=e,{release:"string"==typeof __SENTRY_RELEASE__?__SENTRY_RELEASE__:rv.SENTRY_RELEASE?.id,sendClientReports:!0,parentSpanIsAlwaysRootSpan:!0,...n});var n;__(t,"browser",["browser"],rv.SENTRY_SDK_SOURCE||"npm"),t._metadata?.sdk&&(t._metadata.sdk.settings={infer_ip:t.sendDefaultPii?"auto":"never",...t._metadata.sdk.settings}),super(t);const{sendDefaultPii:r,sendClientReports:i,enableLogs:a,_experiments:s,enableMetrics:o}=this._options,l=o??s?.enableMetrics??!0;rv.document&&(i||a||l)&&rv.document.addEventListener("visibilitychange",()=>{"hidden"===rv.document.visibilityState&&(i&&this._flushOutcomes(),a&&Ny(this),l&&Fy(this))}),r&&this.on("beforeSendSession",y_)}eventFromException(e,t){return function(e,t,n,r){const i=gv(e,t,n?.syntheticException||void 0,r);return Yf(i),i.level="error",n?.event_id&&(i.event_id=n.event_id),ly(i)}(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return function(e,t,n="info",r,i){const a=yv(e,t,r?.syntheticException||void 0,i);return a.level=n,r?.event_id&&(a.event_id=r.event_id),ly(a)}(this._options.stackParser,e,t,n,this._options.attachStacktrace)}_prepareEvent(e,t,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n,r)}}const xv="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,bv=zp,wv=(e,t,n,r)=>{let i,a;return s=>{t.value>=0&&(s||r)&&(a=t.value-(i??0),(a||void 0===i)&&(i=t.value,t.delta=a,t.rating=((e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good")(t.value,n),e(t)))}},Sv=(e=!0)=>{const t=bv.performance?.getEntriesByType?.("navigation")[0];if(!e||t&&t.responseStart>0&&t.responseStart<performance.now())return t},kv=()=>{const e=Sv();return e?.activationStart??0};function Tv(e,t,n){bv.document&&bv.addEventListener(e,t,n)}function Cv(e,t,n){bv.document&&bv.removeEventListener(e,t,n)}let Ev=-1;const Iv=new Set,Pv=e=>{if(function(e){return"pagehide"===e.type||"hidden"===bv.document?.visibilityState}(e)&&Ev>-1){if("visibilitychange"===e.type||"pagehide"===e.type)for(const e of Iv)e();isFinite(Ev)||(Ev="visibilitychange"===e.type?e.timeStamp:0,Cv("prerenderingchange",Pv,!0))}},Mv=()=>{if(bv.document&&Ev<0){const e=kv(),t=bv.document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0]?.startTime;Ev=t??("hidden"!==bv.document?.visibilityState||bv.document?.prerendering?1/0:0),Tv("visibilitychange",Pv,!0),Tv("pagehide",Pv,!0),Tv("prerenderingchange",Pv,!0)}return{get firstHiddenTime(){return Ev},onHidden(e){Iv.add(e)}}};const Av=(e,t=-1)=>{const n=Sv();let r="navigate";n&&(bv.document?.prerendering||kv()>0?r="prerender":bv.document?.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-")));return{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},zv=new WeakMap;function Dv(e,t){try{return zv.get(e)||zv.set(e,new t),zv.get(e)}catch(WI){return new t}}class Rv{constructor(){Rv.prototype.__init.call(this),Rv.prototype.__init2.call(this)}__init(){this._sessionValue=0}__init2(){this._sessionEntries=[]}_processEntry(e){if(e.hadRecentInput)return;const t=this._sessionEntries[0],n=this._sessionEntries[this._sessionEntries.length-1];this._sessionValue&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this._sessionValue+=e.value,this._sessionEntries.push(e)):(this._sessionValue=e.value,this._sessionEntries=[e]),this._onAfterProcessingUnexpectedShift?.(e)}}const Lv=(e,t,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return r.observe({type:e,buffered:!0,...n}),r}}catch{}},Nv=e=>{let t=!1;return()=>{t||(e(),t=!0)}},jv=e=>{bv.document?.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},Fv=[1800,3e3],Ov=[.1,.25],Bv=(e,t={})=>{((e,t={})=>{jv(()=>{const n=Mv(),r=Av("FCP");let i;const a=Lv("paint",e=>{for(const t of e)"first-contentful-paint"===t.name&&(a.disconnect(),t.startTime<n.firstHiddenTime&&(r.value=Math.max(t.startTime-kv(),0),r.entries.push(t),i(!0)))});a&&(i=wv(e,r,Fv,t.reportAllChanges))})})(Nv(()=>{const n=Av("CLS",0);let r;const i=Mv(),a=Dv(t,Rv),s=e=>{for(const t of e)a._processEntry(t);a._sessionValue>n.value&&(n.value=a._sessionValue,n.entries=a._sessionEntries,r())},o=Lv("layout-shift",s);o&&(r=wv(e,n,Ov,t.reportAllChanges),i.onHidden(()=>{s(o.takeRecords()),r(!0)}),bv?.setTimeout?.(r))}))};let Vv=0,Uv=1/0,qv=0;const $v=e=>{e.forEach(e=>{e.interactionId&&(Uv=Math.min(Uv,e.interactionId),qv=Math.max(qv,e.interactionId),Vv=qv?(qv-Uv)/7+1:0)})};let Gv;const Hv=()=>Gv?Vv:performance.interactionCount||0;let Zv=0;class Wv{constructor(){Wv.prototype.__init.call(this),Wv.prototype.__init2.call(this)}__init(){this._longestInteractionList=[]}__init2(){this._longestInteractionMap=new Map}_resetInteractions(){Zv=Hv(),this._longestInteractionList.length=0,this._longestInteractionMap.clear()}_estimateP98LongestInteraction(){const e=Math.min(this._longestInteractionList.length-1,Math.floor((Hv()-Zv)/50));return this._longestInteractionList[e]}_processEntry(e){if(this._onBeforeProcessingEntry?.(e),!e.interactionId&&"first-input"!==e.entryType)return;const t=this._longestInteractionList.at(-1);let n=this._longestInteractionMap.get(e.interactionId);if(n||this._longestInteractionList.length<10||e.duration>t._latency){if(n?e.duration>n._latency?(n.entries=[e],n._latency=e.duration):e.duration===n._latency&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],_latency:e.duration},this._longestInteractionMap.set(n.id,n),this._longestInteractionList.push(n)),this._longestInteractionList.sort((e,t)=>t._latency-e._latency),this._longestInteractionList.length>10){const e=this._longestInteractionList.splice(10);for(const t of e)this._longestInteractionMap.delete(t.id)}this._onAfterProcessingINPCandidate?.(n)}}}const Xv=e=>{const t=bv.requestIdleCallback||bv.setTimeout;"hidden"===bv.document?.visibilityState?e():(Tv("visibilitychange",e=Nv(e),{once:!0,capture:!0}),Tv("pagehide",e,{once:!0,capture:!0}),t(()=>{e(),Cv("visibilitychange",e,{capture:!0}),Cv("pagehide",e,{capture:!0})}))},Yv=[200,500],Kv=(e,t={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const n=Mv();jv(()=>{"interactionCount"in performance||Gv||(Gv=Lv("event",$v,{type:"event",buffered:!0,durationThreshold:0}));const r=Av("INP");let i;const a=Dv(t,Wv),s=e=>{Xv(()=>{for(const n of e)a._processEntry(n);const t=a._estimateP98LongestInteraction();t&&t._latency!==r.value&&(r.value=t._latency,r.entries=t.entries,i())})},o=Lv("event",s,{durationThreshold:t.durationThreshold??40});i=wv(e,r,Yv,t.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),n.onHidden(()=>{s(o.takeRecords()),i(!0)}))})};class Qv{_processEntry(e){this._onBeforeProcessingEntry?.(e)}}const Jv=[2500,4e3],ex=[800,1800],tx=e=>{bv.document?.prerendering?jv(()=>tx(e)):"complete"!==bv.document?.readyState?addEventListener("load",()=>tx(e),!0):setTimeout(e)},nx={},rx={};let ix,ax,sx,ox;function lx(e,t=!1){return yx("cls",e,px,ix,t)}function cx(e,t=!1){return yx("lcp",e,fx,ax,t)}function ux(e){return yx("inp",e,gx,ox)}function hx(e,t){return _x(e,t),rx[e]||(!function(e){const t={};"event"===e&&(t.durationThreshold=0);Lv(e,t=>{dx(e,{entries:t})},t)}(e),rx[e]=!0),vx(e,t)}function dx(e,t){const n=nx[e];if(n?.length)for(const r of n)try{r(t)}catch(WI){xv&&qp.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Yp(r)}\nError:`,WI)}}function px(){return Bv(e=>{dx("cls",{metric:e}),ix=e},{reportAllChanges:!0})}function fx(){return((e,t={})=>{jv(()=>{const n=Mv(),r=Av("LCP");let i;const a=Dv(t,Qv),s=e=>{t.reportAllChanges||(e=e.slice(-1));for(const t of e)a._processEntry(t),t.startTime<n.firstHiddenTime&&(r.value=Math.max(t.startTime-kv(),0),r.entries=[t],i())},o=Lv("largest-contentful-paint",s);if(o){i=wv(e,r,Jv,t.reportAllChanges);const n=Nv(()=>{s(o.takeRecords()),o.disconnect(),i(!0)}),a=e=>{e.isTrusted&&(Xv(n),Cv(e.type,a,{capture:!0}))};for(const e of["keydown","click","visibilitychange"])Tv(e,a,{capture:!0})}})})(e=>{dx("lcp",{metric:e}),ax=e},{reportAllChanges:!0})}function mx(){return((e,t={})=>{const n=Av("TTFB"),r=wv(e,n,ex,t.reportAllChanges);tx(()=>{const e=Sv();e&&(n.value=Math.max(e.responseStart-kv(),0),n.entries=[e],r(!0))})})(e=>{dx("ttfb",{metric:e}),sx=e})}function gx(){return Kv(e=>{dx("inp",{metric:e}),ox=e})}function yx(e,t,n,r,i=!1){let a;return _x(e,t),rx[e]||(a=n(),rx[e]=!0),r&&t({metric:r}),vx(e,t,i?a:void 0)}function _x(e,t){nx[e]=nx[e]||[],nx[e].push(t)}function vx(e,t,n){return()=>{n&&n();const r=nx[e];if(!r)return;const i=r.indexOf(t);-1!==i&&r.splice(i,1)}}function xx(e){return"number"==typeof e&&isFinite(e)}function bx(e,t,n,{...r}){const i=cg(e).start_timestamp;return i&&i>t&&"function"==typeof e.updateStartTime&&e.updateStartTime(t),ey(e,()=>{const e=Jg({startTime:t,...r});return e&&e.end(n),e})}function wx(e){const t=bm();if(!t)return;const{name:n,transaction:r,attributes:i,startTime:a}=e,{release:s,environment:o,sendDefaultPii:l}=t.getOptions(),c=t.getIntegrationByName("Replay"),u=c?.getReplayId(),h=_m(),d=h.getUser(),p=void 0!==d?d.email||d.id||d.ip_address:void 0;let f;try{f=h.getScopeData().contexts.profile.profile_id}catch{}return Jg({name:n,attributes:{release:s,environment:o,user:p||void 0,profile_id:f||void 0,replay_id:u||void 0,transaction:r,"user_agent.original":bv.navigator?.userAgent,"client.address":l?"{{auto}}":void 0,...i},startTime:a,experimental:{standalone:!0}})}function Sx(){return bv.addEventListener&&bv.performance}function kx(e){return e/1e3}function Tx(e){try{return PerformanceObserver.supportedEntryTypes.includes(e)}catch{return!1}}function Cx(e,t){let n,r=!1;function i(e){!r&&n&&t(e,n),r=!0}(e=>{const t=t=>{"pagehide"!==t.type&&"hidden"!==bv.document?.visibilityState||e(t)};Tv("visibilitychange",t,{capture:!0,once:!0}),Tv("pagehide",t,{capture:!0,once:!0})})(()=>{i("pagehide")});const a=e.on("beforeStartNavigationSpan",(e,t)=>{t?.isRedirect||(i("navigation"),a(),s())}),s=e.on("afterStartPageLoadSpan",e=>{n=e.spanContext().spanId,s()})}function Ex(e){let t,n=0;if(!Tx("layout-shift"))return;const r=lx(({metric:e})=>{const r=e.entries[e.entries.length-1];r&&(n=e.value,t=r)},!0);Cx(e,(e,i)=>{!function(e,t,n,r){xv&&qp.log(`Sending CLS span (${e})`);const i=t?kx((nm()||0)+t.startTime):em(),a=_m().getScopeData().transactionName,s=t?Cf(t.sources[0]?.node):"Layout shift",o={[Em]:"auto.http.browser.cls",[Cm]:"ui.webvital.cls",[Dm]:0,"sentry.pageload.span_id":n,"sentry.report_event":r};t?.sources&&t.sources.forEach((e,t)=>{o[`cls.source.${t+1}`]=Cf(e.node)});const l=wx({name:s,transaction:a,attributes:o,startTime:i});l&&(l.addEvent("cls",{[Pm]:"",[Mm]:e}),l.end(i))}(n,t,i,e),r()})}function Ix(e){let t,n=0;if(!Tx("largest-contentful-paint"))return;const r=cx(({metric:e})=>{const r=e.entries[e.entries.length-1];r&&(n=e.value,t=r)},!0);Cx(e,(e,i)=>{!function(e,t,n,r){xv&&qp.log(`Sending LCP span (${e})`);const i=kx((nm()||0)+(t?.startTime||0)),a=_m().getScopeData().transactionName,s=t?Cf(t.element):"Largest contentful paint",o={[Em]:"auto.http.browser.lcp",[Cm]:"ui.webvital.lcp",[Dm]:0,"sentry.pageload.span_id":n,"sentry.report_event":r};t&&(t.element&&(o["lcp.element"]=Cf(t.element)),t.id&&(o["lcp.id"]=t.id),t.url&&(o["lcp.url"]=t.url),null!=t.loadTime&&(o["lcp.loadTime"]=t.loadTime),null!=t.renderTime&&(o["lcp.renderTime"]=t.renderTime),null!=t.size&&(o["lcp.size"]=t.size));const l=wx({name:s,transaction:a,attributes:o,startTime:i});l&&(l.addEvent("lcp",{[Pm]:"millisecond",[Mm]:e}),l.end(i))}(n,t,i,e),r()})}function Px(e){return e?((nm()||performance.timeOrigin)+e)/1e3:e}function Mx(e){const t={};if(null!=e.nextHopProtocol){const{name:n,version:r}=function(e){let t="unknown",n="unknown",r="";for(const i of e){if("/"===i){[t,n]=e.split("/");break}if(!isNaN(Number(i))){t="h"===r?"http":r,n=e.split(r)[1];break}r+=i}return r===e&&(t=r),{name:t,version:n}}(e.nextHopProtocol);t["network.protocol.version"]=r,t["network.protocol.name"]=n}return nm()||Sx()?.timeOrigin?(n={...t,"http.request.redirect_start":Px(e.redirectStart),"http.request.redirect_end":Px(e.redirectEnd),"http.request.worker_start":Px(e.workerStart),"http.request.fetch_start":Px(e.fetchStart),"http.request.domain_lookup_start":Px(e.domainLookupStart),"http.request.domain_lookup_end":Px(e.domainLookupEnd),"http.request.connect_start":Px(e.connectStart),"http.request.secure_connection_start":Px(e.secureConnectionStart),"http.request.connection_end":Px(e.connectEnd),"http.request.request_start":Px(e.requestStart),"http.request.response_start":Px(e.responseStart),"http.request.response_end":Px(e.responseEnd),"http.request.time_to_first_byte":null!=e.responseStart?e.responseStart/1e3:void 0},Object.fromEntries(Object.entries(n).filter(([,e])=>null!=e))):t;var n}const Ax=2147483647;let zx,Dx,Rx=0,Lx={};function Nx({recordClsStandaloneSpans:e,recordLcpStandaloneSpans:t,client:n}){const r=Sx();if(r&&nm()){r.mark&&bv.performance.mark("sentry-tracing-init");const i=t?Ix(n):cx(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Lx.lcp={value:e.value,unit:"millisecond"},zx=t)},!0),a=yx("ttfb",({metric:e})=>{e.entries[e.entries.length-1]&&(Lx.ttfb={value:e.value,unit:"millisecond"})},mx,sx),s=e?Ex(n):lx(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Lx.cls={value:e.value,unit:""},Dx=t)},!0);return()=>{i?.(),a(),s?.()}}return()=>{}}function jx(e,t){const n=Sx(),r=nm();if(!n?.getEntries||!r)return;const i=kx(r),a=n.getEntries(),{op:s,start_timestamp:o}=cg(e);a.slice(Rx).forEach(n=>{const r=kx(n.startTime),a=kx(Math.max(0,n.duration));if(!("navigation"===s&&o&&i+r<o))switch(n.entryType){case"navigation":!function(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{Fx(e,t,r,n)}),Fx(e,t,"secureConnection",n,"TLS/SSL"),Fx(e,t,"fetch",n,"cache"),Fx(e,t,"domainLookup",n,"DNS"),function(e,t,n){const r=n+kx(t.requestStart),i=n+kx(t.responseEnd),a=n+kx(t.responseStart);t.responseEnd&&(bx(e,r,i,{op:"browser.request",name:t.name,attributes:{[Em]:"auto.ui.browser.metrics"}}),bx(e,a,i,{op:"browser.response",name:t.name,attributes:{[Em]:"auto.ui.browser.metrics"}}))}(e,t,n)}(e,n,i);break;case"mark":case"paint":case"measure":{!function(e,t,n,r,i,a){if(function(e){if("measure"!==e?.entryType)return;try{return"Components "===e.detail.devtools.track}catch{return}}(t))return;if(["mark","measure"].includes(t.entryType)&&Gf(t.name,a))return;const s=Sv(!1),o=kx(s?s.requestStart:0),l=i+Math.max(n,o),c=i+n,u=c+r,h={[Em]:"auto.resource.browser.metrics"};l!==c&&(h["sentry.browser.measure_happened_before_request"]=!0,h["sentry.browser.measure_start_time"]=l);(function(e,t){try{const n=t.detail;if(!n)return;if("object"==typeof n){for(const[t,r]of Object.entries(n))if(r&&_f(r))e[`sentry.browser.measure.detail.${t}`]=r;else if(void 0!==r)try{e[`sentry.browser.measure.detail.${t}`]=JSON.stringify(r)}catch{}return}if(_f(n))return void(e["sentry.browser.measure.detail"]=n);try{e["sentry.browser.measure.detail"]=JSON.stringify(n)}catch{}}catch{}})(h,t),l<=u&&bx(e,l,u,{name:t.name,op:t.entryType,attributes:h})}(e,n,r,a,i,t.ignorePerformanceApiSpans);const s=Mv(),o=n.startTime<s.firstHiddenTime;"first-paint"===n.name&&o&&(Lx.fp={value:n.startTime,unit:"millisecond"}),"first-contentful-paint"===n.name&&o&&(Lx.fcp={value:n.startTime,unit:"millisecond"});break}case"resource":!function(e,t,n,r,i,a,s){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const o=t.initiatorType?`resource.${t.initiatorType}`:"resource.other";if(s?.includes(o))return;const l={[Em]:"auto.resource.browser.metrics"},c=p_(n);c.protocol&&(l["url.scheme"]=c.protocol.split(":").pop());c.host&&(l["server.address"]=c.host);l["url.same_origin"]=n.includes(bv.location.origin),function(e,t,n){n.forEach(([n,r])=>{const i=e[n];null!=i&&("number"==typeof i&&i<Ax||"string"==typeof i)&&(t[r]=i)})}(t,l,[["responseStatus","http.response.status_code"],["transferSize","http.response_transfer_size"],["encodedBodySize","http.response_content_length"],["decodedBodySize","http.decoded_response_content_length"],["renderBlockingStatus","resource.render_blocking_status"],["deliveryType","http.response_delivery_type"]]);const u={...l,...Mx(t)},h=a+r,d=h+i;bx(e,h,d,{name:n.replace(bv.location.origin,""),op:o,attributes:u})}(e,n,n.name,r,a,i,t.ignoreResourceSpans)}}),Rx=Math.max(a.length-1,0),function(e){const t=bv.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&e.setAttribute("connectionType",n.type),xx(n.rtt)&&(Lx["connection.rtt"]={value:n.rtt,unit:"millisecond"}));xx(t.deviceMemory)&&e.setAttribute("deviceMemory",`${t.deviceMemory} GB`);xx(t.hardwareConcurrency)&&e.setAttribute("hardwareConcurrency",String(t.hardwareConcurrency))}(e),"pageload"===s&&(function(e){const t=Sv(!1);if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}(Lx),t.recordClsOnPageloadSpan||delete Lx.cls,t.recordLcpOnPageloadSpan||delete Lx.lcp,Object.entries(Lx).forEach(([e,t])=>{!function(e,t,n,r=yg()){const i=r&&gg(r);i&&(Ap&&qp.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),i.addEvent(e,{[Mm]:t,[Pm]:n}))}(e,t.value,t.unit)}),e.setAttribute("performance.timeOrigin",i),e.setAttribute("performance.activationStart",kv()),function(e,t){zx&&t.recordLcpOnPageloadSpan&&(zx.element&&e.setAttribute("lcp.element",Cf(zx.element)),zx.id&&e.setAttribute("lcp.id",zx.id),zx.url&&e.setAttribute("lcp.url",zx.url.trim().slice(0,200)),null!=zx.loadTime&&e.setAttribute("lcp.loadTime",zx.loadTime),null!=zx.renderTime&&e.setAttribute("lcp.renderTime",zx.renderTime),e.setAttribute("lcp.size",zx.size));Dx?.sources&&t.recordClsOnPageloadSpan&&Dx.sources.forEach((t,n)=>e.setAttribute(`cls.source.${n+1}`,Cf(t.node)))}(e,t)),zx=void 0,Dx=void 0,Lx={}}function Fx(e,t,n,r,i=n){const a=function(e){if("secureConnection"===e)return"connectEnd";if("fetch"===e)return"domainLookupStart";return`${e}End`}(n),s=t[a],o=t[`${n}Start`];o&&s&&bx(e,r+kx(o),r+kx(s),{op:`browser.${i}`,name:t.name,attributes:{[Em]:"auto.ui.browser.metrics",..."redirect"===n&&null!=t.redirectCount?{"http.redirect_count":t.redirectCount}:{}}})}const Ox=({entries:e})=>{const t=yg(),n=t?gg(t):void 0,r=n?cg(n).description:_m().getScopeData().transactionName;e.forEach(e=>{const t=e;if(!t.identifier)return;const n=t.name,i=t.renderTime,a=t.loadTime,[s,o]=a?[kx(a),"load-time"]:i?[kx(i),"render-time"]:[em(),"entry-emission"],l="image-paint"===n?kx(Math.max(0,(i??0)-(a??0))):0,c={[Em]:"auto.ui.browser.elementtiming",[Cm]:"ui.elementtiming",[Sm]:"component","sentry.span_start_time_source":o,"sentry.transaction_name":r,"element.id":t.id,"element.type":t.element?.tagName?.toLowerCase()||"unknown","element.size":t.naturalWidth&&t.naturalHeight?`${t.naturalWidth}x${t.naturalHeight}`:void 0,"element.render_time":i,"element.load_time":a,"element.url":t.url||void 0,"element.identifier":t.identifier,"element.paint_type":n};Qg({name:`element[${t.identifier}]`,attributes:c,startTime:s,onlyIfParent:!0},e=>{e.end(s+l)})})};let Bx,Vx,Ux,qx;function $x(e){tf("dom",e),nf("dom",Gx)}function Gx(){if(!bv.document)return;const e=rf.bind(null,"dom"),t=Hx(e,!0);bv.document.addEventListener("click",t,!1),bv.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach(t=>{const n=bv,r=n[t]?.prototype;r?.hasOwnProperty?.("addEventListener")&&(Mf(r,"addEventListener",function(t){return function(n,r,i){if("click"===n||"keypress"==n)try{const r=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},a=r[n]=r[n]||{refCount:0};if(!a.handler){const r=Hx(e);a.handler=r,t.call(this,n,r,i)}a.refCount++}catch{}return t.call(this,n,r,i)}}),Mf(r,"removeEventListener",function(e){return function(t,n,r){if("click"===t||"keypress"==t)try{const n=this.__sentry_instrumentation_handlers__||{},i=n[t];i&&(i.refCount--,i.refCount<=0&&(e.call(this,t,i.handler,r),i.handler=void 0,delete n[t]),0===Object.keys(n).length&&delete this.__sentry_instrumentation_handlers__)}catch{}return e.call(this,t,n,r)}}))})}function Hx(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=function(e){try{return e.target}catch{return null}}(n);if(function(e,t){return"keypress"===e&&(!t?.tagName||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)}(n.type,r))return;Af(n,"_sentryCaptured",!0),r&&!r._sentryId&&Af(r,"_sentryId",Hf());const i="keypress"===n.type?"input":n.type;if(!function(e){if(e.type!==Vx)return!1;try{if(!e.target||e.target._sentryId!==Ux)return!1}catch{}return!0}(n)){e({event:n,name:i,global:t}),Vx=n.type,Ux=r?r._sentryId:void 0}clearTimeout(Bx),Bx=bv.setTimeout(()=>{Ux=void 0,Vx=void 0},1e3)}}function Zx(e){const t="history";tf(t,e),nf(t,Wx)}function Wx(){function e(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const r=qx,i=function(e){try{return new URL(e,bv.location.origin).toString()}catch{return e}}(String(n));if(qx=i,r===i)return e.apply(this,t);rf("history",{from:r,to:i})}return e.apply(this,t)}}bv.addEventListener("popstate",()=>{const e=bv.location.href,t=qx;if(qx=e,t===e)return;rf("history",{from:t,to:e})}),"history"in H_&&H_.history&&(Mf(bv.history,"pushState",e),Mf(bv.history,"replaceState",e))}const Xx={};function Yx(e){const t=Xx[e];if(t)return t;let n=bv[e];if(Z_(n))return Xx[e]=n.bind(bv);const r=bv.document;if(r&&"function"==typeof r.createElement)try{const t=r.createElement("iframe");t.hidden=!0,r.head.appendChild(t);const i=t.contentWindow;i?.[e]&&(n=i[e]),r.head.removeChild(t)}catch(WI){xv&&qp.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,WI)}return n?Xx[e]=n.bind(bv):n}function Kx(...e){return Yx("setTimeout")(...e)}const Qx="__sentry_xhr_v3__";function Jx(e){tf("xhr",e),nf("xhr",eb)}function eb(){if(!bv.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;e.open=new Proxy(e.open,{apply(e,t,n){const r=new Error,i=1e3*em(),a=gf(n[0])?n[0].toUpperCase():void 0,s=function(e){if(gf(e))return e;try{return e.toString()}catch{}return}(n[1]);if(!a||!s)return e.apply(t,n);t[Qx]={method:a,url:s,request_headers:{}},"POST"===a&&s.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const o=()=>{const e=t[Qx];if(e&&4===t.readyState){try{e.status_code=t.status}catch{}rf("xhr",{endTimestamp:1e3*em(),startTimestamp:i,xhr:t,virtualError:r})}};return"onreadystatechange"in t&&"function"==typeof t.onreadystatechange?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply:(e,t,n)=>(o(),e.apply(t,n))}):t.addEventListener("readystatechange",o),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(e,t,n){const[r,i]=n,a=t[Qx];return a&&gf(r)&&gf(i)&&(a.request_headers[r.toLowerCase()]=i),e.apply(t,n)}}),e.apply(t,n)}}),e.send=new Proxy(e.send,{apply(e,t,n){const r=t[Qx];if(!r)return e.apply(t,n);void 0!==n[0]&&(r.body=n[0]);return rf("xhr",{startTimestamp:1e3*em(),xhr:t}),e.apply(t,n)}})}const tb=Symbol.for("sentry__originalRequestBody");function nb(e){return new URLSearchParams(e).toString()}function rb(e,t=qp){try{if("string"==typeof e)return[e];if(e instanceof URLSearchParams)return[e.toString()];if(e instanceof FormData)return[nb(e)];if(!e)return[void 0]}catch(n){return xv&&t.error(n,"Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return xv&&t.log("Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}function ib(e=[]){if(e.length>=2&&e[1]&&"object"==typeof e[1]&&"body"in e[1])return e[1].body;if(e.length>=1&&e[0]instanceof Request){const t=e[0][tb];return void 0!==t?t:void 0}}function ab(e){let t;try{t=e.getAllResponseHeaders()}catch(n){return xv&&qp.error(n,"Failed to get xhr response headers",e),{}}return t?t.split("\r\n").reduce((e,t)=>{const[n,r]=t.split(": ");return r&&(e[n.toLowerCase()]=r),e},{}):{}}const sb=[],ob=new Map,lb=new Map;function cb(){if(Sx()&&nm()){const e=ux(hb);return()=>{e()}}return()=>{}}const ub={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};const hb=({metric:e})=>{if(null==e.value)return;const t=kx(e.value);if(t>60)return;const n=e.entries.find(t=>t.duration===e.value&&ub[t.name]);if(!n)return;const{interactionId:r}=n,i=ub[n.name],a=kx(nm()+n.startTime),s=yg(),o=s?gg(s):void 0,l=null!=r?ob.get(r):void 0,c=l?.span||o,u=c?cg(c).description:_m().getScopeData().transactionName,h=wx({name:l?.elementName||Cf(n.target),transaction:u,attributes:{[Em]:"auto.http.browser.inp",[Cm]:`ui.interaction.${i}`,[Dm]:n.duration},startTime:a});h&&(h.addEvent("inp",{[Pm]:"millisecond",[Mm]:e.value}),h.end(a+t))};function db(){const e=Object.keys(ub);function t(e){const t=e.target;if(!t)return;const n=Cf(t),r=Math.round(e.timeStamp);if(lb.set(r,n),lb.size>50){const e=lb.keys().next().value;void 0!==e&&lb.delete(e)}}nv()&&e.forEach(e=>{bv.addEventListener(e,t,{capture:!0,passive:!0})});const n=({entries:e})=>{const t=yg(),n=t&&gg(t);e.forEach(e=>{if(!function(e){return"duration"in e}(e))return;const t=e.interactionId;if(null==t)return;if(ob.has(t))return;const r=e.target?Cf(e.target):function(e){const t=Math.round(e.startTime);let n=lb.get(t);if(!n)for(let r=-5;r<=5;r++){const e=lb.get(t+r);if(e){n=e;break}}return n||"<unknown>"}(e);if(sb.length>10){const e=sb.shift();ob.delete(e)}sb.push(t),ob.set(t,{span:n,elementName:r})})};hx("event",n),hx("first-input",n)}function pb(e,t=Yx("fetch")){let n=0,r=0;return $y(e,async function(i){const a=i.body.length;n+=a,r++;const s={body:i.body,method:"POST",referrerPolicy:"strict-origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};try{const n=await t(e.url,s);return{statusCode:n.status,headers:{"x-sentry-rate-limits":n.headers.get("X-Sentry-Rate-Limits"),"retry-after":n.headers.get("Retry-After")}}}catch(WI){throw Xx["fetch"]=void 0,WI}finally{n-=a,r--}},Vy(e.bufferSize||40))}const fb="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function mb(e,t,n,r){const i={filename:e,function:"<anonymous>"===t?$p:t,in_app:!0};return void 0!==n&&(i.lineno=n),void 0!==r&&(i.colno=r),i}const gb=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,yb=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,_b=/\((\S*)(?::(\d+))(?::(\d+))\)/,vb=/at (.+?) ?\(data:(.+?),/,xb=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,bb=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,wb=Zp(...[[30,e=>{const t=e.match(vb);if(t)return{filename:`<data:${t[2]}>`,function:t[1]};const n=gb.exec(e);if(n){const[,e,t,r]=n;return mb(e,$p,+t,+r)}const r=yb.exec(e);if(r){if(r[2]&&0===r[2].indexOf("eval")){const e=_b.exec(r[2]);e&&(r[2]=e[1],r[3]=e[2],r[4]=e[3])}const[e,t]=Sb(r[1]||$p,r[2]);return mb(t,e,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}}],[50,e=>{const t=xb.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=bb.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||$p;return[n,e]=Sb(n,e),mb(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}}]]),Sb=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:$p,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},kb=1024,Tb=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:"Breadcrumbs",setup(e){t.console&&function(e){const t="console";tf(t,e),nf(t,L_)}(function(e){return function(t){if(bm()!==e)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:N_(t.level),message:qf(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;n.message=`Assertion failed: ${qf(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1)}b_(n,{input:t.args,level:t.level})}}(e)),t.dom&&$x(function(e,t){return function(n){if(bm()!==e)return;let r,i,a="object"==typeof t?t.serializeAttribute:void 0,s="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;s&&s>kb&&(fb&&qp.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${s} was configured. Sentry will use 1024 instead.`),s=kb),"string"==typeof a&&(a=[a]);try{const e=n.event,t=function(e){return!!e&&!!e.target}(e)?e.target:e;r=Cf(t,{keyAttrs:a,maxStringLength:s}),i=Pf(t)}catch{r="<unknown>"}if(0===r.length)return;const o={category:`ui.${n.name}`,message:r};i&&(o.data={"ui.component_name":i}),b_(o,{event:n.event,name:n.name,global:n.global})}}(e,t.dom)),t.xhr&&Jx(function(e){return function(t){if(bm()!==e)return;const{startTimestamp:n,endTimestamp:r}=t,i=t.xhr[Qx];if(!n||!r||!i)return;const{method:a,url:s,status_code:o,body:l}=i,c={method:a,url:s,status_code:o},u={xhr:t.xhr,input:l,startTimestamp:n,endTimestamp:r},h={category:"xhr",data:c,type:"http",level:G_(o)};e.emit("beforeOutgoingRequestBreadcrumb",h,u),b_(h,u)}}(e)),t.fetch&&X_(function(e){return function(t){if(bm()!==e)return;const{startTimestamp:n,endTimestamp:r}=t;if(r&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.fetchData.method,t.fetchData.url,t.error){const i=t.fetchData,a={data:t.error,input:t.args,startTimestamp:n,endTimestamp:r},s={category:"fetch",data:i,level:"error",type:"http"};e.emit("beforeOutgoingRequestBreadcrumb",s,a),b_(s,a)}else{const i=t.response,a={...t.fetchData,status_code:i?.status};t.fetchData.request_body_size,t.fetchData.response_body_size;const s={input:t.args,response:i,startTimestamp:n,endTimestamp:r},o={category:"fetch",data:a,type:"http",level:G_(a.status_code)};e.emit("beforeOutgoingRequestBreadcrumb",o,s),b_(o,s)}}}(e)),t.history&&Zx(function(e){return function(t){if(bm()!==e)return;let n=t.from,r=t.to;const i=p_(rv.location.href);let a=n?p_(n):void 0;const s=p_(r);a?.path||(a=i),i.protocol===s.protocol&&i.host===s.host&&(r=s.relative),i.protocol===a.protocol&&i.host===a.host&&(n=a.relative),b_({category:"navigation",data:{from:n,to:r}})}}(e)),t.sentry&&e.on("beforeSendEvent",function(e){return function(t){bm()===e&&b_({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:Wf(t)},{event:t})}}(e))}}};const Cb=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Eb=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,unregisterOriginalCallbacks:!1,...e};return{name:"BrowserApiErrors",setupOnce(){t.setTimeout&&Mf(rv,"setTimeout",Ib),t.setInterval&&Mf(rv,"setInterval",Ib),t.requestAnimationFrame&&Mf(rv,"requestAnimationFrame",Pb),t.XMLHttpRequest&&"XMLHttpRequest"in rv&&Mf(XMLHttpRequest.prototype,"send",Mb);const e=t.eventTarget;if(e){(Array.isArray(e)?e:Cb).forEach(e=>function(e,t){const n=rv,r=n[e]?.prototype;if(!r?.hasOwnProperty?.("addEventListener"))return;Mf(r,"addEventListener",function(n){return function(r,i,a){try{"function"==typeof i.handleEvent&&(i.handleEvent=sv(i.handleEvent,{mechanism:{data:{handler:Yp(i),target:e},handled:!1,type:"auto.browser.browserapierrors.handleEvent"}}))}catch{}return t.unregisterOriginalCallbacks&&function(e,t,n){e&&"object"==typeof e&&"removeEventListener"in e&&"function"==typeof e.removeEventListener&&e.removeEventListener(t,n)}(this,r,i),n.apply(this,[r,sv(i,{mechanism:{data:{handler:Yp(i),target:e},handled:!1,type:"auto.browser.browserapierrors.addEventListener"}}),a])}}),Mf(r,"removeEventListener",function(e){return function(t,n,r){try{const i=n.__sentry_wrapped__;i&&e.call(this,t,i,r)}catch{}return e.call(this,t,n,r)}})}(e,t))}}}};function Ib(e){return function(...t){const n=t[0];return t[0]=sv(n,{mechanism:{handled:!1,type:`auto.browser.browserapierrors.${Yp(e)}`}}),e.apply(this,t)}}function Pb(e){return function(t){return e.apply(this,[sv(t,{mechanism:{data:{handler:Yp(e)},handled:!1,type:"auto.browser.browserapierrors.requestAnimationFrame"}})])}}function Mb(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(e=>{e in n&&"function"==typeof n[e]&&Mf(n,e,function(t){const n={mechanism:{data:{handler:Yp(t)},handled:!1,type:`auto.browser.browserapierrors.xhr.${e}`}},r=Df(t);return r&&(n.mechanism.data.handler=Yp(r)),sv(t,n)})}),e.apply(this,t)}}const Ab=()=>({name:"BrowserSession",setupOnce(){void 0!==rv.document?(Ey({ignoreDuration:!0}),My(),Zx(({from:e,to:t})=>{void 0!==e&&e!==t&&(Ey({ignoreDuration:!0}),My())})):fb&&qp.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),zb=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(!function(e){sf(t=>{const{stackParser:n,attachStacktrace:r}=Rb();if(bm()!==e||av())return;const{msg:i,url:a,line:s,column:o,error:l}=t,c=function(e,t,n,r){const i=e.exception=e.exception||{},a=i.values=i.values||[],s=a[0]=a[0]||{},o=s.stacktrace=s.stacktrace||{},l=o.frames=o.frames||[],c=r,u=n,h=function(e){if(!gf(e)||0===e.length)return;if(e.startsWith("data:"))return`<${f_(e,!1)}>`;return e}(t)??If();0===l.length&&l.push({colno:c,filename:h,function:$p,in_app:!0,lineno:u});return e}(gv(n,l||i,void 0,r,!1),a,s,o);c.level="error",Ty(c,{originalException:l,mechanism:{handled:!1,type:"auto.browser.global_handlers.onerror"}})})}(e),Db("onerror")),t.onunhandledrejection&&(!function(e){cf(t=>{const{stackParser:n,attachStacktrace:r}=Rb();if(bm()!==e||av())return;const i=function(e){if(_f(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}(t),a=_f(i)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(i)}`}]}}:gv(n,i,void 0,r,!0);a.level="error",Ty(a,{originalException:i,mechanism:{handled:!1,type:"auto.browser.global_handlers.onunhandledrejection"}})})}(e),Db("onunhandledrejection"))}}};function Db(e){fb&&qp.log(`Global Handler attached: ${e}`)}function Rb(){const e=bm();return e?.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Lb=()=>({name:"HttpContext",preprocessEvent(e){if(!rv.navigator&&!rv.location&&!rv.document)return;const t=ov(),n={...t.headers,...e.request?.headers};e.request={...t,...e.request,headers:n}}}),Nb=(e={})=>{const t=e.limit||5,n=e.key||"cause";return{name:"LinkedErrors",preprocessEvent(e,r,i){M_(lv,i.getOptions().stackParser,n,t,e,r)}}};function jb(){return!!function(){if(void 0===rv.window)return!1;const e=rv;if(e.nw)return!1;const t=e.chrome||e.browser;if(!t?.runtime?.id)return!1;const n=If(),r=["chrome-extension","moz-extension","ms-browser-extension","safari-web-extension"];return!(rv===rv.top&&r.some(e=>n.startsWith(`${e}://`)))}()&&(fb&&Op(()=>{}),!0)}function Fb(e={}){const t=!e.skipBrowserExtensionCheck&&jb();let n=null==e.defaultIntegrations?[E_(),k_(),V_(),Eb(),Tb(),zb(),Nb(),j_(),Lb(),Ab()]:e.defaultIntegrations;const r={...e,enabled:!t&&e.enabled,stackParser:(i=e.stackParser||wb,Array.isArray(i)?Zp(...i):i),integrations:Dy({integrations:e.integrations,defaultIntegrations:n}),transport:e.transport||pb};var i;return u_(vv,r)}const Ob=zp,Bb="sentryReplaySession",Vb="Unable to send Replay",Ub=15e4,qb=5e3,$b=2e7,Gb=36e5;var Hb=Object.defineProperty,Zb=(e,t,n)=>((e,t,n)=>t in e?Hb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),Wb=(e=>(e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment",e))(Wb||{});function Xb(e){const t=e?.host;return Boolean(t?.shadowRoot===e)}function Yb(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function Kb(e){try{const n=e.rules||e.cssRules;return n?((t=Array.from(n,Qb).join("")).includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),t):null}catch(n){return null}var t}function Qb(e){let t;if(function(e){return"styleSheet"in e}(e))try{t=Kb(e.styleSheet)||function(e){const{cssText:t}=e;if(t.split('"').length<3)return t;const n=["@import",`url(${JSON.stringify(e.href)})`];return""===e.layerName?n.push("layer"):e.layerName&&n.push(`layer(${e.layerName})`),e.supportsText&&n.push(`supports(${e.supportsText})`),e.media.length&&n.push(e.media.mediaText),n.join(" ")+";"}(e)}catch(n){}else if(function(e){return"selectorText"in e}(e)){let t=e.cssText;const n=e.selectorText.includes(":"),r="string"==typeof e.style.all&&e.style.all;if(r&&(t=function(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style,i=r[n],a=r.getPropertyPriority(i);t+=`${i}:${r.getPropertyValue(i)}${a?" !important":""};`}return`${e.selectorText} { ${t} }`}(e)),n&&(t=function(e){const t=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return e.replace(t,"$1\\$2")}(t)),n||r)return t}return t||e.cssText}class Jb{constructor(){Zb(this,"idNodeMap",new Map),Zb(this,"nodeMetaMap",new WeakMap)}getId(e){if(!e)return-1;const t=this.getMeta(e)?.id;return t??-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach(e=>this.removeNodeFromMap(e))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const n=t.id;this.idNodeMap.set(n,e),this.nodeMetaMap.set(e,t)}replace(e,t){const n=this.getNode(e);if(n){const e=this.nodeMetaMap.get(n);e&&this.nodeMetaMap.set(t,e)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function ew({maskInputOptions:e,tagName:t,type:n}){return"OPTION"===t&&(t="SELECT"),Boolean(e[t.toLowerCase()]||n&&e[n]||"password"===n||"INPUT"===t&&!n&&e.text)}function tw({isMasked:e,element:t,value:n,maskInputFn:r}){let i=n||"";return e?(r&&(i=r(i,t)),"*".repeat(i.length)):i}function nw(e){return e.toLowerCase()}function rw(e){return e.toUpperCase()}const iw="__rrweb_original__";function aw(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?nw(t):null}function sw(e,t,n){return"INPUT"!==t||"radio"!==n&&"checkbox"!==n?e.value:e.getAttribute("value")||""}function ow(e,t){let n;try{n=new URL(e,t??window.location.href)}catch(fP){return null}const r=n.pathname.match(/\.([0-9a-z]+)(?:$)/i);return r?.[1]??null}const lw={};function cw(e){const t=lw[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const i=t.contentWindow;i&&i[e]&&(r=i[e]),n.head.removeChild(t)}catch(WI){}return lw[e]=r.bind(window)}function uw(...e){return cw("setTimeout")(...e)}function hw(...e){return cw("clearTimeout")(...e)}function dw(e){try{return e.contentDocument}catch(WI){}}let pw=1;const fw=new RegExp("[^a-z0-9-_:]");function mw(){return pw++}let gw,yw;const _w=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,vw=/^(?:[a-z+]+:)?\/\//i,xw=/^www\..*/i,bw=/^(data:)([^,]*),(.*)/i;function ww(e,t){return(e||"").replace(_w,(e,n,r,i,a,s)=>{const o=r||a||s,l=n||i||"";if(!o)return e;if(vw.test(o)||xw.test(o))return`url(${l}${o}${l})`;if(bw.test(o))return`url(${l}${o}${l})`;if("/"===o[0])return`url(${l}${function(e){let t="";return t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0],t=t.split("?")[0],t}(t)+o}${l})`;const c=t.split("/"),u=o.split("/");c.pop();for(const t of u)"."!==t&&(".."===t?c.pop():c.push(t));return`url(${l}${c.join("/")}${l})`})}const Sw=/^[^ \t\n\r\u000c]+/,kw=/^[, \t\n\r\u000c]+/;const Tw=new WeakMap;function Cw(e,t){return t&&""!==t.trim()?Iw(e,t):t}function Ew(e){return Boolean("svg"===e.tagName||e.ownerSVGElement)}function Iw(e,t){let n=Tw.get(e);if(n||(n=e.createElement("a"),Tw.set(e,n)),t){if(t.startsWith("blob:")||t.startsWith("data:"))return t}else t="";return n.setAttribute("href",t),n.href}function Pw(e,t,n,r,i,a,s){if(!r)return r;if("src"===n||"href"===n&&("use"!==t||"#"!==r[0]))return Cw(e,r);if("xlink:href"===n&&"#"!==r[0])return Cw(e,r);if("background"===n&&("table"===t||"td"===t||"th"===t))return Cw(e,r);if("srcset"===n)return function(e,t){if(""===t.trim())return t;let n=0;function r(e){let r;const i=e.exec(t.substring(n));return i?(r=i[0],n+=r.length,r):""}const i=[];for(;r(kw),!(n>=t.length);){let a=r(Sw);if(","===a.slice(-1))a=Cw(e,a.substring(0,a.length-1)),i.push(a);else{let r="";a=Cw(e,a);let s=!1;for(;;){const e=t.charAt(n);if(""===e){i.push((a+r).trim());break}if(s)")"===e&&(s=!1);else{if(","===e){n+=1,i.push((a+r).trim());break}"("===e&&(s=!0)}r+=e,n+=1}}}return i.join(", ")}(e,r);if("style"===n){let t=ww(r,Iw(e));return s&&s.size>0&&(t=function(e,t){if(!e||0===t.size)return e;try{const n=e.split(";"),r=[];for(let e of n){if(e=e.trim(),!e)continue;const n=e.indexOf(":");if(-1===n){r.push(e);continue}const i=e.slice(0,n).trim();t.has(i)||r.push(e)}return r.join("; ")+(r.length>0&&e.endsWith(";")?";":"")}catch(n){return e}}(t,s)),t}return"object"===t&&"data"===n?Cw(e,r):"function"==typeof a?a(n,r,i):r}function Mw(e,t,n){return("video"===e||"audio"===e)&&"autoplay"===t}function Aw(e,t,n=1/0,r=0){return e?e.nodeType!==e.ELEMENT_NODE||r>n?-1:t(e)?r:Aw(e.parentNode,t,n,r+1):-1}function zw(e,t){return n=>{const r=n;if(null===r)return!1;try{if(e)if("string"==typeof e){if(r.matches(`.${e}`))return!0}else if(function(e,t){for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}return!1}(r,e))return!0;return!(!t||!r.matches(t))}catch{return!1}}}function Dw(e,t,n,r,i,a){try{const s=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===s)return!1;if("INPUT"===s.tagName){const e=s.getAttribute("autocomplete");if(["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"].includes(e))return!0}let o=-1,l=-1;if(a){if(l=Aw(s,zw(r,i)),l<0)return!0;o=Aw(s,zw(t,n),l>=0?l:1/0)}else{if(o=Aw(s,zw(t,n)),o<0)return!1;l=Aw(s,zw(r,i),o>=0?o:1/0)}return o>=0?!(l>=0)||o<=l:!(l>=0)&&!!a}catch(WI){}return!!a}function Rw(e,t){const{doc:n,mirror:r,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:o,maskAttributeFn:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:d,inlineStylesheet:p,maskInputOptions:f={},maskTextFn:m,maskInputFn:g,dataURLOptions:y={},inlineImages:_,recordCanvas:v,keepIframeSrcFn:x,newlyAddedElement:b=!1,ignoreCSSAttributes:w}=t,S=function(e,t){if(!t.hasNode(e))return;const n=t.getId(e);return 1===n?void 0:n}(n,r);switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:Wb.Document,childNodes:[],compatMode:e.compatMode}:{type:Wb.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:Wb.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:S};case e.ELEMENT_NODE:return function(e,t){const{doc:n,blockClass:r,blockSelector:i,unblockSelector:a,inlineStylesheet:s,maskInputOptions:o={},maskAttributeFn:l,maskInputFn:c,dataURLOptions:u={},inlineImages:h,recordCanvas:d,keepIframeSrcFn:p,newlyAddedElement:f=!1,rootId:m,maskTextClass:g,unmaskTextClass:y,maskTextSelector:_,unmaskTextSelector:v,ignoreCSSAttributes:x}=t,b=function(e,t,n,r){try{if(r&&e.matches(r))return!1;if("string"==typeof t){if(e.classList.contains(t))return!0}else for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}if(n)return e.matches(n)}catch(WI){}return!1}(e,r,i,a),w=function(e){if(e instanceof HTMLFormElement)return"form";const t=nw(e.tagName);return fw.test(t)?"div":t}(e);let S={};const k=e.attributes.length;for(let C=0;C<k;C++){const t=e.attributes[C];t.name&&!Mw(w,t.name,t.value)&&(S[t.name]=Pw(n,w,nw(t.name),t.value,e,l,x))}if("link"===w&&s){const t=Array.from(n.styleSheets).find(t=>t.href===e.href);let r=null;t&&(r=Kb(t)),r&&(S.rel=null,S.href=null,S.crossorigin=null,S._cssText=ww(r,t.href))}if("style"===w&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=Kb(e.sheet);t&&(S._cssText=ww(t,Iw(n)))}if("input"===w||"textarea"===w||"select"===w||"option"===w){const t=e,n=aw(t),r=sw(t,rw(w),n),i=t.checked;if("submit"!==n&&"button"!==n&&r){const e=Dw(t,g,_,y,v,ew({type:n,tagName:rw(w),maskInputOptions:o}));S.value=tw({isMasked:e,element:t,value:r,maskInputFn:c})}i&&(S.checked=i)}"option"===w&&(e.selected&&!o.select?S.selected=!0:delete S.selected);if("canvas"===w&&d)if("2d"===e.__context)(function(e){const t=e.getContext("2d");if(!t)return!0;for(let n=0;n<e.width;n+=50)for(let r=0;r<e.height;r+=50){const i=t.getImageData,a=iw in i?i[iw]:i;if(new Uint32Array(a.call(t,n,r,Math.min(50,e.width-n),Math.min(50,e.height-r)).data.buffer).some(e=>0!==e))return!1}return!0})(e)||(S.rr_dataURL=e.toDataURL(u.type,u.quality));else if(!("__context"in e)){const t=e.toDataURL(u.type,u.quality),r=n.createElement("canvas");r.width=e.width,r.height=e.height;t!==r.toDataURL(u.type,u.quality)&&(S.rr_dataURL=t)}if("img"===w&&h){gw||(gw=n.createElement("canvas"),yw=gw.getContext("2d"));const t=e,r=(t.currentSrc||t.getAttribute("src"),t.crossOrigin),i=()=>{t.removeEventListener("load",i);try{gw.width=t.naturalWidth,gw.height=t.naturalHeight,yw.drawImage(t,0,0),S.rr_dataURL=gw.toDataURL(u.type,u.quality)}catch(fP){if("anonymous"!==t.crossOrigin)return t.crossOrigin="anonymous",void(t.complete&&0!==t.naturalWidth?i():t.addEventListener("load",i))}"anonymous"===t.crossOrigin&&(r?S.crossOrigin=r:t.removeAttribute("crossorigin"))};t.complete&&0!==t.naturalWidth?i():t.addEventListener("load",i)}"audio"!==w&&"video"!==w||(S.rr_mediaState=e.paused?"paused":"played",S.rr_mediaCurrentTime=e.currentTime);f||(e.scrollLeft&&(S.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(S.rr_scrollTop=e.scrollTop));if(b){const{width:t,height:n}=e.getBoundingClientRect();S={class:S.class,rr_width:`${t}px`,rr_height:`${n}px`}}"iframe"!==w||p(S.src)||(b||dw(e)||(S.rr_src=S.src),delete S.src);let T;try{customElements.get(w)&&(T=!0)}catch(WI){}return{type:Wb.Element,tagName:w,attributes:S,childNodes:[],isSVG:Ew(e)||void 0,needBlock:b,rootId:m,isCustom:T}}(e,{doc:n,blockClass:i,blockSelector:a,unblockSelector:s,inlineStylesheet:p,maskAttributeFn:l,maskInputOptions:f,maskInputFn:g,dataURLOptions:y,inlineImages:_,recordCanvas:v,keepIframeSrcFn:x,newlyAddedElement:b,rootId:S,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:d,ignoreCSSAttributes:w});case e.TEXT_NODE:return function(e,t){const{maskAllText:n,maskTextClass:r,unmaskTextClass:i,maskTextSelector:a,unmaskTextSelector:s,maskTextFn:o,maskInputOptions:l,maskInputFn:c,rootId:u}=t,h=e.parentNode&&e.parentNode.tagName;let d=e.textContent;const p="STYLE"===h||void 0,f="SCRIPT"===h||void 0,m="TEXTAREA"===h||void 0;if(p&&d){try{e.nextSibling||e.previousSibling||e.parentNode.sheet?.cssRules&&(d=Kb(e.parentNode.sheet))}catch(fP){}d=ww(d,Iw(t.doc))}f&&(d="SCRIPT_PLACEHOLDER");const g=Dw(e,r,a,i,s,n);p||f||m||!d||!g||(d=o?o(d,e.parentElement):d.replace(/[\S]/g,"*"));m&&d&&(l.textarea||g)&&(d=c?c(d,e.parentNode):d.replace(/[\S]/g,"*"));if("OPTION"===h&&d){d=tw({isMasked:Dw(e,r,a,i,s,ew({type:null,tagName:h,maskInputOptions:l})),element:e,value:d,maskInputFn:c})}return{type:Wb.Text,textContent:d||"",isStyle:p,rootId:u}}(e,{doc:n,maskAllText:o,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:d,maskTextFn:m,maskInputOptions:f,maskInputFn:g,rootId:S});case e.CDATA_SECTION_NODE:return{type:Wb.CDATA,textContent:"",rootId:S};case e.COMMENT_NODE:return{type:Wb.Comment,textContent:e.textContent||"",rootId:S};default:return!1}}function Lw(e){return null==e?"":e.toLowerCase()}function Nw(e,t){const{doc:n,mirror:r,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:o,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:h,skipChild:d=!1,inlineStylesheet:p=!0,maskInputOptions:f={},maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOMOptions:_,dataURLOptions:v={},inlineImages:x=!1,recordCanvas:b=!1,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k=5e3,onBlockedImageLoad:T,onStylesheetLoad:C,stylesheetLoadTimeout:E=5e3,keepIframeSrcFn:I=()=>!1,newlyAddedElement:P=!1,ignoreCSSAttributes:M}=t;let{preserveWhiteSpace:A=!0}=t;const z=Rw(e,{doc:n,mirror:r,blockClass:i,blockSelector:a,maskAllText:o,unblockSelector:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:h,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,dataURLOptions:v,inlineImages:x,recordCanvas:b,keepIframeSrcFn:I,newlyAddedElement:P,ignoreCSSAttributes:M});if(!z)return null;let D;D=r.hasNode(e)?r.getId(e):!function(e,t){if(t.comment&&e.type===Wb.Comment)return!0;if(e.type===Wb.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&("preload"===e.attributes.rel||"modulepreload"===e.attributes.rel)||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&"js"===ow(e.attributes.href)))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(Lw(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===Lw(e.attributes.name)||"icon"===Lw(e.attributes.rel)||"apple-touch-icon"===Lw(e.attributes.rel)||"shortcut icon"===Lw(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&Lw(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(Lw(e.attributes.property).match(/^(og|twitter|fb):/)||Lw(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===Lw(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===Lw(e.attributes.name)||"googlebot"===Lw(e.attributes.name)||"bingbot"===Lw(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===Lw(e.attributes.name)||"generator"===Lw(e.attributes.name)||"framework"===Lw(e.attributes.name)||"publisher"===Lw(e.attributes.name)||"progid"===Lw(e.attributes.name)||Lw(e.attributes.property).match(/^article:/)||Lw(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===Lw(e.attributes.name)||"yandex-verification"===Lw(e.attributes.name)||"csrf-token"===Lw(e.attributes.name)||"p:domain_verify"===Lw(e.attributes.name)||"verify-v1"===Lw(e.attributes.name)||"verification"===Lw(e.attributes.name)||"shopify-checkout-api-token"===Lw(e.attributes.name)))return!0}}return!1}(z,_)&&(A||z.type!==Wb.Text||z.isStyle||z.textContent.replace(/^\s+|\s+$/gm,"").length)?mw():-2;const R=Object.assign(z,{id:D});if(r.add(e,R),-2===D)return null;w&&w(e);let L=!d;if(R.type===Wb.Element){L=L&&!R.needBlock;const t=e.shadowRoot;t&&Yb(t)&&(R.isShadowHost=!0)}if((R.type===Wb.Document||R.type===Wb.Element)&&L){_.headWhitespace&&R.type===Wb.Element&&"head"===R.tagName&&(A=!1);const t={doc:n,mirror:r,blockClass:i,blockSelector:a,maskAllText:o,unblockSelector:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:h,skipChild:d,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOMOptions:_,dataURLOptions:v,inlineImages:x,recordCanvas:b,preserveWhiteSpace:A,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k,onBlockedImageLoad:T,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:I,ignoreCSSAttributes:M},P=e.childNodes?Array.from(e.childNodes):[];for(const e of P){const n=Nw(e,t);n&&R.childNodes.push(n)}if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot)for(const n of Array.from(e.shadowRoot.childNodes)){const r=Nw(n,t);r&&(Yb(e.shadowRoot)&&(r.isShadow=!0),R.childNodes.push(r))}}if(e.parentNode&&Xb(e.parentNode)&&Yb(e.parentNode)&&(R.isShadow=!0),R.type!==Wb.Element||"iframe"!==R.tagName||R.needBlock||function(e,t,n){const r=e.contentWindow;if(!r)return;let i,a=!1;try{i=r.document.readyState}catch(o){return}if("complete"!==i){const r=uw(()=>{a||(t(),a=!0)},n);return void e.addEventListener("load",()=>{hw(r),a=!0,t()})}const s="about:blank";if(r.location.href!==s||e.src===s||""===e.src)return uw(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}(e,()=>{const t=dw(e);if(t&&S){const n=Nw(t,{doc:t,mirror:r,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:o,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:h,skipChild:!1,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOMOptions:_,dataURLOptions:v,inlineImages:x,recordCanvas:b,preserveWhiteSpace:A,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:I,ignoreCSSAttributes:M});n&&S(e,n)}},k),R.type===Wb.Element&&"img"===R.tagName&&!e.complete&&R.needBlock){const t=e,n=()=>{if(t.isConnected&&!t.complete&&T)try{const e=t.getBoundingClientRect();e.width>0&&e.height>0&&T(t,R,e)}catch(e){}t.removeEventListener("load",n)};t.isConnected&&t.addEventListener("load",n)}return R.type===Wb.Element&&"link"===R.tagName&&"string"==typeof R.attributes.rel&&("stylesheet"===R.attributes.rel||"preload"===R.attributes.rel&&"string"==typeof R.attributes.href&&"css"===ow(R.attributes.href))&&function(e,t,n){let r,i=!1;try{r=e.sheet}catch(s){return}if(r)return;const a=uw(()=>{i||(t(),i=!0)},n);e.addEventListener("load",()=>{hw(a),i=!0,t()})}(e,()=>{if(C){const t=Nw(e,{doc:n,mirror:r,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:o,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:h,skipChild:!1,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOMOptions:_,dataURLOptions:v,inlineImages:x,recordCanvas:b,preserveWhiteSpace:A,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:k,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:I,ignoreCSSAttributes:M});t&&C(e,t)}},E),R.type===Wb.Element&&delete R.needBlock,R}function jw(e,t,n=document){const r={capture:!0,passive:!0};return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}let Fw={map:{},getId:()=>-1,getNode:()=>null,removeNodeFromMap(){},has:()=>!1,reset(){}};function Ow(e,t,n={}){let r=null,i=0;return function(...a){const s=Date.now();i||!1!==n.leading||(i=s);const o=t-(s-i),l=this;o<=0||o>t?(r&&(!function(...e){aS("clearTimeout")(...e)}(r),r=null),i=s,e.apply(l,a)):r||!1===n.trailing||(r=sS(()=>{i=!1===n.leading?0:Date.now(),r=null,e.apply(l,a)},o))}}function Bw(e,t,n,r,i=window){const a=i.Object.getOwnPropertyDescriptor(e,t);return i.Object.defineProperty(e,t,r?n:{set(e){sS(()=>{n.set.call(this,e)},0),a&&a.set&&a.set.call(this,e)}}),()=>Bw(e,t,a||{},!0)}function Vw(e,t,n){try{if(!(t in e))return()=>{};const r=e[t],i=n(r);return"function"==typeof i&&(i.prototype=i.prototype||{},Object.defineProperties(i,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=i,()=>{e[t]=r}}catch{return()=>{}}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(Fw=new Proxy(Fw,{get:(e,t,n)=>Reflect.get(e,t,n)}));let Uw=Date.now;function qw(e){const t=e.document;return{left:t.scrollingElement?t.scrollingElement.scrollLeft:void 0!==e.pageXOffset?e.pageXOffset:t?.documentElement.scrollLeft||t?.body?.parentElement?.scrollLeft||t?.body?.scrollLeft||0,top:t.scrollingElement?t.scrollingElement.scrollTop:void 0!==e.pageYOffset?e.pageYOffset:t?.documentElement.scrollTop||t?.body?.parentElement?.scrollTop||t?.body?.scrollTop||0}}function $w(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function Gw(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function Hw(e){if(!e)return null;try{return e.nodeType===e.ELEMENT_NODE?e:e.parentElement}catch(t){return null}}function Zw(e,t,n,r,i){if(!e)return!1;const a=Hw(e);if(!a)return!1;const s=zw(t,n);if(!i){const e=r&&a.matches(r);return s(a)&&!e}const o=Aw(a,s);let l=-1;return!(o<0)&&(r&&(l=Aw(a,zw(null,r))),o>-1&&l<0||o<l)}function Ww(e,t){return-2===t.getId(e)}function Xw(e,t){if(Xb(e))return!1;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||Xw(e.parentNode,t))}function Yw(e){return Boolean(e.changedTouches)}function Kw(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function Qw(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function Jw(e){return Boolean(e?.shadowRoot)}/[1-9][0-9]{12}/.test(Date.now().toString())||(Uw=()=>(new Date).getTime());class eS{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){return this.styleIDMap.get(e)??-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let n;return n=void 0===t?this.id++:t,this.styleIDMap.set(e,n),this.idStyleMap.set(n,e),n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function tS(e){let t=null;return e.getRootNode?.()?.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.getRootNode().host&&(t=e.getRootNode().host),t}function nS(e){const t=e.ownerDocument;if(!t)return!1;const n=function(e){let t,n=e;for(;t=tS(n);)n=t;return n}(e);return t.contains(n)}function rS(e){const t=e.ownerDocument;return!!t&&(t.contains(e)||nS(e))}const iS={};function aS(e){const t=iS[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const i=t.contentWindow;i&&i[e]&&(r=i[e]),n.head.removeChild(t)}catch(WI){}return iS[e]=r.bind(window)}function sS(...e){return aS("setTimeout")(...e)}var oS=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(oS||{}),lS=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(lS||{}),cS=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(cS||{}),uS=(e=>(e[e.Mouse=0]="Mouse",e[e.Pen=1]="Pen",e[e.Touch=2]="Touch",e))(uS||{}),hS=(e=>(e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange",e[e.RateChange=4]="RateChange",e))(hS||{});function dS(e){try{return e.contentDocument}catch(WI){}}function pS(e){return"__ln"in e}class fS{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let n=0;n<e;n++)t=t?.next||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&pS(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&pS(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;null===t.next&&(this.tail=t),this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous):(this.head=t.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}}const mS=(e,t)=>`${e}@${t}`;class gS{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new Set,n=new fS,r=e=>{let t=e,n=-2;for(;-2===n;)t=t&&t.nextSibling,n=t&&this.mirror.getId(t);return n},i=i=>{if(!i.parentNode||!rS(i))return;const a=Xb(i.parentNode)?this.mirror.getId(tS(i)):this.mirror.getId(i.parentNode),s=r(i);if(-1===a||-1===s)return n.addNode(i);const o=Nw(i,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{Kw(e,this.mirror)&&!Zw(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&this.iframeManager.addIframe(e),Qw(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),Jw(i)&&this.shadowDomManager.addShadowRoot(i.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{Zw(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(this.iframeManager.attachIframe(e,t),e.contentWindow&&this.canvasManager.addWindow(e.contentWindow),this.shadowDomManager.observeAttachShadow(e))},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)},onBlockedImageLoad:(e,t,{width:n,height:r})=>{this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:{style:{width:`${n}px`,height:`${r}px`}}}]})},ignoreCSSAttributes:this.ignoreCSSAttributes});o&&(e.push({parentId:a,nextId:s,node:o}),t.add(o.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const o of this.movedSet)_S(this.removes,o,this.mirror)&&!this.movedSet.has(o.parentNode)||i(o);for(const o of this.addedSet)vS(this.droppedSet,o)||_S(this.removes,o,this.mirror)?vS(this.movedSet,o)?i(o):this.droppedSet.add(o):i(o);let a=null;for(;n.length;){let e=null;if(a){const t=this.mirror.getId(a.value.parentNode),n=r(a.value);-1!==t&&-1!==n&&(e=a)}if(!e){let t=n.tail;for(;t;){const n=t;if(t=t.previous,n){const t=this.mirror.getId(n.value.parentNode);if(-1===r(n.value))continue;if(-1!==t){e=n;break}{const t=n.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=n;break}}}}}}if(!e){for(;n.head;)n.removeNode(n.head.value);break}a=e.previous,n.removeNode(e.value),i(e.value)}const s={texts:this.texts.map(e=>({id:this.mirror.getId(e.node),value:e.value})).filter(e=>!t.has(e.id)).filter(e=>this.mirror.has(e.id)),attributes:this.attributes.map(e=>{const{attributes:t}=e;if("string"==typeof t.style){const n=JSON.stringify(e.styleDiff),r=JSON.stringify(e._unchangedStyles);n.length<t.style.length&&(n+r).split("var(").length===t.style.split("var(").length&&(t.style=e.styleDiff)}return{id:this.mirror.getId(e.node),attributes:t}}).filter(e=>!t.has(e.id)).filter(e=>this.mirror.has(e.id)),removes:this.removes,adds:e};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=e=>{if(!Ww(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;Zw(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||t===e.oldValue||this.texts.push({value:Dw(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&t?this.maskTextFn?this.maskTextFn(t,Hw(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let n=e.attributeName,r=e.target.getAttribute(n);if("value"===n){const n=aw(t),i=t.tagName;r=sw(t,i,n);const a=ew({maskInputOptions:this.maskInputOptions,tagName:i,type:n});r=tw({isMasked:Dw(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,a),element:t,value:r,maskInputFn:this.maskInputFn})}if(Zw(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||r===e.oldValue)return;let i=this.attributeMap.get(e.target);if("IFRAME"===t.tagName&&"src"===n&&!this.keepIframeSrcFn(r)){if(dS(t))return;n="rr_src"}if(i||(i={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(i),this.attributeMap.set(e.target,i)),"type"===n&&"INPUT"===t.tagName&&"password"===(e.oldValue||"").toLowerCase()&&t.setAttribute("data-rr-is-password","true"),!Mw(t.tagName,n)&&(i.attributes[n]=Pw(this.doc,nw(t.tagName),nw(n),r,t,this.maskAttributeFn),"style"===n)){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch(WI){this.unattachedDoc=this.doc}const n=this.unattachedDoc.createElement("span");e.oldValue&&n.setAttribute("style",e.oldValue);for(const e of Array.from(t.style)){const r=t.style.getPropertyValue(e),a=t.style.getPropertyPriority(e);r!==n.style.getPropertyValue(e)||a!==n.style.getPropertyPriority(e)?i.styleDiff[e]=""===a?r:[r,a]:i._unchangedStyles[e]=[r,a]}for(const e of Array.from(n.style))""===t.style.getPropertyValue(e)&&(i.styleDiff[e]=!1)}break}case"childList":if(Zw(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;e.addedNodes.forEach(t=>this.genAdds(t,e.target)),e.removedNodes.forEach(t=>{const n=this.mirror.getId(t),r=Xb(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);Zw(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||Ww(t,this.mirror)||!function(e,t){return-1!==t.getId(e)}(t,this.mirror)||(this.addedSet.has(t)?(yS(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===n||Xw(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[mS(n,r)]?yS(this.movedSet,t):this.removes.push({parentId:r,id:n,isShadow:!(!Xb(e.target)||!Yb(e.target))||void 0})),this.mapRemoves.push(t))})}},this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!this.addedSet.has(e)&&!this.movedSet.has(e)){if(this.mirror.hasNode(e)){if(Ww(e,this.mirror))return;this.movedSet.add(e);let n=null;t&&this.mirror.hasNode(t)&&(n=this.mirror.getId(t)),n&&-1!==n&&(this.movedMap[mS(this.mirror.getId(e),n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);Zw(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(e.childNodes&&e.childNodes.forEach(e=>this.genAdds(e)),Jw(e)&&e.shadowRoot.childNodes.forEach(t=>{this.processedNodeManager.add(t,this),this.genAdds(t,e)}))}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager","ignoreCSSAttributes"].forEach(t=>{this[t]=e[t]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function yS(e,t){e.delete(t),t.childNodes?.forEach(t=>yS(e,t))}function _S(e,t,n){return 0!==e.length&&function(e,t,n){let r=t.parentNode;for(;r;){const t=n.getId(r);if(e.some(e=>e.id===t))return!0;r=r.parentNode}return!1}(e,t,n)}function vS(e,t){return 0!==e.size&&xS(e,t)}function xS(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||xS(e,n))}let bS;const wS=e=>{if(!bS)return e;return(...t)=>{try{return e(...t)}catch(n){if(bS&&!0===bS(n))return()=>{};throw n}}},SS=[];function kS(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch{}return e&&e.target}function TS(e,t){const n=new gS;SS.push(n),n.init(e);let r=window.MutationObserver||window.__rrMutationObserver;const i=window?.Zone?.__symbol__?.("MutationObserver");i&&window[i]&&(r=window[i]);const a=new r(wS(t=>{e.onMutation&&!1===e.onMutation(t)||n.processMutations.bind(n)(t)}));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function CS({mouseInteractionCb:e,doc:t,mirror:n,blockClass:r,blockSelector:i,unblockSelector:a,sampling:s}){if(!1===s.mouseInteraction)return()=>{};const o=!0===s.mouseInteraction||void 0===s.mouseInteraction?{}:s.mouseInteraction,l=[];let c=null;return Object.keys(cS).filter(e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==o[e]).forEach(s=>{let o=nw(s);const u=(t=>s=>{const o=kS(s);if(Zw(o,r,i,a,!0))return;let l=null,u=t;if("pointerType"in s){switch(s.pointerType){case"mouse":l=uS.Mouse;break;case"touch":l=uS.Touch;break;case"pen":l=uS.Pen}l===uS.Touch?cS[t]===cS.MouseDown?u="TouchStart":cS[t]===cS.MouseUp&&(u="TouchEnd"):uS.Pen}else Yw(s)&&(l=uS.Touch);null!==l?(c=l,(u.startsWith("Touch")&&l===uS.Touch||u.startsWith("Mouse")&&l===uS.Mouse)&&(l=null)):cS[t]===cS.Click&&(l=c,c=null);const h=Yw(s)?s.changedTouches[0]:s;if(!h)return;const d=n.getId(o),{clientX:p,clientY:f}=h;wS(e)({type:cS[u],id:d,x:p,y:f,...null!==l&&{pointerType:l}})})(s);if(window.PointerEvent)switch(cS[s]){case cS.MouseDown:case cS.MouseUp:o=o.replace("mouse","pointer");break;case cS.TouchStart:case cS.TouchEnd:return}l.push(jw(o,u,t))}),wS(()=>{l.forEach(e=>e())})}function ES({scrollCb:e,doc:t,mirror:n,blockClass:r,blockSelector:i,unblockSelector:a,sampling:s}){return jw("scroll",wS(Ow(wS(s=>{const o=kS(s);if(!o||Zw(o,r,i,a,!0))return;const l=n.getId(o);if(o===t&&t.defaultView){const n=qw(t.defaultView);e({id:l,x:n.left,y:n.top})}else e({id:l,x:o.scrollLeft,y:o.scrollTop})}),s.scroll||100)),t)}const IS=["INPUT","TEXTAREA","SELECT"],PS=new WeakMap;function MS({inputCb:e,doc:t,mirror:n,blockClass:r,blockSelector:i,unblockSelector:a,ignoreClass:s,ignoreSelector:o,maskInputOptions:l,maskInputFn:c,sampling:u,userTriggeredOnInput:h,maskTextClass:d,unmaskTextClass:p,maskTextSelector:f,unmaskTextSelector:m}){function g(e){let n=kS(e);const u=e.isTrusted,g=n&&rw(n.tagName);if("OPTION"===g&&(n=n.parentElement),!n||!g||IS.indexOf(g)<0||Zw(n,r,i,a,!0))return;const _=n;if(_.classList.contains(s)||o&&_.matches(o))return;const v=aw(n);let x=sw(_,g,v),b=!1;const w=ew({maskInputOptions:l,tagName:g,type:v}),S=Dw(n,d,f,p,m,w);"radio"!==v&&"checkbox"!==v||(b=n.checked),x=tw({isMasked:S,element:n,value:x,maskInputFn:c}),y(n,h?{text:x,isChecked:b,userTriggered:u}:{text:x,isChecked:b});const k=n.name;"radio"===v&&k&&b&&t.querySelectorAll(`input[type="radio"][name="${k}"]`).forEach(e=>{if(e!==n){const t=tw({isMasked:S,element:e,value:sw(e,g,v),maskInputFn:c});y(e,h?{text:t,isChecked:!b,userTriggered:!1}:{text:t,isChecked:!b})}})}function y(t,r){const i=PS.get(t);if(!i||i.text!==r.text||i.isChecked!==r.isChecked){PS.set(t,r);const i=n.getId(t);wS(e)({...r,id:i})}}const _=("last"===u.input?["change"]:["input","change"]).map(e=>jw(e,wS(g),t)),v=t.defaultView;if(!v)return()=>{_.forEach(e=>e())};const x=v.Object.getOwnPropertyDescriptor(v.HTMLInputElement.prototype,"value"),b=[[v.HTMLInputElement.prototype,"value"],[v.HTMLInputElement.prototype,"checked"],[v.HTMLSelectElement.prototype,"value"],[v.HTMLTextAreaElement.prototype,"value"],[v.HTMLSelectElement.prototype,"selectedIndex"],[v.HTMLOptionElement.prototype,"selected"]];return x&&x.set&&_.push(...b.map(e=>Bw(e[0],e[1],{set(){wS(g)({target:this,isTrusted:!1})}},!1,v))),wS(()=>{_.forEach(e=>e())})}function AS(e){return function(e,t){if(LS("CSSGroupingRule")&&e.parentRule instanceof CSSGroupingRule||LS("CSSMediaRule")&&e.parentRule instanceof CSSMediaRule||LS("CSSSupportsRule")&&e.parentRule instanceof CSSSupportsRule||LS("CSSConditionRule")&&e.parentRule instanceof CSSConditionRule){const n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else if(e.parentStyleSheet){const n=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(n)}return t}(e,[])}function zS(e,t,n){let r,i;return e?(e.ownerNode?r=t.getId(e.ownerNode):i=n.getId(e),{styleId:i,id:r}):{}}function DS({mirror:e,stylesheetManager:t},n){let r=null;r="#document"===n.nodeName?e.getId(n):e.getId(n.host);const i="#document"===n.nodeName?n.defaultView?.Document:n.ownerDocument?.defaultView?.ShadowRoot,a=i?.prototype?Object.getOwnPropertyDescriptor(i?.prototype,"adoptedStyleSheets"):void 0;return null!==r&&-1!==r&&i&&a?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get(){return a.get?.call(this)},set(e){const n=a.set?.call(this,e);if(null!==r&&-1!==r)try{t.adoptStyleSheets(e,r)}catch(WI){}return n}}),wS(()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get:a.get,set:a.set})})):()=>{}}function RS(e,t={}){const n=e.doc.defaultView;if(!n)return()=>{};let r;e.recordDOM&&(r=TS(e,e.doc));const i=function({mousemoveCb:e,sampling:t,doc:n,mirror:r}){if(!1===t.mousemove)return()=>{};const i="number"==typeof t.mousemove?t.mousemove:50,a="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let s,o=[];const l=Ow(wS(t=>{const n=Date.now()-s;e(o.map(e=>(e.timeOffset-=n,e)),t),o=[],s=null}),a),c=wS(Ow(wS(e=>{const t=kS(e),{clientX:n,clientY:i}=Yw(e)?e.changedTouches[0]:e;s||(s=Uw()),o.push({x:n,y:i,id:r.getId(t),timeOffset:Uw()-s}),l("undefined"!=typeof DragEvent&&e instanceof DragEvent?lS.Drag:e instanceof MouseEvent?lS.MouseMove:lS.TouchMove)}),i,{trailing:!1})),u=[jw("mousemove",c,n),jw("touchmove",c,n),jw("drag",c,n)];return wS(()=>{u.forEach(e=>e())})}(e),a=CS(e),s=ES(e),o=function({viewportResizeCb:e},{win:t}){let n=-1,r=-1;return jw("resize",wS(Ow(wS(()=>{const t=$w(),i=Gw();n===t&&r===i||(e({width:Number(i),height:Number(t)}),n=t,r=i)}),200)),t)}(e,{win:n}),l=MS(e),c=function({mediaInteractionCb:e,blockClass:t,blockSelector:n,unblockSelector:r,mirror:i,sampling:a,doc:s}){const o=wS(s=>Ow(wS(a=>{const o=kS(a);if(!o||Zw(o,t,n,r,!0))return;const{currentTime:l,volume:c,muted:u,playbackRate:h}=o;e({type:s,id:i.getId(o),currentTime:l,volume:c,muted:u,playbackRate:h})}),a.media||500)),l=[jw("play",o(hS.Play),s),jw("pause",o(hS.Pause),s),jw("seeked",o(hS.Seeked),s),jw("volumechange",o(hS.VolumeChange),s),jw("ratechange",o(hS.RateChange),s)];return wS(()=>{l.forEach(e=>e())})}(e);let u=()=>{},h=()=>{},d=()=>{},p=()=>{};e.recordDOM&&(u=function({styleSheetRuleCb:e,mirror:t,stylesheetManager:n},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};const i=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(i,{apply:wS((r,i,a)=>{const[s,o]=a,{id:l,styleId:c}=zS(i,t,n.styleMirror);return(l&&-1!==l||c&&-1!==c)&&e({id:l,styleId:c,adds:[{rule:s,index:o}]}),r.apply(i,a)})});const a=r.CSSStyleSheet.prototype.deleteRule;let s,o;r.CSSStyleSheet.prototype.deleteRule=new Proxy(a,{apply:wS((r,i,a)=>{const[s]=a,{id:o,styleId:l}=zS(i,t,n.styleMirror);return(o&&-1!==o||l&&-1!==l)&&e({id:o,styleId:l,removes:[{index:s}]}),r.apply(i,a)})}),r.CSSStyleSheet.prototype.replace&&(s=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(s,{apply:wS((r,i,a)=>{const[s]=a,{id:o,styleId:l}=zS(i,t,n.styleMirror);return(o&&-1!==o||l&&-1!==l)&&e({id:o,styleId:l,replace:s}),r.apply(i,a)})})),r.CSSStyleSheet.prototype.replaceSync&&(o=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(o,{apply:wS((r,i,a)=>{const[s]=a,{id:o,styleId:l}=zS(i,t,n.styleMirror);return(o&&-1!==o||l&&-1!==l)&&e({id:o,styleId:l,replaceSync:s}),r.apply(i,a)})}));const l={};NS("CSSGroupingRule")?l.CSSGroupingRule=r.CSSGroupingRule:(NS("CSSMediaRule")&&(l.CSSMediaRule=r.CSSMediaRule),NS("CSSConditionRule")&&(l.CSSConditionRule=r.CSSConditionRule),NS("CSSSupportsRule")&&(l.CSSSupportsRule=r.CSSSupportsRule));const c={};return Object.entries(l).forEach(([r,i])=>{c[r]={insertRule:i.prototype.insertRule,deleteRule:i.prototype.deleteRule},i.prototype.insertRule=new Proxy(c[r].insertRule,{apply:wS((r,i,a)=>{const[s,o]=a,{id:l,styleId:c}=zS(i.parentStyleSheet,t,n.styleMirror);return(l&&-1!==l||c&&-1!==c)&&e({id:l,styleId:c,adds:[{rule:s,index:[...AS(i),o||0]}]}),r.apply(i,a)})}),i.prototype.deleteRule=new Proxy(c[r].deleteRule,{apply:wS((r,i,a)=>{const[s]=a,{id:o,styleId:l}=zS(i.parentStyleSheet,t,n.styleMirror);return(o&&-1!==o||l&&-1!==l)&&e({id:o,styleId:l,removes:[{index:[...AS(i),s]}]}),r.apply(i,a)})})}),wS(()=>{r.CSSStyleSheet.prototype.insertRule=i,r.CSSStyleSheet.prototype.deleteRule=a,s&&(r.CSSStyleSheet.prototype.replace=s),o&&(r.CSSStyleSheet.prototype.replaceSync=o),Object.entries(l).forEach(([e,t])=>{t.prototype.insertRule=c[e].insertRule,t.prototype.deleteRule=c[e].deleteRule})})}(e,{win:n}),h=DS(e,e.doc),d=function({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:n,stylesheetManager:r},{win:i}){const a=i.CSSStyleDeclaration.prototype.setProperty;i.CSSStyleDeclaration.prototype.setProperty=new Proxy(a,{apply:wS((i,s,o)=>{const[l,c,u]=o;if(n.has(l))return a.apply(s,[l,c,u]);const{id:h,styleId:d}=zS(s.parentRule?.parentStyleSheet,t,r.styleMirror);return(h&&-1!==h||d&&-1!==d)&&e({id:h,styleId:d,set:{property:l,value:c,priority:u},index:AS(s.parentRule)}),i.apply(s,o)})});const s=i.CSSStyleDeclaration.prototype.removeProperty;return i.CSSStyleDeclaration.prototype.removeProperty=new Proxy(s,{apply:wS((i,a,o)=>{const[l]=o;if(n.has(l))return s.apply(a,[l]);const{id:c,styleId:u}=zS(a.parentRule?.parentStyleSheet,t,r.styleMirror);return(c&&-1!==c||u&&-1!==u)&&e({id:c,styleId:u,remove:{property:l},index:AS(a.parentRule)}),i.apply(a,o)})}),wS(()=>{i.CSSStyleDeclaration.prototype.setProperty=a,i.CSSStyleDeclaration.prototype.removeProperty=s})}(e,{win:n}),e.collectFonts&&(p=function({fontCb:e,doc:t}){const n=t.defaultView;if(!n)return()=>{};const r=[],i=new WeakMap,a=n.FontFace;n.FontFace=function(e,t,n){const r=new a(e,t,n);return i.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};const s=Vw(t.fonts,"add",function(t){return function(n){return sS(wS(()=>{const t=i.get(n);t&&(e(t),i.delete(n))}),0),t.apply(this,[n])}});return r.push(()=>{n.FontFace=a}),r.push(s),wS(()=>{r.forEach(e=>e())})}(e)));const f=function(e){const{doc:t,mirror:n,blockClass:r,blockSelector:i,unblockSelector:a,selectionCb:s}=e;let o=!0;const l=wS(()=>{const e=t.getSelection();if(!e||o&&e?.isCollapsed)return;o=e.isCollapsed||!1;const l=[],c=e.rangeCount||0;for(let t=0;t<c;t++){const s=e.getRangeAt(t),{startContainer:o,startOffset:c,endContainer:u,endOffset:h}=s;Zw(o,r,i,a,!0)||Zw(u,r,i,a,!0)||l.push({start:n.getId(o),startOffset:c,end:n.getId(u),endOffset:h})}s({ranges:l})});return l(),jw("selectionchange",l)}(e),m=function({doc:e,customElementCb:t}){const n=e.defaultView;if(!n||!n.customElements)return()=>{};const r=Vw(n.customElements,"define",function(e){return function(n,r,i){try{t({define:{name:n}})}catch(WI){}return e.apply(this,[n,r,i])}});return r}(e),g=[];for(const y of e.plugins)g.push(y.observer(y.callback,n,y.options));return wS(()=>{SS.forEach(e=>e.reset()),r?.disconnect(),i(),a(),s(),o(),l(),c(),u(),h(),d(),p(),f(),m(),g.forEach(e=>e())})}function LS(e){return void 0!==window[e]}function NS(e){return Boolean(void 0!==window[e]&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class jS{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,n,r){const i=n||this.getIdToRemoteIdMap(e),a=r||this.getRemoteIdToIdMap(e);let s=i.get(t);return s||(s=this.generateIdFn(),i.set(t,s),a.set(s,t)),s}getIds(e,t){const n=this.getIdToRemoteIdMap(e),r=this.getRemoteIdToIdMap(e);return t.map(t=>this.getId(e,t,n,r))}getRemoteId(e,t,n){const r=n||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;const i=r.get(t);return i||-1}getRemoteIds(e,t){const n=this.getRemoteIdToIdMap(e);return t.map(t=>this.getRemoteId(e,t,n))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class FS{constructor(){this.crossOriginIframeMirror=new jS(mw),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class OS{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new jS(mw),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new jS(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),this.recordCrossOriginIframes&&e.contentWindow?.addEventListener("message",this.handleMessage.bind(this)),this.loadListener?.(e);const n=dS(e);n&&n.adoptedStyleSheets&&n.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(n.adoptedStyleSheets,this.mirror.getId(n))}handleMessage(e){const t=e;if("rrweb"!==t.data.type||t.origin!==t.data.origin)return;if(!e.source)return;const n=this.crossOriginIframeMap.get(e.source);if(!n)return;const r=this.transformCrossOriginEvent(n,t.data.event);r&&this.wrappedEmit(r,t.data.isCheckout)}transformCrossOriginEvent(e,t){switch(t.type){case oS.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e);const n=t.data.node.id;return this.crossOriginIframeRootIdMap.set(e,n),this.patchRootIdOnNode(t.data.node,n),{timestamp:t.timestamp,type:oS.IncrementalSnapshot,data:{source:lS.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case oS.Meta:case oS.Load:case oS.DomContentLoaded:return!1;case oS.Plugin:return t;case oS.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case oS.IncrementalSnapshot:switch(t.data.source){case lS.Mutation:return t.data.adds.forEach(t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e);const n=this.crossOriginIframeRootIdMap.get(e);n&&this.patchRootIdOnNode(t.node,n)}),t.data.removes.forEach(t=>{this.replaceIds(t,e,["parentId","id"])}),t.data.attributes.forEach(t=>{this.replaceIds(t,e,["id"])}),t.data.texts.forEach(t=>{this.replaceIds(t,e,["id"])}),t;case lS.Drag:case lS.TouchMove:case lS.MouseMove:return t.data.positions.forEach(t=>{this.replaceIds(t,e,["id"])}),t;case lS.ViewportResize:return!1;case lS.MediaInteraction:case lS.MouseInteraction:case lS.Scroll:case lS.CanvasMutation:case lS.Input:return this.replaceIds(t.data,e,["id"]),t;case lS.StyleSheetRule:case lS.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case lS.Font:return t;case lS.Selection:return t.data.ranges.forEach(t=>{this.replaceIds(t,e,["start","end"])}),t;case lS.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),t.data.styles?.forEach(t=>{this.replaceStyleIds(t,e,["styleId"])}),t}}return!1}replace(e,t,n,r){for(const i of r)(Array.isArray(t[i])||"number"==typeof t[i])&&(Array.isArray(t[i])?t[i]=e.getIds(n,t[i]):t[i]=e.getId(n,t[i]));return t}replaceIds(e,t,n){return this.replace(this.crossOriginIframeMirror,e,t,n)}replaceStyleIds(e,t,n){return this.replace(this.crossOriginIframeStyleMirror,e,t,n)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(e=>{this.replaceIdOnNode(e,t)})}patchRootIdOnNode(e,t){e.type===Wb.Document||e.rootId||(e.rootId=t),"childNodes"in e&&e.childNodes.forEach(e=>{this.patchRootIdOnNode(e,t)})}}class BS{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class VS{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!Yb(e))return;if(this.shadowDoms.has(e))return;this.shadowDoms.add(e),this.bypassOptions.canvasManager.addShadowRoot(e);const n=TS({...this.bypassOptions,doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push(()=>n.disconnect()),this.restoreHandlers.push(ES({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),sS(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(DS({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){const t=dS(e),n=function(e){try{return e.contentWindow}catch(WI){}}(e);t&&n&&this.patchAttachShadow(n.Element,t)}patchAttachShadow(e,t){const n=this;this.restoreHandlers.push(Vw(e.prototype,"attachShadow",function(e){return function(r){const i=e.call(this,r);return this.shadowRoot&&rS(this)&&n.addShadowRoot(this.shadowRoot,t),i}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch(WI){}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet,this.bypassOptions.canvasManager.resetShadowRoots()}}for(var US="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qS="undefined"==typeof Uint8Array?[]:new Uint8Array(256),$S=0;$S<64;$S++)qS[US.charCodeAt($S)]=$S;class GS{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}addWindow(){}addShadowRoot(){}resetShadowRoots(){}}class HS{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new eS,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const n={id:t,styleIds:[]},r=[];for(const i of e){let e;this.styleMirror.has(i)?e=this.styleMirror.getId(i):(e=this.styleMirror.add(i),r.push({styleId:e,rules:Array.from(i.rules||CSSRule,(e,t)=>({rule:Qb(e),index:t}))})),n.styleIds.push(e)}r.length>0&&(n.styles=r),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class ZS{constructor(){this.nodeMap=new WeakMap,this.active=!1}inOtherBuffer(e,t){const n=this.nodeMap.get(e);return n&&Array.from(n).some(e=>e!==t)}add(e,t){this.active||(this.active=!0,function(...e){aS("requestAnimationFrame")(...e)}(()=>{this.nodeMap=new WeakMap,this.active=!1})),this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}destroy(){}}let WS,XS;try{if(2!==Array.from([1],e=>2*e)[0]){const e=document.createElement("iframe");document.body.appendChild(e),Array.from=e.contentWindow?.Array.from||Array.from,document.body.removeChild(e)}}catch(fP){}const YS=new Jb;function KS(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:i="rr-block",blockSelector:a=null,unblockSelector:s=null,ignoreClass:o="rr-ignore",ignoreSelector:l=null,maskAllText:c=!1,maskTextClass:u="rr-mask",unmaskTextClass:h=null,maskTextSelector:d=null,unmaskTextSelector:p=null,inlineStylesheet:f=!0,maskAllInputs:m,maskInputOptions:g,slimDOMOptions:y,maskAttributeFn:_,maskInputFn:v,maskTextFn:x,maxCanvasSize:b=null,packFn:w,sampling:S={},dataURLOptions:k={},mousemoveWait:T,recordDOM:C=!0,recordCanvas:E=!1,recordCrossOriginIframes:I=!1,recordAfter:P=("DOMContentLoaded"===e.recordAfter?e.recordAfter:"load"),userTriggeredOnInput:M=!1,collectFonts:A=!1,inlineImages:z=!1,plugins:D,keepIframeSrcFn:R=()=>!1,ignoreCSSAttributes:L=new Set([]),errorHandler:N,onMutation:j,getCanvasManager:F}=e;bS=N;const O=!I||window.parent===window;let B=!1;if(!O)try{window.parent.document&&(B=!1)}catch(WI){B=!0}if(O&&!t)throw new Error("emit function is required");if(!O&&!B)return()=>{};void 0!==T&&void 0===S.mousemove&&(S.mousemove=T),YS.reset();const V=!0===m?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==g?g:{},U=!0===y||"all"===y?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===y,headMetaDescKeywords:"all"===y}:y||{};let q;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let $=0;const G=e=>{for(const t of D||[])t.eventProcessor&&(e=t.eventProcessor(e));return w&&!B&&(e=w(e)),e};WS=(e,i)=>{const a=e;if(a.timestamp=Uw(),!SS[0]?.isFrozen()||a.type===oS.FullSnapshot||a.type===oS.IncrementalSnapshot&&a.data.source===lS.Mutation||SS.forEach(e=>e.unfreeze()),O)t?.(G(a),i);else if(B){const e={type:"rrweb",event:G(a),origin:window.location.origin,isCheckout:i};window.parent.postMessage(e,"*")}if(a.type===oS.FullSnapshot)q=a,$=0;else if(a.type===oS.IncrementalSnapshot){if(a.data.source===lS.Mutation&&a.data.isAttachIframe)return;$++;const e=r&&$>=r,t=n&&q&&a.timestamp-q.timestamp>n;(e||t)&&ee(!0)}};const H=e=>{WS({type:oS.IncrementalSnapshot,data:{source:lS.Mutation,...e}})},Z=e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.Scroll,...e}}),W=e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.CanvasMutation,...e}}),X=new HS({mutationCb:H,adoptedStyleSheetCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.AdoptedStyleSheet,...e}})}),Y="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new FS:new OS({mirror:YS,mutationCb:H,stylesheetManager:X,recordCrossOriginIframes:I,wrappedEmit:WS});for(const ne of D||[])ne.getMirror&&ne.getMirror({nodeMirror:YS,crossOriginIframeMirror:Y.crossOriginIframeMirror,crossOriginIframeStyleMirror:Y.crossOriginIframeStyleMirror});const K=new ZS,Q=function(e,t){try{return e?e(t):new GS}catch{return new GS}}(F,{mirror:YS,win:window,mutationCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.CanvasMutation,...e}}),recordCanvas:E,blockClass:i,blockSelector:a,unblockSelector:s,maxCanvasSize:b,sampling:S.canvas,dataURLOptions:k,errorHandler:N}),J="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new BS:new VS({mutationCb:H,scrollCb:Z,bypassOptions:{onMutation:j,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:c,maskTextClass:u,unmaskTextClass:h,maskTextSelector:d,unmaskTextSelector:p,inlineStylesheet:f,maskInputOptions:V,dataURLOptions:k,maskAttributeFn:_,maskTextFn:x,maskInputFn:v,recordCanvas:E,inlineImages:z,sampling:S,slimDOMOptions:U,iframeManager:Y,stylesheetManager:X,canvasManager:Q,keepIframeSrcFn:R,processedNodeManager:K,ignoreCSSAttributes:L},mirror:YS}),ee=(e=!1)=>{if(!C)return;WS({type:oS.Meta,data:{href:window.location.href,width:Gw(),height:$w()}},e),X.reset(),J.init(),SS.forEach(e=>e.lock());const t=function(e,t){const{mirror:n=new Jb,blockClass:r="rr-block",blockSelector:i=null,unblockSelector:a=null,maskAllText:s=!1,maskTextClass:o="rr-mask",unmaskTextClass:l=null,maskTextSelector:c=null,unmaskTextSelector:u=null,inlineStylesheet:h=!0,inlineImages:d=!1,recordCanvas:p=!1,maskAllInputs:f=!1,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOM:_=!1,dataURLOptions:v,preserveWhiteSpace:x,onSerialize:b,onIframeLoad:w,iframeLoadTimeout:S,onBlockedImageLoad:k,onStylesheetLoad:T,stylesheetLoadTimeout:C,keepIframeSrcFn:E=()=>!1,ignoreCSSAttributes:I=new Set([])}=t||{};return Nw(e,{doc:e,mirror:n,blockClass:r,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:o,unmaskTextClass:l,maskTextSelector:c,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:h,maskInputOptions:!0===f?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===f?{}:f,maskAttributeFn:m,maskTextFn:g,maskInputFn:y,slimDOMOptions:!0===_||"all"===_?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===_,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===_?{}:_,dataURLOptions:v,inlineImages:d,recordCanvas:p,preserveWhiteSpace:x,onSerialize:b,onIframeLoad:w,iframeLoadTimeout:S,onBlockedImageLoad:k,onStylesheetLoad:T,stylesheetLoadTimeout:C,keepIframeSrcFn:E,newlyAddedElement:!1,ignoreCSSAttributes:I})}(document,{mirror:YS,blockClass:i,blockSelector:a,unblockSelector:s,maskAllText:c,maskTextClass:u,unmaskTextClass:h,maskTextSelector:d,unmaskTextSelector:p,inlineStylesheet:f,maskAllInputs:V,maskAttributeFn:_,maskInputFn:v,maskTextFn:x,slimDOM:U,dataURLOptions:k,recordCanvas:E,inlineImages:z,onSerialize:e=>{Kw(e,YS)&&Y.addIframe(e),Qw(e,YS)&&X.trackLinkElement(e),Jw(e)&&J.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{Y.attachIframe(e,t),e.contentWindow&&Q.addWindow(e.contentWindow),J.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{X.attachLinkElement(e,t)},onBlockedImageLoad:(e,t,{width:n,height:r})=>{H({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:{style:{width:`${n}px`,height:`${r}px`}}}]})},keepIframeSrcFn:R,ignoreCSSAttributes:L});t&&(WS({type:oS.FullSnapshot,data:{node:t,initialOffset:qw(window)}}),SS.forEach(e=>e.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&X.adoptStyleSheets(document.adoptedStyleSheets,YS.getId(document)))};XS=ee;try{const e=[],t=e=>wS(RS)({onMutation:j,mutationCb:H,mousemoveCb:(e,t)=>WS({type:oS.IncrementalSnapshot,data:{source:t,positions:e}}),mouseInteractionCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.MouseInteraction,...e}}),scrollCb:Z,viewportResizeCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.ViewportResize,...e}}),inputCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.Input,...e}}),mediaInteractionCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.MediaInteraction,...e}}),styleSheetRuleCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.StyleSheetRule,...e}}),styleDeclarationCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.StyleDeclaration,...e}}),canvasMutationCb:W,fontCb:e=>WS({type:oS.IncrementalSnapshot,data:{source:lS.Font,...e}}),selectionCb:e=>{WS({type:oS.IncrementalSnapshot,data:{source:lS.Selection,...e}})},customElementCb:e=>{WS({type:oS.IncrementalSnapshot,data:{source:lS.CustomElement,...e}})},blockClass:i,ignoreClass:o,ignoreSelector:l,maskAllText:c,maskTextClass:u,unmaskTextClass:h,maskTextSelector:d,unmaskTextSelector:p,maskInputOptions:V,inlineStylesheet:f,sampling:S,recordDOM:C,recordCanvas:E,inlineImages:z,userTriggeredOnInput:M,collectFonts:A,doc:e,maskAttributeFn:_,maskInputFn:v,maskTextFn:x,keepIframeSrcFn:R,blockSelector:a,unblockSelector:s,slimDOMOptions:U,dataURLOptions:k,mirror:YS,iframeManager:Y,stylesheetManager:X,shadowDomManager:J,processedNodeManager:K,canvasManager:Q,ignoreCSSAttributes:L,plugins:D?.filter(e=>e.observer)?.map(e=>({observer:e.observer,options:e.options,callback:t=>WS({type:oS.Plugin,data:{plugin:e.name,payload:t}})}))||[]},{});Y.addLoadListener(n=>{try{e.push(t(n.contentDocument))}catch(r){}});const n=()=>{ee(),e.push(t(document))};return"interactive"===document.readyState||"complete"===document.readyState?n():(e.push(jw("DOMContentLoaded",()=>{WS({type:oS.DomContentLoaded,data:{}}),"DOMContentLoaded"===P&&n()})),e.push(jw("load",()=>{WS({type:oS.Load,data:{}}),"load"===P&&n()},window))),()=>{e.forEach(e=>e()),K.destroy(),XS=void 0,bS=void 0}}catch(te){}}var QS,JS;KS.mirror=YS,KS.takeFullSnapshot=function(e){if(!XS)throw new Error("please take full snapshot after start recording");XS(e)},(JS=QS||(QS={}))[JS.NotStarted=0]="NotStarted",JS[JS.Running=1]="Running",JS[JS.Stopped=2]="Stopped";function ek(e){return e>9999999999?e:1e3*e}function tk(e){return e>9999999999?e/1e3:e}function nk(e,t){"sentry.transaction"!==t.category&&(["ui.click","ui.input"].includes(t.category)?e.triggerUserActivity():e.checkAndHandleExpiredSession(),e.addUpdate(()=>(e.throttledAddEvent({type:oS.Custom,timestamp:1e3*(t.timestamp||0),data:{tag:"breadcrumb",payload:zg(t,10,1e3)}}),"console"===t.category)))}function rk(e){return e.closest("button,a")||e}function ik(e){const t=ak(e);return t&&t instanceof Element?rk(t):t}function ak(e){return function(e){return"object"==typeof e&&!!e&&"target"in e}(e)?e.target:e}let sk;function ok(e){return sk||(sk=[],Mf(Ob,"open",function(e){return function(...t){if(sk)try{sk.forEach(e=>e())}catch{}return e.apply(Ob,t)}})),sk.push(e),()=>{const t=sk?sk.indexOf(e):-1;t>-1&&sk.splice(t,1)}}const lk=new Set([lS.Mutation,lS.StyleSheetRule,lS.StyleDeclaration,lS.AdoptedStyleSheet,lS.CanvasMutation,lS.Selection,lS.MediaInteraction]);class ck{constructor(e,t,n=nk){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=t.timeout/1e3,this._threshold=t.threshold/1e3,this._scrollTimeout=t.scrollTimeout/1e3,this._replay=e,this._ignoreSelector=t.ignoreSelector,this._addBreadcrumbEvent=n}addListeners(){const e=ok(()=>{this._lastMutation=hk()});this._teardown=()=>{e(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,t){if(function(e,t){if(!uk.includes(e.tagName))return!0;if("INPUT"===e.tagName&&!["submit","button"].includes(e.getAttribute("type")||""))return!0;if("A"===e.tagName&&(e.hasAttribute("download")||e.hasAttribute("target")&&"_self"!==e.getAttribute("target")))return!0;if(t&&e.matches(t))return!0;return!1}(t,this._ignoreSelector)||!function(e){return!(!e.data||"number"!=typeof e.data.nodeId||!e.timestamp)}(e))return;const n={timestamp:tk(e.timestamp),clickBreadcrumb:e,clickCount:0,node:t};this._clicks.some(e=>e.node===n.node&&Math.abs(e.timestamp-n.timestamp)<1)||(this._clicks.push(n),1===this._clicks.length&&this._scheduleCheckClicks())}registerMutation(e=Date.now()){this._lastMutation=tk(e)}registerScroll(e=Date.now()){this._lastScroll=tk(e)}registerClick(e){const t=rk(e);this._handleMultiClick(t)}_handleMultiClick(e){this._getClicks(e).forEach(e=>{e.clickCount++})}_getClicks(e){return this._clicks.filter(t=>t.node===e)}_checkClicks(){const e=[],t=hk();this._clicks.forEach(n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0),!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0),n.timestamp+this._timeout<=t&&e.push(n)});for(const n of e){const e=this._clicks.indexOf(n);e>-1&&(this._generateBreadcrumbs(n),this._clicks.splice(e,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){const t=this._replay,n=e.scrollAfter&&e.scrollAfter<=this._scrollTimeout,r=e.mutationAfter&&e.mutationAfter<=this._threshold,i=!n&&!r,{clickCount:a,clickBreadcrumb:s}=e;if(i){const n=1e3*Math.min(e.mutationAfter||this._timeout,this._timeout),r=n<1e3*this._timeout?"mutation":"timeout",i={type:"default",message:s.message,timestamp:s.timestamp,category:"ui.slowClickDetected",data:{...s.data,url:Ob.location.href,route:t.getCurrentRoute(),timeAfterClickMs:n,endReason:r,clickCount:a||1}};return void this._addBreadcrumbEvent(t,i)}if(a>1){const e={type:"default",message:s.message,timestamp:s.timestamp,category:"ui.multiClick",data:{...s.data,url:Ob.location.href,route:t.getCurrentRoute(),clickCount:a,metric:!0}};this._addBreadcrumbEvent(t,e)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=Kx(()=>this._checkClicks(),1e3)}}const uk=["A","BUTTON","INPUT"];function hk(){return Date.now()/1e3}function dk(e,t){try{if(!function(e){return 3===e.type}(t))return;const{source:n}=t.data;if(lk.has(n)&&e.registerMutation(t.timestamp),n===lS.Scroll&&e.registerScroll(t.timestamp),function(e){return e.data.source===lS.MouseInteraction}(t)){const{type:n,id:r}=t.data,i=KS.mirror.getNode(r);i instanceof HTMLElement&&n===cS.Click&&e.registerClick(i)}}catch{}}function pk(e){return{timestamp:Date.now()/1e3,type:"default",...e}}var fk=(e=>(e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment",e))(fk||{});const mk=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function gk(e){const t={};!e["data-sentry-component"]&&e["data-sentry-element"]&&(e["data-sentry-component"]=e["data-sentry-element"]);for(const n in e)if(mk.has(n)){let r=n;"data-testid"!==n&&"data-test-id"!==n||(r="testId"),t[r]=e[n]}return t}const yk=e=>t=>{if(!e.isEnabled())return;const n=function(e){const{target:t,message:n}=function(e){const t="click"===e.name;let n,r=null;try{r=t?ik(e.event):ak(e.event),n=Cf(r,{maxStringLength:200})||"<unknown>"}catch{n="<unknown>"}return{target:r,message:n}}(e);return pk({category:`ui.${e.name}`,..._k(t,n)})}(t);if(!n)return;const r="click"===t.name,i=r?t.event:void 0;var a,s,o;!(r&&e.clickDetector&&i?.target)||i.altKey||i.metaKey||i.ctrlKey||i.shiftKey||(a=e.clickDetector,s=n,o=ik(t.event),a.handleClick(s,o)),nk(e,n)};function _k(e,t){const n=KS.mirror.getId(e),r=n&&KS.mirror.getNode(n),i=r&&KS.mirror.getMeta(r),a=i&&function(e){return e.type===fk.Element}(i)?i:null;return{message:t,data:a?{nodeId:n,node:{id:n,tagName:a.tagName,textContent:Array.from(a.childNodes).map(e=>e.type===fk.Text&&e.textContent).filter(Boolean).map(e=>e.trim()).join(""),attributes:gk(a.attributes)}}:{}}}function vk(e,t){if(!e.isEnabled())return;e.updateUserActivity();const n=function(e){const{metaKey:t,shiftKey:n,ctrlKey:r,altKey:i,key:a,target:s}=e;if(!s||function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable}(s)||!a)return null;const o=t||r||i,l=1===a.length;if(!o&&l)return null;const c=Cf(s,{maxStringLength:200})||"<unknown>",u=_k(s,c);return pk({category:"ui.keyDown",message:c,data:{...u.data,metaKey:t,shiftKey:n,ctrlKey:r,altKey:i,key:a}})}(t);n&&nk(e,n)}const xk={resource:function(e){const{entryType:t,initiatorType:n,name:r,responseEnd:i,startTime:a,decodedBodySize:s,encodedBodySize:o,responseStatus:l,transferSize:c}=e;if(["fetch","xmlhttprequest"].includes(n))return null;return{type:`${t}.${n}`,start:Sk(a),end:Sk(i),name:r,data:{size:c,statusCode:l,decodedBodySize:s,encodedBodySize:o}}},paint:function(e){const{duration:t,entryType:n,name:r,startTime:i}=e,a=Sk(i);return{type:n,name:r,start:a,end:a+t,data:void 0}},navigation:function(e){const{entryType:t,name:n,decodedBodySize:r,duration:i,domComplete:a,encodedBodySize:s,domContentLoadedEventStart:o,domContentLoadedEventEnd:l,domInteractive:c,loadEventStart:u,loadEventEnd:h,redirectCount:d,startTime:p,transferSize:f,type:m}=e;if(0===i)return null;return{type:`${t}.${m}`,start:Sk(p),end:Sk(a),name:n,data:{size:f,decodedBodySize:r,encodedBodySize:s,duration:i,domInteractive:c,domContentLoadedEventStart:o,domContentLoadedEventEnd:l,loadEventStart:u,loadEventEnd:h,domComplete:a,redirectCount:d}}}};function bk(e,t){return({metric:n})=>{t.replayPerformanceEntries.push(e(n))}}function wk(e){const t=xk[e.entryType];return t?t(e):null}function Sk(e){return((nm()||Ob.performance.timeOrigin)+e)/1e3}function kk(e){const t=e.entries[e.entries.length-1];return Ik(e,"largest-contentful-paint",t?.element?[t.element]:void 0)}function Tk(e){return void 0!==e.sources}function Ck(e){const t=[],n=[];for(const r of e.entries)if(Tk(r)){const e=[];for(const t of r.sources)if(t.node){n.push(t.node);const r=KS.mirror.getId(t.node);r&&e.push(r)}t.push({value:r.value,nodeIds:e.length?e:void 0})}return Ik(e,"cumulative-layout-shift",n,t)}function Ek(e){const t=e.entries[e.entries.length-1];return Ik(e,"interaction-to-next-paint",t?.target?[t.target]:void 0)}function Ik(e,t,n,r){const i=e.value,a=e.rating,s=Sk(i);return{type:"web-vital",name:t,start:s,end:s,data:{value:i,size:i,rating:a,nodeIds:n?n.map(e=>KS.mirror.getId(e)):void 0,attributions:r}}}const Pk="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;const Mk=["log","warn","error"],Ak="[Replay] ";function zk(e,t="info"){b_({category:"console",data:{logger:"replay"},level:t,message:`${Ak}${e}`},{level:t})}const Dk=function(){let e=!1,t=!1;const n={exception:()=>{},infoTick:()=>{},setConfig:n=>{e=!!n.captureExceptions,t=!!n.traceInternals}};return Pk?(Mk.forEach(e=>{n[e]=(...n)=>{qp[e](Ak,...n),t&&zk(n.join(""),N_(e))}}),n.exception=(r,...i)=>{i.length&&n.error&&n.error(...i),qp.error(Ak,r),e?ky(r,{mechanism:{handled:!0,type:"auto.function.replay.debug"}}):t&&zk(r,"error")},n.infoTick=(...e)=>{qp.log(Ak,...e),t&&setTimeout(()=>zk(e[0]),0)}):Mk.forEach(e=>{n[e]=()=>{}}),n}();class Rk extends Error{constructor(){super("Event buffer exceeded maximum size of 20000000.")}}class Lk{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1,this.waitForCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){const t=JSON.stringify(e).length;if(this._totalSize+=t,this._totalSize>$b)throw new Rk;this.events.push(e)}finish(){return new Promise(e=>{const t=this.events;this.clear(),e(JSON.stringify(t))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const e=this.events.map(e=>e.timestamp).sort()[0];return e?ek(e):null}}class Nk{constructor(e){this._worker=e,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise((e,t)=>{this._worker.addEventListener("message",({data:n})=>{n.success?e():t()},{once:!0}),this._worker.addEventListener("error",e=>{t(e)},{once:!0})})),this._ensureReadyPromise}destroy(){Pk&&Dk.log("Destroying compression worker"),this._worker.terminate()}postMessage(e,t){const n=this._getAndIncrementId();return new Promise((r,i)=>{const a=({data:t})=>{const s=t;if(s.method===e&&s.id===n){if(this._worker.removeEventListener("message",a),!s.success)return Pk&&Dk.error("Error in compression worker: ",s.response),void i(new Error("Error in compression worker"));r(s.response)}};this._worker.addEventListener("message",a),this._worker.postMessage({id:n,method:e,arg:t})})}_getAndIncrementId(){return this._id++}}class jk{constructor(e){this._worker=new Nk(e),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this.waitForCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){const t=ek(e.timestamp);(!this._earliestTimestamp||t<this._earliestTimestamp)&&(this._earliestTimestamp=t);const n=JSON.stringify(e);return this._totalSize+=n.length,this._totalSize>$b?Promise.reject(new Rk):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear").then(null,e=>{Pk&&Dk.exception(e,'Sending "clear" message to worker failed',e)})}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){const e=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,e}}class Fk{constructor(e){this._fallback=new Lk,this._compression=new jk(e),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get waitForCheckout(){return this._used.waitForCheckout}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}set waitForCheckout(e){this._used.waitForCheckout=e}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(e){return void(Pk&&Dk.exception(e,"Failed to load the compression worker, falling back to simple buffer"))}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:e,hasCheckout:t,waitForCheckout:n}=this._fallback,r=[];for(const a of e)r.push(this._compression.addEvent(a));this._compression.hasCheckout=t,this._compression.waitForCheckout=n,this._used=this._compression;try{await Promise.all(r),this._fallback.clear()}catch(i){Pk&&Dk.exception(i,"Failed to add events when switching buffers.")}}}function Ok({useCompression:e,workerUrl:t}){if(e&&window.Worker){const e=function(e){try{const t=e||function(){if("undefined"==typeof __SENTRY_EXCLUDE_REPLAY_WORKER__||!__SENTRY_EXCLUDE_REPLAY_WORKER__)return function(){const e=new Blob(['var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(t,e){for(var i=new n(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var a=new r(i[30]);for(s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)a[o]=o-i[s]<<5|s;return{b:i,r:a}},o=a(e,2),h=o.b,f=o.r;h[28]=258,f[258]=28;for(var l=a(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,s=0,a=new n(r);s<i;++s)t[s]&&++a[t[s]-1];var o,h=new n(r);for(s=1;s<r;++s)h[s]=h[s-1]+a[s-1]<<1;if(e){o=new n(1<<r);var f=15-r;for(s=0;s<i;++s)if(t[s])for(var l=s<<4|t[s],c=r-t[s],v=h[t[s]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>f]=l}else for(o=new n(i),s=0;s<i;++s)t[s]&&(o[s]=u[h[t[s]-1]++]>>15-t[s]);return o},p=new t(288);for(c=0;c<144;++c)p[c]=8;for(c=144;c<256;++c)p[c]=9;for(c=256;c<280;++c)p[c]=7;for(c=280;c<288;++c)p[c]=8;var g=new t(32);for(c=0;c<32;++c)g[c]=5;var w=d(p,9,0),y=d(g,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},_=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},x=function(r,e){for(var i=[],s=0;s<r.length;++s)r[s]&&i.push({s:s,f:r[s]});var a=i.length,o=i.slice();if(!a)return{t:F,l:0};if(1==a){var h=new t(i[0].s+1);return h[i[0].s]=1,{t:h,l:1}}i.sort(function(t,n){return t.f-n.f}),i.push({s:-1,f:25001});var f=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:f.f+l.f,l:f,r:l};c!=a-1;)f=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:f.f+l.f,l:f,r:l};var d=o[0].s;for(s=1;s<a;++s)o[s].s>d&&(d=o[s].s);var p=new n(d+1),g=A(i[c-1],p,0);if(g>e){s=0;var w=0,y=g-e,m=1<<y;for(o.sort(function(t,n){return p[n.s]-p[t.s]||t.f-n.f});s<a;++s){var b=o[s].s;if(!(p[b]>e))break;w+=m-(1<<g-p[b]),p[b]=e}for(w>>=y;w>0;){var M=o[s].s;p[M]<e?w-=1<<e-p[M]++-1:++s}for(;s>=0&&w;--s){var E=o[s].s;p[E]==e&&(--p[E],++w)}g=e}return{t:new t(p),l:g}},A=function(t,n,r){return-1==t.s?Math.max(A(t.l,n,r+1),A(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,s=t[0],a=1,o=function(t){e[i++]=t},h=1;h<=r;++h)if(t[h]==s&&h!=r)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=t[h]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<e;++s)t[i+s+4]=r[s];return 8*(i+4+e)},U=function(t,r,a,o,h,f,l,u,c,v,m){z(r,m++,a),++h[256];for(var b=x(h,15),M=b.t,E=b.l,A=x(f,15),U=A.t,C=A.l,F=D(M),I=F.c,S=F.n,L=D(U),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=x(q,7),H=G.t,J=G.l,K=19;K>4&&!H[s[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(h,p)+T(f,g)+l,X=T(h,M)+T(f,U)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(U,C,0),R=U;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[s[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=w,P=p,Q=y,R=g;for(B=0;B<u;++B){var rt=o[B];if(rt>255){_(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;_(r,m,Q[et]),m+=R[et],et>3&&(_(r,m,rt>>5&8191),m+=i[et])}else _(r,m,N[rt]),m+=P[rt]}return _(r,m,N[256]),m+P[256]},C=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,s=0|r.length,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=e+=r[a];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},L=function(s,a,o,h,u){if(!u&&(u={l:1},a.dictionary)){var c=a.dictionary.subarray(-32768),v=new t(c.length+s.length);v.set(c),v.set(s,c.length),s=v,u.w=c.length}return function(s,a,o,h,u,c){var v=c.z||s.length,d=new t(h+v+5*(1+Math.ceil(v/7e3))+u),p=d.subarray(h,d.length-u),g=c.l,w=7&(c.r||0);if(a){w&&(p[0]=c.r>>3);for(var y=C[a-1],M=y>>13,E=8191&y,z=(1<<o)-1,_=c.p||new n(32768),x=c.h||new n(z+1),A=Math.ceil(o/3),D=2*A,T=function(t){return(s[t]^s[t+1]<<A^s[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=x[H];if(_[J]=K,x[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!g)){w=U(s,p,0,F,I,S,O,q,G,j-G,w),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(s[j+Q]==s[j+Q-W]){for(var $=0;$<Z&&s[j+$]==s[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-_[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=_[J])&32767}if(R){F[q++]=268435456|f[Q]<<18|l[R];var it=31&f[Q],st=31&l[R];O+=e[it]+i[st],++I[257+it],++S[st],B=j+Q,++L}else F[q++]=s[j],++I[s[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=s[j],++I[s[j]];w=U(s,p,g,F,I,S,O,q,G,j-G,w),g||(c.r=7&w|p[w/8|0]<<3,w-=7,c.h=x,c.p=_,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+g;j+=65535){var at=j+65535;at>=v&&(p[w/8|0]=g,at=v),w=k(p,w+1,s.subarray(j,at))}c.i=v}return b(d,0,h+m(w)+u)}(s,null==a.level?6:a.level,null==a.mem?u.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):20:12+a.mem,o,h,u)},O=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},j=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(L(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var s=this.b.length-this.s.z;this.b.set(n.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(s),32768),this.s.z=n.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n.prototype.flush=function(){this.ondata||E(5),this.s.l&&E(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},n}();function q(t,n){n||(n={});var r=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}}(),e=t.length;r.p(t);var i,s=L(t,n,10+((i=n).filename?i.filename.length+1:0),8),a=s.length;return function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&O(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}}(s,n),O(s,a-8,r.d()),O(s,a-4,e),s}var B=function(){function t(t,n){this.c=S(),this.v=1,j.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),j.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=L(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=S();i.p(n.dictionary),O(t,2,i.d())}}(r,this.o),this.v=0),n&&O(r,r.length-4,this.c.d()),this.ondata(r,n)},t.prototype.flush=function(){j.prototype.flush.call(this)},t}(),G="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(F,{stream:!0})}catch(t){}var J=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(K(t),this.d=n||!1)},t}();function K(n,r){if(G)return G.encode(n);for(var e=n.length,i=new t(n.length+(n.length>>1)),s=0,a=function(t){i[s++]=t},o=0;o<e;++o){if(s+5>i.length){var h=new t(s+8+(e-o<<1));h.set(i),i=h}var f=n.charCodeAt(o);f<128||r?a(f):f<2048?(a(192|f>>6),a(128|63&f)):f>55295&&f<57344?(a(240|(f=65536+(1047552&f)|1023&n.charCodeAt(++o))>>18),a(128|f>>12&63),a(128|f>>6&63),a(128|63&f)):(a(224|f>>12),a(128|f>>6&63),a(128|63&f))}return b(i,0,s)}const N=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(const r of t)n+=r.length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new B,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new J((t,n)=>{this.deflate.push(t,n)}),this.stream.push("[")}},P={clear:()=>{N.clear()},addEvent:t=>N.addEvent(t),finish:()=>N.finish(),compress:t=>function(t){return q(K(t))}(t)};addEventListener("message",function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in P&&"function"==typeof P[n])try{const t=P[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}}),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(e)}();return""}();if(!t)return;Pk&&Dk.log("Using compression worker"+(e?` from ${e}`:""));const n=new Worker(t);return new Fk(n)}catch(t){Pk&&Dk.exception(t,"Failed to create compression worker")}}(t);if(e)return e}return Pk&&Dk.log("Using simple buffer"),new Lk}function Bk(){try{return"sessionStorage"in Ob&&!!Ob.sessionStorage}catch{return!1}}function Vk(e){!function(){if(!Bk())return;try{Ob.sessionStorage.removeItem(Bb)}catch{}}(),e.session=void 0}function Uk(e){return void 0!==e&&Math.random()<e}function qk(e){if(Bk())try{Ob.sessionStorage.setItem(Bb,JSON.stringify(e))}catch{}}function $k(e){const t=Date.now();return{id:e.id||Hf(),started:e.started||t,lastActivity:e.lastActivity||t,segmentId:e.segmentId||0,sampled:e.sampled,previousSessionId:e.previousSessionId,dirty:e.dirty||!1}}function Gk({sessionSampleRate:e,allowBuffering:t,stickySession:n=!1},{previousSessionId:r}={}){const i=function(e,t){return Uk(e)?"session":!!t&&"buffer"}(e,t),a=$k({sampled:i,previousSessionId:r});return n&&qk(a),a}function Hk(e,t,n=+new Date){return null===e||void 0===t||t<0||0!==t&&e+t<=n}function Zk(e,{maxReplayDuration:t,sessionIdleExpire:n,targetTime:r=Date.now()}){return Hk(e.started,t,r)||Hk(e.lastActivity,n,r)}function Wk(e,{sessionIdleExpire:t,maxReplayDuration:n}){return!!Zk(e,{sessionIdleExpire:t,maxReplayDuration:n})&&("buffer"!==e.sampled||0!==e.segmentId)}function Xk({sessionIdleExpire:e,maxReplayDuration:t,previousSessionId:n},r){const i=r.stickySession&&function(){if(!Bk())return null;try{const e=Ob.sessionStorage.getItem(Bb);if(!e)return null;const t=JSON.parse(e);return Pk&&Dk.infoTick("Loading existing session"),$k(t)}catch{return null}}();return i?Wk(i,{sessionIdleExpire:e,maxReplayDuration:t})?(Pk&&Dk.infoTick("Session in sessionStorage is expired, creating new one..."),Gk(r,{previousSessionId:i.id})):i:(Pk&&Dk.infoTick("Creating new session"),Gk(r,{previousSessionId:n}))}function Yk(e,t,n){return!!Qk(e,t)&&(Kk(e,t,n),!0)}async function Kk(e,t,n){const{eventBuffer:r}=e;if(!r||r.waitForCheckout&&!n)return null;const i="buffer"===e.recordingMode;try{n&&i&&r.clear(),n&&(r.hasCheckout=!0,r.waitForCheckout=!1);const a=function(e,t){try{if("function"==typeof t&&function(e){return e.type===oS.Custom}(e))return t(e)}catch(n){return Pk&&Dk.exception(n,"An error occurred in the `beforeAddRecordingEvent` callback, skipping the event..."),null}return e}(t,e.getOptions().beforeAddRecordingEvent);if(!a)return;return await r.addEvent(a)}catch(a){const t=a&&a instanceof Rk,n=t?"addEventSizeExceeded":"addEvent",s=bm();if(s){const e=t?"buffer_overflow":"internal_sdk_error";s.recordDroppedEvent(e,"replay")}if(t&&i)return r.clear(),r.waitForCheckout=!0,null;e.handleException(a),await e.stop({reason:n})}}function Qk(e,t){if(!e.eventBuffer||e.isPaused()||!e.isEnabled())return!1;const n=ek(t.timestamp);return!(n+e.timeouts.sessionIdlePause<Date.now())&&(!(n>e.getContext().initialTimestamp+e.getOptions().maxReplayDuration)||(Pk&&Dk.infoTick(`Skipping event with timestamp ${n} because it is after maxReplayDuration`),!1))}function Jk(e){return!e.type}function eT(e){return"transaction"===e.type}function tT(e){return"feedback"===e.type}function nT(e){return(t,n)=>{if(!e.isEnabled()||!Jk(t)&&!eT(t))return;const r=n.statusCode;!r||r<200||r>=300||(eT(t)?function(e,t){const n=e.getContext();t.contexts?.trace?.trace_id&&n.traceIds.size<100&&n.traceIds.add(t.contexts.trace.trace_id)}(e,t):function(e,t){const n=e.getContext();t.event_id&&n.errorIds.size<100&&n.errorIds.add(t.event_id);if("buffer"!==e.recordingMode||!t.tags||!t.tags.replayId)return;const{beforeErrorSampling:r}=e.getOptions();if("function"==typeof r&&!r(t))return;Kx(async()=>{try{await e.sendBufferedReplayOrFlush()}catch(fP){e.handleException(fP)}})}(e,t))}}function rT(e){return t=>{e.isEnabled()&&Jk(t)&&function(e,t){const n=t.exception?.values?.[0]?.value;if("string"!=typeof n)return;if(n.match(/(reactjs\.org\/docs\/error-decoder\.html\?invariant=|react\.dev\/errors\/)(418|419|422|423|425)/)||n.match(/(does not match server-rendered HTML|Hydration failed because)/i)){nk(e,pk({category:"replay.hydrate-error",data:{url:If()}}))}}(e,t)}}function iT(e){const t=bm();t&&t.on("beforeAddBreadcrumb",t=>function(e,t){if(!e.isEnabled()||!aT(t))return;const n=function(e){if(!aT(e)||["fetch","xhr","sentry.event","sentry.transaction"].includes(e.category)||e.category.startsWith("ui."))return null;if("console"===e.category)return function(e){const t=e.data?.arguments;if(!Array.isArray(t)||0===t.length)return pk(e);let n=!1;const r=t.map(e=>{if(!e)return e;if("string"==typeof e)return e.length>qb?(n=!0,`${e.slice(0,qb)}`):e;if("object"==typeof e)try{const t=zg(e,7);return JSON.stringify(t).length>qb?(n=!0,`${JSON.stringify(t,null,2).slice(0,qb)}`):t}catch{}return e});return pk({...e,data:{...e.data,arguments:r,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}(e);return pk(e)}(t);n&&nk(e,n)}(e,t))}function aT(e){return!!e.category}function sT(){const e=_m().getPropagationContext().dsc;e&&delete e.replay_id;const t=yg();if(t){delete Mg(t).replay_id}}function oT(e){return Object.assign((t,n)=>{if(!e.isEnabled()||e.isPaused())return t;if(function(e){return"replay_event"===e.type}(t))return delete t.breadcrumbs,t;if(!Jk(t)&&!eT(t)&&!tT(t))return t;if(!e.checkAndHandleExpiredSession())return sT(),t;if(tT(t))return e.flush(),t.contexts.feedback.replay_id=e.getSessionId(),function(e,t){e.triggerUserActivity(),e.addUpdate(()=>!t.timestamp||(e.throttledAddEvent({type:oS.Custom,timestamp:1e3*t.timestamp,data:{tag:"breadcrumb",payload:{timestamp:t.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:t.event_id}}}}),!1))}(e,t),t;if(function(e,t){return!(e.type||!e.exception?.values?.length||!t.originalException?.__rrweb__)}(t,n)&&!e.getOptions()._experiments.captureExceptions)return Pk&&Dk.log("Ignoring error from rrweb internals",t),null;const r=function(e,t){return"buffer"===e.recordingMode&&t.message!==Vb&&!(!t.exception||t.type)&&Uk(e.getOptions().errorSampleRate)}(e,t);if((r||"session"===e.recordingMode)&&(t.tags={...t.tags,replayId:e.getSessionId()}),r&&"buffer"===e.recordingMode&&"buffer"===e.session?.sampled){const t=e.session;t.dirty=!0,e.getOptions().stickySession&&qk(t)}return t},{id:"Replay"})}function lT(e,t){return t.map(({type:t,start:n,end:r,name:i,data:a})=>{const s=e.throttledAddEvent({type:oS.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:t,description:i,startTimestamp:n,endTimestamp:r,data:a}}});return"string"==typeof s?Promise.resolve(null):s})}function cT(e){return t=>{if(!e.isEnabled())return;const n=function(e){const{from:t,to:n}=e,r=Date.now()/1e3;return{type:"navigation.push",start:r,end:r,name:n,data:{previous:t}}}(t);null!==n&&(e.getContext().urls.push(n.name),e.triggerUserActivity(),e.addUpdate(()=>(lT(e,[n]),!1)))}}function uT(e,t){e.isEnabled()&&null!==t&&(function(e,t){return(!Pk||!e.getOptions()._experiments.traceInternals)&&m_(t,bm())}(e,t.name)||e.addUpdate(()=>(lT(e,[t]),!0)))}function hT(e){if(!e)return;const t=new TextEncoder;try{if("string"==typeof e)return t.encode(e).length;if(e instanceof URLSearchParams)return t.encode(e.toString()).length;if(e instanceof FormData){const n=nb(e);return t.encode(n).length}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength}catch{}}function dT(e){if(!e)return;const t=parseInt(e,10);return isNaN(t)?void 0:t}function pT(e,t){if(!e)return{headers:{},size:void 0,_meta:{warnings:[t]}};const n={...e._meta},r=n.warnings||[];return n.warnings=[...r,t],e._meta=n,e}function fT(e,t){if(!t)return null;const{startTimestamp:n,endTimestamp:r,url:i,method:a,statusCode:s,request:o,response:l}=t;return{type:e,start:n/1e3,end:r/1e3,name:i,data:{method:a,statusCode:s,request:o,response:l}}}function mT(e){return{headers:{},size:e,_meta:{warnings:["URL_SKIPPED"]}}}function gT(e,t,n){if(!t&&0===Object.keys(e).length)return;if(!t)return{headers:e};if(!n)return{headers:e,size:t};const r={headers:e,size:t},{body:i,warnings:a}=function(e){if(!e||"string"!=typeof e)return{body:e};const t=e.length>Ub,n=function(e){const t=e[0],n=e[e.length-1];return"["===t&&"]"===n||"{"===t&&"}"===n}(e);if(t){const t=e.slice(0,Ub);return n?{body:t,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${t}`,warnings:["TEXT_TRUNCATED"]}}if(n)try{return{body:JSON.parse(e)}}catch{}return{body:e}}(n);return r.body=i,a?.length&&(r._meta={warnings:a}),r}function yT(e,t){return Object.entries(e).reduce((n,[r,i])=>{const a=r.toLowerCase();return t.includes(a)&&e[r]&&(n[a]=i),n},{})}function _T(e,t){const n=function(e,t=Ob.document.baseURI){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith(Ob.location.origin))return e;const n=new URL(e,t);if(n.origin!==new URL(t).origin)return e;const r=n.href;if(!e.endsWith("/")&&r.endsWith("/"))return r.slice(0,-1);return r}(e);return Gf(n,t)}async function vT(e,t,n){try{const r=await async function(e,t,n){const r=Date.now(),{startTimestamp:i=r,endTimestamp:a=r}=t,{url:s,method:o,status_code:l=0,request_body_size:c,response_body_size:u}=e.data,h=_T(s,n.networkDetailAllowUrls)&&!_T(s,n.networkDetailDenyUrls),d=h?function({networkCaptureBodies:e,networkRequestHeaders:t},n,r){const i=n?function(e,t){if(1===e.length&&"string"!=typeof e[0])return bT(e[0],t);if(2===e.length)return bT(e[1],t);return{}}(n,t):{};if(!e)return gT(i,r,void 0);const a=ib(n),[s,o]=rb(a,Dk),l=gT(i,r,s);if(o)return pT(l,o);return l}(n,t.input,c):mT(c),p=await async function(e,{networkCaptureBodies:t,networkResponseHeaders:n},r,i){if(!e&&void 0!==i)return mT(i);const a=r?xT(r.headers,n):{};if(!r||!t&&void 0!==i)return gT(a,i,void 0);const[s,o]=await async function(e){const t=function(e){try{return e.clone()}catch(t){Pk&&Dk.exception(t,"Failed to clone response body")}}(e);if(!t)return[void 0,"BODY_PARSE_ERROR"];try{const e=await function(e){return new Promise((t,n)=>{const r=Kx(()=>n(new Error("Timeout while trying to read response body")),500);(async function(e){return await e.text()})(e).then(e=>t(e),e=>n(e)).finally(()=>clearTimeout(r))})}(t);return[e]}catch(n){return n instanceof Error&&n.message.indexOf("Timeout")>-1?(Pk&&Dk.warn("Parsing text body from response timed out"),[void 0,"BODY_PARSE_TIMEOUT"]):(Pk&&Dk.exception(n,"Failed to get text body from response"),[void 0,"BODY_PARSE_ERROR"])}}(r),l=function(e,{networkCaptureBodies:t,responseBodySize:n,captureDetails:r,headers:i}){try{const a=e?.length&&void 0===n?hT(e):n;return r?gT(i,a,t?e:void 0):mT(a)}catch(a){return Pk&&Dk.exception(a,"Failed to serialize response body"),gT(i,n,void 0)}}(s,{networkCaptureBodies:t,responseBodySize:i,captureDetails:e,headers:a});if(o)return pT(l,o);return l}(h,n,t.response,u);return{startTimestamp:i,endTimestamp:a,url:s,method:o,statusCode:l,request:d,response:p}}(e,t,n),i=fT("resource.fetch",r);uT(n.replay,i)}catch(r){Pk&&Dk.exception(r,"Failed to capture fetch breadcrumb")}}function xT(e,t){const n={};return t.forEach(t=>{e.get(t)&&(n[t]=e.get(t))}),n}function bT(e,t){if(!e)return{};const n=e.headers;return n?n instanceof Headers?xT(n,t):Array.isArray(n)?{}:yT(n,t):{}}async function wT(e,t,n){try{const r=function(e,t,n){const r=Date.now(),{startTimestamp:i=r,endTimestamp:a=r,input:s,xhr:o}=t,{url:l,method:c,status_code:u=0,request_body_size:h,response_body_size:d}=e.data;if(!l)return null;if(!o||!_T(l,n.networkDetailAllowUrls)||_T(l,n.networkDetailDenyUrls)){return{startTimestamp:i,endTimestamp:a,url:l,method:c,statusCode:u,request:mT(h),response:mT(d)}}const p=o[Qx],f=p?yT(p.request_headers,n.networkRequestHeaders):{},m=yT(ab(o),n.networkResponseHeaders),[g,y]=n.networkCaptureBodies?rb(s,Dk):[void 0],[_,v]=n.networkCaptureBodies?function(e){const t=[];try{return[e.responseText]}catch(WI){t.push(WI)}try{return function(e,t){try{if("string"==typeof e)return[e];if(e instanceof Document)return[e.body.outerHTML];if("json"===t&&e&&"object"==typeof e)return[JSON.stringify(e)];if(!e)return[void 0]}catch(n){return Pk&&Dk.exception(n,"Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return Pk&&Dk.log("Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}(e.response,e.responseType)}catch(WI){t.push(WI)}return Pk&&Dk.warn("Failed to get xhr response body",...t),[void 0]}(o):[void 0],x=gT(f,h,g),b=gT(m,d,_);return{startTimestamp:i,endTimestamp:a,url:l,method:c,statusCode:u,request:y?pT(x,y):x,response:v?pT(b,v):b}}(e,t,n),i=fT("resource.xhr",r);uT(n.replay,i)}catch(r){Pk&&Dk.exception(r,"Failed to capture xhr breadcrumb")}}function ST(e,t){const{xhr:n,input:r}=t;if(!n)return;const i=hT(r),a=n.getResponseHeader("content-length")?dT(n.getResponseHeader("content-length")):function(e,t){try{return hT("json"===t&&e&&"object"==typeof e?JSON.stringify(e):e)}catch{return}}(n.response,n.responseType);void 0!==i&&(e.data.request_body_size=i),void 0!==a&&(e.data.response_body_size=a)}function kT(e){const t=bm();try{const{networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:i,networkRequestHeaders:a,networkResponseHeaders:s}=e.getOptions(),o={replay:e,networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:i,networkRequestHeaders:a,networkResponseHeaders:s};t&&t.on("beforeAddBreadcrumb",(e,t)=>function(e,t,n){if(!t.data)return;try{(function(e){return"xhr"===e.category})(t)&&function(e){return e?.xhr}(n)&&(ST(t,n),wT(t,n,e)),function(e){return"fetch"===e.category}(t)&&function(e){return e?.response}(n)&&(!function(e,t){const{input:n,response:r}=t,i=hT(n?ib(n):void 0),a=r?dT(r.headers.get("content-length")):void 0;void 0!==i&&(e.data.request_body_size=i),void 0!==a&&(e.data.response_body_size=a)}(t,n),vT(t,n,e))}catch(WI){Pk&&Dk.exception(WI,"Error when enriching network breadcrumb")}}(o,e,t))}catch{}}function TT(e){const t=bm();$x(yk(e)),Zx(cT(e)),iT(e),kT(e);const n=oT(e);var r;r=n,vm().addEventProcessor(r),t&&(t.on("beforeSendEvent",rT(e)),t.on("afterSendEvent",nT(e)),t.on("createDsc",t=>{const n=e.getSessionId();if(n&&e.isEnabled()&&"session"===e.recordingMode){e.checkAndHandleExpiredSession()&&(t.replay_id=n)}}),t.on("spanStart",t=>{e.lastActiveSpan=t}),t.on("spanEnd",t=>{e.lastActiveSpan=t}),t.on("beforeSendFeedback",async(t,n)=>{const r=e.getSessionId();n?.includeReplay&&e.isEnabled()&&r&&t.contexts?.feedback&&("api"===t.contexts.feedback.source&&await e.sendBufferedReplayOrFlush(),t.contexts.feedback.replay_id=r)}),t.on("openFeedbackWidget",async()=>{await e.sendBufferedReplayOrFlush()}))}function CT(e){const{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}=e,i=Date.now()/1e3;return{type:"memory",name:"memory",start:i,end:i,data:{memory:{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}}}}function ET(e,t,n){return function(e,t,n){let r,i,a;const s=n?.maxWait?Math.max(n.maxWait,t):0,o=n?.setTimeoutImpl||setTimeout;function l(){return c(),r=e(),r}function c(){void 0!==i&&clearTimeout(i),void 0!==a&&clearTimeout(a),i=a=void 0}function u(){return i&&clearTimeout(i),i=o(l,t),s&&void 0===a&&(a=o(l,s)),r}return u.cancel=c,u.flush=function(){return void 0!==i||void 0!==a?l():r},u}(e,t,{...n,setTimeoutImpl:Kx})}const IT=zp.navigator;function PT(e){let t=!1;return(n,r)=>{if(!e.checkAndHandleExpiredSession())return void(Pk&&Dk.warn("Received replay event after session expired."));const i=r||!t;t=!0,e.clickDetector&&dk(e.clickDetector,n),e.addUpdate(()=>{if("buffer"===e.recordingMode&&i&&e.setInitialState(),!Yk(e,n,i))return!0;if(!i)return!1;const t=e.session;if(function(e,t){if(!t||!e.session||0!==e.session.segmentId)return;Yk(e,function(e){const t=e.getOptions();return{type:oS.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:e.isRecordingCanvas(),sessionSampleRate:t.sessionSampleRate,errorSampleRate:t.errorSampleRate,useCompressionOption:t.useCompression,blockAllMedia:t.blockAllMedia,maskAllText:t.maskAllText,maskAllInputs:t.maskAllInputs,useCompression:!!e.eventBuffer&&"worker"===e.eventBuffer.type,networkDetailHasUrls:t.networkDetailAllowUrls.length>0,networkCaptureBodies:t.networkCaptureBodies,networkRequestHasHeaders:t.networkRequestHeaders.length>0,networkResponseHasHeaders:t.networkResponseHeaders.length>0}}}}(e),!1)}(e,i),"buffer"===e.recordingMode&&t&&e.eventBuffer&&!t.dirty){const n=e.eventBuffer.getEarliestTimestamp();n&&(Pk&&Dk.log(`Updating session start time to earliest event in buffer to ${new Date(n)}`),t.started=n,e.getOptions().stickySession&&qk(t))}return t?.previousSessionId||"session"===e.recordingMode&&e.flush(),!0})}}async function MT({recordingData:e,replayId:t,segmentId:n,eventContext:r,timestamp:i,session:a}){const s=function({recordingData:e,headers:t}){let n;const r=`${JSON.stringify(t)}\n`;if("string"==typeof e)n=`${r}${e}`;else{const t=(new TextEncoder).encode(r);n=new Uint8Array(t.length+e.length),n.set(t),n.set(e,t.length)}return n}({recordingData:e,headers:{segment_id:n}}),{urls:o,errorIds:l,traceIds:c,initialTimestamp:u}=r,h=bm(),d=_m(),p=h?.getTransport(),f=h?.getDsn();if(!(h&&p&&f&&a.sampled))return Promise.resolve({});const m={type:"replay_event",replay_start_timestamp:u/1e3,timestamp:i/1e3,error_ids:l,trace_ids:c,urls:o,replay_id:t,segment_id:n,replay_type:a.sampled},g=await async function({client:e,scope:t,replayId:n,event:r}){const i={event_id:n,integrations:"object"!=typeof e._integrations||null===e._integrations||Array.isArray(e._integrations)?void 0:Object.keys(e._integrations)};e.emit("preprocessEvent",r,i);const a=await by(e.getOptions(),r,i,t,e,vm());if(!a)return null;e.emit("postprocessEvent",a,i),a.platform=a.platform||"javascript";const s=e.getSdkMetadata(),{name:o,version:l,settings:c}=s?.sdk||{};return a.sdk={...a.sdk,name:o||"sentry.javascript.unknown",version:l||"0.0.0",settings:c},a}({scope:d,client:h,replayId:t,event:m});if(!g)return h.recordDroppedEvent("event_processor","replay"),Pk&&Dk.log("An event processor returned `null`, will not send event."),Promise.resolve({});delete g.sdkProcessingMetadata;const y=function(e,t,n,r){return Lg(Gg(e,$g(e),r,n),[[{type:"replay_event"},e],[{type:"replay_recording",length:"string"==typeof t?(new TextEncoder).encode(t).length:t.length},t]])}(g,s,f,h.getOptions().tunnel);let _;try{_=await p.send(y)}catch(fP){const t=new Error(Vb);try{t.cause=fP}catch{}throw t}const v=qy({},_);if(Uy(v,"replay"))throw new zT(v);if("number"==typeof _.statusCode&&(_.statusCode<200||_.statusCode>=300))throw new AT(_.statusCode);return _}class AT extends Error{constructor(e){super(`Transport returned status code ${e}`)}}class zT extends Error{constructor(e){super("Rate limit hit"),this.rateLimits=e}}class DT extends Error{constructor(){super("Session is too long, not sending replay")}}async function RT(e,t={count:0,interval:5e3}){const{recordingData:n,onError:r}=e;if(n.length)try{return await MT(e),!0}catch(fP){if(fP instanceof AT||fP instanceof zT)throw fP;if(Cy("Replays",{_retryCount:t.count}),r&&r(fP),t.count>=3){const e=new Error(`${Vb} - max retries exceeded`);try{e.cause=fP}catch{}throw e}return t.interval*=++t.count,new Promise((n,r)=>{Kx(async()=>{try{await RT(e,t),n(!0)}catch(i){r(i)}},t.interval)})}}const LT="__THROTTLED";function NT(e,t,n){const r=new Map;let i=!1;return(...a)=>{const s=Math.floor(Date.now()/1e3);if((e=>{const t=e-n;r.forEach((e,n)=>{n<t&&r.delete(n)})})(s),[...r.values()].reduce((e,t)=>e+t,0)>=t){const e=i;return i=!0,e?"__SKIPPED":LT}i=!1;const o=r.get(s)||0;return r.set(s,o+1),e(...a)}}class jT{constructor({options:e,recordingOptions:t}){this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._requiresManualStart=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=t,this._options=e,this._debouncedFlush=ET(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=NT((e,t)=>function(e,t,n){return Qk(e,t)?Kk(e,t,n):Promise.resolve(null)}(this,e,t),300,5);const{slowClickTimeout:n,slowClickIgnoreSelectors:r}=this.getOptions(),i=n?{threshold:Math.min(3e3,n),timeout:n,scrollTimeout:300,ignoreSelector:r?r.join(","):""}:void 0;if(i&&(this.clickDetector=new ck(this,i)),Pk){const t=e._experiments;Dk.setConfig({captureExceptions:!!t.captureExceptions,traceInternals:!!t.traceInternals})}this._handleVisibilityChange=()=>{"visible"===Ob.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()},this._handleWindowBlur=()=>{const e=pk({category:"ui.blur"});this._doChangeToBackgroundTasks(e)},this._handleWindowFocus=()=>{const e=pk({category:"ui.focus"});this._doChangeToForegroundTasks(e)},this._handleKeyboardEvent=e=>{vk(this,e)}}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return Boolean(this._canvas)}getOptions(){return this._options}handleException(e){Pk&&Dk.exception(e),this._options.onError&&this._options.onError(e)}initializeSampling(e){const{errorSampleRate:t,sessionSampleRate:n}=this._options,r=t<=0&&n<=0;this._requiresManualStart=r,r||(this._initializeSessionForSampling(e),this.session?!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",Pk&&Dk.infoTick(`Starting replay in ${this.recordingMode} mode`),this._initializeRecording()):Pk&&Dk.exception(new Error("Unable to initialize and create session")))}start(){if(this._isEnabled&&"session"===this.recordingMode)return void(Pk&&Dk.log("Recording is already in progress"));if(this._isEnabled&&"buffer"===this.recordingMode)return void(Pk&&Dk.log("Buffering is in progress, call `flush()` to save the replay"));Pk&&Dk.infoTick("Starting replay in session mode"),this._updateUserActivity();const e=Xk({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=e,this.recordingMode="session",this._initializeRecording()}startBuffering(){if(this._isEnabled)return void(Pk&&Dk.log("Buffering is in progress, call `flush()` to save the replay"));Pk&&Dk.infoTick("Starting replay in buffer mode");const e=Xk({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=e,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{const e=this._canvas;this._stopRecording=KS({...this._recordingOptions,..."buffer"===this.recordingMode?{checkoutEveryNms:6e4}:this._options._experiments.continuousCheckout&&{checkoutEveryNms:Math.max(36e4,this._options._experiments.continuousCheckout)},emit:PT(this),.../iPhone|iPad|iPod/i.test(IT?.userAgent??"")||/Macintosh/i.test(IT?.userAgent??"")&&IT?.maxTouchPoints&&IT?.maxTouchPoints>1?{sampling:{mousemove:!1}}:{},onMutation:this._onMutationHandler.bind(this),...e?{recordCanvas:e.recordCanvas,getCanvasManager:e.getCanvasManager,sampling:e.sampling,dataURLOptions:e.dataURLOptions}:{}})}catch(fP){this.handleException(fP)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(fP){return this.handleException(fP),!1}}async stop({forceFlush:e=!1,reason:t}={}){if(this._isEnabled){this._isEnabled=!1,this.recordingMode="buffer";try{Pk&&Dk.log("Stopping Replay"+(t?` triggered by ${t}`:"")),sT(),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),e&&await this._flush({force:!0}),this.eventBuffer?.destroy(),this.eventBuffer=null,Vk(this)}catch(fP){this.handleException(fP)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),Pk&&Dk.log("Pausing replay"))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),Pk&&Dk.log("Resuming replay"))}async sendBufferedReplayOrFlush({continueRecording:e=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();const t=Date.now();Pk&&Dk.log("Converting buffer to session"),await this.flushImmediate();const n=this.stopRecording();e&&n&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this.session.dirty=!1,this._updateUserActivity(t),this._updateSessionActivity(t),this._maybeSaveSession()),this.startRecording())}addUpdate(e){const t=e();"buffer"!==this.recordingMode&&this._isEnabled&&!0!==t&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),this._stopRecording)this.checkAndHandleExpiredSession(),this._updateSessionActivity();else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(e){if(!e||!1!==this.session?.sampled)return this.session?.id}checkAndHandleExpiredSession(){if(!(this._lastActivity&&Hk(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled))return!!this._checkSession();this.pause()}setInitialState(){const e=`${Ob.location.pathname}${Ob.location.hash}${Ob.location.search}`,t=`${Ob.location.origin}${e}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=t,this._context.initialTimestamp=Date.now(),this._context.urls.push(t)}throttledAddEvent(e,t){const n=this._throttledAddEvent(e,t);if(n===LT){const e=pk({category:"replay.throttled"});this.addUpdate(()=>!Yk(this,{type:5,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e,metric:!0}}))}return n}getCurrentRoute(){const e=this.lastActiveSpan||yg(),t=e&&gg(e),n=(t&&cg(t).data||{})[Sm];if(t&&n&&["route","custom"].includes(n))return cg(t).description}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=Ok({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_initializeSessionForSampling(e){const t=this._options.errorSampleRate>0,n=Xk({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=n}_checkSession(){if(!this.session)return!1;const e=this.session;return!Wk(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(e),!1)}async _refreshSession(e){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(e.id))}_addListeners(){try{Ob.document.addEventListener("visibilitychange",this._handleVisibilityChange),Ob.addEventListener("blur",this._handleWindowBlur),Ob.addEventListener("focus",this._handleWindowFocus),Ob.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(TT(this),this._hasInitializedCoreListeners=!0)}catch(fP){this.handleException(fP)}this._performanceCleanupCallback=function(e){function t(t){e.performanceEntries.includes(t)||e.performanceEntries.push(t)}function n({entries:e}){e.forEach(t)}const r=[];return["navigation","paint","resource"].forEach(e=>{r.push(hx(e,n))}),r.push(cx(bk(kk,e)),lx(bk(Ck,e)),ux(bk(Ek,e))),()=>{r.forEach(e=>e())}}(this)}_removeListeners(){try{Ob.document.removeEventListener("visibilitychange",this._handleVisibilityChange),Ob.removeEventListener("blur",this._handleWindowBlur),Ob.removeEventListener("focus",this._handleWindowFocus),Ob.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(fP){this.handleException(fP)}}_doChangeToBackgroundTasks(e){if(!this.session)return;Zk(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(e&&this._createCustomBreadcrumb(e),this.conditionalFlush())}_doChangeToForegroundTasks(e){if(!this.session)return;this.checkAndHandleExpiredSession()?e&&this._createCustomBreadcrumb(e):Pk&&Dk.log("Document has become active, but session has expired")}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){this.session&&(this.session.lastActivity=e,this._maybeSaveSession())}_createCustomBreadcrumb(e){this.addUpdate(()=>{this.throttledAddEvent({type:oS.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})})}_addPerformanceEntries(){let e=(t=this.performanceEntries,t.map(wk).filter(Boolean)).concat(this.replayPerformanceEntries);var t;if(this.performanceEntries=[],this.replayPerformanceEntries=[],this._requiresManualStart){const t=this._context.initialTimestamp/1e3;e=e.filter(e=>e.start>=t)}return Promise.all(lT(this,e))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:e,eventBuffer:t}=this;if(!e||!t||this._requiresManualStart)return;if(e.segmentId)return;const n=t.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){const e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),e}async _runFlush(){const e=this.getSessionId();if(this.session&&this.eventBuffer&&e){if(await this._addPerformanceEntries(),this.eventBuffer?.hasEvents&&(await async function(e){try{return Promise.all(lT(e,[CT(Ob.performance.memory)]))}catch{return[]}}(this),this.eventBuffer&&e===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();const t=Date.now();if(t-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new DT;const n=this._popEventContext(),r=this.session.segmentId++;this._maybeSaveSession();const i=await this.eventBuffer.finish();await RT({replayId:e,recordingData:i,segmentId:r,eventContext:n,session:this.session,timestamp:t,onError:e=>this.handleException(e)})}catch(fP){this.handleException(fP),this.stop({reason:"sendReplay"});const t=bm();if(t){let n;n=fP instanceof zT?"ratelimit_backoff":fP instanceof DT?"invalid":"send_error",t.recordDroppedEvent(n,"replay")}}}else Pk&&Dk.error("No session or eventBuffer found to flush.")}async _flush({force:e=!1}={}){if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession())return void(Pk&&Dk.error("Attempting to finish replay event after session expired."));if(!this.session)return;const t=this.session.started,n=Date.now()-t;this._debouncedFlush.cancel();const r=n<this._options.minReplayDuration,i=n>this._options.maxReplayDuration+5e3;if(r||i)return Pk&&Dk.log(`Session duration (${Math.floor(n/1e3)}s) is too ${r?"short":"long"}, not sending replay.`),void(r&&this._debouncedFlush());const a=this.eventBuffer;a&&0===this.session.segmentId&&!a.hasCheckout&&Pk&&Dk.log("Flushing initial segment without checkout.");const s=!!this._flushLock;this._flushLock||(this._flushLock=this._runFlush());try{await this._flushLock}catch(fP){this.handleException(fP)}finally{this._flushLock=void 0,s&&this._debouncedFlush()}}_maybeSaveSession(){this.session&&this._options.stickySession&&qk(this.session)}_onMutationHandler(e){const{ignoreMutations:t}=this._options._experiments;if(t?.length&&e.some(e=>{const n=function(e){if(!e)return null;try{return e.nodeType===e.ELEMENT_NODE?e:e.parentElement}catch{return null}}(e.target),r=t.join(",");return n?.matches(r)}))return!1;const n=e.length,r=this._options.mutationLimit,i=r&&n>r;if(n>this._options.mutationBreadcrumbLimit||i){const e=pk({category:"replay.mutations",data:{count:n,limit:i}});this._createCustomBreadcrumb(e)}return!i||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}function FT(e,t){return[...e,...t].join(",")}const OT='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',BT=["content-length","content-type","accept"],VT=Symbol.for("sentry__originalRequestBody");let UT=!1,qT=!1;const $T=e=>new GT(e);class GT{constructor({flushMinDelay:e=5e3,flushMaxDelay:t=5500,minReplayDuration:n=4999,maxReplayDuration:r=36e5,stickySession:i=!0,useCompression:a=!0,workerUrl:s,_experiments:o={},maskAllText:l=!0,maskAllInputs:c=!0,blockAllMedia:u=!0,mutationBreadcrumbLimit:h=750,mutationLimit:d=1e4,slowClickTimeout:p=7e3,slowClickIgnoreSelectors:f=[],networkDetailAllowUrls:m=[],networkDetailDenyUrls:g=[],networkCaptureBodies:y=!0,networkRequestHeaders:_=[],networkResponseHeaders:v=[],mask:x=[],maskAttributes:b=["title","placeholder","aria-label"],unmask:w=[],block:S=[],unblock:k=[],ignore:T=[],maskFn:C,beforeAddRecordingEvent:E,beforeErrorSampling:I,onError:P,attachRawBodyFromRequest:M=!1}={}){this.name="Replay";const A=function({mask:e,unmask:t,block:n,unblock:r,ignore:i}){return{maskTextSelector:FT(e,[".sentry-mask","[data-sentry-mask]"]),unmaskTextSelector:FT(t,[]),blockSelector:FT(n,[".sentry-block","[data-sentry-block]","base","iframe[srcdoc]:not([src])"]),unblockSelector:FT(r,[]),ignoreSelector:FT(i,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'])}}({mask:x,unmask:w,block:S,unblock:k,ignore:T});if(this._recordingOptions={maskAllInputs:c,maskAllText:l,maskInputOptions:{password:!0},maskTextFn:C,maskInputFn:C,maskAttributeFn:(e,t,n)=>function({el:e,key:t,maskAttributes:n,maskAllText:r,privacyOptions:i,value:a}){return r?i.unmaskTextSelector&&e.matches(i.unmaskTextSelector)?a:n.includes(t)||"value"===t&&"INPUT"===e.tagName&&["submit","button"].includes(e.getAttribute("type")||"")?a.replace(/[\S]/g,"*"):a:a}({maskAttributes:b,maskAllText:l,privacyOptions:A,key:e,value:t,el:n}),...A,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:e=>{try{e.__rrweb__=!0}catch{}},recordCrossOriginIframes:Boolean(o.recordCrossOriginIframes)},this._initialOptions={flushMinDelay:e,flushMaxDelay:t,minReplayDuration:Math.min(n,5e4),maxReplayDuration:Math.min(r,Gb),stickySession:i,useCompression:a,workerUrl:s,blockAllMedia:u,maskAllInputs:c,maskAllText:l,mutationBreadcrumbLimit:h,mutationLimit:d,slowClickTimeout:p,slowClickIgnoreSelectors:f,networkDetailAllowUrls:m,networkDetailDenyUrls:g,networkCaptureBodies:y,networkRequestHeaders:HT(_),networkResponseHeaders:HT(v),beforeAddRecordingEvent:E,beforeErrorSampling:I,onError:P,attachRawBodyFromRequest:M,_experiments:o},this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${OT}`:OT,this._recordingOptions.ignoreCSSAttributes=new Set(["background-image"])),this._isInitialized&&nv())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return UT}set _isInitialized(e){UT=e}afterAllSetup(e){nv()&&!this._replay&&(this._initialOptions.attachRawBodyFromRequest&&function(){if("undefined"==typeof Request||qT)return;const e=Request;try{const t=function(t,n){const r=new e(t,n);return null!=n?.body&&(r[VT]=n.body),r};t.prototype=e.prototype,zp.Request=t,qT=!0}catch{}}(),this._setup(e),this._initialize(e))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(e){return this._replay?this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(e):(this._replay.start(),Promise.resolve()):Promise.resolve()}getReplayId(e){if(this._replay?.isEnabled())return this._replay.getSessionId(e)}getRecordingMode(){if(this._replay?.isEnabled())return this._replay.recordingMode}_initialize(e){this._replay&&(this._maybeLoadFromReplayCanvasIntegration(e),this._replay.initializeSampling())}_setup(e){const t=function(e,t){const n=t.getOptions(),r={sessionSampleRate:0,errorSampleRate:0,...e},i=Qm(n.replaysSessionSampleRate),a=Qm(n.replaysOnErrorSampleRate);null==i&&null==a&&Op(()=>{});null!=i&&(r.sessionSampleRate=i);null!=a&&(r.errorSampleRate=a);return r}(this._initialOptions,e);this._replay=new jT({options:t,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(e){try{const t=e.getIntegrationByName("ReplayCanvas");if(!t)return;this._replay._canvas=t.getOptions()}catch{}}}function HT(e){return[...BT,...e.map(e=>e.toLowerCase())]}function ZT(e){try{return new URL(e,rv.location.origin).href}catch{return}}function WT(e){try{return new Headers(e)}catch{return}}const XT=new WeakMap,YT=new Map,KT={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function QT(e,t){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:a,enableHTTPTimings:s,tracePropagationTargets:o,onRequestSpanStart:l,onRequestSpanEnd:c}={...KT,...t},u="function"==typeof a?a:e=>!0,h=e=>function(e,t){const n=If();if(n){let r,i;try{r=new URL(e,n),i=new URL(n).origin}catch{return!1}const a=r.origin===i;return t?Gf(r.toString(),t)||a&&Gf(r.pathname,t):a}{const n=!!e.match(/^\/(?!\/)/);return t?Gf(e,t):n}}(e,o),d={},p=e.getOptions().propagateTraceparent;n&&(e.addEventProcessor(e=>("transaction"===e.type&&e.spans&&e.spans.forEach(e=>{if("http.client"===e.op){const t=YT.get(e.span_id);t&&(e.timestamp=t/1e3,YT.delete(e.span_id))}}),e)),i&&function(e){const t="fetch-body-resolved";tf(t,e),nf(t,()=>Y_(K_))}(e=>{if(e.response){const t=XT.get(e.response);t&&e.endTimestamp&&YT.set(t,e.endTimestamp)}}),X_(e=>{const t=U_(e,u,h,d,{propagateTraceparent:p,onRequestSpanEnd:c});if(e.response&&e.fetchData.__span&&XT.set(e.response,e.fetchData.__span),t){const n=ZT(e.fetchData.url),r=n?p_(n).host:void 0;t.setAttributes({"http.url":n?f_(n):void 0,"server.address":r}),s&&JT(t),l?.(t,{headers:e.headers})}})),r&&Jx(e=>{const t=function(e,t,n,r,i,a){const s=e.xhr,o=s?.[Qx];if(!s||s.__sentry_own_request__||!o)return;const{url:l,method:c}=o,u=xg()&&t(l);if(e.endTimestamp&&u){const t=s.__sentry_xhr_span_id__;if(!t)return;const n=r[t];return void(n&&void 0!==o.status_code&&(Lm(n,o.status_code),n.end(),a?.(n,{headers:WT(ab(s)),error:e.error}),delete r[t]))}const h=ZT(l),d=p_(h||l),p=f_((g=l,g.split(/[?#]/,1)[0])),f=!!yg(),m=u&&f?Jg({name:`${c} ${p}`,attributes:{url:f_(l),type:"xhr","http.method":c,"http.url":h?f_(h):void 0,"server.address":d?.host,[Em]:"auto.http.browser",[Cm]:"http.client",...d?.search&&{"http.query":d?.search},...d?.hash&&{"http.fragment":d?.hash}}}):new Ag;var g;s.__sentry_xhr_span_id__=m.spanContext().spanId,r[s.__sentry_xhr_span_id__]=m,n(l)&&function(e,t,n){const{"sentry-trace":r,baggage:i,traceparent:a}=v_({span:t,propagateTraceparent:n});r&&function(e,t,n,r){const i=e.__sentry_xhr_v3__?.request_headers;if(i?.["sentry-trace"]||!e.setRequestHeader)return;try{if(e.setRequestHeader("sentry-trace",t),r&&!i?.traceparent&&e.setRequestHeader("traceparent",r),n){const t=i?.baggage;t&&t.split(",").some(e=>e.trim().startsWith("sentry-"))||e.setRequestHeader("baggage",n)}}catch{}}(e,r,i,a)}(s,xg()&&f?m:void 0,i);const y=bm();y&&y.emit("beforeOutgoingRequestSpan",m,e);return m}(e,u,h,d,p,c);t&&(s&&JT(t),l?.(t,{headers:WT(e.xhr.__sentry_xhr_v3__?.request_headers)}))})}function JT(e){const{url:t}=cg(e).data;if(!t||"string"!=typeof t)return;const n=hx("resource",({entries:r})=>{r.forEach(r=>{(function(e){return"resource"===e.entryType&&"initiatorType"in e&&"string"==typeof e.nextHopProtocol&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)})(r)&&r.name.endsWith(t)&&(e.setAttributes(Mx(r)),setTimeout(n))})})}const eC="sentry_previous_trace",tC="sentry.previous_trace";function nC(e,{linkPreviousTrace:t,consistentTraceSampling:n}){const r="session-storage"===t;let i=r?function(){try{const e=rv.sessionStorage?.getItem(eC);return JSON.parse(e)}catch{return}}():void 0;e.on("spanStart",e=>{if(gg(e)!==e)return;const t=_m().getPropagationContext();i=function(e,t,n){const r=cg(t);function i(){try{return Number(n.dsc?.sample_rate)??Number(r.data?.[km])}catch{return 0}}const a={spanContext:t.spanContext(),startTimestamp:r.start_timestamp,sampleRate:i(),sampleRand:n.sampleRand};if(!e)return a;const s=e.spanContext;if(s.traceId===r.trace_id)return e;Date.now()/1e3-e.startTimestamp<=3600&&(fb&&qp.log(`Adding previous_trace \`${JSON.stringify(s)}\` link to span \`${JSON.stringify({op:r.op,...t.spanContext()})}\``),t.addLink({context:s,attributes:{[Rm]:"previous_trace"}}),t.setAttribute(tC,`${s.traceId}-${s.spanId}-${rC(s)?1:0}`));return a}(i,e,t),r&&function(e){try{rv.sessionStorage.setItem(eC,JSON.stringify(e))}catch(WI){fb&&qp.warn("Could not store previous trace in sessionStorage",WI)}}(i)});let a=!0;n&&e.on("beforeSampling",e=>{if(!i)return;const t=_m(),n=t.getPropagationContext();a&&n.parentSpanId?a=!1:(t.setPropagationContext({...n,dsc:{...n.dsc,sample_rate:String(i.sampleRate),sampled:String(rC(i.spanContext))},sampleRand:i.sampleRand}),e.parentSampled=rC(i.spanContext),e.parentSampleRate=i.sampleRate,e.spanAttributes={...e.spanAttributes,[Tm]:i.sampleRate})})}function rC(e){return 1===e.traceFlags}const iC={...sy,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,enableElementTiming:!0,ignoreResourceSpans:[],ignorePerformanceApiSpans:[],detectRedirects:!0,linkPreviousTrace:"in-memory",consistentTraceSampling:!1,enableReportPageLoaded:!1,_experiments:{},...KT},aC=(e={})=>{const t={name:void 0,source:void 0},n=rv.document,{enableInp:r,enableElementTiming:i,enableLongTask:a,enableLongAnimationFrame:s,_experiments:{enableInteractions:o,enableStandaloneClsSpans:l,enableStandaloneLcpSpans:c},beforeStartSpan:u,idleTimeout:h,finalTimeout:d,childSpanTimeout:p,markBackgroundSpan:f,traceFetch:m,traceXHR:g,trackFetchStreamPerformance:y,shouldCreateSpanForRequest:_,enableHTTPTimings:v,ignoreResourceSpans:x,ignorePerformanceApiSpans:b,instrumentPageLoad:w,instrumentNavigation:S,detectRedirects:k,linkPreviousTrace:T,consistentTraceSampling:C,enableReportPageLoaded:E,onRequestSpanStart:I,onRequestSpanEnd:P}={...iC,...e};let M,A,z;function D(e,r,i=!0){const a="pageload"===r.op,s=r.name,o=u?u(r):r,f=o.attributes||{};if(s!==o.name&&(f[Sm]="custom",o.attributes=f),!i){const e=Qf();return void Jg({...o,startTime:e}).end(e)}t.name=o.name,t.source=f[Sm];const m=oy(o,{idleTimeout:h,finalTimeout:d,childSpanTimeout:p,disableAutoFinish:a,beforeSpanEnd:t=>{M?.(),jx(t,{recordClsOnPageloadSpan:!l,recordLcpOnPageloadSpan:!c,ignoreResourceSpans:x,ignorePerformanceApiSpans:b}),cC(e,void 0);const n=_m(),r=n.getPropagationContext();n.setPropagationContext({...r,traceId:m.spanContext().traceId,sampled:ug(m),dsc:Mg(t)}),a&&(z=void 0)},trimIdleSpanEndTimestamp:!E});function g(){n&&["interactive","complete"].includes(n.readyState)&&e.emit("idleSpanEnableAutoFinish",m)}a&&E&&(z=m),cC(e,m),a&&!E&&n&&(n.addEventListener("readystatechange",()=>{g()}),g())}return{name:"BrowserTracing",setup(e){if(function(){function e(){const e=yg(),t=e&&gg(e);if(t){const e="internal_error";Ap&&qp.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}vg||(e.tag="sentry_tracingErrorCallback",vg=!0,sf(e),cf(e))}(),M=Nx({recordClsStandaloneSpans:l||!1,recordLcpStandaloneSpans:c||!1,client:e}),r&&cb(),i&&Sx()&&nm()&&hx("element",Ox),s&&zp.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?new PerformanceObserver(e=>{const t=yg();if(t)for(const n of e.getEntries()){if(!n.scripts[0])continue;const e=kx(nm()+n.startTime),{start_timestamp:r,op:i}=cg(t);if("navigation"===i&&r&&e<r)continue;const a=kx(n.duration),s={[Em]:"auto.ui.browser.metrics"},o=n.scripts[0],{invoker:l,invokerType:c,sourceURL:u,sourceFunctionName:h,sourceCharPosition:d}=o;s["browser.script.invoker"]=l,s["browser.script.invoker_type"]=c,u&&(s["code.filepath"]=u),h&&(s["code.function"]=h),-1!==d&&(s["browser.script.source_char_position"]=d),bx(t,e,e+a,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:s})}}).observe({type:"long-animation-frame",buffered:!0}):a&&hx("longtask",({entries:e})=>{const t=yg();if(!t)return;const{op:n,start_timestamp:r}=cg(t);for(const i of e){const e=kx(nm()+i.startTime),a=kx(i.duration);"navigation"===n&&r&&e<r||bx(t,e,e+a,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[Em]:"auto.ui.browser.metrics"}})}}),o&&hx("event",({entries:e})=>{const t=yg();if(t)for(const n of e)if("click"===n.name){const e=kx(nm()+n.startTime),r=kx(n.duration),i={name:Cf(n.target),op:`ui.interaction.${n.name}`,startTime:e,attributes:{[Em]:"auto.ui.browser.metrics"}},a=Pf(n.target);a&&(i.attributes["ui.component_name"]=a),bx(t,e,e+r,i)}}),k&&n){const e=()=>{A=em()};addEventListener("click",e,{capture:!0}),addEventListener("keydown",e,{capture:!0,passive:!0})}function t(){const t=lC(e);t&&!cg(t).timestamp&&(fb&&qp.log(`[Tracing] Finishing current active span with op: ${cg(t).op}`),t.setAttribute(Im,"cancelled"),t.end())}e.on("startNavigationSpan",(n,r)=>{if(bm()!==e)return;if(r?.isRedirect)return fb&&qp.warn("[Tracing] Detected redirect, navigation span will not be the root span, but a child span."),void D(e,{op:"navigation.redirect",...n},!1);A=void 0,t(),vm().setPropagationContext({traceId:sm(),sampleRand:Math.random(),propagationSpanId:xg()?void 0:om()});const i=_m();i.setPropagationContext({traceId:sm(),sampleRand:Math.random(),propagationSpanId:xg()?void 0:om()}),i.setSDKProcessingMetadata({normalizedRequest:void 0}),D(e,{op:"navigation",...n,parentSpan:null,forceTransaction:!0})}),e.on("startPageLoadSpan",(n,r={})=>{if(bm()!==e)return;t();const i=eg(r.sentryTrace||sC("sentry-trace"),r.baggage||sC("baggage")),a=_m();a.setPropagationContext(i),xg()||(a.getPropagationContext().propagationSpanId=om()),a.setSDKProcessingMetadata({normalizedRequest:ov()}),D(e,{op:"pageload",...n})}),e.on("endPageloadSpan",()=>{E&&z&&(z.setAttribute(Im,"reportPageLoaded"),z.end())})},afterAllSetup(e){let n=If();if("off"!==T&&nC(e,{linkPreviousTrace:T,consistentTraceSampling:C}),rv.location){if(w){const t=nm();!function(e,t,n){e.emit("startPageLoadSpan",t,n),_m().setTransactionName(t.name);const r=lC(e);r&&e.emit("afterStartPageLoadSpan",r)}(e,{name:rv.location.pathname,startTime:t?t/1e3:void 0,attributes:{[Sm]:"url",[Em]:"auto.pageload.browser"}})}S&&Zx(({to:t,from:r})=>{if(void 0===r&&-1!==n?.indexOf(t))return void(n=void 0);n=void 0;const i=d_(t),a=lC(e),s=a&&k&&function(e,t){const n=cg(e),r=Qf(),i=n.start_timestamp;if(r-i>uC)return!1;if(t&&r-t<=uC)return!1;return!0}(a,A);!function(e,t,n){const{url:r,isRedirect:i}=n||{};e.emit("beforeStartNavigationSpan",t,{isRedirect:i}),e.emit("startNavigationSpan",t,{isRedirect:i});const a=_m();a.setTransactionName(t.name),r&&!i&&a.setSDKProcessingMetadata({normalizedRequest:{...ov(),url:r}});lC(e)}(e,{name:i?.pathname||rv.location.pathname,attributes:{[Sm]:"url",[Em]:"auto.navigation.browser"}},{url:t,isRedirect:s})})}f&&(rv.document?rv.document.addEventListener("visibilitychange",()=>{const e=yg();if(!e)return;const t=gg(e);if(rv.document.hidden&&t){const e="cancelled",{op:n,status:r}=cg(t);fb&&qp.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${n}`),r||t.setStatus({code:2,message:e}),t.setAttribute("sentry.cancellation_reason","document.hidden"),t.end()}}):fb&&qp.warn("[Tracing] Could not set up background tab detection due to lack of global document")),o&&function(e,t,n,r,i){const a=rv.document;let s;const o=()=>{const a="ui.action.click",o=lC(e);if(o){const e=cg(o).op;if(["navigation","pageload"].includes(e))return void(fb&&qp.warn(`[Tracing] Did not create ${a} span because a pageload or navigation span is in progress.`))}s&&(s.setAttribute(Im,"interactionInterrupted"),s.end(),s=void 0),i.name?s=oy({name:i.name,op:a,attributes:{[Sm]:i.source||"url"}},{idleTimeout:t,finalTimeout:n,childSpanTimeout:r}):fb&&qp.warn(`[Tracing] Did not create ${a} transaction because _latestRouteName is missing.`)};a&&addEventListener("click",o,{capture:!0})}(e,h,d,p,t),r&&db(),QT(e,{traceFetch:m,traceXHR:g,trackFetchStreamPerformance:y,tracePropagationTargets:e.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:_,enableHTTPTimings:v,onRequestSpanStart:I,onRequestSpanEnd:P})}}};function sC(e){const t=rv.document,n=t?.querySelector(`meta[name=${e}]`);return n?.getAttribute("content")||void 0}const oC="_sentry_idleSpan";function lC(e){return e[oC]}function cC(e,t){Af(e,oC,t)}const uC=1.5;class hC extends s.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleReset=()=>{this.setState({hasError:!1,error:null}),window.location.href="/"}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){ky(e,{extra:t})}render(){return this.state.hasError?n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:n.jsxs("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-8 text-center",children:[n.jsx("div",{className:"mb-6",children:n.jsx("svg",{className:"mx-auto h-16 w-16 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),n.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Oops! Something went wrong"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Please try refreshing the page or go back to the home page."}),!1,n.jsxs("div",{className:"flex gap-4 justify-center",children:[n.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Refresh Page"}),n.jsx("button",{onClick:this.handleReset,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go to Home"})]})]})}):this.props.children}}var dC={},pC={},fC={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;"undefined"!=typeof window&&(void 0===window.gtag&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(r=window).gtag.apply(r,t))};e.default=t}(fC);var mC={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e||"";r&&(a=e.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(e,n,r){return n>0&&n+e.length!==r.length&&e.search(t)>-1&&":"!==r.charAt(n-2)&&("-"!==r.charAt(n+e.length)||"-"===r.charAt(n-1))&&r.charAt(n-1).search(/[^\s-]/)<0?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)}));i&&(a=function(e){if(function(e){return"string"==typeof e&&-1!==e.indexOf("@")}(e))return n;return e}(a));return a};var t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;var n="REDACTED (Potential Email Address)"}(mC),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.GA4=void 0;var t=s(fC),n=s(mC),r=["eventCategory","eventAction","eventLabel","eventValue","hitType"],i=["title","location"],a=["page","hitType"];function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){g(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(fP){c=!0,i=fP}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}var _=function(){function e(){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"reset",function(){s.isInitialized=!1,s._testMode=!1,s._currentMeasurementId,s._hasLoadedGA=!1,s._isQueuing=!1,s._queueGtag=[]}),g(this,"_gtag",function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];s._testMode||s._isQueuing?s._queueGtag.push(n):t.default.apply(void 0,n)}),g(this,"_loadGA",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://www.googletagmanager.com/gtag/js";if("undefined"!=typeof window&&"undefined"!=typeof document&&!s._hasLoadedGA){var r=document.createElement("script");r.async=!0,r.src="".concat(n,"?id=").concat(e),t&&r.setAttribute("nonce",t),document.body.appendChild(r),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},s._hasLoadedGA=!0}}),g(this,"_toGtagOptions",function(e){if(e){var t={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"};return Object.entries(e).reduce(function(e,n){var r=d(n,2),i=r[0],a=r[1];return t[i]?e[t[i]]=a:e[i]=a,e},{})}}),g(this,"initialize",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Require GA_MEASUREMENT_ID");var n="string"==typeof e?[{trackingId:e}]:e;s._currentMeasurementId=n[0].trackingId;var r=t.gaOptions,i=t.gtagOptions,a=t.nonce,o=t.testMode,l=void 0!==o&&o,u=t.gtagUrl;if(s._testMode=l,l||s._loadGA(s._currentMeasurementId,a,u),s.isInitialized||(s._gtag("js",new Date),n.forEach(function(e){var t=h(h(h({},s._toGtagOptions(h(h({},r),e.gaOptions))),i),e.gtagOptions);Object.keys(t).length?s._gtag("config",e.trackingId,t):s._gtag("config",e.trackingId)})),s.isInitialized=!0,!l){var d=c(s._queueGtag);for(s._queueGtag=[],s._isQueuing=!1;d.length;){var p=d.shift();s._gtag.apply(s,c(p)),"get"===p[0]&&(s._isQueuing=!0)}}}),g(this,"set",function(e){e&&"object"===l(e)&&(Object.keys(e).length,s._gaCommand("set",e))}),g(this,"_gaCommandSendEvent",function(e,t,n,r,i){s._gtag("event",t,h(h({event_category:e,event_label:n,value:r},i&&{non_interaction:i.nonInteraction}),s._toGtagOptions(i)))}),g(this,"_gaCommandSendEventParameters",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommandSendEvent.apply(s,c(t.slice(1)));else{var i=t[0],a=i.eventCategory,l=i.eventAction,u=i.eventLabel,h=i.eventValue;i.hitType;var d=o(i,r);s._gaCommandSendEvent(a,l,u,h,d)}}),g(this,"_gaCommandSendTiming",function(e,t,n,r){s._gtag("event","timing_complete",{name:t,value:n,event_category:e,event_label:r})}),g(this,"_gaCommandSendPageview",function(e,t){if(t&&Object.keys(t).length){var n=s._toGtagOptions(t),r=n.title,a=n.location,l=o(n,i);s._gtag("event","page_view",h(h(h(h({},e&&{page_path:e}),r&&{page_title:r}),a&&{page_location:a}),l))}else e?s._gtag("event","page_view",{page_path:e}):s._gtag("event","page_view")}),g(this,"_gaCommandSendPageviewParameters",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommandSendPageview.apply(s,c(t.slice(1)));else{var r=t[0],i=r.page;r.hitType;var l=o(r,a);s._gaCommandSendPageview(i,l)}}),g(this,"_gaCommandSend",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];switch("string"==typeof t[0]?t[0]:t[0].hitType){case"event":s._gaCommandSendEventParameters.apply(s,t);break;case"pageview":s._gaCommandSendPageviewParameters.apply(s,t);break;case"timing":s._gaCommandSendTiming.apply(s,c(t.slice(1)))}}),g(this,"_gaCommandSet",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"string"==typeof t[0]&&(t[0]=g({},t[0],t[1])),s._gtag("set",s._toGtagOptions(t[0]))}),g(this,"_gaCommand",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];switch(e){case"send":s._gaCommandSend.apply(s,n);break;case"set":s._gaCommandSet.apply(s,n)}}),g(this,"ga",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommand.apply(s,t);else{var r=t[0];s._gtag("get",s._currentMeasurementId,"client_id",function(e){s._isQueuing=!1;var t=s._queueGtag;for(r({get:function(t){return"clientId"===t?e:"trackingId"===t?s._currentMeasurementId:"apiVersion"===t?"1":void 0}});t.length;){var n=t.shift();s._gtag.apply(s,c(n))}}),s._isQueuing=!0}return s.ga}),g(this,"event",function(e,t){if("string"==typeof e)s._gtag("event",e,s._toGtagOptions(t));else{var r=e.action,i=e.category,a=e.label,o=e.value,l=e.nonInteraction,c=e.transport;if(!i||!r)return;var u={hitType:"event",eventCategory:(0,n.default)(i),eventAction:(0,n.default)(r)};a&&(u.eventLabel=(0,n.default)(a)),void 0!==o&&("number"!=typeof o||(u.eventValue=o)),void 0!==l&&("boolean"!=typeof l||(u.nonInteraction=l)),void 0!==c&&("string"!=typeof c||(["beacon","xhr","image"].indexOf(c),u.transport=c)),s._gaCommand("send",u)}}),g(this,"send",function(e){s._gaCommand("send",e)}),this.reset()}return m(e,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),e}();e.GA4=_;var v=new _;e.default=v}(pC),function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ReactGAImplementation=void 0;var n=function(e,n){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var i=r(n);if(i&&i.has(e))return i.get(e);var a={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=s?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,i&&i.set(e,a);return a}(pC);function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}var i=n.GA4;e.ReactGAImplementation=i;var a=n.default;e.default=a}(dC);const gC=l(dC),yC=()=>{const e=c();return s.useEffect(()=>{gC.send({hitType:"pageview",page:e.pathname+e.search})},[e]),null},_C=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},vC=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),xC=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var bC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=s.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:a,iconNode:o,...l},c)=>s.createElement("svg",{ref:c,...bC,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:vC("lucide",i),...!a&&!xC(l)&&{"aria-hidden":"true"},...l},[...o.map(([e,t])=>s.createElement(e,t)),...Array.isArray(a)?a:[a]])),SC=(e,t)=>{const n=s.forwardRef(({className:n,...r},i)=>{return s.createElement(wC,{ref:i,iconNode:t,className:vC(`lucide-${a=_C(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...r});var a});return n.displayName=_C(e),n},kC=SC("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),TC=SC("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),CC=SC("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),EC=SC("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),IC=SC("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),PC=SC("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),MC=SC("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),AC=SC("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),zC=SC("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),DC=SC("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),RC=SC("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),LC=SC("facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]),NC=SC("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),jC=SC("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),FC=SC("gavel",[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]]),OC=SC("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),BC=SC("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),VC=SC("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),UC=SC("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),qC=SC("instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),$C=SC("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),GC=SC("leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]),HC=SC("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ZC=SC("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),WC=SC("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),XC=SC("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),YC=SC("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),KC=SC("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),QC=SC("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),JC=SC("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),eE=SC("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),tE=SC("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),nE=SC("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),rE=SC("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),iE=SC("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),aE=SC("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),sE=SC("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),oE=SC("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),lE=SC("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),cE=SC("shopping-bag",[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]]),uE=SC("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),hE=SC("sliders-horizontal",[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]]),dE=SC("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),pE=SC("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),fE=SC("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),mE=SC("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),gE=SC("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),yE=SC("twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]),_E=SC("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),vE=SC("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),xE=SC("youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]),bE=[{label:"Home",href:"/",hasDropdown:!1},{label:"Shop",href:"/shop",hasDropdown:!1},{label:"Collections",href:"/collections",hasDropdown:!1},{label:"Pages",href:"#",hasDropdown:!0,dropdownItems:[{label:"About Us",href:"/about"},{label:"Contact Us",href:"/contact"},{label:"FAQ",href:"/faq"},{label:"Shipping",href:"/shipping"},{label:"Returns",href:"/returns"},{label:"Privacy Policy",href:"/privacy"},{label:"Terms of Service",href:"/terms"}]}],wE=()=>{const[e,t]=s.useState(!1),[r,i]=s.useState(!1);u();const{itemCount:a}=Cp();return s.useEffect(()=>{const e=()=>{i(window.scrollY>20)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),n.jsxs(n.Fragment,{children:[n.jsxs("header",{className:"fixed top-0 left-0 right-0 z-50 transition-all duration-300 "+(r?"bg-white shadow-md py-2":"bg-transparent py-4"),children:[n.jsx("div",{className:"hidden md:block transition-all duration-300 overflow-hidden "+(r?"h-0 opacity-0":"h-10 opacity-100"),children:n.jsxs("div",{className:"container mx-auto px-6 flex justify-between items-center text-sm text-gray-600 border-b border-gray-100/50 pb-2",children:[n.jsxs("div",{className:"flex gap-6",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(YC,{size:14,className:"text-primary"})," Ethiopia Cres, Cosmo City, Roodepoort"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(tE,{size:14,className:"text-primary"})," +(27) 479-7830"]})]}),n.jsx("div",{className:"font-medium text-primary",children:"FREE DELIVERY ON ALL ORDERS OVER R200"})]})}),n.jsx("div",{className:"container mx-auto px-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx(h,{to:"/",className:"flex items-center group",children:n.jsx("img",{src:"/images/logo.png",alt:"Hygiene Hub Skincare",className:"h-12 md:h-16 w-auto transition-transform group-hover:scale-105"})}),n.jsx("nav",{className:"hidden lg:flex items-center gap-10",children:bE.map(e=>n.jsxs("div",{className:"group relative",children:[n.jsxs(h,{to:e.href,className:"flex items-center gap-1 text-sm font-medium text-gray-800 hover:text-primary transition-colors py-4 uppercase tracking-wide",children:[e.label,e.hasDropdown&&n.jsx(IC,{size:14,className:"group-hover:rotate-180 transition-transform duration-300"})]}),e.hasDropdown&&e.dropdownItems&&n.jsx("div",{className:"absolute top-full left-0 w-48 bg-white shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 py-2 border-t-2 border-primary translate-y-2 group-hover:translate-y-0",children:e.dropdownItems.map(e=>n.jsx(h,{to:e.href,className:"block px-6 py-2.5 text-xs font-semibold uppercase tracking-wider text-gray-700 hover:bg-light-beige hover:text-primary transition-colors",children:e.label},e.label))}),n.jsx("span",{className:"absolute bottom-2 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"})]},e.label))}),n.jsxs("div",{className:"flex items-center gap-6 text-gray-800",children:[n.jsx("button",{className:"hover:text-primary transition-transform hover:scale-110",children:n.jsx(iE,{className:"w-5 h-5"})}),n.jsx(h,{to:"/account",className:"hover:text-primary transition-transform hover:scale-110 hidden sm:block",children:n.jsx(_E,{className:"w-5 h-5"})}),n.jsxs(h,{to:"/wishlist",className:"relative hover:text-primary transition-transform hover:scale-110 hidden sm:block",children:[n.jsx(BC,{className:"w-5 h-5"}),n.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-4 h-4 bg-primary text-white text-[10px] rounded-full flex items-center justify-center",children:"0"})]}),n.jsxs(h,{to:"/cart",className:"relative hover:text-primary transition-transform hover:scale-110",children:[n.jsx(cE,{className:"w-5 h-5"}),a>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-4 h-4 bg-secondary text-white text-[10px] rounded-full flex items-center justify-center animate-pulse",children:a>9?"9+":a})]}),n.jsx("button",{className:"lg:hidden",onClick:()=>t(!e),children:n.jsx(KC,{className:"w-6 h-6"})})]})]})})]}),e&&n.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 lg:hidden",onClick:()=>t(!1),children:n.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-[300px] bg-white shadow-2xl p-6 flex flex-col gap-6",onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[n.jsx("span",{className:"font-serif text-xl text-secondary font-bold",children:"Menu"}),n.jsx("button",{onClick:()=>t(!1),children:n.jsx(vE,{className:"w-6 h-6 text-gray-500 hover:text-red-500"})})]}),n.jsx("nav",{className:"flex flex-col gap-2",children:bE.map(e=>n.jsx("div",{children:e.hasDropdown?n.jsxs("div",{className:"space-y-2",children:[n.jsx("span",{className:"text-lg font-bold text-gray-900 border-b border-gray-100 block pb-2 uppercase tracking-tighter",children:e.label}),n.jsx("div",{className:"grid grid-cols-2 gap-2 pl-4",children:e.dropdownItems?.map(e=>n.jsx(h,{to:e.href,className:"text-sm text-gray-600 font-medium py-1 hover:text-primary transition-colors",onClick:()=>t(!1),children:e.label},e.label))})]}):n.jsx(h,{to:e.href,className:"text-lg font-medium text-gray-800 hover:text-primary border-b border-gray-50 pb-2 flex justify-between items-center",onClick:()=>t(!1),children:e.label})},e.label))})]})}),n.jsx("div",{className:r?"h-[80px]":"h-0"})]})},SE=()=>n.jsx("footer",{className:"bg-light-beige pt-20 pb-10 border-t border-green-100",children:n.jsxs("div",{className:"container mx-auto px-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx(h,{to:"/",className:"inline-block mb-6",children:n.jsx("img",{src:"/images/logo.png",alt:"Hygiene Hub Skincare",className:"h-16 w-auto"})}),n.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"Elevate your daily routine with our premium skincare collection. Designed for confidence and glow, backed by science and nature."}),n.jsxs("ul",{className:"space-y-4 text-gray-600 text-sm",children:[n.jsxs("li",{className:"flex items-start gap-3 group",children:[n.jsx(YC,{className:"w-5 h-5 text-primary mt-0.5 group-hover:text-secondary transition-colors"}),n.jsx("span",{children:"Ethiopia Cres,Cosmo City,Roodepoort,2188,South Africa"})]}),n.jsxs("li",{className:"flex items-start gap-3 group",children:[n.jsx(tE,{className:"w-5 h-5 text-primary mt-0.5 group-hover:text-secondary transition-colors"}),n.jsx("span",{children:"+(27) - 479 - 7830"})]}),n.jsxs("li",{className:"flex items-start gap-3 group",children:[n.jsx(XC,{className:"w-5 h-5 text-primary mt-0.5 group-hover:text-secondary transition-colors"}),n.jsx("span",{children:"hygienhub@gmail.com"})]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-lg font-serif font-semibold mb-6 text-gray-900 border-b border-gray-200 pb-2 inline-block",children:"Execute Glow"}),n.jsxs("ul",{className:"space-y-3 text-sm text-gray-600",children:[n.jsx("li",{children:n.jsx(h,{to:"/shop?category=skincare",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Skincare Solutions"})}),n.jsx("li",{children:n.jsx(h,{to:"/shop?category=complexion",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Complexion Perfection"})}),n.jsx("li",{children:n.jsx(h,{to:"/shop?category=eyes",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Eye Enhancements"})}),n.jsx("li",{children:n.jsx(h,{to:"/shop?category=lips",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Radiant Lips"})}),n.jsx("li",{children:n.jsx(h,{to:"/shop?category=sets",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Gift Sets"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-lg font-serif font-semibold mb-6 text-gray-900 border-b border-gray-200 pb-2 inline-block",children:"Customer Care"}),n.jsxs("ul",{className:"space-y-3 text-sm text-gray-600",children:[n.jsx("li",{children:n.jsx(h,{to:"/faq",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Help & FAQs"})}),n.jsx("li",{children:n.jsx(h,{to:"/track-order",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Track Order"})}),n.jsx("li",{children:n.jsx(h,{to:"/shipping",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Shipping & Delivery"})}),n.jsx("li",{children:n.jsx(h,{to:"/returns",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Returns & Exchanges"})}),n.jsx("li",{children:n.jsx(h,{to:"/contact",className:"hover:text-primary hover:translate-x-1 transition-all inline-block",children:"Contact Us"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-lg font-serif font-semibold mb-6 text-gray-900 border-b border-gray-200 pb-2 inline-block",children:"Stay in the Loop"}),n.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Subscribe to receive updates, access to exclusive deals, and more."}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"email",name:"email",id:"newsletter-email",placeholder:"Your email address",className:"w-full pl-4 pr-12 py-3 bg-white border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-400 text-sm"}),n.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-primary hover:text-secondary p-1",children:n.jsx(TC,{size:20})})]}),n.jsx("div",{className:"flex gap-3 mt-4",children:[{Icon:LC,href:"https://facebook.com/hygienhub"},{Icon:qC,href:"https://instagram.com/hygienhub"},{Icon:aE,href:"https://t.me/hygienhub"},{Icon:vE,href:"https://x.com/hygienhub"}].map(({Icon:e,href:t},r)=>n.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white border border-gray-100 flex items-center justify-center hover:bg-primary hover:text-white hover:border-primary text-gray-600 transition-all duration-300 shadow-sm",children:n.jsx(e,{size:18})},r))})]})]})]}),n.jsxs("div",{className:"pt-8 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center gap-6 text-sm text-gray-500",children:[n.jsxs("div",{className:"text-center md:text-left",children:[" ",(new Date).getFullYear()," Hygiene Hub Skincare. All Rights Reserved."]}),n.jsxs("div",{className:"flex gap-6",children:[n.jsx(h,{to:"/privacy",className:"hover:text-primary",children:"Privacy Policy"}),n.jsx(h,{to:"/terms",className:"hover:text-primary",children:"Terms of Service"})]})]})]})}),kE=()=>{const[e,t]=s.useState([]),[r,i]=s.useState(!0);return s.useEffect(()=>{(async()=>{try{const{collections:e}=await bp.collections.list();t(e)}catch(e){}finally{i(!1)}})()},[]),r?n.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading collections..."}):n.jsxs("div",{className:"container mx-auto px-4 py-8",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold mb-8 text-center text-secondary",children:"Collections"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map(e=>n.jsxs(h,{to:`/collections/${e.id}`,className:"group block bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 border border-gray-100",children:[n.jsxs("div",{className:"h-48 bg-light-beige flex items-center justify-center overflow-hidden relative",children:[n.jsx("div",{className:"text-secondary opacity-20 font-serif text-6xl font-bold",children:e.title.charAt(0)}),n.jsx("div",{className:"absolute inset-0 bg-black/5 group-hover:bg-black/0 transition-colors"})]}),n.jsxs("div",{className:"p-6",children:[n.jsx("h2",{className:"text-xl font-bold mb-2 group-hover:text-primary transition-colors",children:e.title}),n.jsxs("div",{className:"flex items-center text-primary font-medium text-sm",children:["Shop Collection ",n.jsx(TC,{size:16,className:"ml-2 group-hover:translate-x-1 transition-transform"})]})]})]},e.id))})]})},TE=({id:e,variantId:t,title:r,handle:i,thumbnail:a,price:o,originalPrice:l,category:c})=>{const{addItem:u}=Cp(),[d,p]=s.useState(!1),[f,m]=s.useState(!1);return n.jsxs("div",{className:"group relative bg-white",children:[n.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden bg-gray-100 cursor-pointer",children:[n.jsx(h,{to:`/products/${i}`,children:n.jsx("img",{src:a,alt:r,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110",loading:"lazy"})}),l&&l>o&&n.jsx("span",{className:"absolute top-3 left-3 bg-red-500 text-white text-[10px] uppercase font-bold px-2 py-1 tracking-wider",children:"Sale"}),n.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2 translate-x-10 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-300",children:[n.jsx("button",{className:"w-9 h-9 bg-white rounded-full flex items-center justify-center text-gray-600 hover:bg-primary hover:text-white shadow-md transition-colors",title:"Add to Wishlist",children:n.jsx(BC,{size:18})}),n.jsx("button",{className:"w-9 h-9 bg-white rounded-full flex items-center justify-center text-gray-600 hover:bg-primary hover:text-white shadow-md transition-colors delay-75",title:"Quick View",children:n.jsx(RC,{size:18})})]}),n.jsx("div",{className:"absolute bottom-4 left-4 right-4 translate-y-10 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 ease-out",children:n.jsx("button",{onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),t){p(!0);try{await u(t,1),m(!0),setTimeout(()=>m(!1),2e3)}catch(fP){}finally{p(!1)}}else window.location.href=`/products/${i}`},disabled:d,className:`w-full backdrop-blur-sm font-medium py-3 transition-colors shadow-sm flex items-center justify-center gap-2 text-sm uppercase tracking-wide ${f?"bg-green-600 text-white":"bg-white/90 text-gray-900 hover:bg-primary hover:text-white"} disabled:opacity-70`,children:d?n.jsx(HC,{size:16,className:"animate-spin"}):f?n.jsxs(n.Fragment,{children:[n.jsx(EC,{size:16})," Added"]}):n.jsxs(n.Fragment,{children:[n.jsx(uE,{size:16})," Add to Cart"]})})})]}),n.jsxs("div",{className:"pt-4 text-center",children:[c&&n.jsx("div",{className:"text-[10px] uppercase tracking-widest text-gray-500 mb-1",children:c}),n.jsx("h3",{className:"text-base font-medium text-gray-900 group-hover:text-primary transition-colors mb-2",children:n.jsx(h,{to:`/products/${i}`,children:r})}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[l&&n.jsxs("span",{className:"text-gray-400 line-through",children:["R",l.toFixed(2)]}),n.jsxs("span",{className:"text-secondary font-semibold",children:["R",o.toFixed(2)]})]})]})]})},CE=()=>{const{id:e}=d(),[t,r]=s.useState(null),[i,a]=s.useState([]),[o,l]=s.useState(!0);return s.useEffect(()=>{(async()=>{if(e){l(!0);try{const{collection:t}=await bp.collections.retrieve(e);r(t);const{products:n}=await bp.products.list({collection_id:[e]});a(n)}catch(t){}finally{l(!1)}}})()},[e]),o?n.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading collection..."}):t?n.jsxs("div",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx(h,{to:"/collections",className:"text-gray-500 hover:text-primary text-sm mb-4 inline-block",children:" Back to Collections"}),n.jsx("h1",{className:"text-4xl font-serif font-bold text-secondary",children:t.title})]}),0===i.length?n.jsx("p",{className:"text-center text-gray-500",children:"No products found in this collection."}):n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:i.map(e=>n.jsx(TE,{product:e},e.id))})]}):n.jsx("div",{className:"p-12 text-center text-red-500",children:"Collection not found."})},EE=()=>{const{data:e,isLoading:t}=r({queryKey:["products","bestsellers"],queryFn:async()=>await bp.store.product.list({limit:4})}),i=e?.products||[];return n.jsxs("div",{className:"bg-white",children:[n.jsxs("section",{className:"relative h-screen min-h-[600px] flex items-center justify-center overflow-hidden",children:[n.jsxs("div",{className:"absolute inset-0 z-0",children:[n.jsx("img",{src:"/images/BG pic.png",alt:"Natural Skincare Background",className:"w-full h-full object-cover object-center animate-pulse-slow"}),n.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),n.jsx("div",{className:"relative z-10 container mx-auto px-6 text-center text-white",children:n.jsxs("div",{className:"animate-fade-in-up",children:[n.jsx("span",{className:"inline-block py-1 px-3 border border-white/30 rounded-full text-xs font-bold tracking-[0.2em] uppercase backdrop-blur-sm mb-6",children:"New Collection 2026"}),n.jsxs("h1",{className:"text-5xl md:text-7xl lg:text-8xl font-serif font-bold mb-6 leading-tight",children:["Unlock Your ",n.jsx("br",{})," ",n.jsx("span",{className:"italic",children:"Natural Radiance"})]}),n.jsx("p",{className:"text-lg md:text-xl font-light max-w-2xl mx-auto mb-10 text-white/90",children:"Discover the power of nature with our scientifically formulated skincare. Pure, potent, and proven to transform your skin."}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n.jsx(h,{to:"/shop",className:"px-10 py-4 bg-primary text-white font-bold uppercase tracking-wider hover:bg-white hover:text-primary transition-all duration-300 shadow-lg hover:shadow-xl",children:"Shop Now"}),n.jsx(h,{to:"/about",className:"px-10 py-4 bg-transparent border border-white text-white font-bold uppercase tracking-wider hover:bg-white hover:text-gray-900 transition-all duration-300",children:"Our Story"})]})]})})]}),n.jsx("section",{className:"py-12 bg-light-beige border-b border-gray-100",children:n.jsx("div",{className:"container mx-auto px-6",children:n.jsxs("div",{className:"flex flex-wrap justify-between gap-8 md:gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4 group cursor-pointer",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-colors",children:n.jsx(GC,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-serif font-bold text-gray-900",children:"100% Organic"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Sourced from nature"})]})]}),n.jsxs("div",{className:"flex items-center gap-4 group cursor-pointer",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-secondary group-hover:bg-secondary group-hover:text-white transition-colors",children:n.jsx(oE,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-serif font-bold text-gray-900",children:"Dermatologist Tested"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Safe for all skin types"})]})]}),n.jsxs("div",{className:"flex items-center gap-4 group cursor-pointer",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors",children:n.jsx(pE,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-serif font-bold text-gray-900",children:"Cruelty Free"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Never tested on animals"})]})]}),n.jsxs("div",{className:"flex items-center gap-4 group cursor-pointer",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 group-hover:bg-orange-600 group-hover:text-white transition-colors",children:n.jsx(gE,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-serif font-bold text-gray-900",children:"Free Shipping"}),n.jsx("p",{className:"text-xs text-gray-500",children:"On orders over R500"})]})]})]})})}),n.jsx("section",{className:"py-24",children:n.jsxs("div",{className:"container mx-auto px-6",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsx("span",{className:"text-primary font-bold tracking-widest uppercase text-xs",children:"Best Sellers"}),n.jsx("h2",{className:"text-4xl font-serif font-bold text-gray-900 mt-3 mb-6",children:"Customer Favorites"}),n.jsx("div",{className:"w-24 h-1 bg-secondary mx-auto rounded-full"})]}),t?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:[1,2,3,4].map(e=>n.jsxs("div",{className:"animate-pulse",children:[n.jsx("div",{className:"bg-gray-200 aspect-[3/4] mb-4"}),n.jsx("div",{className:"h-4 bg-gray-200 w-2/3 mx-auto mb-2"}),n.jsx("div",{className:"h-4 bg-gray-200 w-1/3 mx-auto"})]},e))}):i.length>0?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:i.map(e=>{const t=e.variants?.[0],r=t?.calculated_price?.calculated_amount||t?.prices?.[0]?.amount||0,i=r>1e3?r/100:r;return n.jsx(TE,{id:e.id,variantId:t?.id,title:e.title,handle:e.handle,thumbnail:e.thumbnail||"/images/logo.png",price:i,originalPrice:null},e.id)})}):n.jsxs("div",{className:"text-center text-gray-500 py-12 bg-gray-50 rounded-lg",children:[n.jsx("p",{children:"No products found. Start your Medusa backend to see products here."}),n.jsx("p",{className:"text-xs mt-2",children:"Make sure your backend is running at http://localhost:9000"})]}),n.jsx("div",{className:"text-center mt-12",children:n.jsxs(h,{to:"/shop",className:"inline-flex items-center gap-2 text-primary font-bold uppercase tracking-wider hover:text-secondary transition-colors group",children:["View All Products",n.jsx(TC,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),n.jsxs("section",{className:"py-24 bg-cover bg-center bg-fixed relative",style:{backgroundImage:"url('/images/bg 2.jpeg')"},children:[n.jsx("div",{className:"absolute inset-0 bg-black/40"}),n.jsx("div",{className:"container mx-auto px-6 relative z-10 flex justify-end",children:n.jsxs("div",{className:"bg-white/90 backdrop-blur md:max-w-xl p-10 md:p-16 rounded-sm",children:[n.jsx("h3",{className:"text-3xl font-serif font-bold mb-4 text-gray-900",children:"Summer Glow Essentials"}),n.jsx("p",{className:"text-gray-600 mb-8 leading-relaxed",children:"Prepare your skin for the season with our curated collection of hydration boosters and sun protection. Limited time offer: Get a free travel kit with orders over R1000."}),n.jsx(h,{to:"/shop",className:"px-8 py-3 bg-secondary text-white font-bold uppercase tracking-wider hover:bg-primary transition-colors inline-block",children:"Shop the Edit"})]})})]})]})},IE=()=>n.jsxs("div",{className:"bg-white",children:[n.jsxs("section",{className:"relative py-24 bg-light-beige overflow-hidden",children:[n.jsx("div",{className:"container mx-auto px-6 relative z-10",children:n.jsxs("div",{className:"max-w-3xl",children:[n.jsx("span",{className:"text-primary font-bold tracking-widest uppercase text-xs mb-4 block",children:"Our Journey"}),n.jsxs("h1",{className:"text-5xl md:text-6xl font-serif font-bold text-gray-900 mb-8 leading-tight",children:["Honoring Your Skin with ",n.jsx("span",{className:"italic text-primary",children:"Nature's Best"})]}),n.jsx("p",{className:"text-lg text-gray-600 leading-relaxed mb-8",children:"Founded in 2026, Hygiene Hub Skincare was born out of a simple philosophy: skincare should be an act of self-care, not a chore. We believe in the transformative power of nature, scientifically refined to deliver professional results in the comfort of your home."})]})}),n.jsx("div",{className:"absolute top-0 right-0 w-1/3 h-full opacity-10 pointer-events-none",children:n.jsx("img",{src:"/images/logo.png",alt:"Watermark",className:"w-full h-full object-contain"})})]}),n.jsx("section",{className:"py-24",children:n.jsx("div",{className:"container mx-auto px-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-16 items-center",children:[n.jsx("div",{children:n.jsx("img",{src:"/images/bg 2.jpeg",alt:"Natural ingredients",className:"rounded-sm shadow-2xl w-full h-[500px] object-cover"})}),n.jsxs("div",{className:"space-y-8",children:[n.jsx("h2",{className:"text-4xl font-serif font-bold text-gray-900 mb-6",children:"Our Philosophy"}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-primary",children:n.jsx(BC,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-lg mb-2",children:"Ethics First"}),n.jsx("p",{className:"text-gray-600 text-sm",children:"We are 100% cruelty-free and prioritize ethically sourced ingredients from sustainable farms."})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-secondary",children:n.jsx(lE,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-lg mb-2",children:"Purity Guaranteed"}),n.jsx("p",{className:"text-gray-600 text-sm",children:"No parabens, sulfates, or artificial fragrances. Only clean, potent botanical extracts."})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-purple-50 rounded-full flex items-center justify-center text-purple-600",children:n.jsx(pE,{size:24})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-lg mb-2",children:"Visible Results"}),n.jsx("p",{className:"text-gray-600 text-sm",children:"Every formula is dermatologist-tested and proven to improve skin health and radiance."})]})]})]})]})]})})}),n.jsx("section",{className:"py-24 bg-gray-50",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsx("h2",{className:"text-4xl font-serif font-bold text-gray-900 mb-16",children:"What We Stand For"}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:[{title:"Transparency",desc:"We list every ingredient and its purpose. No secrets."},{title:"Sustainability",desc:"Recyclable packaging and carbon-neutral shipping."},{title:"Quality",desc:"Small-batch production to ensure ultimate freshness."},{title:"Community",desc:"A portion of every sale supports local water initiatives."}].map((e,t)=>n.jsxs("div",{className:"bg-white p-8 rounded-sm shadow-sm hover:shadow-md transition-shadow border border-gray-100",children:[n.jsx("div",{className:"w-10 h-10 bg-primary/10 text-primary rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(CC,{size:20})}),n.jsx("h4",{className:"font-bold text-gray-900 mb-3",children:e.title}),n.jsx("p",{className:"text-gray-500 text-sm leading-relaxed",children:e.desc})]},t))})]})}),n.jsx("section",{className:"py-24 bg-primary text-white text-center",children:n.jsxs("div",{className:"container mx-auto px-6 max-w-2xl",children:[n.jsx("h2",{className:"text-4xl font-serif font-bold mb-6 italic text-white/90 underline italic",children:"Start Your Skin Transformation"}),n.jsx("p",{className:"text-white/80 mb-10 leading-relaxed",children:"Join thousands of others who have discovered the power of natural skincare. Experience the Hygiene Hub difference today."}),n.jsx("a",{href:"/shop",className:"px-10 py-4 bg-white text-primary font-bold uppercase tracking-widest hover:bg-secondary hover:text-white transition-all duration-300 inline-block shadow-lg",children:"Explore the Collection"})]})})]}),PE=()=>{const[e,t]=s.useState(!1),[i,a]=s.useState(null),{data:o,isLoading:l}=r({queryKey:["products","shop"],queryFn:async()=>await bp.store.product.list({limit:20})}),c=o?.products||[];return n.jsxs("div",{className:"bg-white min-h-screen pt-24 pb-12",children:[n.jsx("div",{className:"bg-light-beige py-12 mb-10 border-b border-green-50",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-2",children:"Shop Collection"}),n.jsx("p",{className:"text-gray-500",children:"Curated essentials for your daily ritual."})]})}),n.jsx("div",{className:"container mx-auto px-6",children:n.jsxs("div",{className:"flex flex-col lg:flex-row gap-12",children:[n.jsxs("aside",{className:"hidden lg:block w-64 flex-shrink-0 space-y-8",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"font-serif font-bold text-lg mb-4 flex items-center gap-2",children:[n.jsx(jC,{size:18})," Filters"]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Categories"}),["Skincare","Body","Hair","Suncare","Sets","New Arrivals"].map(e=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",id:e,className:"rounded border-gray-300 text-primary focus:ring-primary",checked:i===e,onChange:()=>a(i===e?null:e)}),n.jsx("label",{htmlFor:e,className:"text-gray-600 hover:text-primary cursor-pointer",children:e})]},e))]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Price Range"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"number",placeholder:"Min",className:"w-full px-2 py-1 border border-gray-200 rounded text-sm"}),n.jsx("span",{className:"text-gray-400",children:"-"}),n.jsx("input",{type:"number",placeholder:"Max",className:"w-full px-2 py-1 border border-gray-200 rounded text-sm"})]})]})]}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsxs("button",{className:"lg:hidden flex items-center gap-2 text-gray-800 font-medium",onClick:()=>t(!e),children:[n.jsx(hE,{size:18})," Filters"]}),n.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",c.length," results"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-gray-500 hidden sm:inline",children:"Sort by:"}),n.jsxs("div",{className:"relative group",children:[n.jsxs("button",{className:"flex items-center gap-1 text-sm font-medium text-gray-900 hover:text-primary",children:["Best Selling ",n.jsx(IC,{size:14})]}),n.jsx("div",{className:"absolute right-0 top-full pt-2 opacity-0 group-hover:opacity-100 invisible group-hover:visible transition-all z-10 w-40",children:n.jsxs("div",{className:"bg-white shadow-lg border border-gray-100 rounded-md py-1",children:[n.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Price: Low to High"}),n.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Price: High to Low"}),n.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Newest"})]})})]})]})]}),l?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(e=>n.jsxs("div",{className:"animate-pulse",children:[n.jsx("div",{className:"bg-gray-100 aspect-[3/4] mb-3"}),n.jsx("div",{className:"h-4 bg-gray-100 w-3/4 mb-2"}),n.jsx("div",{className:"h-4 bg-gray-100 w-1/4"})]},e))}):c.length>0?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:c.map(e=>{const t=e.variants?.[0],r=t?.calculated_price?.calculated_amount||t?.prices?.[0]?.amount||0,i=r>1e3?r/100:r;return n.jsx(TE,{id:e.id,variantId:t?.id,title:e.title,handle:e.handle,thumbnail:e.thumbnail||"/images/logo.png",price:i},e.id)})}):n.jsx("div",{className:"bg-gray-50 py-12 text-center rounded-lg",children:n.jsx("p",{className:"text-gray-600",children:"No products found."})})]})]})})]})},ME=()=>{const{handle:e}=d(),[t,i]=s.useState(1),[a,o]=s.useState(0),[l,c]=s.useState(!1),[u,p]=s.useState(!1),{addItem:f}=Cp(),{data:m,isLoading:g}=r({queryKey:["product",e],queryFn:async()=>{if(!e)return null;const t=await bp.store.product.list({handle:e,limit:1});if(t.products&&t.products.length>0)return t.products[0];const n=await bp.store.product.list({limit:20});return n.products?.find(t=>t.handle===e)||n.products?.[0]},enabled:!!e}),y=m;if(g)return n.jsx("div",{className:"min-h-screen flex items-center justify-center",children:n.jsx(HC,{className:"w-8 h-8 animate-spin text-primary"})});if(!y)return n.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:["Product not found. ",n.jsx(h,{to:"/shop",className:"ml-2 underline",children:"Return to Shop"})]});const _=y.variants?.[a],v=_?.calculated_price?.calculated_amount||_?.prices?.[0]?.amount||0,x=v>1e3?v/100:v;return n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6",children:[n.jsxs(h,{to:"/shop",className:"inline-flex items-center gap-2 text-gray-500 hover:text-primary mb-8 text-sm uppercase tracking-wide",children:[n.jsx(kC,{size:16})," Back to Shop"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12 lg:gap-20",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"aspect-[4/5] bg-gray-100 overflow-hidden relative group",children:[n.jsx("img",{src:y.thumbnail||"/images/logo.png",alt:y.title,className:"w-full h-full object-cover"}),n.jsxs("div",{className:"absolute top-4 right-4 flex flex-col gap-3 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx("button",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-600 hover:text-primary shadow-sm",children:n.jsx(BC,{size:20})}),n.jsx("button",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-600 hover:text-primary shadow-sm",children:n.jsx(sE,{size:20})})]})]}),n.jsx("div",{className:"grid grid-cols-4 gap-4",children:(y.images?.length?y.images:[{url:y.thumbnail}]).slice(0,4).map((e,t)=>e?.url&&n.jsx("div",{className:"aspect-square bg-gray-100 cursor-pointer hover:ring-2 ring-primary transition-all",children:n.jsx("img",{src:e.url,alt:"",className:"w-full h-full object-cover"})},t))})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsxs("div",{className:"flex text-yellow-400",children:[n.jsx(fE,{size:14,fill:"currentColor"}),n.jsx(fE,{size:14,fill:"currentColor"}),n.jsx(fE,{size:14,fill:"currentColor"}),n.jsx(fE,{size:14,fill:"currentColor"}),n.jsx(fE,{size:14,fill:"currentColor"})]}),n.jsx("span",{className:"text-xs text-gray-500",children:"(128 Reviews)"})]}),n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:y.title}),n.jsxs("div",{className:"text-2xl text-secondary font-semibold mb-6",children:["R",x.toFixed(2)]}),n.jsx("div",{className:"prose prose-sm text-gray-600 mb-8 max-w-none",children:y.description||"Experience the ultimate in skincare luxury. This product is formulated with potent natural ingredients to rejuvenate and protect your skin."}),y.variants&&y.variants.length>0&&n.jsxs("div",{className:"mb-8",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-3",children:"Size / Variant"}),n.jsx("div",{className:"flex flex-wrap gap-3",children:y.variants.map((e,t)=>n.jsx("button",{onClick:()=>o(t),className:"px-4 py-2 border text-sm transition-all "+(a===t?"border-primary bg-primary text-white":"border-gray-200 text-gray-700 hover:border-primary"),children:e.title},e.id))})]}),n.jsxs("div",{className:"flex gap-4 mb-8",children:[n.jsxs("div",{className:"flex items-center border border-gray-200 rounded-sm",children:[n.jsx("button",{onClick:()=>i(Math.max(1,t-1)),className:"w-10 h-10 flex items-center justify-center hover:bg-gray-50",children:n.jsx(QC,{size:16})}),n.jsx("span",{className:"w-12 text-center font-medium",children:t}),n.jsx("button",{onClick:()=>i(t+1),className:"w-10 h-10 flex items-center justify-center hover:bg-gray-50",children:n.jsx(nE,{size:16})})]}),n.jsx("button",{onClick:async()=>{if(y&&y.variants?.[a]){c(!0);try{await f(y.variants[a].id,t),p(!0),setTimeout(()=>p(!1),2e3)}catch(fP){}finally{c(!1)}}},disabled:l,className:`flex-1 font-bold uppercase tracking-wider transition-colors shadow-lg flex items-center justify-center gap-2 ${u?"bg-green-600 text-white":"bg-primary text-white hover:bg-dark-green"} disabled:opacity-70`,children:l?n.jsx(HC,{className:"w-5 h-5 animate-spin"}):u?n.jsxs(n.Fragment,{children:[n.jsx(EC,{size:18})," Added to Cart"]}):"Add to Cart"})]}),n.jsxs("div",{className:"border-t border-gray-100 pt-6 space-y-3 text-sm text-gray-600",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(gE,{size:18,className:"text-primary"}),n.jsx("span",{children:"Free shipping on orders over R500"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(oE,{size:18,className:"text-primary"}),n.jsx("span",{children:"100% Organic & Chemical Free"})]})]})]})]})]})})},AE=({toggleView:e})=>{const{login:t}=Mp(),[r,i]=s.useState({email:"",password:""}),[a,o]=s.useState(""),[l,c]=s.useState(!1);return n.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden p-8",children:[n.jsxs("div",{className:"text-center mb-10",children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-gray-900 mb-2",children:"Welcome Back"}),n.jsx("p",{className:"text-gray-500 text-sm",children:"Sign in to access your account"})]}),n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(""),c(!0);try{await t(r.email,r.password)}catch(fP){o(fP.message||"Login failed. Please check your credentials.")}finally{c(!1)}},className:"space-y-4",children:[a&&n.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:a}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(XC,{className:"absolute left-4 top-3.5 text-gray-400 w-5 h-5"}),n.jsx("input",{type:"email",required:!0,className:"w-full border border-gray-100 bg-gray-50 pl-12 pr-4 py-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",placeholder:"you@example.com",value:r.email,onChange:e=>i({...r,email:e.target.value})})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(ZC,{className:"absolute left-4 top-3.5 text-gray-400 w-5 h-5"}),n.jsx("input",{type:"password",required:!0,className:"w-full border border-gray-100 bg-gray-50 pl-12 pr-4 py-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",placeholder:"",value:r.password,onChange:e=>i({...r,password:e.target.value})})]})]}),n.jsxs("button",{type:"submit",disabled:l,className:"w-full bg-primary text-white py-4 rounded-xl font-bold uppercase tracking-widest text-sm hover:bg-dark-green transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2 group",children:[l?"Signing In...":"Sign In",!l&&n.jsx(TC,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]}),n.jsx("div",{className:"mt-8 pt-8 border-t border-gray-100 text-center",children:n.jsxs("p",{className:"text-gray-500 text-sm",children:["Don't have an account?",n.jsx("button",{onClick:e,className:"ml-2 font-bold text-primary hover:underline",children:"Create one now"})]})})]})},zE=({toggleView:e})=>{const{register:t}=Mp(),[r,i]=s.useState({email:"",password:"",first_name:"",last_name:"",phone:""}),[a,o]=s.useState(""),[l,c]=s.useState(!1);return n.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden p-8",children:[n.jsxs("div",{className:"text-center mb-10",children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-gray-900 mb-2",children:"Join Hygiene Hub"}),n.jsx("p",{className:"text-gray-500 text-sm",children:"Create an account for a faster checkout"})]}),n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(""),c(!0);try{await t(r)}catch(fP){o(fP.message||"Registration failed. Please try again.")}finally{c(!1)}},className:"space-y-4",children:[a&&n.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100",children:a}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"First Name"}),n.jsx("input",{type:"text",required:!0,className:"w-full border border-gray-100 bg-gray-50 p-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",value:r.first_name,onChange:e=>i({...r,first_name:e.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Last Name"}),n.jsx("input",{type:"text",required:!0,className:"w-full border border-gray-100 bg-gray-50 p-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",value:r.last_name,onChange:e=>i({...r,last_name:e.target.value})})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(XC,{className:"absolute left-4 top-3.5 text-gray-400 w-5 h-5"}),n.jsx("input",{type:"email",required:!0,className:"w-full border border-gray-100 bg-gray-50 pl-12 pr-4 py-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",placeholder:"you@example.com",value:r.email,onChange:e=>i({...r,email:e.target.value})})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(ZC,{className:"absolute left-4 top-3.5 text-gray-400 w-5 h-5"}),n.jsx("input",{type:"password",required:!0,className:"w-full border border-gray-100 bg-gray-50 pl-12 pr-4 py-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",placeholder:"",value:r.password,onChange:e=>i({...r,password:e.target.value})})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600",children:"Phone (Optional)"}),n.jsx("input",{type:"tel",className:"w-full border border-gray-100 bg-gray-50 p-3 rounded-xl focus:bg-white focus:ring-2 focus:ring-primary/20 outline-none transition-all",placeholder:"+27...",value:r.phone,onChange:e=>i({...r,phone:e.target.value})})]}),n.jsxs("button",{type:"submit",disabled:l,className:"w-full bg-primary text-white py-4 rounded-xl font-bold uppercase tracking-widest text-sm hover:bg-dark-green transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2 group",children:[l?"Creating Account...":"Create Account",!l&&n.jsx(TC,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]}),n.jsx("div",{className:"mt-8 pt-8 border-t border-gray-100 text-center",children:n.jsxs("p",{className:"text-gray-500 text-sm",children:["Already have an account?",n.jsx("button",{onClick:e,className:"ml-2 font-bold text-primary hover:underline",children:"Sign in here"})]})})]})};
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var DE={exports:{}};
/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.17.0/LICENSE.txt
 */DE.exports=function(){var e={},n={};function r(t,r,i){if(n[t]=i,"index"===t){var a="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",s={};return n.shared(s),n.index(e,s),"undefined"!=typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([a],{type:"text/javascript"}))),e}}return r("shared",["exports"],function(e){function n(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}l((r=r.apply(e,t||[])).next())})}function r(e,t){this.x=e,this.y=t}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var a,s;"function"==typeof SuppressedError&&SuppressedError,r.prototype={clone(){return new r(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:r},r.convert=function(e){if(e instanceof r)return e;if(Array.isArray(e))return new r(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new r(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};var o=function(){if(s)return a;function e(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}return s=1,a=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=i/a}var s=0,o=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?s=n:o=n,n=.5*(o-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},a}(),l=i(o);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let r=0;r<e*e;r++){const n=4*r;t.fillStyle=`rgb(${n},${n+1},${n+2})`,t.fillRect(r%e,Math.floor(r/e),1,1)}const n=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&n[t]!==t){u=!0;break}}}return u||!1}var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array;function m(){var e=new f(9);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function g(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function v(e,t,n){var r=new f(3);return r[0]=e,r[1]=t,r[2]=n,r}function x(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function b(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function w(e,t,n){var r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2];return e[0]=i*l-a*o,e[1]=a*s-r*l,e[2]=r*o-i*s,e}var S,k=_;function T(e,t,n){var r=t[0],i=t[1],a=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*s,e}function C(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function E(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"zyx",a=Math.PI/360;t*=a,r*=a,n*=a;var s=Math.sin(t),o=Math.cos(t),l=Math.sin(n),c=Math.cos(n),u=Math.sin(r),h=Math.cos(r);switch(i){case"xyz":e[0]=s*c*h+o*l*u,e[1]=o*l*h-s*c*u,e[2]=o*c*u+s*l*h,e[3]=o*c*h-s*l*u;break;case"xzy":e[0]=s*c*h-o*l*u,e[1]=o*l*h-s*c*u,e[2]=o*c*u+s*l*h,e[3]=o*c*h+s*l*u;break;case"yxz":e[0]=s*c*h+o*l*u,e[1]=o*l*h-s*c*u,e[2]=o*c*u-s*l*h,e[3]=o*c*h+s*l*u;break;case"yzx":e[0]=s*c*h+o*l*u,e[1]=o*l*h+s*c*u,e[2]=o*c*u-s*l*h,e[3]=o*c*h-s*l*u;break;case"zxy":e[0]=s*c*h-o*l*u,e[1]=o*l*h+s*c*u,e[2]=o*c*u+s*l*h,e[3]=o*c*h-s*l*u;break;case"zyx":e[0]=s*c*h-o*l*u,e[1]=o*l*h+s*c*u,e[2]=o*c*u-s*l*h,e[3]=o*c*h+s*l*u;break;default:throw new Error("Unknown angle order "+i)}return e}function I(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}function P(e,t){var n=new f(2);return n[0]=e,n[1]=t,n}y(),S=new f(4),f!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[3]=0),y(),v(1,0,0),v(0,1,0),C(),C(),m(),I();const M=8192;function A(e,t,n){return t*(M/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}function z(e,t){return(e%t+t)%t}function D(e,t,n){return e*(1-n)+t*n}function R(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function L(e,t,n,r){const i=new l(e,t,n,r);return e=>i.solve(e)}const N=L(.25,.1,.25,1);function j(e,t,n){return Math.min(n,Math.max(t,e))}function F(e,t,n){const r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function O(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}let B=1;function V(e,t,n){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function U(e,t,n){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function q(e){return Array.isArray(e)?e.map(q):"object"==typeof e&&e?V(e,q):e}const $={};function G(e){$[e]||($[e]=!0)}function H(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Z(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let W=null;function X(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function K(e,t,r,i,a){return n(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const n=new VideoFrame(e,{timestamp:0});try{const s=null==n?void 0:n.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const o=s.startsWith("BGR"),l=new Uint8ClampedArray(i*a*4);if(yield n.copyTo(l,function(e,t,n,r,i){const a=4*Math.max(-t,0),s=(Math.max(0,n)-n)*r*4+a,o=4*r,l=Math.max(0,t),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(e.width,t+r)-l,height:Math.min(e.height,n+i)-c},layout:[{offset:s,stride:o}]}}(e,t,r,i,a)),o)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{n.close()}})}let Q,J;function ee(e,t,n,r){return e.addEventListener(t,n,r),{unsubscribe:()=>{e.removeEventListener(t,n,r)}}}function te(e){return e*Math.PI/180}function ne(e){return e/Math.PI*180}const re={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ie={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ae="AbortError";class se extends Error{constructor(e=ae){super(e instanceof Error?e.message:e),this.name=ae,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function oe(e){return e.name===ae}const le={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ce(e){return le.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const ue="global-dispatcher";class he extends Error{constructor(e,t,n,r){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=r}}const de=()=>Z(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,pe=function(e,t){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const n=ce(e.url);if(n)return n(e,t);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:ue},t)}if(!(/^file:/.test(r=e.url)||/^file:/.test(de())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,t){return n(this,void 0,void 0,function*(){const n=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:de(),signal:t.signal});let r,i;"json"!==e.type||n.headers.has("Accept")||n.headers.set("Accept","application/json");try{r=yield fetch(n)}catch(s){if(oe(s))throw s;throw new he(0,s.message,e.url,new Blob)}if(!r.ok){const t=yield r.blob();throw new he(r.status,r.statusText,e.url,t)}i="arrayBuffer"===e.type||"image"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text();const a=yield i;return t.signal.throwIfAborted(),{data:a,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}})}(e,t);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:ue},t)}var r,i,a;return i=e,a=t,new Promise((e,t)=>{var n;const r=new XMLHttpRequest;r.open(i.method||"GET",i.url,!0),"arrayBuffer"!==i.type&&"image"!==i.type||(r.responseType="arraybuffer");for(const a in i.headers)r.setRequestHeader(a,i.headers[a]);"json"===i.type&&(r.responseType="text",(null===(n=i.headers)||void 0===n?void 0:n.Accept)||r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===i.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if(!a.signal.aborted)if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let a=r.response;if("json"===i.type)try{a=JSON.parse(r.response)}catch(n){return void t(n)}e({data:a,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")})}else{const e=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new he(r.status,r.statusText,i.url,e))}},a.signal.addEventListener("abort",()=>{r.abort(),t(new se(a.signal.reason))}),r.send(i.body)})};function fe(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function me(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function ge(e,t,n){if(n&&n[e]){const r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}class ye{constructor(e,t={}){O(this,t),this.type=e}}class _e extends ye{constructor(e,t={}){super("error",O({error:e},t))}}class ve{on(e,t){return this._listeners=this._listeners||{},me(e,t,this._listeners),{unsubscribe:()=>{this.off(e,t)}}}off(e,t){return ge(e,t,this._listeners),ge(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},me(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(e,t){"string"==typeof e&&(e=new ye(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const a of r)ge(n,a,this._oneTimeListeners),a.call(this,e);const i=this._eventedParent;i&&(O(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const be=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function we(e,t){const n={};for(const r in e)"ref"!==r&&(n[r]=e[r]);return be.forEach(e=>{e in t&&(n[e]=t[e])}),n}function Se(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Se(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!Se(e[n],t[n]))return!1;return!0}return e===t}function ke(e,t){e.push(t)}function Te(e,t,n){ke(n,{command:"addSource",args:[e,t[e]]})}function Ce(e,t,n){ke(t,{command:"removeSource",args:[e]}),n[e]=!0}function Ee(e,t,n,r){Ce(e,n,r),Te(e,t,n)}function Ie(e,t,n){let r;for(r in e[n])if(Object.prototype.hasOwnProperty.call(e[n],r)&&"data"!==r&&!Se(e[n][r],t[n][r]))return!1;for(r in t[n])if(Object.prototype.hasOwnProperty.call(t[n],r)&&"data"!==r&&!Se(e[n][r],t[n][r]))return!1;return!0}function Pe(e,t,n,r,i,a){e=e||{},t=t||{};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(Se(e[s],t[s])||n.push({command:a,args:[r,s,t[s],i]}));for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(Se(e[s],t[s])||n.push({command:a,args:[r,s,t[s],i]}))}function Me(e){return e.id}function Ae(e,t){return e[t.id]=t,e}class ze{constructor(e,t,n,r){this.message=(e?`${e}: `:"")+n,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function De(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}class Re extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Le{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,r]of t)this.bindings[n]=r}concat(e){return new Le(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ne={kind:"null"},je={kind:"number"},Fe={kind:"string"},Oe={kind:"boolean"},Be={kind:"color"},Ve={kind:"projectionDefinition"},Ue={kind:"object"},qe={kind:"value"},$e={kind:"collator"},Ge={kind:"formatted"},He={kind:"padding"},Ze={kind:"colorArray"},We={kind:"numberArray"},Xe={kind:"resolvedImage"},Ye={kind:"variableAnchorOffsetCollection"};function Ke(e,t){return{kind:"array",itemType:e,N:t}}function Qe(e){if("array"===e.kind){const t=Qe(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Je=[Ne,je,Fe,Oe,Be,Ve,Ge,Ue,Ke(qe),He,We,Ze,Xe,Ye];function et(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!et(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Je)if(!et(e,t))return null}return`Expected ${Qe(e)} but found ${Qe(t)} instead.`}function tt(e,t){return t.some(t=>t.kind===e.kind)}function nt(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function rt(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const it=.96422,at=.82521,st=4/29,ot=6/29,lt=3*ot*ot,ct=ot*ot*ot,ut=Math.PI/180,ht=180/Math.PI;function dt(e){return(e%=360)<0&&(e+=360),e}function pt([e,t,n,r]){let i,a;const s=mt((.2225045*(e=ft(e))+.7168786*(t=ft(t))+.0606169*(n=ft(n)))/1);e===t&&t===n?i=a=s:(i=mt((.4360747*e+.3850649*t+.1430804*n)/it),a=mt((.0139322*e+.0971045*t+.7141733*n)/at));const o=116*s-16;return[o<0?0:o,500*(i-s),200*(s-a),r]}function ft(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function mt(e){return e>ct?Math.pow(e,1/3):e/lt+st}function gt([e,t,n,r]){let i=(e+16)/116,a=isNaN(t)?i:i+t/500,s=isNaN(n)?i:i-n/200;return i=1*_t(i),a=it*_t(a),s=at*_t(s),[yt(3.1338561*a-1.6168667*i-.4906146*s),yt(-.9787684*a+1.9161415*i+.033454*s),yt(.0719453*a-.2289914*i+1.4052427*s),r]}function yt(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function _t(e){return e>ot?e*e*e:lt*(e-st)}const vt=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function xt(e,t){return vt(e,t)?e[t]:void 0}function bt(e){return parseInt(e.padEnd(2,e),16)/255}function wt(e,t){return St(t?e/100:e,0,1)}function St(e,t,n){return Math.min(Math.max(t,e),n)}function kt(e){return!e.some(Number.isNaN)}const Tt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ct(e,t,n){return e+n*(t-e)}function Et(e,t,n){return e.map((e,r)=>Ct(e,t[r],n))}class It{constructor(e,t,n,r=1,i=!0){this.r=e,this.g=t,this.b=n,this.a=r,i||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[e,t,n,r]))}static parse(e){if(e instanceof It)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=xt(Tt,e);if(t){const[e,n,r]=t;return[e/255,n/255,r/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let n=1;return[bt(e.slice(n,n+=t)),bt(e.slice(n,n+=t)),bt(e.slice(n,n+=t)),bt(e.slice(n,n+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,n,r,i,a,s,o,l,c,u,h,d]=t,p=[i||" ",o||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[r,s,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[St(+n/t,0,1),St(+a/t,0,1),St(+l/t,0,1),h?wt(+h,d):1];if(kt(e))return e}}return}}const n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,t,r,i,a,s,o,l,c]=n,u=[r||" ",a||" ",o].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,St(+i,0,100),St(+s,0,100),l?wt(+l,c):1];if(kt(e))return function([e,t,n,r]){function i(r){const i=(r+e/30)%12,a=t*Math.min(n,1-n);return n-a*Math.max(-1,Math.min(i-3,9-i,1))}return e=dt(e),t/=100,n/=100,[i(0),i(8),i(4),r]}(e)}}}(e);return t?new It(...t,!1):void 0}get rgb(){const{r:e,g:t,b:n,a:r}=this,i=r||1/0;return this.overwriteGetter("rgb",[e/i,t/i,n/i,r])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,n,r,i]=pt(e),a=Math.sqrt(n*n+r*r);return[Math.round(1e4*a)?dt(Math.atan2(r,n)*ht):NaN,a,t,i]}(this.rgb))}get lab(){return this.overwriteGetter("lab",pt(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,r]=this.rgb;return`rgba(${[e,t,n].map(e=>Math.round(255*e)).join(",")},${r})`}static interpolate(e,t,n,r="rgb"){switch(r){case"rgb":{const[r,i,a,s]=Et(e.rgb,t.rgb,n);return new It(r,i,a,s,!1)}case"hcl":{const[r,i,a,s]=e.hcl,[o,l,c,u]=t.hcl;let h,d;if(isNaN(r)||isNaN(o))isNaN(r)?isNaN(o)?h=NaN:(h=o,1!==a&&0!==a||(d=l)):(h=r,1!==c&&0!==c||(d=i));else{let e=o-r;o>r&&e>180?e-=360:o<r&&r-o>180&&(e+=360),h=r+n*e}const[p,f,m,g]=function([e,t,n,r]){return e=isNaN(e)?0:e*ut,gt([n,Math.cos(e)*t,Math.sin(e)*t,r])}([h,null!=d?d:Ct(i,l,n),Ct(a,c,n),Ct(s,u,n)]);return new It(p,f,m,g,!1)}case"lab":{const[r,i,a,s]=gt(Et(e.lab,t.lab,n));return new It(r,i,a,s,!1)}}}}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1);class Pt{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Mt=["bottom","center","top"];class At{constructor(e,t,n,r,i,a){this.text=e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i,this.verticalAlign=a}}class zt{constructor(e){this.sections=e}static fromString(e){return new zt([new At(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof zt?e:zt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}}class Dt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dt)return e;if("number"==typeof e)return new Dt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Dt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Dt(Et(e.values,t.values,n))}}class Rt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Rt)return e;if("number"==typeof e)return new Rt([e]);if(Array.isArray(e)){for(const t of e)if("number"!=typeof t)return;return new Rt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Rt(Et(e.values,t.values,n))}}class Lt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Lt)return e;if("string"==typeof e){const t=It.parse(e);if(!t)return;return new Lt([t])}if(!Array.isArray(e))return;const t=[];for(const n of e){if("string"!=typeof n)return;const e=It.parse(n);if(!e)return;t.push(e)}return new Lt(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n,r="rgb"){const i=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let a=0;a<e.values.length;a++)i.push(It.interpolate(e.values[a],t.values[a],n,r));return new Lt(i)}}class Nt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const jt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ft{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ft)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const n=e[t],r=e[t+1];if("string"!=typeof n||!jt.has(n))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Ft(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const r=e.values,i=t.values;if(r.length!==i.length)throw new Nt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const a=[];for(let s=0;s<r.length;s+=2){if(r[s]!==i[s])throw new Nt(`Cannot interpolate values containing mismatched anchors. from[${s}]: ${r[s]}, to[${s}]: ${i[s]}`);a.push(r[s]);const[e,t]=r[s+1],[o,l]=i[s+1];a.push([Ct(e,o,n),Ct(t,l,n)])}return new Ft(a)}}class Ot{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ot({name:e,available:!1}):null}}class Bt{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new Bt(e,t,n)}static parse(e){return e instanceof Bt?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Bt(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Bt(e.from,e.to,e.transition):"string"==typeof e?new Bt(e,e,1):void 0}}function Vt(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ut(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Bt||e instanceof It||e instanceof Pt||e instanceof zt||e instanceof Dt||e instanceof Rt||e instanceof Lt||e instanceof Ft||e instanceof Ot)return!0;if(Array.isArray(e)){for(const t of e)if(!Ut(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ut(e[t]))return!1;return!0}return!1}function qt(e){if(null===e)return Ne;if("string"==typeof e)return Fe;if("boolean"==typeof e)return Oe;if("number"==typeof e)return je;if(e instanceof It)return Be;if(e instanceof Bt)return Ve;if(e instanceof Pt)return $e;if(e instanceof zt)return Ge;if(e instanceof Dt)return He;if(e instanceof Rt)return We;if(e instanceof Lt)return Ze;if(e instanceof Ft)return Ye;if(e instanceof Ot)return Xe;if(Array.isArray(e)){const t=e.length;let n;for(const r of e){const e=qt(r);if(n){if(n===e)continue;n=qe;break}n=e}return Ke(n||qe,t)}return Ue}function $t(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof It||e instanceof Bt||e instanceof zt||e instanceof Dt||e instanceof Rt||e instanceof Lt||e instanceof Ft||e instanceof Ot?e.toString():JSON.stringify(e)}class Gt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ut(e[1]))return t.error("invalid value");const n=e[1];let r=qt(n);const i=t.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Gt(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ht={string:Fe,number:je,boolean:Oe,object:Ue};class Zt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,r=1;const i=e[0];if("array"===i){let i,a;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Ht)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Ht[n],r++}else i=qe;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],r++}n=Ke(i,a)}else{if(!Ht[i])throw new Error(`Types doesn't contain name = ${i}`);n=Ht[i]}const a=[];for(;r<e.length;r++){const n=t.parse(e[r],r,qe);if(!n)return null;a.push(n)}return new Zt(n,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!et(this.type,qt(n)))return n;if(t===this.args.length-1)throw new Nt(`Expected value to be of type ${Qe(this.type)}, but found ${Qe(qt(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Wt={"to-boolean":Oe,"to-color":Be,"to-number":je,"to-string":Fe};class Xt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Wt[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const r=Wt[n],i=[];for(let a=1;a<e.length;a++){const n=t.parse(e[a],a,qe);if(!n)return null;i.push(n)}return new Xt(r,i)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,n;for(const r of this.args){if(t=r.evaluate(e),n=null,t instanceof It)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Vt(t[0],t[1],t[2],t[3]),!n))return new It(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Nt(n||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const r=Dt.parse(t);if(r)return r}throw new Nt(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const r=Rt.parse(t);if(r)return r}throw new Nt(`Could not parse numberArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const r=Lt.parse(t);if(r)return r}throw new Nt(`Could not parse colorArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const r=Ft.parse(t);if(r)return r}throw new Nt(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Nt(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return zt.fromString($t(this.args[0].evaluate(e)));case"resolvedImage":return Ot.fromString($t(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return $t(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Yt=["Unknown","Point","LineString","Polygon"];class Kt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=It.parse(e),this._parseColorCache.set(e,t)),t}}class Qt{constructor(e,t,n=[],r,i=new Le,a=[]){this.registry=e,this.path=n,this.key=n.map(e=>`[${e}]`).join(""),this.scope=i,this.errors=a,this.expectedType=r,this._isConstant=t}parse(e,t,n,r,i={}){return t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)}_parse(e,t){function n(e,t,n){return"assert"===n?new Zt(t,[e]):"coerce"===n?new Xt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const a=this.registry[i];if(a){let i=a.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind){if("projectionDefinition"===e.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===e.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===e.kind&&["value","array"].includes(r.kind))i=n(i,e,t.typeAnnotation||"coerce");else if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof Gt)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const e=new Kt;try{i=new Gt(i.type,i.evaluate(e))}catch(r){return this.error(r.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const r="number"==typeof e?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Qt(this.registry,this._isConstant,r,t||null,i,this.errors)}error(e,...t){const n=`${this.key}${t.map(e=>`[${e}]`).join("")}`;this.errors.push(new Re(n,e))}checkSubtype(e,t){const n=et(e,t);return n&&this.error(n),n}}class Jt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const a=t.parse(e[i+1],i+1);if(!a)return null;n.push([r,a])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return r?new Jt(n,r):null}outputDefined(){return this.result.outputDefined()}}class en{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new en(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class tn{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,je),r=t.parse(e[2],2,Ke(t.expectedType||qe));return n&&r?new tn(r.type.itemType,n,r):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Nt(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Nt(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Nt(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class nn{constructor(e,t){this.type=Oe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,qe),r=t.parse(e[2],2,qe);return n&&r?tt(n.type,[Oe,Fe,je,Ne,qe])?new nn(n,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!nt(t,["boolean","string","number","null"]))throw new Nt(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(qt(t))} instead.`);if(!nt(n,["string","array"]))throw new Nt(`Expected second argument to be of type array or string, but found ${Qe(qt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class rn{constructor(e,t,n){this.type=je,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,qe),r=t.parse(e[2],2,qe);if(!n||!r)return null;if(!tt(n.type,[Oe,Fe,je,Ne,qe]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,je);return i?new rn(n,r,i):null}return new rn(n,r)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!nt(t,["boolean","string","number","null"]))throw new Nt(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(qt(t))} instead.`);let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(e)),nt(n,["string"])){const e=n.indexOf(t,r);return-1===e?-1:[...n.slice(0,e)].length}if(nt(n,["array"]))return n.indexOf(t,r);throw new Nt(`Expected second argument to be of type array or string, but found ${Qe(qt(n))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class an{constructor(e,t,n,r,i,a){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const i={},a=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const o=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,qt(e)))return null}else n=qt(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=a.length}const u=t.parse(o,l,r);if(!u)return null;r=r||u.type,a.push(u)}const s=t.parse(e[1],1,qe);if(!s)return null;const o=t.parse(e[e.length-1],e.length-1,r);return o?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new an(n,r,s,i,a,o):null}evaluate(e){const t=this.input.evaluate(e);return(qt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class sn{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r=[];for(let a=1;a<e.length-1;a+=2){const i=t.parse(e[a],a,Oe);if(!i)return null;const s=t.parse(e[a+1],a+1,n);if(!s)return null;r.push([i,s]),n=n||s.type}const i=t.parse(e[e.length-1],e.length-1,n);if(!i)return null;if(!n)throw new Error("Can't infer output type");return new sn(n,r,i)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class on{constructor(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,qe),r=t.parse(e[2],2,je);if(!n||!r)return null;if(!tt(n.type,[Ke(qe),Fe,qe]))return t.error(`Expected first argument to be of type array or string, but found ${Qe(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,je);return i?new on(n.type,n,r,i):null}return new on(n.type,n,r)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let r;if(this.endIndex&&(r=this.endIndex.evaluate(e)),nt(t,["string"]))return[...t].slice(n,r).join("");if(nt(t,["array"]))return t.slice(n,r);throw new Nt(`Expected first argument to be of type array or string, but found ${Qe(qt(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ln(e,t){const n=e.length-1;let r,i,a=0,s=n,o=0;for(;a<=s;)if(o=Math.floor((a+s)/2),r=e[o],i=e[o+1],r<=t){if(o===n||t<i)return o;a=o+1}else{if(!(r>t))throw new Nt("Input is not a number.");s=o-1}return 0}class cn{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,i]of n)this.labels.push(r),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,je);if(!n)return null;const r=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let a=1;a<e.length;a+=2){const n=1===a?-1/0:e[a],s=e[a+1],o=a,l=a+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(r.length&&r[r.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);const c=t.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([n,c])}return new cn(i,n,r)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[ln(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hn,dn,pn=function(){if(dn)return hn;function e(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}return dn=1,hn=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=i/a}var s=0,o=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?s=n:o=n,n=.5*(o-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},hn}(),fn=un(pn);class mn{constructor(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[a,s]of i)this.labels.push(a),this.outputs.push(s)}static interpolationFactor(e,t,n,r){let i=0;if("exponential"===e.name)i=gn(t,e.base,n,r);else if("linear"===e.name)i=gn(t,1,n,r);else if("cubic-bezier"===e.name){const a=e.controlPoints;i=new fn(a[0],a[1],a[2],a[3]).solve(gn(t,1,n,r))}return i}static parse(e,t){let[n,r,i,...a]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,je),!i)return null;const s=[];let o=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||t.expectedType==Ze?t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType):o=Be;for(let l=0;l<a.length;l+=2){const e=a[l],n=a[l+1],r=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,i,o);if(!c)return null;o=o||c.type,s.push([e,c])}return rt(o,je)||rt(o,Ve)||rt(o,Be)||rt(o,He)||rt(o,We)||rt(o,Ze)||rt(o,Ye)||rt(o,Ke(je))?new mn(o,n,r,i,s):t.error(`Type ${Qe(o)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);const a=ln(t,r),s=mn.interpolationFactor(this.interpolation,r,t[a],t[a+1]),o=n[a].evaluate(e),l=n[a+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ct(o,l,s);case"color":return It.interpolate(o,l,s);case"padding":return Dt.interpolate(o,l,s);case"colorArray":return Lt.interpolate(o,l,s);case"numberArray":return Rt.interpolate(o,l,s);case"variableAnchorOffsetCollection":return Ft.interpolate(o,l,s);case"array":return Et(o,l,s);case"projectionDefinition":return Bt.interpolate(o,l,s)}case"interpolate-hcl":switch(this.type.kind){case"color":return It.interpolate(o,l,s,"hcl");case"colorArray":return Lt.interpolate(o,l,s,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return It.interpolate(o,l,s,"lab");case"colorArray":return Lt.interpolate(o,l,s,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function gn(e,t,n,r){const i=r-n,a=e-n;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}const yn={color:It.interpolate,number:Ct,padding:Dt.interpolate,numberArray:Rt.interpolate,colorArray:Lt.interpolate,variableAnchorOffsetCollection:Ft.interpolate,array:Et};class _n{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const r=t.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const s of e.slice(1)){const e=t.parse(s,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,i.push(e)}if(!n)throw new Error("No output type");const a=r&&i.some(e=>et(r,e.type));return new _n(a?qe:n,i)}evaluate(e){let t,n=null,r=0;for(const i of this.args)if(r++,n=i.evaluate(e),n&&n instanceof Ot&&!n.available&&(t||(t=n.name),n=null,r===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function vn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function xn(e,t,n,r){return 0===r.compare(t,n)}function bn(e,t,n){const r="=="!==e&&"!="!==e;return class i{constructor(e,t,n){this.type=Oe,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let a=t.parse(e[1],1,qe);if(!a)return null;if(!vn(n,a.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${Qe(a.type)}'.`);let s=t.parse(e[2],2,qe);if(!s)return null;if(!vn(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${Qe(s.type)}'.`);if(a.type.kind!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Qe(a.type)}' and '${Qe(s.type)}'.`);r&&("value"===a.type.kind&&"value"!==s.type.kind?a=new Zt(s.type,[a]):"value"!==a.type.kind&&"value"===s.type.kind&&(s=new Zt(a.type,[s])));let o=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(o=t.parse(e[3],3,$e),!o)return null}return new i(a,s,o)}evaluate(i){const a=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const t=qt(a),n=qt(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Nt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=qt(a),n=qt(s);if("string"!==e.kind||"string"!==n.kind)return t(i,a,s)}return this.collator?n(i,a,s,this.collator.evaluate(i)):t(i,a,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const wn=bn("==",function(e,t,n){return t===n},xn),Sn=bn("!=",function(e,t,n){return t!==n},function(e,t,n,r){return!xn(0,t,n,r)}),kn=bn("<",function(e,t,n){return t<n},function(e,t,n,r){return r.compare(t,n)<0}),Tn=bn(">",function(e,t,n){return t>n},function(e,t,n,r){return r.compare(t,n)>0}),Cn=bn("<=",function(e,t,n){return t<=n},function(e,t,n,r){return r.compare(t,n)<=0}),En=bn(">=",function(e,t,n){return t>=n},function(e,t,n,r){return r.compare(t,n)>=0});class In{constructor(e,t,n){this.type=$e,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Oe);if(!r)return null;const i=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Oe);if(!i)return null;let a=null;return n.locale&&(a=t.parse(n.locale,1,Fe),!a)?null:new In(r,i,a)}evaluate(e){return new Pt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Pn{constructor(e,t,n,r,i){this.type=Fe,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,je);if(!n)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=t.parse(r.locale,1,Fe),!i))return null;let a=null;if(r.currency&&(a=t.parse(r.currency,1,Fe),!a))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,je),!s))return null;let o=null;return r["max-fraction-digits"]&&(o=t.parse(r["max-fraction-digits"],1,je),!o)?null:new Pn(n,i,a,s,o)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Mn{constructor(e){this.type=Ge,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const r=[];let i=!1;for(let a=1;a<=e.length-1;++a){const n=e[a];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,je),!e))return null;let a=null;if(n["text-font"]&&(a=t.parse(n["text-font"],1,Ke(Fe)),!a))return null;let s=null;if(n["text-color"]&&(s=t.parse(n["text-color"],1,Be),!s))return null;let o=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!Mt.includes(n["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${n["vertical-align"]}' instead.`);if(o=t.parse(n["vertical-align"],1,Fe),!o)return null}const l=r[r.length-1];l.scale=e,l.font=a,l.textColor=s,l.verticalAlign=o}else{const n=t.parse(e[a],1,qe);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Mn(r)}evaluate(e){return new zt(this.sections.map(t=>{const n=t.content.evaluate(e);return qt(n)===Xe?new At("",n,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new At($t(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class An{constructor(e){this.type=Xe,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Fe);return n?new An(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Ot.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class zn{constructor(e){this.type=je,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${Qe(n.type)} instead.`):new zn(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Nt(`Expected value to be of type string or array, but found ${Qe(qt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Dn=8192;function Rn(e,t){const n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*Dn),Math.round(r*i*Dn)]}function Ln(e,t){const n=Math.pow(2,t.z);return[(i=(e[0]/Dn+t.x)/n,360*i-180),(r=(e[1]/Dn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,i}function Nn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function jn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Fn(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],a=e[0]-n[0],s=e[1]-n[1];return r*s-a*i==0&&r*a<=0&&i*s<=0}function On(e,t,n,r){return 0!=(i=[r[0]-n[0],r[1]-n[1]])[0]*(a=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*a[0]&&!(!Gn(e,t,n,r)||!Gn(n,r,e,t));var i,a}function Bn(e,t,n){for(const r of n)for(let n=0;n<r.length-1;++n)if(On(e,t,r[n],r[n+1]))return!0;return!1}function Vn(e,t,n=!1){let r=!1;for(const o of t)for(let t=0;t<o.length-1;t++){if(Fn(e,o[t],o[t+1]))return n;(a=o[t])[1]>(i=e)[1]!=(s=o[t+1])[1]>i[1]&&i[0]<(s[0]-a[0])*(i[1]-a[1])/(s[1]-a[1])+a[0]&&(r=!r)}var i,a,s;return r}function Un(e,t){for(const n of t)if(Vn(e,n))return!0;return!1}function qn(e,t){for(const n of e)if(!Vn(n,t))return!1;for(let n=0;n<e.length-1;++n)if(Bn(e[n],e[n+1],t))return!1;return!0}function $n(e,t){for(const n of t)if(qn(e,n))return!0;return!1}function Gn(e,t,n,r){const i=r[0]-n[0],a=r[1]-n[1],s=(e[0]-n[0])*a-i*(e[1]-n[1]),o=(t[0]-n[0])*a-i*(t[1]-n[1]);return s>0&&o<0||s<0&&o>0}function Hn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const a=[];for(let r=0;r<e[i].length;r++){const s=Rn(e[i][r],n);Nn(t,s),a.push(s)}r.push(a)}return r}function Zn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const a=Hn(e[i],t,n);r.push(a)}return r}function Wn(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){const t=.5*r;let i=e[0]-n[0]>t?-r:n[0]-e[0]>t?r:0;0===i&&(i=e[0]-n[2]>t?-r:n[2]-e[0]>t?r:0),e[0]+=i}Nn(t,e)}function Xn(e,t,n,r){const i=Math.pow(2,r.z)*Dn,a=[r.x*Dn,r.y*Dn],s=[];for(const o of e)for(const e of o){const r=[e.x+a[0],e.y+a[1]];Wn(r,t,n,i),s.push(r)}return s}function Yn(e,t,n,r){const i=Math.pow(2,r.z)*Dn,a=[r.x*Dn,r.y*Dn],s=[];for(const l of e){const e=[];for(const n of l){const r=[n.x+a[0],n.y+a[1]];Nn(t,r),e.push(r)}s.push(e)}if(t[2]-t[0]<=i/2){(o=t)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const e of s)for(const r of e)Wn(r,t,n,i)}var o;return s}class Kn{constructor(e,t){this.type=Oe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const n of t.features){const{type:t,coordinates:r}=n.geometry;"Polygon"===t&&e.push(r),"MultiPolygon"===t&&e.push(...r)}if(e.length)return new Kn(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Kn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Kn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const a=Hn(t.coordinates,r,i),s=Xn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of s)if(!Vn(e,a))return!1}if("MultiPolygon"===t.type){const a=Zn(t.coordinates,r,i),s=Xn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of s)if(!Un(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const a=Hn(t.coordinates,r,i),s=Yn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of s)if(!qn(e,a))return!1}if("MultiPolygon"===t.type){const a=Zn(t.coordinates,r,i),s=Yn(e.geometry(),n,r,i);if(!jn(n,r))return!1;for(const e of s)if(!$n(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Qn=class{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1);const a=r+1;if(a<this.length&&n(t[a],t[r])<0&&(r=a),n(t[r],i)>=0)break;t[e]=t[r],e=r}t[e]=i}};function Jn(e,t,n=0,r=e.length-1,i=tr){for(;r>n;){if(r-n>600){const a=r-n+1,s=t-n+1,o=Math.log(a),l=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*l*(a-l)/a)*(s-a/2<0?-1:1);Jn(e,t,Math.max(n,Math.floor(t-s*l/a+c)),Math.min(r,Math.floor(t+(a-s)*l/a+c)),i)}const a=e[t];let s=n,o=r;for(er(e,n,t),i(e[r],a)>0&&er(e,n,r);s<o;){for(er(e,s,o),s++,o--;i(e[s],a)<0;)s++;for(;i(e[o],a)>0;)o--}0===i(e[n],a)?er(e,n,o):(o++,er(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function er(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function tr(e,t){return e<t?-1:e>t?1:0}function nr(e,t){if(e.length<=1)return[e];const n=[];let r,i;for(const a of e){const e=ir(a);0!==e&&(a.area=Math.abs(e),void 0===i&&(i=e<0),i===e<0?(r&&n.push(r),r=[a]):r.push(a))}if(r&&n.push(r),t>1)for(let a=0;a<n.length;a++)n[a].length<=t||(Jn(n[a],t,1,n[a].length-1,rr),n[a]=n[a].slice(0,t));return n}function rr(e,t){return t.area-e.area}function ir(e){let t=0;for(let n,r,i=0,a=e.length,s=a-1;i<a;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}const ar=1/298.257223563,sr=ar*(2-ar),or=Math.PI/180;class lr{constructor(e){const t=6378.137*or*1e3,n=Math.cos(e*or),r=1/(1-sr*(1-n*n)),i=Math.sqrt(r);this.kx=t*i*n,this.ky=t*i*r*(1-sr)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+r*r)}pointOnLine(e,t){let n,r,i,a,s=1/0;for(let o=0;o<e.length-1;o++){let l=e[o][0],c=e[o][1],u=this.wrap(e[o+1][0]-l)*this.kx,h=(e[o+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[o+1][0],c=e[o+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,n=l,r=c,i=o,a=d)}return{point:[n,r],index:i,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function cr(e,t){return t[0]-e[0]}function ur(e){return e[1]-e[0]+1}function hr(e,t){return e[1]>=e[0]&&e[1]<t}function dr(e,t){if(e[0]>e[1])return[null,null];const n=ur(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===n)return[e,null];const r=Math.floor(n/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}function pr(e,t){if(!hr(t,e.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)Nn(n,e[r]);return n}function fr(e){const t=[1/0,1/0,-1/0,-1/0];for(const n of e)for(const e of n)Nn(t,e);return t}function mr(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function gr(e,t,n){if(!mr(e)||!mr(t))return NaN;let r=0,i=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),n.distance([0,0],[r,i])}function yr(e,t,n){const r=n.pointOnLine(t,e);return n.distance(e,r.point)}function _r(e,t,n,r,i){const a=Math.min(yr(e,[n,r],i),yr(t,[n,r],i)),s=Math.min(yr(n,[e,t],i),yr(r,[e,t],i));return Math.min(a,s)}function vr(e,t,n,r,i){if(!hr(t,e.length)||!hr(r,n.length))return 1/0;let a=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],o=e[s+1];for(let e=r[0];e<r[1];++e){const r=n[e],s=n[e+1];if(On(t,o,r,s))return 0;a=Math.min(a,_r(t,o,r,s,i))}}return a}function xr(e,t,n,r,i){if(!hr(t,e.length)||!hr(r,n.length))return NaN;let a=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(a=Math.min(a,i.distance(e[s],n[t])),0===a)return a;return a}function br(e,t,n){if(Vn(e,t,!0))return 0;let r=1/0;for(const i of t){const t=i[0],a=i[i.length-1];if(t!==a&&(r=Math.min(r,yr(e,[a,t],n)),0===r))return r;const s=n.pointOnLine(i,e);if(r=Math.min(r,n.distance(e,s.point)),0===r)return r}return r}function wr(e,t,n,r){if(!hr(t,e.length))return NaN;for(let a=t[0];a<=t[1];++a)if(Vn(e[a],n,!0))return 0;let i=1/0;for(let a=t[0];a<t[1];++a){const t=e[a],s=e[a+1];for(const e of n)for(let n=0,a=e.length,o=a-1;n<a;o=n++){const a=e[o],l=e[n];if(On(t,s,a,l))return 0;i=Math.min(i,_r(t,s,a,l,r))}}return i}function Sr(e,t){for(const n of e)for(const e of n)if(Vn(e,t,!0))return!0;return!1}function kr(e,t,n,r=1/0){const i=fr(e),a=fr(t);if(r!==1/0&&gr(i,a,n)>=r)return r;if(jn(i,a)){if(Sr(e,t))return 0}else if(Sr(t,e))return 0;let s=1/0;for(const o of e)for(let e=0,r=o.length,i=r-1;e<r;i=e++){const r=o[i],a=o[e];for(const e of t)for(let t=0,i=e.length,o=i-1;t<i;o=t++){const i=e[o],l=e[t];if(On(r,a,i,l))return 0;s=Math.min(s,_r(r,a,i,l,n))}}return s}function Tr(e,t,n,r,i,a){if(!a)return;const s=gr(pr(r,a),i,n);s<t&&e.push([s,a,[0,0]])}function Cr(e,t,n,r,i,a,s){if(!a||!s)return;const o=gr(pr(r,a),pr(i,s),n);o<t&&e.push([o,a,s])}function Er(e,t,n,r,i=1/0){let a=Math.min(r.distance(e[0],n[0][0]),i);if(0===a)return a;const s=new Qn([[0,[0,e.length-1],[0,0]]],cr),o=fr(n);for(;s.length>0;){const i=s.pop();if(i[0]>=a)continue;const l=i[1],c=t?50:100;if(ur(l)<=c){if(!hr(l,e.length))return NaN;if(t){const t=wr(e,l,n,r);if(isNaN(t)||0===t)return t;a=Math.min(a,t)}else for(let t=l[0];t<=l[1];++t){const i=br(e[t],n,r);if(a=Math.min(a,i),0===a)return 0}}else{const n=dr(l,t);Tr(s,a,r,e,o,n[0]),Tr(s,a,r,e,o,n[1])}}return a}function Ir(e,t,n,r,i,a=1/0){let s=Math.min(a,i.distance(e[0],n[0]));if(0===s)return s;const o=new Qn([[0,[0,e.length-1],[0,n.length-1]]],cr);for(;o.length>0;){const a=o.pop();if(a[0]>=s)continue;const l=a[1],c=a[2],u=t?50:100,h=r?50:100;if(ur(l)<=u&&ur(c)<=h){if(!hr(l,e.length)&&hr(c,n.length))return NaN;let a;if(t&&r)a=vr(e,l,n,c,i),s=Math.min(s,a);else if(t&&!r){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(a=yr(n[e],t,i),s=Math.min(s,a),0===s)return s}else if(!t&&r){const t=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(a=yr(e[n],t,i),s=Math.min(s,a),0===s)return s}else a=xr(e,l,n,c,i),s=Math.min(s,a)}else{const a=dr(l,t),u=dr(c,r);Cr(o,s,i,e,n,a[0],u[0]),Cr(o,s,i,e,n,a[0],u[1]),Cr(o,s,i,e,n,a[1],u[0]),Cr(o,s,i,e,n,a[1],u[1])}}return s}function Pr(e){return"MultiPolygon"===e.type?e.coordinates.map(e=>({type:"Polygon",coordinates:e})):"MultiLineString"===e.type?e.coordinates.map(e=>({type:"LineString",coordinates:e})):"MultiPoint"===e.type?e.coordinates.map(e=>({type:"Point",coordinates:e})):[e]}class Mr{constructor(e,t){this.type=je,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new Mr(t,t.features.map(e=>Pr(e.geometry)).flat());if("Feature"===t.type)return new Mr(t,Pr(t.geometry));if("type"in t&&"coordinates"in t)return new Mr(t,Pr(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=e.geometry(),r=n.flat().map(t=>Ln([t.x,t.y],e.canonical));if(0===n.length)return NaN;const i=new lr(r[0][1]);let a=1/0;for(const s of t){switch(s.type){case"Point":a=Math.min(a,Ir(r,!1,[s.coordinates],!1,i,a));break;case"LineString":a=Math.min(a,Ir(r,!1,s.coordinates,!0,i,a));break;case"Polygon":a=Math.min(a,Er(r,!1,s.coordinates,i,a))}if(0===a)return a}return a}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=e.geometry(),r=n.flat().map(t=>Ln([t.x,t.y],e.canonical));if(0===n.length)return NaN;const i=new lr(r[0][1]);let a=1/0;for(const s of t){switch(s.type){case"Point":a=Math.min(a,Ir(r,!0,[s.coordinates],!1,i,a));break;case"LineString":a=Math.min(a,Ir(r,!0,s.coordinates,!0,i,a));break;case"Polygon":a=Math.min(a,Er(r,!0,s.coordinates,i,a))}if(0===a)return a}return a}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const n=e.geometry();if(0===n.length||0===n[0].length)return NaN;const r=nr(n,0).map(t=>t.map(t=>t.map(t=>Ln([t.x,t.y],e.canonical)))),i=new lr(r[0][0][0][1]);let a=1/0;for(const s of t)for(const e of r){switch(s.type){case"Point":a=Math.min(a,Er([s.coordinates],!1,e,i,a));break;case"LineString":a=Math.min(a,Er(s.coordinates,!0,e,i,a));break;case"Polygon":a=Math.min(a,kr(e,s.coordinates,i,a))}if(0===a)return a}return a}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ar{constructor(e){this.type=qe,this.key=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return null==n?t.error("Global state property must be defined."):"string"!=typeof n?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ar(n)}evaluate(e){var t;const n=null===(t=e.globals)||void 0===t?void 0:t.globalState;return n&&0!==Object.keys(n).length?xt(n,this.key):null}eachChild(){}outputDefined(){return!1}}const zr={"==":wn,"!=":Sn,">":Tn,"<":kn,">=":En,"<=":Cn,array:Zt,at:tn,boolean:Zt,case:sn,coalesce:_n,collator:In,format:Mn,image:An,in:nn,"index-of":rn,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:zn,let:Jt,literal:Gt,match:an,number:Zt,"number-format":Pn,object:Zt,slice:on,step:cn,string:Zt,"to-boolean":Xt,"to-color":Xt,"to-number":Xt,"to-string":Xt,var:en,within:Kn,distance:Mr,"global-state":Ar};class Dr{constructor(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],r=Dr.definitions[n];if(!r)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=a.filter(([t])=>!Array.isArray(t)||t.length===e.length-1);let o=null;for(const[l,c]of s){o=new Qt(t.registry,Fr,t.path,null,t.scope);const r=[];let a=!1;for(let t=1;t<e.length;t++){const n=e[t],i=Array.isArray(l)?l[t-1]:l.type,s=o.parse(n,1+r.length,i);if(!s){a=!0;break}r.push(s)}if(!a)if(Array.isArray(l)&&l.length!==r.length)o.error(`Expected ${l.length} arguments, but found ${r.length} instead.`);else{for(let e=0;e<r.length;e++){const t=Array.isArray(l)?l[e]:l.type,n=r[e];o.concat(e+1).checkSubtype(t,n.type)}if(0===o.errors.length)return new Dr(n,i,c,r)}}if(1===s.length)t.errors.push(...o.errors);else{const n=(s.length?s:a).map(([e])=>{return t=e,Array.isArray(t)?`(${t.map(Qe).join(", ")})`:`(${Qe(t.type)}...)`;var t}).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Qe(n.type))}t.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){Dr.definitions=t;for(const n in t)e[n]=Dr}}function Rr(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);const a=i?i.evaluate(e):1,s=Vt(t,n,r,a);if(s)throw new Nt(s);return new It(t/255,n/255,r/255,a,!1)}function Lr(e,t){return e in t}function Nr(e,t){const n=t[e];return void 0===n?null:n}function jr(e){return{type:e}}function Fr(e){if(e instanceof en)return Fr(e.boundExpression);if(e instanceof Dr&&"error"===e.name)return!1;if(e instanceof In)return!1;if(e instanceof Kn)return!1;if(e instanceof Mr)return!1;if(e instanceof Ar)return!1;const t=e instanceof Xt||e instanceof Zt;let n=!0;return e.eachChild(e=>{n=t?n&&Fr(e):n&&e instanceof Gt}),!!n&&Or(e)&&Vr(e,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Or(e){if(e instanceof Dr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Kn)return!1;if(e instanceof Mr)return!1;let t=!0;return e.eachChild(e=>{t&&!Or(e)&&(t=!1)}),t}function Br(e){if(e instanceof Dr&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!Br(e)&&(t=!1)}),t}function Vr(e,t){if(e instanceof Dr&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!Vr(e,t)&&(n=!1)}),n}function Ur(e){return{result:"success",value:e}}function qr(e){return{result:"error",value:e}}function $r(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Gr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Hr(e){return!!e.expression&&e.expression.interpolated}function Zr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Wr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&qt(e)===Ue}function Xr(e){return e}function Yr(e,t){const n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),i=e.type||(Hr(t)?"exponential":"interval"),a=function(e){switch(e.type){case"color":return It.parse;case"padding":return Dt.parse;case"numberArray":return Rt.parse;case"colorArray":return Lt.parse;default:return null}}(t);if(a&&((e=De({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],a(e[1])])),e.default=a(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==(s=e.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${e.colorSpace}"`);var s;const o=function(e){switch(e){case"exponential":return ei;case"interval":return Jr;case"categorical":return Qr;case"identity":return ti;default:throw new Error(`Unknown function type "${e}"`)}}(i);let l,c;if("categorical"===i){l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}if(n){const n={},r=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],a=i[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},r.push(a)),n[a].stops.push([i[0].value,i[1]])}const i=[];for(const e of r)i.push([n[e].zoom,Yr(n[e],t)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:mn.interpolationFactor.bind(void 0,a),zoomStops:i.map(e=>e[0]),evaluate:({zoom:n},r)=>ei({stops:i,base:e.base},t,n).evaluate(n,r)}}if(r){const n="exponential"===i?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:mn.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:({zoom:n})=>o(e,t,n,l,c)}}return{kind:"source",evaluate(n,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?Kr(e.default,t.default):o(e,t,i,l,c)}}}function Kr(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Qr(e,t,n,r,i){return Kr(typeof n===i?r[n]:void 0,e.default,t.default)}function Jr(e,t,n){if("number"!==Zr(n))return Kr(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const i=ln(e.stops.map(e=>e[0]),n);return e.stops[i][1]}function ei(e,t,n){const r=void 0!==e.base?e.base:1;if("number"!==Zr(n))return Kr(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const a=ln(e.stops.map(e=>e[0]),n),s=function(e,t,n,r){const i=r-n,a=e-n;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[a][0],e.stops[a+1][0]),o=e.stops[a][1],l=e.stops[a+1][1],c=yn[t.type]||Xr;return"function"==typeof o.evaluate?{evaluate(...t){const n=o.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return c(n,r,s,e.colorSpace)}}:c(o,l,s,e.colorSpace)}function ti(e,t,n){switch(t.type){case"color":n=It.parse(n);break;case"formatted":n=zt.fromString(n.toString());break;case"resolvedImage":n=Ot.fromString(n.toString());break;case"padding":n=Dt.parse(n);break;case"colorArray":n=Lt.parse(n);break;case"numberArray":n=Rt.parse(n);break;default:Zr(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0)}return Kr(n,e.default,t.default)}Dr.register(zr,{error:[{kind:"error"},[Fe],(e,[t])=>{throw new Nt(t.evaluate(e))}],typeof:[Fe,[qe],(e,[t])=>Qe(qt(t.evaluate(e)))],"to-rgba":[Ke(je,4),[Be],(e,[t])=>{const[n,r,i,a]=t.evaluate(e).rgb;return[255*n,255*r,255*i,a]}],rgb:[Be,[je,je,je],Rr],rgba:[Be,[je,je,je,je],Rr],has:{type:Oe,overloads:[[[Fe],(e,[t])=>Lr(t.evaluate(e),e.properties())],[[Fe,Ue],(e,[t,n])=>Lr(t.evaluate(e),n.evaluate(e))]]},get:{type:qe,overloads:[[[Fe],(e,[t])=>Nr(t.evaluate(e),e.properties())],[[Fe,Ue],(e,[t,n])=>Nr(t.evaluate(e),n.evaluate(e))]]},"feature-state":[qe,[Fe],(e,[t])=>Nr(t.evaluate(e),e.featureState||{})],properties:[Ue,[],e=>e.properties()],"geometry-type":[Fe,[],e=>e.geometryType()],id:[qe,[],e=>e.id()],zoom:[je,[],e=>e.globals.zoom],"heatmap-density":[je,[],e=>e.globals.heatmapDensity||0],elevation:[je,[],e=>e.globals.elevation||0],"line-progress":[je,[],e=>e.globals.lineProgress||0],accumulated:[qe,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[je,jr(je),(e,t)=>{let n=0;for(const r of t)n+=r.evaluate(e);return n}],"*":[je,jr(je),(e,t)=>{let n=1;for(const r of t)n*=r.evaluate(e);return n}],"-":{type:je,overloads:[[[je,je],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[je],(e,[t])=>-t.evaluate(e)]]},"/":[je,[je,je],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[je,[je,je],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[je,[je],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[je,[je],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[je,[je],(e,[t])=>Math.log(t.evaluate(e))],log2:[je,[je],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[je,[je],(e,[t])=>Math.sin(t.evaluate(e))],cos:[je,[je],(e,[t])=>Math.cos(t.evaluate(e))],tan:[je,[je],(e,[t])=>Math.tan(t.evaluate(e))],asin:[je,[je],(e,[t])=>Math.asin(t.evaluate(e))],acos:[je,[je],(e,[t])=>Math.acos(t.evaluate(e))],atan:[je,[je],(e,[t])=>Math.atan(t.evaluate(e))],min:[je,jr(je),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[je,jr(je),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[je,[je],(e,[t])=>Math.abs(t.evaluate(e))],round:[je,[je],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[je,[je],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[je,[je],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Oe,[Fe,qe],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Oe,[qe],(e,[t])=>e.id()===t.value],"filter-type-==":[Oe,[Fe],(e,[t])=>e.geometryType()===t.value],"filter-<":[Oe,[Fe,qe],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[Oe,[qe],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<r}],"filter->":[Oe,[Fe,qe],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[Oe,[qe],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>r}],"filter-<=":[Oe,[Fe,qe],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[Oe,[qe],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<=r}],"filter->=":[Oe,[Fe,qe],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[Oe,[qe],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>=r}],"filter-has":[Oe,[qe],(e,[t])=>t.value in e.properties()],"filter-has-id":[Oe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Oe,[Ke(Fe)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Oe,[Ke(qe)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Oe,[Fe,Ke(qe)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Oe,[Fe,Ke(qe)],(e,[t,n])=>function(e,t,n,r){for(;n<=r;){const i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Oe,overloads:[[[Oe,Oe],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[jr(Oe),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Oe,overloads:[[[Oe,Oe],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[jr(Oe),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Oe,[Oe],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Oe,[Fe],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Fe,jr(qe),(e,t)=>t.map(t=>$t(t.evaluate(e))).join("")],"resolved-locale":[Fe,[$e],(e,[t])=>t.evaluate(e).resolvedLocale()]});class ni{constructor(e,t,n){this.expression=e,this._warningHistory={},this._evaluator=new Kt,this._defaultValue=t?function(e){if("color"===e.type&&Wr(e.default))return new It(0,0,0,0);switch(e.type){case"color":return It.parse(e.default)||null;case"padding":return Dt.parse(e.default)||null;case"numberArray":return Rt.parse(e.default)||null;case"colorArray":return Lt.parse(e.default)||null;case"variableAnchorOffsetCollection":return Ft.parse(e.default)||null;case"projectionDefinition":return Bt.parse(e.default)||null;default:return void 0===e.default?null:e.default}}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this._globalState=n}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._globalState&&(e=hi(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,r,i,a){this._globalState&&(e=hi(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Nt(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0),this._defaultValue}}}function ri(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in zr}function ii(e,t,n){const r=new Qt(zr,Fr,[],t?function(e){const t={color:Be,string:Fe,number:je,enum:Fe,boolean:Oe,formatted:Ge,padding:He,numberArray:We,colorArray:Ze,projectionDefinition:Ve,resolvedImage:Xe,variableAnchorOffsetCollection:Ye};return"array"===e.type?Ke(t[e.value]||qe,e.length):t[e.type]}(t):void 0),i=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Ur(new ni(i,t,n)):qr(r.errors)}class ai{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Br(t.expression),this.globalStateRefs=ui(t.expression),this._globalState=n}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._globalState&&(e=hi(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}evaluate(e,t,n,r,i,a){return this._globalState&&(e=hi(e,this._globalState)),this._styleExpression.evaluate(e,t,n,r,i,a)}}class si{constructor(e,t,n,r,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Br(t.expression),this.globalStateRefs=ui(t.expression),this.interpolationType=r,this._globalState=i}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._globalState&&(e=hi(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}evaluate(e,t,n,r,i,a){return this._globalState&&(e=hi(e,this._globalState)),this._styleExpression.evaluate(e,t,n,r,i,a)}interpolationFactor(e,t,n){return this.interpolationType?mn.interpolationFactor(this.interpolationType,e,t,n):0}}function oi(e,t,n){const r=ii(e,t,n);if("error"===r.result)return r;const i=r.value.expression,a=Or(i);if(!a&&!$r(t))return qr([new Re("","data expressions not supported")]);const s=Vr(i,["zoom"]);if(!s&&!Gr(t))return qr([new Re("","zoom expressions not supported")]);const o=ci(i);return o||s?o instanceof Re?qr([o]):o instanceof mn&&!Hr(t)?qr([new Re("",'"interpolate" expressions cannot be used with this property')]):Ur(o?new si(a?"camera":"composite",r.value,o.labels,o instanceof mn?o.interpolation:void 0,n):new ai(a?"constant":"source",r.value,n)):qr([new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class li{constructor(e,t){this._parameters=e,this._specification=t,De(this,Yr(this._parameters,this._specification))}static deserialize(e){return new li(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ci(e){let t=null;if(e instanceof Jt)t=ci(e.result);else if(e instanceof _n){for(const n of e.args)if(t=ci(n),t)break}else(e instanceof cn||e instanceof mn)&&e.input instanceof Dr&&"zoom"===e.input.name&&(t=e);return t instanceof Re||e.eachChild(e=>{const n=ci(e);n instanceof Re?t=n:!t&&n?t=new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new Re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ui(e,t=new Set){return e instanceof Ar&&t.add(e.key),e.eachChild(e=>{ui(e,t)}),t}function hi(e,t){const{zoom:n,heatmapDensity:r,elevation:i,lineProgress:a,isSupportedScript:s,accumulated:o}=null!=e?e:{};return{zoom:n,heatmapDensity:r,elevation:i,lineProgress:a,isSupportedScript:s,accumulated:o,globalState:t}}function di(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!di(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const pi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fi(e,t){if(null==e)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};di(e)||(e=yi(e));const n=ii(e,pi,t);if("error"===n.result)throw new Error(n.value.map(e=>`${e.key}: ${e.message}`).join(", "));return{filter:(e,t,r)=>n.value.evaluate(e,t,{},r),needGeometry:gi(e),getGlobalStateRefs:()=>ui(n.value.expression)}}function mi(e,t){return e<t?-1:e>t?1:0}function gi(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(gi(e[t]))return!0;return!1}function yi(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?_i(e[1],e[2],"=="):"!="===t?bi(_i(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?_i(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(yi))):"all"===t?["all"].concat(e.slice(1).map(yi)):"none"===t?["all"].concat(e.slice(1).map(yi).map(bi)):"in"===t?vi(e[1],e.slice(2)):"!in"===t?bi(vi(e[1],e.slice(2))):"has"===t?xi(e[1]):"!has"!==t||bi(xi(e[1]));var n}function _i(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function vi(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(mi)]]:["filter-in-small",e,["literal",t]]}}function xi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function bi(e){return["!",e]}function wi(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+=`${wi(n)},`;return`${t}]`}const n=Object.keys(e).sort();let r="{";for(let i=0;i<n.length;i++)r+=`${JSON.stringify(n[i])}:${wi(e[n[i]])},`;return`${r}}`}function Si(e){let t="";for(const n of be)t+=`/${wi(e[n])}`;return t}function ki(e){const t=e.value;return t?[new ze(e.key,t,"constants have been deprecated as of v8")]:[]}function Ti(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ci(e){if(Array.isArray(e))return e.map(Ci);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ci(e[n]);return t}return Ti(e)}function Ei(e){const t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,s=e.styleSpec,o=e.validateSpec;let l=[];const c=Zr(n);if("object"!==c)return[new ze(t,n,`object expected, ${c} found`)];for(const u in n){const e=u.split(".")[0],c=xt(r,e)||r["*"];let h;if(xt(i,e))h=i[e];else if(xt(r,e)){if(void 0===n[u])continue;h=o}else if(i["*"])h=i["*"];else{if(!r["*"]){l.push(new ze(t,n[u],`unknown property "${u}"`));continue}h=o}l=l.concat(h({key:(t?`${t}.`:t)+u,value:n[u],valueSpec:c,style:a,styleSpec:s,object:n,objectKey:u,validateSpec:o},n))}for(const u in r)i[u]||r[u].required&&void 0===r[u].default&&void 0===n[u]&&l.push(new ze(t,n,`missing required property "${u}"`));return l}function Ii(e){const t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,a=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==Zr(t))return[new ze(a,t,`array expected, ${Zr(t)} found`)];if(n.length&&t.length!==n.length)return[new ze(a,t,`array length ${n.length} expected, length ${t.length} found`)];let o={type:n.value,values:n.values};i.$version<7&&(o.function=n.function),"object"===Zr(n.value)&&(o=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(s({array:t,arrayIndex:c,value:t[c],valueSpec:o,validateSpec:e.validateSpec,style:r,styleSpec:i,key:`${a}[${c}]`}));return l}function Pi(e){const t=e.key,n=e.value,r=e.valueSpec;let i=Zr(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new ze(t,n,`number expected, ${i} found`)]:"minimum"in r&&n<r.minimum?[new ze(t,n,`${n} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&n>r.maximum?[new ze(t,n,`${n} is greater than the maximum value ${r.maximum}`)]:[]}function Mi(e){const t=e.valueSpec,n=Ti(e.value.type);let r,i,a,s={};const o="categorical"!==n&&void 0===e.value.property,l=!o,c="array"===Zr(e.value.stops)&&"array"===Zr(e.value.stops[0])&&"object"===Zr(e.value.stops[0][0]),u=Ei({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new ze(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(Ii({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Zr(r)&&0===r.length&&t.push(new ze(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&o&&u.push(new ze(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new ze(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Hr(e.valueSpec)&&u.push(new ze(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!$r(e.valueSpec)?u.push(new ze(e.key,e.value,"property functions not supported")):o&&!Gr(e.valueSpec)&&u.push(new ze(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new ze(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const r=e.value,o=e.key;if("array"!==Zr(r))return[new ze(o,r,`array expected, ${Zr(r)} found`)];if(2!==r.length)return[new ze(o,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Zr(r[0]))return[new ze(o,r,`object expected, ${Zr(r[0])} found`)];if(void 0===r[0].zoom)return[new ze(o,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new ze(o,r,"object stop key must have value")];if(a&&a>Ti(r[0].zoom))return[new ze(o,r[0].zoom,"stop zoom values must appear in ascending order")];Ti(r[0].zoom)!==a&&(a=Ti(r[0].zoom),i=void 0,s={}),n=n.concat(Ei({key:`${o}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Pi,value:d}}))}else n=n.concat(d({key:`${o}[0]`,value:r[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return ri(Ci(r[1]))?n.concat([new ze(`${o}[1]`,r[1],"expressions are not allowed in function stops.")]):n.concat(e.validateSpec({key:`${o}[1]`,value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,a){const o=Zr(e.value),l=Ti(e.value),c=null!==e.value?e.value:a;if(r){if(o!==r)return[new ze(e.key,c,`${o} stop domain type must match previous stop domain type ${r}`)]}else r=o;if("number"!==o&&"string"!==o&&"boolean"!==o)return[new ze(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==o&&"categorical"!==n){let r=`number expected, ${o} found`;return $r(t)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(e.key,c,r)]}return"categorical"!==n||"number"!==o||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===o&&void 0!==i&&l<i?[new ze(e.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===n&&l in s?[new ze(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new ze(e.key,c,`integer expected, found ${l}`)]}}function Ai(e){const t=("property"===e.expressionContext?oi:ii)(Ci(e.value),e.valueSpec);if("error"===t.result)return t.value.map(t=>new ze(`${e.key}${t.key}`,e.value,t.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new ze(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Br(n))return[new ze(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Br(n))return[new ze(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Vr(n,["zoom","feature-state"]))return[new ze(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Or(n))return[new ze(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zi(e){const t=e.key,n=e.value,r=Zr(n);return"string"!==r?[new ze(t,n,`color expected, ${r} found`)]:It.parse(String(n))?[]:[new ze(t,n,`color expected, "${n}" found`)]}function Di(e){const t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ti(n))&&i.push(new ze(t,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(Ti(n))&&i.push(new ze(t,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),i}function Ri(e){return di(Ci(e.value))?Ai(De({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Li(e)}function Li(e){const t=e.value,n=e.key;if("array"!==Zr(t))return[new ze(n,t,`array expected, ${Zr(t)} found`)];const r=e.styleSpec;let i,a=[];if(t.length<1)return[new ze(n,t,"filter array must have at least 1 element")];switch(a=a.concat(Di({key:`${n}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ti(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ti(t[1])&&a.push(new ze(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&a.push(new ze(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Zr(t[1]),"string"!==i&&a.push(new ze(`${n}[1]`,t[1],`string expected, ${i} found`)));for(let s=2;s<t.length;s++)i=Zr(t[s]),"$type"===Ti(t[1])?a=a.concat(Di({key:`${n}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new ze(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)a=a.concat(Li({key:`${n}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Zr(t[1]),2!==t.length?a.push(new ze(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&a.push(new ze(`${n}[1]`,t[1],`string expected, ${i} found`))}return a}function Ni(e,t){const n=e.key,r=e.validateSpec,i=e.style,a=e.styleSpec,s=e.value,o=e.objectKey,l=a[`${t}_${e.layerType}`];if(!l)return[];const c=o.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return r({key:n,value:s,valueSpec:a.transition,style:i,styleSpec:a});const u=e.valueSpec||l[o];if(!u)return[new ze(n,s,`unknown property "${o}"`)];let h;if("string"===Zr(s)&&$r(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new ze(n,s,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&"text-font"===o&&Wr(Ci(s))&&"identity"===Ti(s.type)&&d.push(new ze(n,s,'"text-font" does not support identity functions')),d.concat(r({key:e.key,value:s,valueSpec:u,style:i,styleSpec:a,expressionContext:"property",propertyType:t,propertyKey:o}))}function ji(e){return Ni(e,"paint")}function Fi(e){return Ni(e,"layout")}function Oi(e){let t=[];const n=e.value,r=e.key,i=e.style,a=e.styleSpec;if("object"!==Zr(n))return[new ze(r,n,`object expected, ${Zr(n)} found`)];n.type||n.ref||t.push(new ze(r,n,'either "type" or "ref" is required'));let s=Ti(n.type);const o=Ti(n.ref);if(n.id){const a=Ti(n.id);for(let s=0;s<e.arrayIndex;s++){const e=i.layers[s];Ti(e.id)===a&&t.push(new ze(r,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach(e=>{e in n&&t.push(new ze(r,n[e],`"${e}" is prohibited for ref layers`))}),i.layers.forEach(t=>{Ti(t.id)===o&&(e=t)}),e?e.ref?t.push(new ze(r,n.ref,"ref cannot reference another ref layer")):s=Ti(e.type):t.push(new ze(r,n.ref,`ref layer "${o}" not found`))}else if("background"!==s)if(n.source){const e=i.sources&&i.sources[n.source],a=e&&Ti(e.type);e?"vector"===a&&"raster"===s?t.push(new ze(r,n.source,`layer "${n.id}" requires a raster source`)):"raster-dem"!==a&&"hillshade"===s||"raster-dem"!==a&&"color-relief"===s?t.push(new ze(r,n.source,`layer "${n.id}" requires a raster-dem source`)):"raster"===a&&"raster"!==s?t.push(new ze(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==s&&"color-relief"!==s?t.push(new ze(r,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===a&&e.lineMetrics||t.push(new ze(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ze(r,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new ze(r,n.source,`source "${n.source}" not found`))}else t.push(new ze(r,n,'missing required property "source"'));return t=t.concat(Ei({key:r,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${r}.type`,value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:n,objectKey:"type"}),filter:Ri,layout:e=>Ei({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Fi(De({layerType:s},e))}}),paint:e=>Ei({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>ji(De({layerType:s},e))}})}})),t}function Bi(e){const t=e.value,n=e.key,r=Zr(t);return"string"!==r?[new ze(n,t,`string expected, ${r} found`)]:[]}const Vi={promoteId:function({key:e,value:t}){if("string"===Zr(t))return Bi({key:e,value:t});{const n=[];for(const r in t)n.push(...Bi({key:`${e}.${r}`,value:t[r]}));return n}}};function Ui(e){const t=e.value,n=e.key,r=e.styleSpec,i=e.style,a=e.validateSpec;if(!t.type)return[new ze(n,t,'"type" is required')];const s=Ti(t.type);let o;switch(s){case"vector":case"raster":return o=Ei({key:n,value:t,valueSpec:r[`source_${s.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Vi,validateSpec:a}),o;case"raster-dem":return o=function(e){var t;const n=null!==(t=e.sourceName)&&void 0!==t?t:"",r=e.value,i=e.styleSpec,a=i.source_raster_dem,s=e.style;let o=[];const l=Zr(r);if(void 0===r)return o;if("object"!==l)return o.push(new ze("source_raster_dem",r,`object expected, ${l} found`)),o;const c="custom"===Ti(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const d in r)!c&&u.includes(d)?o.push(new ze(d,r[d],`In "${n}": "${d}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):a[d]?o=o.concat(e.validateSpec({key:d,value:r[d],valueSpec:a[d],validateSpec:e.validateSpec,style:s,styleSpec:i})):o.push(new ze(d,r[d],`unknown property "${d}"`));return o}({sourceName:n,value:t,style:e.style,styleSpec:r,validateSpec:a}),o;case"geojson":if(o=Ei({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,validateSpec:a,objectElementValidators:Vi}),t.cluster)for(const e in t.clusterProperties){const[r,i]=t.clusterProperties[e],a="string"==typeof r?[r,["accumulated"],["get",e]]:r;o.push(...Ai({key:`${n}.${e}.map`,value:i,expressionContext:"cluster-map"})),o.push(...Ai({key:`${n}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return o;case"video":return Ei({key:n,value:t,valueSpec:r.source_video,style:i,validateSpec:a,styleSpec:r});case"image":return Ei({key:n,value:t,valueSpec:r.source_image,style:i,validateSpec:a,styleSpec:r});case"canvas":return[new ze(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Di({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function qi(e){const t=e.value,n=e.styleSpec,r=n.light,i=e.style;let a=[];const s=Zr(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new ze("light",t,`object expected, ${s} found`)]),a;for(const o in t){const s=o.match(/^(.*)-transition$/);a=a.concat(s&&r[s[1]]&&r[s[1]].transition?e.validateSpec({key:o,value:t[o],valueSpec:n.transition,validateSpec:e.validateSpec,style:i,styleSpec:n}):r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new ze(o,t[o],`unknown property "${o}"`)])}return a}function $i(e){const t=e.value,n=e.styleSpec,r=n.sky,i=e.style,a=Zr(t);if(void 0===t)return[];if("object"!==a)return[new ze("sky",t,`object expected, ${a} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:i,styleSpec:n}):[new ze(o,t[o],`unknown property "${o}"`)]);return s}function Gi(e){const t=e.value,n=e.styleSpec,r=n.terrain,i=e.style;let a=[];const s=Zr(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new ze("terrain",t,`object expected, ${s} found`)]),a;for(const o in t)a=a.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new ze(o,t[o],`unknown property "${o}"`)]);return a}function Hi(e){let t=[];const n=e.value,r=e.key;if(Array.isArray(n)){const i=[],a=[];for(const s in n)n[s].id&&i.includes(n[s].id)&&t.push(new ze(r,n,`all the sprites' ids must be unique, but ${n[s].id} is duplicated`)),i.push(n[s].id),n[s].url&&a.includes(n[s].url)&&t.push(new ze(r,n,`all the sprites' URLs must be unique, but ${n[s].url} is duplicated`)),a.push(n[s].url),t=t.concat(Ei({key:`${r}[${s}]`,value:n[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Bi({key:r,value:n})}function Zi(e){return Boolean(e)&&e.constructor===Object}function Wi(e){return Zi(e.value)?[]:[new ze(e.key,e.value,`object expected, ${Zr(e.value)} found`)]}const Xi={"*":()=>[],array:Ii,boolean:function(e){const t=e.value,n=e.key,r=Zr(t);return"boolean"!==r?[new ze(n,t,`boolean expected, ${r} found`)]:[]},number:Pi,color:zi,constants:ki,enum:Di,filter:Ri,function:Mi,layer:Oi,object:Ei,source:Ui,light:qi,sky:$i,terrain:Gi,projection:function(e){const t=e.value,n=e.styleSpec,r=n.projection,i=e.style,a=Zr(t);if(void 0===t)return[];if("object"!==a)return[new ze("projection",t,`object expected, ${a} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:i,styleSpec:n}):[new ze(o,t[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(e){const t=e.key;let n=e.value;n=n instanceof String?n.valueOf():n;const r=Zr(n);return"array"!==r||(i=n,Array.isArray(i)&&3===i.length&&"string"==typeof i[0]&&"string"==typeof i[1]&&"number"==typeof i[2])||function(e){return!!["interpolate","step","literal"].includes(e[0])}(n)?["array","string"].includes(r)?[]:[new ze(t,n,`projection expected, invalid type "${r}" found`)]:[new ze(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)];var i},string:Bi,formatted:function(e){return 0===Bi(e).length?[]:Ai(e)},resolvedImage:function(e){return 0===Bi(e).length?[]:Ai(e)},padding:function(e){const t=e.key,n=e.value;if("array"===Zr(n)){if(n.length<1||n.length>4)return[new ze(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const r={type:"number"};let i=[];for(let a=0;a<n.length;a++)i=i.concat(e.validateSpec({key:`${t}[${a}]`,value:n[a],validateSpec:e.validateSpec,valueSpec:r}));return i}return Pi({key:t,value:n,valueSpec:{}})},numberArray:function(e){const t=e.key,n=e.value;if("array"===Zr(n)){const r={type:"number"};if(n.length<1)return[new ze(t,n,"array length at least 1 expected, length 0 found")];let i=[];for(let a=0;a<n.length;a++)i=i.concat(e.validateSpec({key:`${t}[${a}]`,value:n[a],validateSpec:e.validateSpec,valueSpec:r}));return i}return Pi({key:t,value:n,valueSpec:{}})},colorArray:function(e){const t=e.key,n=e.value;if("array"===Zr(n)){if(n.length<1)return[new ze(t,n,"array length at least 1 expected, length 0 found")];let e=[];for(let r=0;r<n.length;r++)e=e.concat(zi({key:`${t}[${r}]`,value:n[r]}));return e}return zi({key:t,value:n})},variableAnchorOffsetCollection:function(e){const t=e.key,n=e.value,r=Zr(n),i=e.styleSpec;if("array"!==r||n.length<1||n.length%2!=0)return[new ze(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let s=0;s<n.length;s+=2)a=a.concat(Di({key:`${t}[${s}]`,value:n[s],valueSpec:i.layout_symbol["text-anchor"]})),a=a.concat(Ii({key:`${t}[${s+1}]`,value:n[s+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:i}));return a},sprite:Hi,state:Wi,fontFaces:function(e){const t=e.key,n=e.value,r=e.validateSpec,i=e.styleSpec,a=e.style;if(!Zi(n))return[new ze(t,n,`object expected, ${Zr(n)} found`)];const s=[];for(const o in n){const e=n[o],l=Zr(e);if("string"===l)s.push(...Bi({key:`${t}.${o}`,value:e}));else if("array"===l){const n={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[l,c]of e.entries())s.push(...Ei({key:`${t}.${o}[${l}]`,value:c,valueSpec:n,styleSpec:i,style:a,validateSpec:r}))}else s.push(new ze(`${t}.${o}`,e,`string or array expected, ${l} found`))}return s}};function Yi(e){const t=e.value,n=e.valueSpec,r=e.styleSpec;return e.validateSpec=Yi,n.expression&&Wr(Ti(t))?Mi(e):n.expression&&ri(Ci(t))?Ai(e):n.type&&Xi[n.type]?Xi[n.type](e):Ei(De({},e,{valueSpec:n.type?r[n.type]:n}))}function Ki(e){const t=e.value,n=e.key,r=Bi(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new ze(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new ze(n,t,'"glyphs" url must include a "{range}" token'))),r}function Qi(e,t=xe){let n=[];return n=n.concat(Yi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Yi,objectElementValidators:{glyphs:Ki,"*":()=>[]}})),e.constants&&(n=n.concat(ki({key:"constants",value:e.constants}))),ea(n)}function Ji(e){return function(t){return e(Object.assign({},t,{validateSpec:Yi}))}}function ea(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function ta(e){return function(...t){return ea(e.apply(this,t))}}Qi.source=ta(Ji(Ui)),Qi.sprite=ta(Ji(Hi)),Qi.glyphs=ta(Ji(Ki)),Qi.light=ta(Ji(qi)),Qi.sky=ta(Ji($i)),Qi.terrain=ta(Ji(Gi)),Qi.state=ta(Ji(Wi)),Qi.layer=ta(Ji(Oi)),Qi.filter=ta(Ji(Ri)),Qi.paintProperty=ta(Ji(ji)),Qi.layoutProperty=ta(Ji(Fi));const na={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class ra{constructor(e,t){this._globalState=t,this.setValue(e)}evaluate(){var e;return null!==(e=this._literalValue)&&void 0!==e?e:this._compiledValue.evaluate({})}setValue(e){if(null==e||"visible"===e||"none"===e)return this._literalValue="none"===e?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const t=ii(e,na,this._globalState);if("error"===t.result)throw this._literalValue="visible",this._compiledValue=void 0,new Error(t.value.map(e=>`${e.key}: ${e.message}`).join(", "));this._literalValue=void 0,this._compiledValue=t.value,this._globalStateRefs=ui(t.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ia=xe,aa=Qi,sa=aa.light,oa=aa.sky,la=aa.paintProperty,ca=aa.layoutProperty;function ua(e,t){let n=!1;if(t&&t.length)for(const r of t)e.fire(new _e(new Error(r.message))),n=!0;return n}class ha{constructor(e,t,n){const r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(let e=0;e<this.d*this.d;e++){const t=i[3+e],n=i[3+e+1];r.push(t===n?null:i.subarray(t,n))}const a=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],a),this.bboxes=i.subarray(a),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let e=0;e<this.d*this.d;e++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;const i=n/t*e;this.min=-i,this.max=e+i}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,n,r,i,a){this.cells[i].push(a)}query(e,t,n,r,i){const a=this.min,s=this.max;if(e<=a&&t<=a&&s<=n&&s<=r&&!i)return Array.prototype.slice.call(this.keys);{const a=[];return this._forEachCell(e,t,n,r,this._queryCell,a,{},i),a}}_queryCell(e,t,n,r,i,a,s,o){const l=this.cells[i];if(null!==l){const i=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(o?o(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&n>=c[l+0]&&r>=c[l+1])?(s[h]=!0,a.push(i[h])):s[h]=!1}}}}_forEachCell(e,t,n,r,i,a,s,o){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!o||o(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&i.call(this,e,t,n,r,c,a,s,o))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let n=0;for(let a=0;a<this.cells.length;a++)n+=this.cells[a].length;const r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let i=t;for(let a=0;a<e.length;a++){const t=e[a];r[3+a]=i,r.set(t,i),i+=t.length}return r[3+e.length]=i,r.set(this.keys,i),i+=this.keys.length,r[3+e.length+1]=i,r.set(this.bboxes,i),i+=this.bboxes.length,r.buffer}static serialize(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new ha(e.buffer)}}const da={};function pa(e,t,n={}){if(da[e])throw new Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),da[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}pa("Object",Object),pa("Set",Set),pa("TransferableGridIndex",ha),pa("Color",It),pa("Error",Error),pa("AJAXError",he),pa("ResolvedImage",Ot),pa("StylePropertyFunction",li),pa("StyleExpression",ni,{omit:["_evaluator"]}),pa("ZoomDependentExpression",si),pa("ZoomConstantExpression",ai),pa("CompoundExpression",Dr,{omit:["_evaluate"]});for(const t in zr)zr[t]._classRegistryKey||pa(`Expression_${t}`,zr[t]);function fa(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ma(e){return e.$name||e.constructor._classRegistryKey}function ga(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const t=ma(e);return!(!t||"Object"===t)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||fa(e)||X(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function ya(e,t){if(ga(e))return(fa(e)||X(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const r of e)n.push(ya(r,t));return n}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const n=ma(e);if(!n)throw new Error(`can't serialize object of unregistered class ${e.constructor.name}`);if(!da[n])throw new Error(`${n} is not registered.`);const{klass:r}=da[n],i=r.serialize?r.serialize(e,t):{};if(r.serialize){if(t&&i===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const r in e){if(!e.hasOwnProperty(r))continue;if(da[n].omit.indexOf(r)>=0)continue;const a=e[r];i[r]=da[n].shallow.indexOf(r)>=0?a:ya(a,t)}e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}function _a(e){if(ga(e))return e;if(Array.isArray(e))return e.map(_a);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const t=ma(e)||"Object";if(!da[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=da[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const r=Object.create(n.prototype);for(const i of Object.keys(e)){if("$name"===i)continue;const n=e[i];r[i]=da[t].shallow.indexOf(i)>=0?n:_a(n)}return r}class va{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}function xa(e){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function ba(e){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function wa(e){return/\s/u.test(String.fromCodePoint(e))}function Sa(e){for(const t of e)if(ba(t.codePointAt(0)))return!0;return!1}function ka(e){for(const t of e)if(!Ea(t.codePointAt(0)))return!1;return!0}function Ta(e){const t=e.map(e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(t){return null}}).filter(e=>e);return new RegExp(t.join("|"),"u")}const Ca=Ta(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ea(e){return!Ca.test(String.fromCodePoint(e))}function Ia(e){return!(ba(e)||(t=e,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}const Pa=Ta(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ma(e){return Pa.test(String.fromCodePoint(e))}function Aa(e,t){return!(!t&&Ma(e)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(e)))}function za(e){for(const t of e)if(Ma(t.codePointAt(0)))return!0;return!1}const Da=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(Da.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,t){return n(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const n=e.pluginURL,r=new Promise(e=>{this.loadScriptResolve=e});t(n);const i=new Promise(e=>setTimeout(()=>e(),this.TIMEOUT));if(yield Promise.race([r,i]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:n};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class Ra{constructor(e,t){this.isSupportedScript=La,this.zoom=e,t?(this.now=t.now||0,this.fadeDuration=t.fadeDuration||0,this.zoomHistory=t.zoomHistory||new va,this.transition=t.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new va,this.transition={})}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}function La(e){return function(e,t){for(const n of e)if(!Aa(n.codePointAt(0),t))return!1;return!0}(e,"loaded"===Da.getRTLTextPluginStatus())}const Na="-transition";class ja{constructor(e,t,n){this.property=e,this.value=t,this.expression=function(e,t,n){if(Wr(e))return new li(e,t);if(ri(e)){const r=oi(e,t,n);if("error"===r.result)throw new Error(r.value.map(e=>`${e.key}: ${e.message}`).join(", "));return r.value}{let n=e;return"color"===t.type&&"string"==typeof e?n=It.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"numberArray"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"colorArray"!==t.type||"string"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?n=Ft.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(n=Bt.parse(e)):n=Lt.parse(e):n=Rt.parse(e):n=Dt.parse(e),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Fa{constructor(e,t){this.property=e,this.value=new ja(e,void 0,t)}transitioned(e,t){return new Ba(this.property,this.value,t,O({},e.transition,this.transition),e.now)}untransitioned(){return new Ba(this.property,this.value,null,{},0)}}class Oa{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=t}getValue(e){return q(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fa(this._values[e].property,this._globalState)),this._values[e].value=new ja(this._values[e].property,null===t?void 0:q(t),this._globalState)}getTransition(e){return q(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fa(this._values[e].property,this._globalState)),this._values[e].transition=q(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const r=this.getTransition(t);void 0!==r&&(e[`${t}${Na}`]=r)}return e}transitioned(e,t){const n=new Va(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(e,t._values[r]);return n}untransitioned(){const e=new Va(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ba{constructor(e,t,n,r,i){this.property=e,this.value=t,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return a.possiblyEvaluate(e,t,n);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),i,R(s))}}return i}}class Va{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const r=new $a(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ua{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=t}hasValue(e){return void 0!==this._values[e].value}getValue(e){return q(this._values[e].value)}setValue(e,t){this._values[e]=new ja(this._values[e].property,null===t?void 0:q(t),this._globalState)}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const r=new $a(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}}class qa{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}class $a{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ga{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,n){const r=yn[this.specification.type];return r?r(e,t,n):e}}class Ha{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,r){return new qa(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new qa(this,{kind:"constant",value:void 0},e.parameters);const r=yn[this.specification.type];if(r){const i=r(e.value.value,t.value.value,n);return new qa(this,{kind:"constant",value:i},e.parameters)}return e}evaluate(e,t,n,r,i,a){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,a)}}class Za extends Ha{possiblyEvaluate(e,t,n,r){if(void 0===e.value)return new qa(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},n,r),a="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,s=this._calculate(a,a,a,t);return new qa(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new qa(this,{kind:"constant",value:n},t)}return new qa(this,e.expression,t)}evaluate(e,t,n,r,i,a){if("source"===e.kind){const s=e.evaluate(t,n,r,i,a);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Wa{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){if(void 0!==e.value){if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new Ra(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Ra(Math.floor(t.zoom),t)),e.expression.evaluate(new Ra(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Xa{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}interpolate(){return!1}}class Ya{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const r=this.defaultPropertyValues[t]=new ja(n,void 0,void 0),i=this.defaultTransitionablePropertyValues[t]=new Fa(n,void 0);this.defaultTransitioningPropertyValues[t]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}pa("DataDrivenProperty",Ha),pa("DataConstantProperty",Ga),pa("CrossFadedDataDrivenProperty",Za),pa("CrossFadedProperty",Wa),pa("ColorRampProperty",Xa);class Ka extends ve{constructor(e,t,n){if(super(),this.id=e.id,this.type=e.type,this._globalState=n,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(r=this.visibility,new ra(r,n)),"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=fi(e.filter,n)),t.layout&&(this._unevaluatedLayout=new Ua(t.layout,n)),t.paint)){this._transitionablePaint=new Oa(t.paint,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $a(t.paint)}var r}setFilter(e){this.filter=e,this._featureFilter=fi(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const t of this._visibilityExpression.getGlobalStateRefs())e.add(t);if(this._unevaluatedLayout)for(const t in this._unevaluatedLayout._values){const n=this._unevaluatedLayout._values[t];for(const t of n.getGlobalStateRefs())e.add(t)}for(const t of this._featureFilter.getGlobalStateRefs())e.add(t);return e}getPaintAffectingGlobalStateRefs(){var e;const t=new globalThis.Map;if(this._transitionablePaint)for(const n in this._transitionablePaint._values){const r=this._transitionablePaint._values[n].value;for(const i of r.getGlobalStateRefs()){const a=null!==(e=t.get(i))&&void 0!==e?e:[];a.push({name:n,value:r.value}),t.set(i,a)}}return t}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,t,n={}){if(null==t||!this._validate(ca,`layers.${this.id}.layout.${e}`,e,t,n))return"visibility"===e?(this.visibility=t,this._visibilityExpression.setValue(t),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,t)}getPaintProperty(e){return e.endsWith(Na)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(la,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(e.endsWith(Na))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const n=this._transitionablePaint._values[e],r="cross-faded-data-driven"===n.property.specification["property-type"],i=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||i||r||this._handleOverridablePaintPropertyUpdate(e,a,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e=this.minzoom,t=!1){return!!(this.minzoom&&e<(t?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this._evaluatedVisibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),U(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,n,r,i={}){return(!i||!1!==i.validate)&&ua(this,e.call(aa,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof qa&&$r(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}let Qa;var Ja={get paint(){return Qa=Qa||new Ya({"raster-opacity":new Ga(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ga(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ga(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ga(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ga(xe.paint_raster["raster-saturation"]),"raster-contrast":new Ga(xe.paint_raster["raster-contrast"]),"raster-resampling":new Ga(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ga(xe.paint_raster["raster-fade-duration"])})}};class es extends Ka{constructor(e,t){super(e,Ja,t)}}const ts={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ns{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function is(e,t=1){let n=0,r=0;return{members:e.map(e=>{const i=ts[e.type].BYTES_PER_ELEMENT,a=n=as(n,Math.max(t,i)),s=e.components||1;return r=Math.max(r,i),n+=i*s,{name:e.name,type:e.type,components:s,offset:a}}),size:as(n,Math.max(r,t)),alignment:t}}function as(e,t){return Math.ceil(e/t)*t}class ss extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}ss.prototype.bytesPerElement=4,pa("StructArrayLayout2i4",ss);class os extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}os.prototype.bytesPerElement=6,pa("StructArrayLayout3i6",os);class ls extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,e}}ls.prototype.bytesPerElement=8,pa("StructArrayLayout4i8",ls);class cs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,s){const o=6*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,this.int16[o+4]=a,this.int16[o+5]=s,e}}cs.prototype.bytesPerElement=12,pa("StructArrayLayout2i4i12",cs);class us extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,s){const o=4*e,l=8*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.uint8[l+4]=r,this.uint8[l+5]=i,this.uint8[l+6]=a,this.uint8[l+7]=s,e}}us.prototype.bytesPerElement=8,pa("StructArrayLayout2i4ub8",us);class hs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}hs.prototype.bytesPerElement=8,pa("StructArrayLayout2f8",hs);class ds extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,r,i,a,s,o,l,c)}emplace(e,t,n,r,i,a,s,o,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=a,this.uint16[h+5]=s,this.uint16[h+6]=o,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}ds.prototype.bytesPerElement=20,pa("StructArrayLayout10ui20",ds);class ps extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,r,i,a,s,o)}emplace(e,t,n,r,i,a,s,o,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=n,this.uint16[c+2]=r,this.uint16[c+3]=i,this.uint16[c+4]=a,this.uint16[c+5]=s,this.uint16[c+6]=o,this.uint16[c+7]=l,e}}ps.prototype.bytesPerElement=16,pa("StructArrayLayout8ui16",ps);class fs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,r,i,a,s,o,l,c,u,h)}emplace(e,t,n,r,i,a,s,o,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=a,this.uint16[p+5]=s,this.uint16[p+6]=o,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}fs.prototype.bytesPerElement=24,pa("StructArrayLayout4i4ui4i24",fs);class ms extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}ms.prototype.bytesPerElement=12,pa("StructArrayLayout3f12",ms);class gs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}gs.prototype.bytesPerElement=4,pa("StructArrayLayout1ul4",gs);class ys extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,a,s,o,l)}emplace(e,t,n,r,i,a,s,o,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=r,this.int16[u+3]=i,this.int16[u+4]=a,this.int16[u+5]=s,this.uint32[h+3]=o,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}ys.prototype.bytesPerElement=20,pa("StructArrayLayout6i1ul2ui20",ys);class _s extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,s){const o=6*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,this.int16[o+4]=a,this.int16[o+5]=s,e}}_s.prototype.bytesPerElement=12,pa("StructArrayLayout2i2i2i12",_s);class vs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i)}emplace(e,t,n,r,i,a){const s=4*e,o=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=r,this.int16[o+6]=i,this.int16[o+7]=a,e}}vs.prototype.bytesPerElement=16,pa("StructArrayLayout2f1f2i16",vs);class xs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,s){const o=16*e,l=4*e,c=8*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[l+1]=r,this.float32[l+2]=i,this.int16[c+6]=a,this.int16[c+7]=s,e}}xs.prototype.bytesPerElement=16,pa("StructArrayLayout2ub2f2i16",xs);class bs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}bs.prototype.bytesPerElement=6,pa("StructArrayLayout3ui6",bs);class ws extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g)}emplace(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y){const _=24*e,v=12*e,x=48*e;return this.int16[_+0]=t,this.int16[_+1]=n,this.uint16[_+2]=r,this.uint16[_+3]=i,this.uint32[v+2]=a,this.uint32[v+3]=s,this.uint32[v+4]=o,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,e}}ws.prototype.bytesPerElement=48,pa("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ws);class Ss extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,k,T,C,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,k,T,C,E)}emplace(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,k,T,C,E,I){const P=32*e,M=16*e;return this.int16[P+0]=t,this.int16[P+1]=n,this.int16[P+2]=r,this.int16[P+3]=i,this.int16[P+4]=a,this.int16[P+5]=s,this.int16[P+6]=o,this.int16[P+7]=l,this.uint16[P+8]=c,this.uint16[P+9]=u,this.uint16[P+10]=h,this.uint16[P+11]=d,this.uint16[P+12]=p,this.uint16[P+13]=f,this.uint16[P+14]=m,this.uint16[P+15]=g,this.uint16[P+16]=y,this.uint16[P+17]=_,this.uint16[P+18]=v,this.uint16[P+19]=x,this.uint16[P+20]=b,this.uint16[P+21]=w,this.uint16[P+22]=S,this.uint32[M+12]=k,this.float32[M+13]=T,this.float32[M+14]=C,this.uint16[P+30]=E,this.uint16[P+31]=I,e}}Ss.prototype.bytesPerElement=64,pa("StructArrayLayout8i15ui1ul2f2ui64",Ss);class ks extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ks.prototype.bytesPerElement=4,pa("StructArrayLayout1f4",ks);class Ts extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[6*e+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}Ts.prototype.bytesPerElement=12,pa("StructArrayLayout1ui2f12",Ts);class Cs extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e}}Cs.prototype.bytesPerElement=8,pa("StructArrayLayout1ul2ui8",Cs);class Es extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}Es.prototype.bytesPerElement=4,pa("StructArrayLayout2ui4",Es);class Is extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Is.prototype.bytesPerElement=2,pa("StructArrayLayout1ui2",Is);class Ps extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.float32[a+3]=i,e}}Ps.prototype.bytesPerElement=16,pa("StructArrayLayout4f16",Ps);class Ms extends ns{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}Ms.prototype.size=20;class As extends ys{get(e){return new Ms(this,e)}}pa("CollisionBoxArray",As);class zs extends ns{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}zs.prototype.size=48;class Ds extends ws{get(e){return new zs(this,e)}}pa("PlacedSymbolArray",Ds);class Rs extends ns{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Rs.prototype.size=64;class Ls extends Ss{get(e){return new Rs(this,e)}}pa("SymbolInstanceArray",Ls);class Ns extends ks{getoffsetX(e){return this.float32[1*e+0]}}pa("GlyphOffsetArray",Ns);class js extends os{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}pa("SymbolLineVertexArray",js);class Fs extends ns{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Fs.prototype.size=12;class Os extends Ts{get(e){return new Fs(this,e)}}pa("TextAnchorOffsetArray",Os);class Bs extends ns{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Bs.prototype.size=8;class Vs extends Cs{get(e){return new Bs(this,e)}}pa("FeatureIndexArray",Vs);class Us extends ss{}class qs extends ss{}class $s extends ss{}class Gs extends cs{}class Hs extends us{}class Zs extends hs{}class Ws extends ds{}class Xs extends ps{}class Ys extends fs{}class Ks extends ms{}class Qs extends gs{}class Js extends _s{}class eo extends xs{}class to extends bs{}class no extends Es{}const ro=is([{name:"a_pos",components:2,type:"Int16"}],4),{members:io}=ro;class ao{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,t,n,r){const i=this.segments[this.segments.length-1];return e>ao.MAX_VERTEX_ARRAY_LENGTH&&G(`Max vertices per segment is ${ao.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ao.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!i||i.vertexLength+e>ao.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r?this.createNewSegment(t,n,r):i}createNewSegment(e,t,n){const r={vertexOffset:e.length,primitiveOffset:t.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==n&&(r.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(r),r}getOrCreateLatestSegment(e,t,n){return this.prepareSegment(0,e,t,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,r){return new ao([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function so(e,t){return 256*(e=j(Math.floor(e),0,255))+j(Math.floor(t),0,255)}ao.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pa("SegmentVector",ao);const oo=is([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),lo=is([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var co,uo,ho,po={exports:{}},fo={exports:{}},mo={exports:{}},go=function(){if(ho)return po.exports;ho=1;var e=(co||(co=1,fo.exports=function(e,t){var n,r,i,a,s,o,l,c;for(r=e.length-(n=3&e.length),i=t,s=3432918353,o=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(a=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),fo.exports),t=(uo||(uo=1,mo.exports=function(e,t){for(var n,r=e.length,i=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),mo.exports);return po.exports=e,po.exports.murmur3=e,po.exports.murmur2=t,po.exports}(),yo=i(go);class _o{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,r){this.ids.push(vo(e)),this.positions.push(t,n,r)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=vo(e);let n=0,r=this.ids.length-1;for(;n<r;){const e=n+r>>1;this.ids[e]>=t?r=e:n=e+1}const i=[];for(;this.ids[n]===t;)i.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return i}static serialize(e,t){const n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return xo(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}}static deserialize(e){const t=new _o;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function vo(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:yo(String(e))}function xo(e,t,n,r){for(;n<r;){const i=e[n+r>>1];let a=n-1,s=r+1;for(;;){do{a++}while(e[a]<i);do{s--}while(e[s]>i);if(a>=s)break;bo(e,a,s),bo(t,3*a,3*s),bo(t,3*a+1,3*s+1),bo(t,3*a+2,3*s+2)}s-n<r-s?(xo(e,t,n,s),n=s+1):(xo(e,t,s+1,r),r=s)}}function bo(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}pa("FeaturePositionMap",_o);class wo{constructor(e,t){this.gl=e.gl,this.location=t}}class So extends wo{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ko extends wo{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class To extends wo{constructor(e,t){super(e,t),this.current=It.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Co=new Float32Array(16);function Eo(e){return[so(255*e.r,255*e.g),so(255*e.b,255*e.a)]}class Io{constructor(e,t,n){this.value=e,this.uniformNames=t.map(e=>`u_${e}`),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new To(e,t):new So(e,t)}}class Po{constructor(e,t){this.uniformNames=t.map(e=>`u_${e}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,t){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,t.y,t.height,t.width]}setUniform(e,t,n,r){let i=null;"u_pattern_to"===r?i=this.patternTo:"u_pattern_from"===r?i=this.patternFrom:"u_dasharray_to"===r?i=this.dashTo:"u_dasharray_from"===r?i=this.dashFrom:"u_pixel_ratio_to"===r?i=this.pixelRatioTo:"u_pixel_ratio_from"===r&&(i=this.pixelRatioFrom),null!==i&&e.set(i)}getBinding(e,t,n){return"u_pattern"===n.substr(0,9)||"u_dasharray_"===n.substr(0,12)?new ko(e,t):new So(e,t)}}class Mo{constructor(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(e,t,n){const r=this.paintVertexArray.length,i=this.expression.evaluate(new Ra(0,n),t,{},n.canonical,[],n.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(r,e,i)}updatePaintArray(e,t,n,r,i){const a=this.expression.evaluate(new Ra(0,i),n,r);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if("color"===this.type){const r=Eo(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(e,t,n,r,i,a){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,n){const r=this.expression.evaluate(new Ra(this.zoom,n),t,{},n.canonical,[],n.formattedSection),i=this.expression.evaluate(new Ra(this.zoom+1,n),t,{},n.canonical,[],n.formattedSection),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,r,i)}updatePaintArray(e,t,n,r,i){const a=this.expression.evaluate(new Ra(this.zoom,i),n,r),s=this.expression.evaluate(new Ra(this.zoom+1,i),n,r);this._setPaintValue(e,t,a,s)}_setPaintValue(e,t,n,r){if("color"===this.type){const i=Eo(n),a=Eo(r);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],a[0],a[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=j(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,n){return new So(e,t)}}class zo{constructor(e,t,n,r,i,a){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=r,this.layerId=a,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}populatePaintArray(e,t,n){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,this.getPositionIds(t),n)}updatePaintArray(e,t,n,r,i){this._setPaintValues(e,t,this.getPositionIds(n),i)}_setPaintValues(e,t,n,r){const i=this.getPositions(r);if(!i||!n)return;const a=i[n.min],s=i[n.mid],o=i[n.max];if(a&&s&&o)for(let l=e;l<t;l++)this.emplace(this.zoomInPaintVertexArray,l,s,a),this.emplace(this.zoomOutPaintVertexArray,l,s,o)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const t=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,t,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,t,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Do extends zo{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return oo.members}emplace(e,t,n,r){e.emplace(t,n.tlbr[0],n.tlbr[1],n.tlbr[2],n.tlbr[3],r.tlbr[0],r.tlbr[1],r.tlbr[2],r.tlbr[3],n.pixelRatio,r.pixelRatio)}}class Ro extends zo{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return lo.members}emplace(e,t,n,r){e.emplace(t,0,n.y,n.height,n.width,0,r.y,r.height,r.width)}}class Lo{constructor(e,t,n){this.binders={},this._buffers=[];const r=[];for(const i in e.paint._values){if(!n(i))continue;const a=e.paint.get(i);if(!(a instanceof qa&&$r(a.property.specification)))continue;const s=jo(i,e.type),o=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===o.kind)this.binders[i]=h?new Po(o.value,s):new Io(o.value,s,l),r.push(`/u_${i}`);else if("source"===o.kind||h){const n=Fo(i,l,"source");this.binders[i]=h?"line-dasharray"===i?new Ro(o,l,c,t,n,e.id):new Do(o,l,c,t,n,e.id):new Mo(o,s,l,n),r.push(`/a_${i}`)}else{const e=Fo(i,l,"composite");this.binders[i]=new Ao(o,s,l,c,t,e),r.push(`/z_${i}`)}}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Mo||t instanceof Ao?t.maxValue:0}populatePaintArrays(e,t,n){for(const r in this.binders){const i=this.binders[r];(i instanceof Mo||i instanceof Ao||i instanceof zo)&&i.populatePaintArray(e,t,n)}}setConstantPatternPositions(e,t){for(const n in this.binders){const r=this.binders[n];r instanceof Po&&r.setConstantPatternPositions(e,t)}}setConstantDashPositions(e,t){for(const n in this.binders){const r=this.binders[n];r instanceof Po&&r.setConstantDashPositions(e,t)}}updatePaintArrays(e,t,n,r,i){let a=!1;for(const s in e){const o=t.getPositions(s);for(const t of o){const o=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Mo||l instanceof Ao||l instanceof zo)&&!0===l.expression.isStateDependent){const c=r.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,o,e[s],i),a=!0}}}}return a}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Io||n instanceof Po)&&e.push(...n.uniformNames.map(e=>`#define HAS_UNIFORM_${e}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Mo||n instanceof Ao)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);else if(n instanceof zo){const t=n.getVertexAttributes();for(const n of t)e.push(n.name)}}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Io||n instanceof Po||n instanceof Ao)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Io||i instanceof Po||i instanceof Ao)for(const a of i.uniformNames)if(t[a]){const s=i.getBinding(e,t[a],a);n.push({name:a,property:r,binding:s})}}return n}setUniforms(e,t,n,r){for(const{name:i,property:a,binding:s}of t)this.binders[a].setUniform(s,r,n.get(a),i)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof zo){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof Mo||n instanceof Ao)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Mo||n instanceof Ao||n instanceof zo)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Mo||t instanceof Ao||t instanceof zo)&&t.destroy()}}}class No{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Lo(r,t,n);this.needsUpload=!1,this._featureMap=new _o,this._bufferOffset=0}populatePaintArrays(e,t,n,r){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,r){for(const i of n)this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,t,i,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function jo(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function Fo(e,t,n){const r={color:{source:hs,composite:Ps},number:{source:ks,composite:hs}},i={"line-pattern":{source:Ws,composite:Ws},"fill-pattern":{source:Ws,composite:Ws},"fill-extrusion-pattern":{source:Ws,composite:Ws},"line-dasharray":{source:Xs,composite:Xs}}[e];return i&&i[n]||r[t][n]}pa("ConstantBinder",Io),pa("CrossFadedConstantBinder",Po),pa("SourceExpressionBinder",Mo),pa("CrossFadedPatternBinder",Do),pa("CrossFadedDasharrayBinder",Ro),pa("CompositeExpressionBinder",Ao),pa("ProgramConfiguration",Lo,{omit:["_buffers"]}),pa("ProgramConfigurationSet",No);const Oo=Math.pow(2,14)-1,Bo=-Oo-1;function Vo(e){const t=M/e.extent,n=e.loadGeometry();for(let r=0;r<n.length;r++){const e=n[r];for(let n=0;n<e.length;n++){const r=e[n],i=Math.round(r.x*t),a=Math.round(r.y*t);r.x=j(i,Bo,Oo),r.y=j(a,Bo,Oo),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&G("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Uo(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Vo(e):[]}}const qo=-32768;function $o(e,t,n,r,i){e.emplaceBack(qo+8*t+r,qo+8*n+i)}class Go{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new qs,this.indexArray=new to,this.segments=new ao,this.programConfigurations=new No(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){const r=this.layers[0],i=[];let a=null,s=!1,o="heatmap"===r.type;if("circle"===r.type){const e=r;a=e.layout.get("circle-sort-key"),s=!a.isConstant(),o=o||"map"===e.paint.get("circle-pitch-alignment")}const l=o?t.subdivisionGranularity.circle:1;for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Uo(c,e);if(!this.layers[0]._featureFilter.filter(new Ra(this.zoom),t,n))continue;const r=s?a.evaluate(t,{},n):void 0,o={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:Vo(c),patterns:{},sortKey:r};i.push(o)}s&&i.sort((e,t)=>e.sortKey-t.sortKey);for(const c of i){const{geometry:r,index:i,sourceLayerIndex:a}=c,s=e[i].feature;this.addFeature(c,r,i,n,l),t.featureIndex.insert(s,r,i,a,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,io),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,r,i=1){let a;switch(i){case 1:a=[0,7];break;case 3:a=[0,2,5,7];break;case 5:a=[0,1,3,4,6,7];break;case 7:a=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${i}; valid values are 1, 3, 5, 7.`)}const s=a.length;for(const o of t)for(const t of o){const n=t.x,r=t.y;if(n<0||n>=M||r<0||r>=M)continue;const i=this.segments.prepareSegment(s*s,this.layoutVertexArray,this.indexArray,e.sortKey),o=i.vertexLength;for(let e=0;e<s;e++)for(let t=0;t<s;t++)$o(this.layoutVertexArray,n,r,a[t],a[e]);for(let e=0;e<s-1;e++)for(let t=0;t<s-1;t++){const n=o+e*s+t,r=o+(e+1)*s+t;this.indexArray.emplaceBack(n,r+1,n+1),this.indexArray.emplaceBack(n,r,r+1)}i.vertexLength+=s*s,i.primitiveLength+=(s-1)*(s-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:{},canonical:r})}}function Ho(e,t){for(let n=0;n<e.length;n++)if(tl(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(tl(e,t[n]))return!0;return!!Yo(e,t)}function Zo(e,t,n){return!!tl(e,t)||!!Qo(t,e,n)}function Wo(e,t){if(1===e.length)return el(t,e[0]);for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++)if(tl(e,r[t]))return!0}for(let n=0;n<e.length;n++)if(el(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Yo(e,t[n]))return!0;return!1}function Xo(e,t,n){if(e.length>1){if(Yo(e,t))return!0;for(let r=0;r<t.length;r++)if(Qo(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(Qo(e[r],t,n))return!0;return!1}function Yo(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)if(Ko(r,i,t[e],t[e+1]))return!0}return!1}function Ko(e,t,n,r){return H(e,n,r)!==H(t,n,r)&&H(e,t,n)!==H(e,t,r)}function Qo(e,t,n){const r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(Jo(e,t[i-1],t[i])<r)return!0;return!1}function Jo(e,t,n){const r=t.distSqr(n);if(0===r)return e.distSqr(t);const i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function el(e,t){let n,r,i,a=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)r=n[e],i=n[s],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(a=!a)}return a}function tl(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const a=e[r],s=e[i];a.y>t.y!=s.y>t.y&&t.x<(s.x-a.x)*(t.y-a.y)/(s.y-a.y)+a.x&&(n=!n)}return n}function nl(e,t,n){const r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;const a=H(e,t,n[0]);return a!==H(e,t,n[1])||a!==H(e,t,n[2])||a!==H(e,t,n[3])}function rl(e,t,n){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function il(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function al(e,t,n,i,a){if(!t[0]&&!t[1])return e;const s=r.convert(t)._mult(a);"viewport"===n&&s._rotate(-i);const o=[];for(let r=0;r<e.length;r++)o.push(e[r].sub(s));return o}function sl(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n],i=t.at(-1);(0===n||i&&!r.equals(i))&&t.push(r)}return t}function ol({queryGeometry:e,size:t},n){return Zo(e,n,t)}function ll({queryGeometry:e,size:t,transform:n,unwrappedTileID:r,getElevation:i},a){return Zo(e,a,t*(n.projectTileCoordinates(a.x,a.y,r,i).signedDistanceFromCamera/n.cameraToCenterDistance))}function cl({queryGeometry:e,size:t,transform:n,unwrappedTileID:r,getElevation:i},a){const s=n.projectTileCoordinates(a.x,a.y,r,i).signedDistanceFromCamera,o=t*(n.cameraToCenterDistance/s);return Zo(e,dl(a,n,r,i),o)}function ul({queryGeometry:e,size:t,transform:n,unwrappedTileID:r,getElevation:i},a){return Zo(e,dl(a,n,r,i),t)}function hl({queryGeometry:e,size:t,transform:n,unwrappedTileID:r,getElevation:i,pitchAlignment:a="map",pitchScale:s="map"},o){const l="map"===a?"map"===s?ol:ll:"map"===s?cl:ul,c={queryGeometry:e,size:t,transform:n,unwrappedTileID:r,getElevation:i};for(const u of o)for(const e of u)if(l(c,e))return!0;return!1}function dl(e,t,n,i){const a=t.projectTileCoordinates(e.x,e.y,n,i).point;return new r((.5*a.x+.5)*t.width,(.5*-a.y+.5)*t.height)}let pl,fl;pa("CircleBucket",Go,{omit:["layers"]});var ml={get paint(){return fl=fl||new Ya({"circle-radius":new Ha(xe.paint_circle["circle-radius"]),"circle-color":new Ha(xe.paint_circle["circle-color"]),"circle-blur":new Ha(xe.paint_circle["circle-blur"]),"circle-opacity":new Ha(xe.paint_circle["circle-opacity"]),"circle-translate":new Ga(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ga(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ga(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ga(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ha(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ha(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ha(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return pl=pl||new Ya({"circle-sort-key":new Ha(xe.layout_circle["circle-sort-key"])})}};class gl extends Ka{constructor(e,t){super(e,ml,t)}createBucket(e){return new Go(e)}queryRadius(e){const t=e;return rl("circle-radius",this,t)+rl("circle-stroke-width",this,t)+il(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:n,geometry:r,transform:i,pixelsToTileUnits:a,unwrappedTileID:s,getElevation:o}){const l=al(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-i.bearingInRadians,a),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),u=this.paint.get("circle-pitch-scale"),h=this.paint.get("circle-pitch-alignment");let d,p;return"map"===h?(d=l,p=c*a):(f=i,m=s,g=o,d=l.map(e=>dl(e,f,m,g)),p=c),hl({queryGeometry:d,size:p,transform:i,unwrappedTileID:s,getElevation:o,pitchAlignment:h,pitchScale:u},r);var f,m,g}}class yl extends Go{}let _l;pa("HeatmapBucket",yl,{omit:["layers"]});var vl={get paint(){return _l=_l||new Ya({"heatmap-radius":new Ha(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ha(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ga(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xa(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ga(xe.paint_heatmap["heatmap-opacity"])})}};function xl(e,{width:t,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*n*r)throw new RangeError(`mismatched image size. expected: ${i.length} but got: ${t*n*r}`)}else i=new Uint8Array(t*n*r);return e.width=t,e.height=n,e.data=i,e}function bl(e,{width:t,height:n},r){if(t===e.width&&n===e.height)return;const i=xl({},{width:t,height:n},r);wl(e,i,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},r),e.width=t,e.height=n,e.data=i.data}function wl(e,t,n,r,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,o=t.data;if(s===o)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<i.height;l++){const c=((n.y+l)*e.width+n.x)*a,u=((r.y+l)*t.width+r.x)*a;for(let e=0;e<i.width*a;e++)o[u+e]=s[c+e]}return t}class Sl{constructor(e,t){xl(this,e,1,t)}resize(e){bl(this,e,1)}clone(){return new Sl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){wl(e,t,n,r,i,1)}}class kl{constructor(e,t){xl(this,e,4,t)}resize(e){bl(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){wl(e,t,n,r,i,4)}setPixel(e,t,n){const r=4*(e*this.width+t);this.data[r+0]=Math.round(255*n.r/n.a),this.data[r+1]=Math.round(255*n.g/n.a),this.data[r+2]=Math.round(255*n.b/n.a),this.data[r+3]=Math.round(255*n.a)}}function Tl(e){const t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new kl({width:n,height:r});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const a=(r,a,s)=>{t[e.evaluationKey]=s;const o=e.expression.evaluate(t);i.setPixel(r/4/n,a/4,o)};if(e.clips)for(let s=0,o=0;s<r;++s,o+=4*n)for(let t=0,r=0;t<n;t++,r+=4){const i=t/(n-1),{start:l,end:c}=e.clips[s];a(o,r,l*(1-i)+c*i)}else for(let s=0,o=0;s<n;s++,o+=4)a(0,o,s/(n-1));return i}pa("AlphaImage",Sl),pa("RGBAImage",kl);const Cl="big-fb";class El extends Ka{createBucket(e){return new yl(e)}constructor(e,t){super(e,vl,t),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Cl)&&this.heatmapFbos.delete(Cl)}queryRadius(e){return rl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:n,geometry:r,transform:i,pixelsToTileUnits:a,unwrappedTileID:s,getElevation:o}){return hl({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(t,n)*a,transform:i,unwrappedTileID:s,getElevation:o},r)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&!this.isHidden()}}let Il;var Pl={get paint(){return Il=Il||new Ya({"hillshade-illumination-direction":new Ga(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ga(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ga(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ga(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ga(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ga(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ga(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ga(xe.paint_hillshade["hillshade-method"])})}};class Ml extends Ka{constructor(e,t){super(e,Pl,t),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,t=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,r=this.paint.get("hillshade-shadow-color").values;const i=Math.max(e.length,t.length,n.length,r.length);e=e.concat(Array(i-e.length).fill(e.at(-1))),t=t.concat(Array(i-t.length).fill(t.at(-1))),n=n.concat(Array(i-n.length).fill(n.at(-1))),r=r.concat(Array(i-r.length).fill(r.at(-1)));const a=t.map(te);return{directionRadians:e.map(te),altitudeRadians:a,shadowColor:r,highlightColor:n}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&!this.isHidden()}}let Al;var zl={get paint(){return Al=Al||new Ya({"color-relief-opacity":new Ga(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Xa(xe["paint_color-relief"]["color-relief-color"])})}};class Dl{constructor(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,t,n){const{width:r,height:i}=e,a=!(this.size&&this.size[0]===r&&this.size[1]===i||n),{context:s}=this,{gl:o}=s;if(this.useMipmap=Boolean(t&&t.useMipmap),o.bindTexture(o.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[r,i],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||X(e)?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,r,i,0,this.format,o.UNSIGNED_BYTE,e.data);else{const{x:t,y:a}=n||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||X(e)?o.texSubImage2D(o.TEXTURE_2D,0,t,a,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,t,a,r,i,o.RGBA,o.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&o.generateMipmap(o.TEXTURE_2D),s.pixelStoreUnpackFlipY.setDefault(),s.pixelStoreUnpack.setDefault(),s.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,t,n){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Rl{constructor(e,t,n,r=1,i=1,a=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void G(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const o=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=i,this.blueFactor=a,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let l=0;l<o;l++)this.data[this._idx(-1,l)]=this.data[this._idx(0,l)],this.data[this._idx(o,l)]=this.data[this._idx(o-1,l)],this.data[this._idx(l,-1)]=this.data[this._idx(l,0)],this.data[this._idx(l,o)]=this.data[this._idx(l,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let l=0;l<o;l++)for(let e=0;e<o;e++){const t=this.get(l,e);t>this.max&&(this.max=t),t<this.min&&(this.min=t)}}get(e,t){const n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return this.unpack(n[r],n[r+1],n[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${t}, dim: ${this.dim}`);return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}pack(e){return Ll(e,this.getUnpackVector())}getPixels(){return new kl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,i=t*this.dim+this.dim,a=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:a=s-1;break;case 1:s=a+1}const o=-t*this.dim,l=-n*this.dim;for(let c=a;c<s;c++)for(let t=r;t<i;t++)this.data[this._idx(t,c)]=e.data[this._idx(t+o,c+l)]}}function Ll(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=Math.min(n,r,i),o=Math.round((e+a)/s);return{r:Math.floor(o*s/n)%256,g:Math.floor(o*s/r)%256,b:Math.floor(o*s/i)%256}}pa("DEMData",Rl);class Nl extends Ka{constructor(e,t){super(e,zl,t)}_createColorRamp(e){const t={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof ai&&n._styleExpression.expression instanceof mn){this.colorRampExpression=n;const e=n._styleExpression.expression;t.elevationStops=e.labels,t.colorStops=[];for(const n of t.elevationStops)t.colorStops.push(e.evaluate({globals:{elevation:n}}))}if(t.elevationStops.length<1&&(t.elevationStops=[0],t.colorStops=[It.transparent]),t.elevationStops.length<2&&(t.elevationStops.push(t.elevationStops[0]+1),t.colorStops.push(t.colorStops[0])),t.elevationStops.length<=e)return t;const r={elevationStops:[],colorStops:[]},i=(t.elevationStops.length-1)/(e-1);for(let a=0;a<t.elevationStops.length-.5;a+=i)r.elevationStops.push(t.elevationStops[Math.round(a)]),r.colorStops.push(t.colorStops[Math.round(a)]);return G(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${t.elevationStops.length}`),r}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,t,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const r=this._createColorRamp(t),i=new kl({width:r.colorStops.length,height:1}),a=new kl({width:r.colorStops.length,height:1});for(let s=0;s<r.elevationStops.length;s++){const e=Ll(r.elevationStops[s],n);a.setPixel(0,s,new It(e.r/255,e.g/255,e.b/255,1)),i.setPixel(0,s,r.colorStops[s])}return this.colorRampTextures={elevationTexture:new Dl(e,a,e.gl.RGBA),colorTexture:new Dl(e,i,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const jl=is([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fl}=jl;function Ol(e,t,n){const r=n.patternDependencies;let i=!1;for(const a of t){const t=a.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const n=t.constantOr(null);n&&(i=!0,r[n.to]=!0,r[n.from]=!0)}return i}function Bl(e,t,n,r,i){const{zoom:a}=r,s=i.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:a-1},n,{},i.availableImages),r=t.evaluate({zoom:a},n,{},i.availableImages),l=t.evaluate({zoom:a+1},n,{},i.availableImages);e=e&&e.name?e.name:e,r=r&&r.name?r.name:r,l=l&&l.name?l.name:l,s[e]=!0,s[r]=!0,s[l]=!0,n.patterns[o.id]={min:e,mid:r,max:l}}}return n}function Vl(e,t,n,r,i){let a;if(i===function(e,t,n,r){let i=0;for(let a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}(e,t,n,r)>0)for(let s=t;s<n;s+=r)a=cc(s/r|0,e[s],e[s+1],a);else for(let s=n-r;s>=t;s-=r)a=cc(s/r|0,e[s],e[s+1],a);return a&&rc(a,a.next)&&(uc(a),a=a.next),a}function Ul(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!rc(r,r.next)&&0!==nc(r.prev,r,r.next))r=r.next;else{if(uc(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function ql(e,t,n,r,i,a,s){if(!e)return;!s&&a&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Kl(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let a=null;for(t=0;i;){t++;let s=i,o=0;for(let e=0;e<n&&(o++,s=s.nextZ,s);e++);let l=n;for(;o>0||l>0&&s;)0!==o&&(0===l||!s||i.z<=s.z)?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=s}a.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,a);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?Gl(e,r,i,a):$l(e))t.push(l.i,e.i,c.i),uc(e),e=c.next,o=c.next;else if((e=c)===o){s?1===s?ql(e=Hl(Ul(e),t),t,n,r,i,a,2):2===s&&Zl(e,t,n,r,i,a):ql(Ul(e),t,n,r,i,a,1);break}}}function $l(e){const t=e.prev,n=e,r=e.next;if(nc(t,n,r)>=0)return!1;const i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,c=r.y,u=Math.min(i,a,s),h=Math.min(o,l,c),d=Math.max(i,a,s),p=Math.max(o,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&ec(i,o,a,l,s,c,f.x,f.y)&&nc(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Gl(e,t,n,r){const i=e.prev,a=e,s=e.next;if(nc(i,a,s)>=0)return!1;const o=i.x,l=a.x,c=s.x,u=i.y,h=a.y,d=s.y,p=Math.min(o,l,c),f=Math.min(u,h,d),m=Math.max(o,l,c),g=Math.max(u,h,d),y=Kl(p,f,t,n,r),_=Kl(m,g,t,n,r);let v=e.prevZ,x=e.nextZ;for(;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==i&&v!==s&&ec(o,u,l,h,c,d,v.x,v.y)&&nc(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&ec(o,u,l,h,c,d,x.x,x.y)&&nc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==i&&v!==s&&ec(o,u,l,h,c,d,v.x,v.y)&&nc(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&ec(o,u,l,h,c,d,x.x,x.y)&&nc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Hl(e,t){let n=e;do{const r=n.prev,i=n.next.next;!rc(r,i)&&ic(r,n,n.next,i)&&oc(r,i)&&oc(i,r)&&(t.push(r.i,n.i,i.i),uc(n),uc(n.next),n=e=i),n=n.next}while(n!==e);return Ul(n)}function Zl(e,t,n,r,i,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&tc(s,e)){let o=lc(s,e);return s=Ul(s,s.next),o=Ul(o,o.next),ql(s,t,n,r,i,a,0),void ql(o,t,n,r,i,a,0)}e=e.next}s=s.next}while(s!==e)}function Wl(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Xl(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let a,s=-1/0;if(rc(e,n))return n;do{if(rc(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s&&(s=e,a=n.x<n.next.x?n:n.next,e===r))return a}n=n.next}while(n!==t);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=l&&r!==n.x&&Jl(i<c?r:s,i,l,c,i<c?s:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);oc(n,e)&&(t<u||t===u&&(n.x>a.x||n.x===a.x&&Yl(a,n)))&&(a=n,u=t)}n=n.next}while(n!==o);return a}(e,t);if(!n)return t;const r=lc(n,e);return Ul(r,r.next),Ul(n,n.next)}function Yl(e,t){return nc(e.prev,e,t.prev)<0&&nc(t.next,e,e.next)<0}function Kl(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ql(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Jl(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function ec(e,t,n,r,i,a,s,o){return!(e===s&&t===o)&&Jl(e,t,n,r,i,a,s,o)}function tc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ic(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(oc(e,t)&&oc(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(nc(e.prev,e,t.prev)||nc(e,t.prev,t))||rc(e,t)&&nc(e.prev,e,e.next)>0&&nc(t.prev,t,t.next)>0)}function nc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function rc(e,t){return e.x===t.x&&e.y===t.y}function ic(e,t,n,r){const i=sc(nc(e,t,n)),a=sc(nc(e,t,r)),s=sc(nc(n,r,e)),o=sc(nc(n,r,t));return i!==a&&s!==o||!(0!==i||!ac(e,n,t))||!(0!==a||!ac(e,r,t))||!(0!==s||!ac(n,e,r))||!(0!==o||!ac(n,t,r))}function ac(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function sc(e){return e>0?1:e<0?-1:0}function oc(e,t){return nc(e.prev,e,e.next)<0?nc(e,t,e.next)>=0&&nc(e,e.prev,t)>=0:nc(e,t,e.prev)<0||nc(e,e.next,t)<0}function lc(e,t){const n=hc(e.i,e.x,e.y),r=hc(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function cc(e,t,n,r){const i=hc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function uc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function hc(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class dc{constructor(e,t){if(t>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=t}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class pc{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}pc.noSubdivision=new pc({fill:new dc(0,0),line:new dc(0,0),tile:new dc(0,0),stencil:new dc(0,0),circle:1}),pa("SubdivisionGranularityExpression",dc),pa("SubdivisionGranularitySetting",pc);const fc=-32768,mc=32767;class gc{constructor(e,t){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=M/e,this._canonical=t}_getKey(e,t){return(e+=32768)<<16|t+32768}_vertexToIndex(e,t){if(e<-32768||t<-32768||e>32767||t>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const n=0|Math.round(e),r=0|Math.round(t),i=this._getKey(n,r);if(this._vertexDictionary.has(i))return this._vertexDictionary.get(i);const a=this._vertexBuffer.length/2;return this._vertexDictionary.set(i,a),this._vertexBuffer.push(n,r),a}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,t){const n=[];for(let r=0;r<t.length;r+=3){const i=t[r],a=t[r+1],s=t[r+2],o=e[2*i],l=e[2*i+1];(e[2*a]-o)*(e[2*s+1]-l)-(e[2*a+1]-l)*(e[2*s]-o)>0?(n.push(i),n.push(s),n.push(a)):(n.push(i),n.push(a),n.push(s))}return n}(this._vertexBuffer,e);const t=[],n=e.length;for(let r=0;r<n;r+=3){const n=[e[r+0],e[r+1],e[r+2]],i=[this._vertexBuffer[2*e[r+0]+0],this._vertexBuffer[2*e[r+0]+1],this._vertexBuffer[2*e[r+1]+0],this._vertexBuffer[2*e[r+1]+1],this._vertexBuffer[2*e[r+2]+0],this._vertexBuffer[2*e[r+2]+1]];let a=1/0,s=1/0,o=-1/0,l=-1/0;for(let e=0;e<3;e++){const t=i[2*e],n=i[2*e+1];a=Math.min(a,t),o=Math.max(o,t),s=Math.min(s,n),l=Math.max(l,n)}if(a===o||s===l)continue;const c=Math.floor(a/this._granularityCellSize),u=Math.ceil(o/this._granularityCellSize),h=Math.floor(s/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let e=h;e<d;e++){const r=this._scanlineGenerateVertexRingForCellRow(e,i,n);vc(this._vertexBuffer,r,t)}else t.push(...n)}return t}_scanlineGenerateVertexRingForCellRow(e,t,n){const r=e*this._granularityCellSize,i=r+this._granularityCellSize,a=[];for(let s=0;s<3;s++){const e=t[2*s],o=t[2*s+1],l=t[2*(s+1)%6],c=t[(2*(s+1)+1)%6],u=t[2*(s+2)%6],h=t[(2*(s+2)+1)%6],d=l-e,p=c-o,f=0===d,m=0===p,g=(r-o)/p,y=(i-o)/p,_=Math.min(g,y),v=Math.max(g,y);if(!m&&(_>=1||v<=0)||m&&(o<r||o>i)){c>=r&&c<=i&&a.push(n[(s+1)%3]);continue}!m&&_>0&&a.push(this._vertexToIndex(e+d*_,o+p*_));const x=e+d*Math.max(_,0),b=e+d*Math.min(v,1);f||this._generateIntraEdgeVertices(a,e,o,l,c,x,b),!m&&v<1&&a.push(this._vertexToIndex(e+d*v,o+p*v)),(m||c>=r&&c<=i)&&a.push(n[(s+1)%3]),!m&&(c<=r||c>=i)&&this._generateInterEdgeVertices(a,e,o,l,c,u,h,b,r,i)}return a}_generateIntraEdgeVertices(e,t,n,r,i,a,s){const o=r-t,l=i-n,c=0===l,u=c?Math.min(t,r):Math.min(a,s),h=c?Math.max(t,r):Math.max(a,s),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?t<r:a<s)for(let f=d;f<=p;f++){const r=f*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/o))}else for(let f=p;f>=d;f--){const r=f*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/o))}}_generateInterEdgeVertices(e,t,n,r,i,a,s,o,l,c){const u=i-n,h=a-r,d=s-i,p=(l-i)/d,f=(c-i)/d,m=Math.min(p,f),g=Math.max(p,f),y=r+h*m;let _=Math.floor(Math.min(y,o)/this._granularityCellSize)+1,v=Math.ceil(Math.max(y,o)/this._granularityCellSize)-1,x=o<y;const b=0===d;if(b&&(s===l||s===c))return;if(b||m>=1||g<=0){const e=n-s,r=a+(t-a)*Math.min((l-s)/e,(c-s)/e);_=Math.floor(Math.min(r,o)/this._granularityCellSize)+1,v=Math.ceil(Math.max(r,o)/this._granularityCellSize)-1,x=o<r}const w=u>0?c:l;if(x)for(let S=_;S<=v;S++)e.push(this._vertexToIndex(S*this._granularityCellSize,w));else for(let S=v;S>=_;S--)e.push(this._vertexToIndex(S*this._granularityCellSize,w))}_generateOutline(e){const t=[];for(const n of e){const e=_c(n,this._granularity,!0),r=this._pointArrayToIndices(e),i=[];for(let t=1;t<r.length;t++)i.push(r[t-1]),i.push(r[t]);t.push(i)}return t}_handlePoles(e){let t=!1,n=!1;this._canonical&&(0===this._canonical.y&&(t=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(t||n)&&this._fillPoles(e,t,n)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let t=0;t<e.length;t+=2){const n=e[t+1];n===fc&&(e[t+1]=-32767),n===mc&&(e[t+1]=32766)}}_generatePoleQuad(e,t,n,r,i,a){r>i!=(a===fc)?(e.push(t),e.push(n),e.push(this._vertexToIndex(r,a)),e.push(n),e.push(this._vertexToIndex(i,a)),e.push(this._vertexToIndex(r,a))):(e.push(n),e.push(t),e.push(this._vertexToIndex(r,a)),e.push(this._vertexToIndex(i,a)),e.push(n),e.push(this._vertexToIndex(r,a)))}_fillPoles(e,t,n){const r=this._vertexBuffer,i=M,a=e.length;for(let s=2;s<a;s+=3){const a=e[s-2],o=e[s-1],l=e[s],c=r[2*a],u=r[2*a+1],h=r[2*o],d=r[2*o+1],p=r[2*l],f=r[2*l+1];t&&(0===u&&0===d&&this._generatePoleQuad(e,a,o,c,h,fc),0===d&&0===f&&this._generatePoleQuad(e,o,l,h,p,fc),0===f&&0===u&&this._generatePoleQuad(e,l,a,p,c,fc)),n&&(u===i&&d===i&&this._generatePoleQuad(e,a,o,c,h,mc),d===i&&f===i&&this._generatePoleQuad(e,o,l,h,p,mc),f===i&&u===i&&this._generatePoleQuad(e,l,a,p,c,mc))}}_initializeVertices(e){for(let t=0;t<e.length;t+=2)this._vertexToIndex(e[t],e[t+1])}subdividePolygonInternal(e,t){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:n,holeIndices:r}=function(e){const t=[],n=[];for(const r of e)if(0!==r.length){r!==e[0]&&t.push(n.length/2);for(let e=0;e<r.length;e++)n.push(r[e].x),n.push(r[e].y)}return{flattened:n,holeIndices:t}}(e);let i;this._initializeVertices(n);try{const e=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let a=Vl(e,0,i,n,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,c;if(r&&(a=function(e,t,n,r){const i=[];for(let a=0,s=t.length;a<s;a++){const n=Vl(e,t[a]*r,a<s-1?t[a+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(Ql(n))}i.sort(Wl);for(let a=0;a<i.length;a++)n=Xl(i[a],n);return n}(e,t,a,n)),e.length>80*n){o=e[0],l=e[1];let t=o,r=l;for(let a=n;a<i;a+=n){const n=e[a],i=e[a+1];n<o&&(o=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-o,r-l),c=0!==c?32767/c:0}return ql(a,s,n,o,l,c,0),s}(n,r),t=this._convertIndices(n,e);i=this._subdivideTrianglesScanline(t)}catch(s){}let a=[];return t&&(a=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(i),{verticesFlattened:this._vertexBuffer,indicesTriangles:i,indicesLineList:a}}_convertIndices(e,t){const n=[];for(let r=0;r<t.length;r++)n.push(this._vertexToIndex(e[2*t[r]],e[2*t[r]+1]));return n}_pointArrayToIndices(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];t.push(this._vertexToIndex(r.x,r.y))}return t}}function yc(e,t,n,r=!0){return new gc(n,t).subdividePolygonInternal(e,r)}function _c(e,t,n=!1){if(!e||e.length<1)return[];if(e.length<2)return[];const i=e[0],a=e[e.length-1],s=n&&(i.x!==a.x||i.y!==a.y);if(t<2)return s?[...e,e[0]]:[...e];const o=Math.floor(M/t),l=[];l.push(new r(e[0].x,e[0].y));const c=e.length,u=s?c:c-1;for(let h=0;h<u;h++){const t=e[h],n=h<c-1?e[h+1]:e[0],i=t.x,a=t.y,s=n.x,u=n.y,d=i!==s,p=a!==u;if(!d&&!p)continue;const f=s-i,m=u-a,g=Math.abs(f),y=Math.abs(m);let _=i,v=a;for(;;){const e=f>0?(Math.floor(_/o)+1)*o:(Math.ceil(_/o)-1)*o,t=m>0?(Math.floor(v/o)+1)*o:(Math.ceil(v/o)-1)*o,n=Math.abs(_-e),i=Math.abs(v-t),a=Math.abs(_-s),c=Math.abs(v-u),h=d?n/g:Number.POSITIVE_INFINITY,x=p?i/y:Number.POSITIVE_INFINITY;if((a<=n||!d)&&(c<=i||!p))break;if(h<x&&d||!p){_=e,v+=m*h;const t=new r(_,Math.round(v));l[l.length-1].x===t.x&&l[l.length-1].y===t.y||l.push(t)}else{_+=f*x,v=t;const e=new r(Math.round(_),v);l[l.length-1].x===e.x&&l[l.length-1].y===e.y||l.push(e)}}const x=new r(s,u);l[l.length-1].x===x.x&&l[l.length-1].y===x.y||l.push(x)}return l}function vc(e,t,n){if(0===t.length)throw new Error("Subdivision vertex ring is empty.");let r=0,i=e[2*t[0]];for(let l=1;l<t.length;l++){const n=e[2*t[l]];n<i&&(i=n,r=l)}const a=t.length;let s=r,o=(s+1)%a;for(;;){const r=s-1>=0?s-1:a-1,i=(o+1)%a,l=e[2*t[r]],c=e[2*t[i]],u=e[2*t[s]],h=e[2*t[s]+1],d=e[2*t[o]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const n=d-h,a=-(e[2*t[o]]-u),s=h<d?1:-1;((l-u)*n+(e[2*t[r]+1]-h)*a)*s>((c-u)*n+(e[2*t[i]+1]-h)*a)*s&&(p=!0)}if(p){const e=t[r],i=t[s],l=t[o];e!==i&&e!==l&&i!==l&&n.push(l,i,e),s--,s<0&&(s=a-1)}else{const e=t[i],r=t[s],l=t[o];e!==r&&e!==l&&r!==l&&n.push(l,r,e),o++,o>=a&&(o=0)}if(r===i)break}}function xc(e,t,n,r,i,a,s,o,l){const c=i.length/2,u=s&&o&&l;if(c<ao.MAX_VERTEX_ARRAY_LENGTH){const h=t.prepareSegment(c,n,r),d=h.vertexLength;for(let e=0;e<a.length;e+=3)r.emplaceBack(d+a[e],d+a[e+1],d+a[e+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=a.length/3,u&&(f=s.prepareSegment(c,n,o),p=f.vertexLength,f.vertexLength+=c);for(let t=0;t<i.length;t+=2)e(i[t],i[t+1]);if(u)for(let e=0;e<l.length;e++){const t=l[e];for(let e=1;e<t.length;e+=2)o.emplaceBack(p+t[e-1],p+t[e]);f.primitiveLength+=t.length/2}}else!function(e,t,n,r,i,a){const s=[];for(let h=0;h<r.length/2;h++)s.push(-1);const o={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=2;h<i.length;h+=3){const d=i[h-2],p=i[h-1],f=i[h];let m=s[d]<l,g=s[p]<l,y=s[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(y?1:0))>ao.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=o.count,m=!0,g=!0,y=!0,u=0);const _=bc(s,r,a,o,d,m,c),v=bc(s,r,a,o,p,g,c),x=bc(s,r,a,o,f,y,c);n.emplaceBack(u+_-l,u+v-l,u+x-l),c.primitiveLength++}}(t,n,r,i,a,e),u&&function(e,t,n,r,i,a){const s=[];for(let h=0;h<r.length/2;h++)s.push(-1);const o={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=0;h<i.length;h++){const d=i[h];for(let p=1;p<i[h].length;p+=2){const i=d[p-1],h=d[p];let f=s[i]<l,m=s[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>ao.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=o.count,f=!0,m=!0,u=0);const g=bc(s,r,a,o,i,f,c),y=bc(s,r,a,o,h,m,c);n.emplaceBack(u+g-l,u+y-l),c.primitiveLength++}}}(s,n,o,i,l,e),t.forceNewSegmentOnNextPrepare(),null==s||s.forceNewSegmentOnNextPrepare()}function bc(e,t,n,r,i,a,s){if(a){const a=r.count;return n(t[2*i],t[2*i+1]),e[i]=r.count,r.count++,s.vertexLength++,a}return e[i]}class wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new $s,this.indexArray=new to,this.indexArray2=new no,this.programConfigurations=new No(e.layers,e.zoom),this.segments=new ao,this.segments2=new ao,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.hasDependencies=Ol("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),i=!r.isConstant(),a=[];for(const{feature:s,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Uo(s,e);if(!this.layers[0]._featureFilter.filter(new Ra(this.zoom),u,n))continue;const h=i?r.evaluate(u,{},n,t.availableImages):void 0,d={id:o,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Vo(s),patterns:{},sortKey:h};a.push(d)}i&&a.sort((e,t)=>e.sortKey-t.sortKey);for(const s of a){const{geometry:r,index:i,sourceLayerIndex:a}=s;if(this.hasDependencies){const e=Bl("fill",this.layers,s,{zoom:this.zoom},t);this.patternFeatures.push(e)}else this.addFeature(s,r,i,n,{},t.subdivisionGranularity);t.featureIndex.insert(e[i].feature,r,i,a,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}addFeatures(e,t,n){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,n,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,r,i,a){for(const s of nr(t,500)){const e=yc(s,r,a.fill.getGranularityForZoomLevel(r.z)),t=this.layoutVertexArray;xc((e,n)=>{t.emplaceBack(e,n)},this.segments,this.layoutVertexArray,this.indexArray,e.verticesFlattened,e.indicesTriangles,this.segments2,this.indexArray2,e.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,canonical:r})}}let Sc,kc;pa("FillBucket",wc,{omit:["layers","patternFeatures"]});var Tc={get paint(){return kc=kc||new Ya({"fill-antialias":new Ga(xe.paint_fill["fill-antialias"]),"fill-opacity":new Ha(xe.paint_fill["fill-opacity"]),"fill-color":new Ha(xe.paint_fill["fill-color"]),"fill-outline-color":new Ha(xe.paint_fill["fill-outline-color"]),"fill-translate":new Ga(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ga(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Za(xe.paint_fill["fill-pattern"])})},get layout(){return Sc=Sc||new Ya({"fill-sort-key":new Ha(xe.layout_fill["fill-sort-key"])})}};class Cc extends Ka{constructor(e,t){super(e,Tc,t)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new wc(e)}queryRadius(){return il(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:t,transform:n,pixelsToTileUnits:r}){return Wo(al(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-n.bearingInRadians,r),t)}isTileClipped(){return!0}}const Ec=is([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ic=is([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Pc}=Ec;class Mc{constructor(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(Ac,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,n=[];let i,a=1,s=0,o=0,l=0;for(;e.pos<t;){if(s<=0){const t=e.readVarint();a=7&t,s=t>>3}if(s--,1===a||2===a)o+=e.readSVarint(),l+=e.readSVarint(),1===a&&(i&&n.push(i),i=[]),i&&i.push(new r(o,l));else{if(7!==a)throw new Error(`unknown command ${a}`);i&&i.push(i[0].clone())}}return i&&n.push(i),n}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,r=0,i=0,a=0,s=1/0,o=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(r<=0){const t=e.readVarint();n=7&t,r=t>>3}if(r--,1===n||2===n)i+=e.readSVarint(),a+=e.readSVarint(),i<s&&(s=i),i>o&&(o=i),a<l&&(l=a),a>c&&(c=a);else if(7!==n)throw new Error(`unknown command ${n}`)}return[s,l,o,c]}toGeoJSON(e,t,n){const r=this.extent*Math.pow(2,n),i=this.extent*e,a=this.extent*t,s=this.loadGeometry();function o(e){return[360*(e.x+i)/r-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+a)/r)*Math.PI))-90]}function l(e){return e.map(o)}let c;if(1===this.type){const e=[];for(const n of s)e.push(n[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=s.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=zc(s),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function Ac(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function zc(e){const t=e.length;if(t<=1)return[e];const n=[];let r,i;for(let a=0;a<t;a++){const t=Dc(e[a]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(r&&n.push(r),r=[e[a]]):r&&r.push(e[a]))}return r&&n.push(r),n}function Dc(e){let t=0;for(let n,r,i=0,a=e.length,s=a-1;i<a;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}Mc.types=["Unknown","Point","LineString","Polygon"];class Rc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Lc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Mc(this._pbf,t,this.extent,this._keys,this._values)}}function Lc(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class Nc{constructor(e,t){this.layers=e.readFields(jc,{},t)}}function jc(e,t,n){if(3===e){const e=new Rc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const Fc=Math.pow(2,13);function Oc(e,t,n,r,i,a,s,o){e.emplaceBack(t,n,2*Math.floor(r*Fc)+s,i*Fc*2,a*Fc*2,Math.round(o))}class Bc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Gs,this.centroidVertexArray=new Us,this.indexArray=new to,this.programConfigurations=new No(e.layers,e.zoom),this.segments=new ao,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.features=[],this.hasDependencies=Ol("fill-extrusion",this.layers,t);for(const{feature:r,id:i,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,o=Uo(r,e);if(!this.layers[0]._featureFilter.filter(new Ra(this.zoom),o,n))continue;const l={id:i,sourceLayerIndex:s,index:a,geometry:e?o.geometry:Vo(r),properties:r.properties,type:r.type,patterns:{}};this.hasDependencies?this.features.push(Bl("fill-extrusion",this.layers,l,{zoom:this.zoom},t)):this.addFeature(l,l.geometry,a,n,{},t.subdivisionGranularity),t.featureIndex.insert(r,l.geometry,a,s,this.index,!0)}}addFeatures(e,t,n){for(const r of this.features){const{geometry:i}=r;this.addFeature(r,i,r.index,t,n,e.subdivisionGranularity)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n})}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pc),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ic.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,r,i,a){for(const s of nr(t,500)){const t={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(t,r,e,s,a);const i=this.layoutVertexArray.length-n,o=Math.floor(t.x/t.sampleCount),l=Math.floor(t.y/t.sampleCount);for(let e=0;e<i;e++)this.centroidVertexArray.emplaceBack(o,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,canonical:r})}processPolygon(e,t,n,r,i){if(r.length<1)return;if(qc(r[0]))return;for(const u of r)0!==u.length&&Vc(e,u);const a={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},s=i.fill.getGranularityForZoomLevel(t.z),o="Polygon"===Mc.types[n.type];for(const u of r){if(0===u.length)continue;if(qc(u))continue;const e=_c(u,s,o);this._generateSideFaces(e,a)}if(!o)return;const l=yc(r,t,s,!1),c=this.layoutVertexArray;xc((e,t)=>{Oc(c,e,t,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(e,t){let n=0;for(let r=1;r<e.length;r++){const i=e[r],a=e[r-1];if(Uc(i,a))continue;t.segment.vertexLength+4>ao.MAX_VERTEX_ARRAY_LENGTH&&(t.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const s=i.sub(a)._perp()._unit(),o=a.dist(i);n+o>32768&&(n=0),Oc(this.layoutVertexArray,i.x,i.y,s.x,s.y,0,0,n),Oc(this.layoutVertexArray,i.x,i.y,s.x,s.y,0,1,n),n+=o,Oc(this.layoutVertexArray,a.x,a.y,s.x,s.y,0,0,n),Oc(this.layoutVertexArray,a.x,a.y,s.x,s.y,0,1,n);const l=t.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),t.segment.vertexLength+=4,t.segment.primitiveLength+=2}}}function Vc(e,t){for(let n=0;n<t.length;n++){const r=t[n];n===t.length-1&&t[0].x===r.x&&t[0].y===r.y||(e.x+=r.x,e.y+=r.y,e.sampleCount++)}}function Uc(e,t){return e.x===t.x&&(e.x<0||e.x>M)||e.y===t.y&&(e.y<0||e.y>M)}function qc(e){return e.every(e=>e.x<0)||e.every(e=>e.x>M)||e.every(e=>e.y<0)||e.every(e=>e.y>M)}let $c;pa("FillExtrusionBucket",Bc,{omit:["layers","features"]});var Gc={get paint(){return $c=$c||new Ya({"fill-extrusion-opacity":new Ga(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ha(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ga(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ga(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Za(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ha(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ha(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ga(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hc extends Ka{constructor(e,t){super(e,Gc,t)}createBucket(e){return new Bc(e)}queryRadius(){return il(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:n,geometry:i,transform:a,pixelsToTileUnits:s,pixelPosMatrix:o}){const l=al(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-a.bearingInRadians,s),c=this.paint.get("fill-extrusion-height").evaluate(t,n),u=this.paint.get("fill-extrusion-base").evaluate(t,n),h=function(e,t){const n=[];for(const i of e){const e=[i.x,i.y,0,1];T(e,e,t),n.push(new r(e[0]/e[3],e[1]/e[3]))}return n}(l,o),d=function(e,t,n,i){const a=[],s=[],o=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,h=i[8]*n,d=i[9]*n,p=i[10]*n,f=i[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const a=n.x,s=n.y,m=i[0]*a+i[4]*s+i[12],g=i[1]*a+i[5]*s+i[13],y=i[2]*a+i[6]*s+i[14],_=i[3]*a+i[7]*s+i[15],v=y+c,x=_+u,b=m+h,w=g+d,S=y+p,k=_+f,T=new r((m+o)/x,(g+l)/x);T.z=v/x,e.push(T);const C=new r(b/k,w/k);C.z=S/k,t.push(C)}a.push(e),s.push(t)}return[a,s]}(i,u,c,o);return function(e,t,n){let r=1/0;Wo(n,t)&&(r=Wc(n,t[0]));for(let i=0;i<t.length;i++){const a=t[i],s=e[i];for(let e=0;e<a.length-1;e++){const t=a[e],i=[t,a[e+1],s[e+1],s[e],t];Ho(n,i)&&(r=Math.min(r,Wc(n,i)))}}return r!==1/0&&r}(d[0],d[1],h)}}function Zc(e,t){return e.x*t.x+e.y*t.y}function Wc(e,t){if(1===e.length){let n=0;const r=t[n++];let i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){const a=t[n],s=e[0],o=i.sub(r),l=a.sub(r),c=s.sub(r),u=Zc(o,o),h=Zc(o,l),d=Zc(l,l),p=Zc(c,o),f=Zc(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=r.z*(1-g-y)+i.z*g+a.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}const Xc=is([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yc}=Xc,Kc=is([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qc}=Kc,Jc=Math.cos(Math.PI/180*37.5),eu=Math.pow(2,14)/.5;class tu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Hs,this.layoutVertexArray2=new Zs,this.indexArray=new to,this.programConfigurations=new No(e.layers,e.zoom),this.segments=new ao,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n){this.hasDependencies=Ol("line",this.layers,t)||this.hasLineDasharray(this.layers);const r=this.layers[0].layout.get("line-sort-key"),i=!r.isConstant(),a=[];for(const{feature:s,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Uo(s,e);if(!this.layers[0]._featureFilter.filter(new Ra(this.zoom),t,n))continue;const u=i?r.evaluate(t,{},n):void 0,h={id:o,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?t.geometry:Vo(s),patterns:{},dashes:{},sortKey:u};a.push(h)}i&&a.sort((e,t)=>e.sortKey-t.sortKey);for(const s of a){const{geometry:r,index:i,sourceLayerIndex:a}=s;this.hasDependencies?(Ol("line",this.layers,t)?Bl("line",this.layers,s,{zoom:this.zoom},t):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,s,this.zoom,t),this.patternFeatures.push(s)):this.addFeature(s,r,i,n,{},{},t.subdivisionGranularity),t.featureIndex.insert(e[i].feature,r,i,a,this.index)}}update(e,t,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,{imagePositions:n,dashPositions:r})}addFeatures(e,t,n,r){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n,r,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,r,i,a,s){const o=this.layers[0].layout,l=o.get("line-join").evaluate(e,{}),c=o.get("line-cap"),u=o.get("line-miter-limit"),h=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h,r,s);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{imagePositions:i,dashPositions:a,canonical:r})}addLine(e,t,n,r,i,a,s,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=_c(e,s?o.line.getGranularityForZoomLevel(s.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===Mc.types[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===n&&(i=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,m,g,y;this.e1=this.e2=-1,l&&(p=e[c-2],y=e[u].sub(p)._unit()._perp());for(let _=u;_<c;_++){if(m=_===c-1?l?e[u+1]:void 0:e[_+1],m&&e[_].equals(m))continue;y&&(g=y),p&&(f=p),p=e[_],y=m?m.sub(p)._unit()._perp():g,g=g||y;let t=g.add(y);0===t.x&&0===t.y||t._unit();const s=g.x*y.x+g.y*y.y,o=t.x*y.x+t.y*y.y,v=0!==o?1/o:1/0,x=2*Math.sqrt(2-2*o),b=o<Jc&&f&&m,w=g.x*y.y-g.y*y.x>0;if(b&&_>u){const e=p.dist(f);if(e>2*h){const t=p.sub(p.sub(f)._mult(h/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,g,0,0,d),f=t}}const S=f&&m;let k=S?n:l?"butt":r;if(S&&"round"===k&&(v<a?k="miter":v<=2&&(k="fakeround")),"miter"===k&&v>i&&(k="bevel"),"bevel"===k&&(v>2&&(k="flipbevel"),v<i&&(k="miter")),f&&this.updateDistance(f,p),"miter"===k)t._mult(v),this.addCurrentVertex(p,t,0,0,d);else if("flipbevel"===k){if(v>100)t=y.mult(-1);else{const e=v*g.add(y).mag()/g.sub(y).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(p,t,0,0,d),this.addCurrentVertex(p,t.mult(-1),0,0,d)}else if("bevel"===k||"fakeround"===k){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(f&&this.addCurrentVertex(p,g,t,n,d),"fakeround"===k){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+s*(s*(3.55645-1.43519*s)-3.2452))*e*e+(.848013+s*(.215638*s-1.06021)))}const r=y.sub(g)._mult(n)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(p,r.x,r.y,!1,w,0,d)}}m&&this.addCurrentVertex(p,y,-t,-n,d)}else if("butt"===k)this.addCurrentVertex(p,t,0,0,d);else if("square"===k){const e=f?1:-1;this.addCurrentVertex(p,t,e,e,d)}else"round"===k&&(f&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,y,-1,-1,d,!0),this.addCurrentVertex(p,y,0,0,d)));if(b&&_<c-1){const e=p.dist(m);if(e>2*h){const t=p.add(m.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,y,0,0,d),p=t}}}}addCurrentVertex(e,t,n,r,i,a=!1){const s=t.y*r-t.x,o=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,i),this.addHalfVertex(e,s,o,a,!0,-r,i),this.distance>eu/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,r,i,a))}addHalfVertex({x:e,y:t},n,r,i,a,s,o){const l=.5*(this.lineClips?this.scaledDistance*(eu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(a?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,c,this.e2),o.primitiveLength++),a?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}hasLineDasharray(e){for(const t of e){const e=t.paint.get("line-dasharray");if(e&&!e.isConstant())return!0}return!1}addLineDashDependencies(e,t,n,r){for(const i of e){const e=i.paint.get("line-dasharray");if(!e||"constant"===e.value.kind)continue;const a="round"===i.layout.get("line-cap"),s={dasharray:e.value.evaluate({zoom:n-1},t,{}),round:a},o={dasharray:e.value.evaluate({zoom:n},t,{}),round:a},l={dasharray:e.value.evaluate({zoom:n+1},t,{}),round:a},c=`${s.dasharray.join(",")},${s.round}`,u=`${o.dasharray.join(",")},${o.round}`,h=`${l.dasharray.join(",")},${l.round}`;r.dashDependencies[c]=s,r.dashDependencies[u]=o,r.dashDependencies[h]=l,t.dashes[i.id]={min:c,mid:u,max:h}}}}let nu,ru;pa("LineBucket",tu,{omit:["layers","patternFeatures"]});var iu={get paint(){return ru=ru||new Ya({"line-opacity":new Ha(xe.paint_line["line-opacity"]),"line-color":new Ha(xe.paint_line["line-color"]),"line-translate":new Ga(xe.paint_line["line-translate"]),"line-translate-anchor":new Ga(xe.paint_line["line-translate-anchor"]),"line-width":new Ha(xe.paint_line["line-width"]),"line-gap-width":new Ha(xe.paint_line["line-gap-width"]),"line-offset":new Ha(xe.paint_line["line-offset"]),"line-blur":new Ha(xe.paint_line["line-blur"]),"line-dasharray":new Za(xe.paint_line["line-dasharray"]),"line-pattern":new Za(xe.paint_line["line-pattern"]),"line-gradient":new Xa(xe.paint_line["line-gradient"])})},get layout(){return nu=nu||new Ya({"line-cap":new Ga(xe.layout_line["line-cap"]),"line-join":new Ha(xe.layout_line["line-join"]),"line-miter-limit":new Ga(xe.layout_line["line-miter-limit"]),"line-round-limit":new Ga(xe.layout_line["line-round-limit"]),"line-sort-key":new Ha(xe.layout_line["line-sort-key"])})}};class au extends Ha{possiblyEvaluate(e,t){return t=new Ra(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=O({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}let su;class ou extends Ka{constructor(e,t){super(e,iu,t),this.gradientVersion=0,su||(su=new au(iu.paint.properties["line-width"].specification),su.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!(void 0===e._styleExpression)&&e._styleExpression.expression instanceof cn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=su.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new tu(e)}queryRadius(e){const t=e,n=lu(rl("line-width",this,t),rl("line-gap-width",this,t)),r=rl("line-offset",this,t);return n/2+Math.abs(r)+il(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:n,geometry:i,transform:a,pixelsToTileUnits:s}){const o=al(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-a.bearingInRadians,s),l=s/2*lu(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(i=function(e,t){const n=[];for(let i=0;i<e.length;i++){const a=sl(e[i]),s=[];for(let e=0;e<a.length;e++){const n=a[e],i=a[e-1],o=a[e+1],l=0===e?new r(0,0):n.sub(i)._unit()._perp(),c=e===a.length-1?new r(0,0):o.sub(n)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(t)._add(n))}n.push(s)}return n}(i,c*s)),function(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(e.length>=3)for(let t=0;t<i.length;t++)if(tl(e,i[t]))return!0;if(Xo(e,i,n))return!0}return!1}(o,i,l)}isTileClipped(){return!0}}function lu(e,t){return t>0?t+2*e:e}const cu=is([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uu=is([{name:"a_projected_pos",components:3,type:"Float32"}],4);is([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hu=is([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);is([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const du=is([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pu=is([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fu(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Da.applyArabicShaping&&(e=Da.applyArabicShaping(e)),e}(e.text,t,n)}),e}is([{name:"triangle",components:3,type:"Uint16"}]),is([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),is([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),is([{type:"Float32",name:"offsetX"}]),is([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),is([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var mu=24;const gu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},yu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_u={40:!0};function vu(e,t,n,r,i,a){if("fontStack"in t){const r=n[t.fontStack],a=r&&r[e];return a?a.metrics.advance*t.scale+i:0}{const e=r[t.imageName];return e?e.displaySize[0]*t.scale*mu/a+i:0}}function xu(e,t,n,r){const i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function bu(e,t,n){let r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function wu(e,t,n,r,i,a){let s=null,o=xu(t,n,i,a);for(const l of r){const e=xu(t-l.x,n,i,a)+l.badness;e<=o&&(s=l,o=e)}return{index:e,x:t,priorBreak:s,badness:o}}function Su(e){return e?Su(e.priorBreak).concat(e.index):[]}class ku{constructor(e="",t=[],n=[]){this.text=e,this.sections=t,this.sectionIndex=n,this.imageSectionID=null}static fromFeature(e,t){const n=new ku;for(let r=0;r<e.sections.length;r++){const i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=function(e){let t="",n={premature:!0,value:void 0};const r=e[Symbol.iterator]();let i=r.next();const a=e[Symbol.iterator]();a.next();let s=a.next();for(;!i.done;)t+=!s.done&&Ia(s.value.codePointAt(0))&&!gu[s.value]||!n.premature&&Ia(n.value.codePointAt(0))&&!gu[n.value]||!gu[i.value]?i.value:gu[i.value],n={value:i.value,premature:!1},i=r.next(),s=a.next();return t}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),t=e?e[0].length:0,n=this.text.match(/\S\s*$/),r=n?n[0].length-1:0;this.text=this.text.substring(t,this.text.length-r),this.sectionIndex=this.sectionIndex.slice(t,this.sectionIndex.length-r)}substring(e,t){const n=[...this.text].slice(e,t).join(""),r=this.sectionIndex.slice(e,t);return new ku(n,this.sections,r)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}getMaxImageSize(e){let t=0,n=0;for(let r=0;r<this.length();r++){const i=this.getSection(r);if("imageName"in i){const r=e[i.imageName];if(!r)continue;const a=r.displaySize;t=Math.max(t,a[0]),n=Math.max(n,a[1])}}return{maxImageWidth:t,maxImageHeight:n}}addTextSection(e,t){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||t});const n=this.sections.length-1;this.sectionIndex.push(...[...e.text].map(()=>n))}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void G("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:t}),this.sectionIndex.push(this.sections.length-1)):G("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,t,n,r,i){const a=[],s=this.determineAverageLineWidth(e,t,n,r,i),o=this.hasZeroWidthSpaces();let l=0,c=0;const u=this.text[Symbol.iterator]();let h=u.next();const d=this.text[Symbol.iterator]();d.next();let p=d.next();const f=this.text[Symbol.iterator]();f.next(),f.next();let m=f.next();for(;!h.done;){const t=this.getSection(c),g=h.value.codePointAt(0);if(wa(g)||(l+=vu(g,t,n,r,e,i)),!p.done){const e=xa(g),n=p.value.codePointAt(0);(yu[g]||e||"imageName"in t||!m.done&&_u[n])&&a.push(wu(c+1,l,s,a,bu(g,n,e&&o),!1))}c++,h=u.next(),p=d.next(),m=f.next()}return Su(wu(this.length(),l,s,a,0,!0))}determineAverageLineWidth(e,t,n,r,i){let a=0,s=0;for(const o of this.text){const t=this.getSection(s);a+=vu(o.codePointAt(0),t,n,r,e,i),s++}return a/Math.max(1,Math.ceil(a/t))}}const Tu=4294967296,Cu=1/Tu,Eu="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class Iu{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,n=this.length){for(;this.pos<n;){const n=this.readVarint(),r=n>>3,i=this.pos;this.type=7&n,e(r,t,this),this.pos===i&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Tu;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Tu;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,r;return r=t[this.pos++],n=127&r,r<128?n:(r=t[this.pos++],n|=(127&r)<<7,r<128?n:(r=t[this.pos++],n|=(127&r)<<14,r<128?n:(r=t[this.pos++],n|=(127&r)<<21,r<128?n:(r=t[this.pos],n|=(15&r)<<28,function(e,t,n){const r=n.buf;let i,a;if(a=r[n.pos++],i=(112&a)>>4,a<128)return Pu(e,i,t);if(a=r[n.pos++],i|=(127&a)<<3,a<128)return Pu(e,i,t);if(a=r[n.pos++],i|=(127&a)<<10,a<128)return Pu(e,i,t);if(a=r[n.pos++],i|=(127&a)<<17,a<128)return Pu(e,i,t);if(a=r[n.pos++],i|=(127&a)<<24,a<128)return Pu(e,i,t);if(a=r[n.pos++],i|=(1&a)<<31,a<128)return Pu(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Eu?Eu.decode(this.buf.subarray(t,e)):function(e,t,n){let r="",i=t;for(;i<n;){const t=e[i];let a,s,o,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>n)break;1===c?t<128&&(l=t):2===c?(a=e[i+1],128==(192&a)&&(l=(31&t)<<6|63&a,l<=127&&(l=null))):3===c?(a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&t)<<12|(63&a)<<6|63&s,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&t)<<18|(63&a)<<12|(63&s)<<6|63&o,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Cu),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Cu),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");var i,a;t.realloc(10),i=n,(a=t).buf[a.pos++]=127&i|128,i>>>=7,a.buf[a.pos++]=127&i|128,i>>>=7,a.buf[a.pos++]=127&i|128,i>>>=7,a.buf[a.pos++]=127&i|128,a.buf[a.pos]=127&(i>>>=7),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let r,i,a=0;a<t.length;a++){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&Mu(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const r=this.pos-n;r>=128&&Mu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Au,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,zu,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Lu,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Du,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Ru,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Nu,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,ju,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Fu,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Ou,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function Pu(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Mu(e,t,n){const r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(let i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function Au(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function zu(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function Du(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function Ru(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function Lu(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function Nu(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function ju(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function Fu(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function Ou(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Bu(e,t,n){1===e&&n.readMessage(Vu,t)}function Vu(e,t,n){if(3===e){const{id:e,bitmap:r,width:i,height:a,left:s,top:o,advance:l}=n.readMessage(Uu,{});t.push({id:e,bitmap:new Sl({width:i+6,height:a+6},r),metrics:{width:i,height:a,left:s,top:o,advance:l}})}}function Uu(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function qu(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort((e,t)=>t.h-e.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let i=0,a=0;for(const s of e)for(let e=r.length-1;e>=0;e--){const t=r[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,a=Math.max(a,s.y+s.h),i=Math.max(i,s.x+s.w),s.w===t.w&&s.h===t.h){const t=r.pop();t&&e<r.length&&(r[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(r.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:i,h:a,fill:t/(i*a)||0}}class $u{constructor(e,{pixelRatio:t,version:n,stretchX:r,stretchY:i,content:a,textFitWidth:s,textFitHeight:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=i,this.content=a,this.version=n,this.textFitWidth=s,this.textFitHeight=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gu{constructor(e,t){const n={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,n,i),this.addImages(t,r,i);const{w:a,h:s}=qu(i),o=new kl({width:a||1,height:s||1});for(const l in e){const t=e[l],r=n[l].paddedRect;kl.copy(t.data,o,{x:0,y:0},{x:r.x+1,y:r.y+1},t.data)}for(const l in t){const e=t[l],n=r[l].paddedRect,i=n.x+1,a=n.y+1,s=e.data.width,c=e.data.height;kl.copy(e.data,o,{x:0,y:0},{x:i,y:a},e.data),kl.copy(e.data,o,{x:0,y:c-1},{x:i,y:a-1},{width:s,height:1}),kl.copy(e.data,o,{x:0,y:0},{x:i,y:a+c},{width:s,height:1}),kl.copy(e.data,o,{x:s-1,y:0},{x:i-1,y:a},{width:1,height:c}),kl.copy(e.data,o,{x:0,y:0},{x:i+s,y:a},{width:1,height:c})}this.image=o,this.iconPositions=n,this.patternPositions=r}addImages(e,t,n){for(const r in e){const i=e[r],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(a),t[r]=new $u(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,i]=e.tl;n.update(t.data,void 0,{x:r,y:i})}}var Hu;function Zu(t,n,r,i,a,s,o,l,c,u,h,d,p,f,m){const g=ku.fromFeature(t,a);let y;d===e.az.vertical&&g.verticalizePunctuation();let _=g.determineLineBreaks(u,s,n,i,f);const{processBidirectionalText:v,processStyledBidirectionalText:x}=Da;if(v&&1===g.sections.length){y=[],_=_.map(e=>g.toCodeUnitIndex(e));const e=v(g.toString(),_);for(const t of e){const e=[...t].map(()=>0);y.push(new ku(t,g.sections,e))}}else if(x){y=[],_=_.map(e=>g.toCodeUnitIndex(e));let e=0;const t=[];for(const r of g.text)t.push(...Array(r.length).fill(g.sectionIndex[e])),e++;const n=x(g.text,t,_);for(const r of n){const e=[];let t="";for(const n of r[0])e.push(r[1][t.length]),t+=n;y.push(new ku(r[0],g.sections,e))}}else y=function(e,t){const n=[];let r=0;for(const i of t)n.push(e.substring(r,i)),r=i;return r<e.length()&&n.push(e.substring(r,e.length())),n}(g,_);const b=[],w={positionedLines:b,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,n,r,i,a,s,o,l,c,u,h){let d=0,p=0,f=0,m=0;const g="right"===o?1:"left"===o?0:.5,y=mu/h;let _=0;for(const b of i){b.trim();const i=b.getMaxScale(),s={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=s;const o=s.positionedGlyphs;let h=0;if(!b.length()){p+=a,++_;continue}const v=Xu(r,b,y);let x=0;for(const a of b.text){const s=b.getSection(x),f=a.codePointAt(0),m=Ku(l,u,f),g={glyph:f,imageName:null,x:d,y:p+-17,vertical:m,scale:1,fontStack:"",sectionIndex:b.getSectionIndex(x),metrics:null,rect:null};let _;if("fontStack"in s){if(_=Qu(s,f,m,v,t,n),!_)continue;g.fontStack=s.fontStack}else{if(e.iconsInText=!0,s.scale*=y,_=Ju(s,m,i,v,r),!_)continue;h=Math.max(h,_.imageOffset),g.imageName=s.imageName}const{rect:w,metrics:S,baselineOffset:k}=_;g.y+=k,g.scale=s.scale,g.metrics=S,g.rect=w,o.push(g),m?(e.verticalizable=!0,d+=("imageName"in s?S.advance:mu)*s.scale+c):d+=S.advance*s.scale+c,x++}0!==o.length&&(f=Math.max(d-c,f),eh(o,0,o.length-1,g)),d=0,s.lineOffset=Math.max(h,(i-1)*mu);const w=a*i+h;p+=w,m=Math.max(w,m),++_}const{horizontalAlign:v,verticalAlign:x}=Wu(s);(function(e,t,n,r,i,a,s,o,l){const c=(t-n)*i;let u=0;u=a!==s?-o*r- -17:-r*l*s+.5*s;for(const h of e)for(const e of h.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,g,v,x,f,m,a,p,i.length),e.top+=-x*p,e.bottom=e.top+p,e.left+=-v*f,e.right=e.left+f}(w,n,r,i,y,o,l,c,d,u,p,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&w}function Wu(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Xu(e,t,n){const r=t.getMaxScale()*mu,{maxImageWidth:i,maxImageHeight:a}=t.getMaxImageSize(e),s=Math.max(r,a*n);return{verticalLineContentWidth:Math.max(r,i*n),horizontalLineContentHeight:s}}function Yu(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function Ku(t,n,r){return!(t===e.az.horizontal||!n&&!ba(r)||n&&(wa(r)||(i=r,/\p{sc=Arab}/u.test(String.fromCodePoint(i)))));var i}function Qu(e,t,n,r,i,a){const s=a[e.fontStack],o=function(e,t,n,r){if(e&&e.rect)return e;const i=t[n.fontStack],a=i&&i[r];return a?{rect:null,metrics:a.metrics}:null}(s&&s[t],i,e,t);if(null===o)return null;let l;if(n)l=r.verticalLineContentWidth-e.scale*mu;else{const t=Yu(e.verticalAlign);l=(r.horizontalLineContentHeight-e.scale*mu)*t}return{rect:o.rect,metrics:o.metrics,baselineOffset:l}}function Ju(e,t,n,r,i){const a=i[e.imageName];if(!a)return null;const s=a.paddedRect,o=a.displaySize,l={width:o[0],height:o[1],left:1,top:-3,advance:t?o[1]:o[0]};let c;if(t)c=r.verticalLineContentWidth-o[1]*e.scale;else{const t=Yu(e.verticalAlign);c=(r.horizontalLineContentHeight-o[1]*e.scale)*t}return{rect:s,metrics:l,baselineOffset:c,imageOffset:(t?o[0]:o[1])*e.scale-mu*n}}function eh(e,t,n,r){if(0===r)return;const i=e[n],a=(e[n].x+i.metrics.advance*i.scale)*r;for(let s=t;s<=n;s++)e[s].x-=a}function th(e,t,n){const{horizontalAlign:r,verticalAlign:i}=Wu(n),a=t[0]-e.displaySize[0]*r,s=t[1]-e.displaySize[1]*i;return{image:e,top:s,bottom:s+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function nh(e){var t,n;let r=e.left,i=e.top,a=e.right-r,s=e.bottom-i;const o=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(n=e.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===o&&a/s<c||"proportional"===o){const e=Math.ceil(s*c);r*=e/a,a=e}}else if("proportional"===o&&"stretchOnly"===l&&0!==c&&a/s>c){const e=Math.ceil(a/c);i*=e/s,s=e}return{x1:r,y1:i,x2:r+a,y2:i+s}}function rh(e,t,n,r,i,a){const s=e.image;let o;if(s.content){const e=s.content,t=s.pixelRatio||1;o=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*a,c=t.right*a;let u,h,d,p;"width"===n||"both"===n?(p=i[0]+l-r[3],h=i[0]+c+r[1]):(p=i[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*a,m=t.bottom*a;return"height"===n||"both"===n?(u=i[1]+f-r[0],d=i[1]+m+r[2]):(u=i[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:o}}pa("ImagePosition",$u),pa("ImageAtlas",Gu),e.az=void 0,(Hu=e.az||(e.az={}))[Hu.none=0]="none",Hu[Hu.horizontal=1]="horizontal",Hu[Hu.vertical=2]="vertical",Hu[Hu.horizontalOnly=3]="horizontalOnly";const ih=128,ah=32640;function sh(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ra(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=n;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let a=i;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const s=t[i],o=t[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:o,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:o,minSize:n.evaluate(new Ra(s)),maxSize:n.evaluate(new Ra(o)),interpolationType:r}}}function oh(e,t,n){let r="never";const i=e.get(t);return i?r=i:e.get(n)&&(r="always"),r}const lh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ch(e,t,n,r,i,a,s,o,l,c,u,h,d){const p=o?Math.min(ah,Math.round(o[0])):0,f=o?Math.min(ah,Math.round(o[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),a,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function uh(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function hh(e){for(const t of e.sections)if(za(t.text))return!0;return!1}class dh{constructor(e){this.layoutVertexArray=new Ys,this.indexArray=new to,this.programConfigurations=e,this.segments=new ao,this.dynamicLayoutVertexArray=new Ks,this.opacityVertexArray=new Qs,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ds}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uu.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lh,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pa("SymbolBuffers",dh);class ph{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ao,this.collisionVertexArray=new eo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pa("CollisionBuffers",ph);class fh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(e=>e.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sh(this.zoom,n["text-size"]),this.iconSizeData=sh(this.zoom,n["icon-size"]);const r=this.layers[0].layout,i=r.get("symbol-sort-key"),a=r.get("symbol-z-order");this.canOverlap="never"!==oh(r,"text-overlap","text-allow-overlap")||"never"!==oh(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&!i.isConstant(),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(t=>e.az[t])),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=t.sourceID}createArrays(){this.text=new dh(new No(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new dh(new No(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ns,this.lineVertexArray=new js,this.symbolInstances=new Ls,this.textAnchorOffsets=new Os}calculateGlyphDependencies(e,t,n,r,i){for(const a of e)if(t[a.codePointAt(0)]=!0,(n||r)&&i){const e=gu[a];e&&(t[e.codePointAt(0)]=!0)}}populate(t,n,r){const i=this.layers[0],a=i.layout,s=a.get("text-font"),o=a.get("text-field"),l=a.get("icon-image"),c=("constant"!==o.value.kind||o.value.value instanceof zt&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=a.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Ra(this.zoom);for(const{feature:g,id:y,index:_,sourceLayerIndex:v}of t){const t=i._featureFilter.needGeometry,n=Uo(g,t);if(!i._featureFilter.filter(m,n,r))continue;let o,l;if(t||(n.geometry=Vo(g)),c){const e=i.getValueAndResolveTokens("text-field",n,r,f),t=zt.factory(e),a=this.hasRTLText=this.hasRTLText||hh(t);(!a||"unavailable"===Da.getRTLTextPluginStatus()||a&&Da.isParsed())&&(o=fu(t,i,n))}if(u){const e=i.getValueAndResolveTokens("icon-image",n,r,f);l=e instanceof Ot?e:Ot.fromString(e)}if(!o&&!l)continue;const x=this.sortFeaturesByKey?h.evaluate(n,{},r):void 0;if(this.features.push({id:y,text:o,icon:l,index:_,sourceLayerIndex:v,geometry:n.geometry,properties:g.properties,type:Mc.types[g.type],sortKey:x}),l&&(d[l.name]=!0),o){const t=s.evaluate(n,{},r).join(","),i="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.az.vertical)>=0;for(const e of o.sections)if(e.image)d[e.image.name]=!0;else{const n=Sa(o.toString()),r=e.fontStack||t,a=p[r]=p[r]||{};this.calculateGlyphDependencies(e.text,a,i,this.allowVerticalPlacement,n)}}}"line"===a.get("symbol-placement")&&(this.features=function(e){const t={},n={},r=[];let i=0;function a(t){r.push(e[t]),i++}function s(e,t,i){const a=n[e];return delete n[e],n[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(i[0]),a}function o(e,n,i){const a=t[n];return delete t[n],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=i[0].concat(r[a].geometry[0]),a}function l(e,t,n){const r=n?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){a(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=o(p,f,h),i=s(p,f,r[e].geometry);delete t[p],delete n[f],n[l(d,r[i].geometry,!0)]=i,r[e].geometry=null}else p in n?s(p,f,h):f in t?o(p,f,h):(a(c),t[p]=i-1,n[f]=i-1)}return r.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,{imagePositions:n}),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,{imagePositions:n}))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]);const i={};for(let a=e.segment+1;a<t.length;a++)i[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:n},a<t.length-1&&(n+=t[a+1].dist(t[a]));for(let a=e.segment||0;a>=0;a--)i[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:r},a>0&&(r+=t[a-1].dist(t[a]));for(let e=0;e<t.length;e++){const t=i[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,n,r,i,a,s,o,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,m=t.segments.prepareSegment(4*n.length,f,p,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&o===e.az.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let e=0;e<n.length;e++){const{tl:i,tr:a,bl:o,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=n[e],k=m.vertexLength,T=b[1];ch(f,l.x,l.y,i.x,T+i.y,u.x,u.y,r,w,h.x,h.y,y,x),ch(f,l.x,l.y,a.x,T+a.y,u.x+u.w,u.y,r,w,g.x,h.y,y,x),ch(f,l.x,l.y,o.x,T+o.y,u.x,u.y+u.h,r,w,h.x,g.y,y,x),ch(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,r,w,g.x,g.y,y,x),uh(t.dynamicLayoutVertexArray,l,_),p.emplaceBack(k,k+2,k+1),p.emplaceBack(k+1,k+2,k+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),e!==n.length-1&&S===n[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{imagePositions:{},canonical:d,formattedSection:v&&v[S]})}t.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],o,0,!1,0,h)}_addCollisionDebugVertex(e,t,n,r,i,a){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,r,i,Math.round(a.x),Math.round(a.y))}addCollisionDebugVertices(e,t,n,i,a,s,o){const l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,d=o.anchorX,p=o.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new r(e,t)),this._addCollisionDebugVertex(u,h,s,d,p,new r(n,t)),this._addCollisionDebugVertex(u,h,s,d,p,new r(n,i)),this._addCollisionDebugVertex(u,h,s,d,p,new r(e,i)),l.vertexLength+=4;const f=a.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,r){for(let i=e;i<t;i++){const e=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,r?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ph(Js,du.members,no),this.iconCollisionBox=new ph(Js,du.members,no);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,r,i,a,s,o,l){const c={};for(let u=t;u<n;u++){const t=e.get(u);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let u=r;u<i;u++){const t=e.get(u);c.verticalTextBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalTextFeatureIndex=t.featureIndex;break}for(let u=a;u<s;u++){const t=e.get(u);c.iconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.iconFeatureIndex=t.featureIndex;break}for(let u=o;u<l;u++){const t=e.get(u);c.verticalIconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalIconFeatureIndex=t.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs;for(let i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+2,i+1),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),r=[],i=[],a=[];for(let s=0;s<this.symbolInstances.length;++s){a.push(s);const e=this.symbolInstances.get(s);r.push(0|Math.round(t*e.anchorX+n*e.anchorY)),i.push(e.featureIndex)}return a.sort((e,t)=>r[e]-r[t]||i[t]-i[e]),a}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mh,gh;pa("SymbolBucket",fh,{omit:["layers","collisionBoxArray","features","compareText"]}),fh.MAX_GLYPHS=65535,fh.addDynamicAttributes=uh;var yh={get paint(){return gh=gh||new Ya({"icon-opacity":new Ha(xe.paint_symbol["icon-opacity"]),"icon-color":new Ha(xe.paint_symbol["icon-color"]),"icon-halo-color":new Ha(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ha(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ha(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ga(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ga(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ha(xe.paint_symbol["text-opacity"]),"text-color":new Ha(xe.paint_symbol["text-color"],{runtimeType:Be,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ha(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Ha(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ha(xe.paint_symbol["text-halo-blur"]),"text-translate":new Ga(xe.paint_symbol["text-translate"]),"text-translate-anchor":new Ga(xe.paint_symbol["text-translate-anchor"])})},get layout(){return mh=mh||new Ya({"symbol-placement":new Ga(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ga(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ga(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ha(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ga(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ga(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ga(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ga(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ga(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ga(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ha(xe.layout_symbol["icon-size"]),"icon-text-fit":new Ga(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ga(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ha(xe.layout_symbol["icon-image"]),"icon-rotate":new Ha(xe.layout_symbol["icon-rotate"]),"icon-padding":new Ha(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ga(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ha(xe.layout_symbol["icon-offset"]),"icon-anchor":new Ha(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ga(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ga(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ga(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Ha(xe.layout_symbol["text-field"]),"text-font":new Ha(xe.layout_symbol["text-font"]),"text-size":new Ha(xe.layout_symbol["text-size"]),"text-max-width":new Ha(xe.layout_symbol["text-max-width"]),"text-line-height":new Ga(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ha(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Ha(xe.layout_symbol["text-justify"]),"text-radial-offset":new Ha(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ga(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ha(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ha(xe.layout_symbol["text-anchor"]),"text-max-angle":new Ga(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ga(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Ha(xe.layout_symbol["text-rotate"]),"text-padding":new Ga(xe.layout_symbol["text-padding"]),"text-keep-upright":new Ga(xe.layout_symbol["text-keep-upright"]),"text-transform":new Ha(xe.layout_symbol["text-transform"]),"text-offset":new Ha(xe.layout_symbol["text-offset"]),"text-allow-overlap":new Ga(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ga(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ga(xe.layout_symbol["text-ignore-placement"]),"text-optional":new Ga(xe.layout_symbol["text-optional"])})}};class _h{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ne,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pa("FormatSectionOverride",_h,{omit:["defaultValue"]});class vh extends Ka{constructor(e,t){super(e,yh,t)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,r){const i=this.layout.get(e).evaluate(t,{},n,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||ri(a.value)||!i?i:(s=t.properties,i.replace(/{([^{}]+)}/g,(e,t)=>s&&t in s?String(s[t]):""));var s}createBucket(e){return new fh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of yh.paint.overridableProperties){if(!vh.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new _h(t),r=new ni(n,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new ai("source",r):new si("composite",r,t.value.zoomStops),this.paint._values[e]=new qa(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&vh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),r=yh.paint.properties[t];let i=!1;const a=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof zt)a(n.value.value.sections);else if("source"===n.value.kind||"composite"===n.value.kind){const e=t=>{i||(t instanceof Gt&&qt(t.value)===Ge?a(t.value.sections):t instanceof Mn?a(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return i}}let xh;var bh={get paint(){return xh=xh||new Ya({"background-color":new Ga(xe.paint_background["background-color"]),"background-pattern":new Wa(xe.paint_background["background-pattern"]),"background-opacity":new Ga(xe.paint_background["background-opacity"])})}};class wh extends Ka{constructor(e,t){super(e,bh,t)}}class Sh extends Ka{constructor(e,t){super(e,{},t),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class kh{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Th={once:!0},Ch=6371008.8;class Eh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(F(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Ch*Math.acos(Math.min(i,1))}static convert(e){if(e instanceof Eh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Eh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Eh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ih=2*Math.PI*Ch;function Ph(e){return Ih*Math.cos(e*Math.PI/180)}function Mh(e){return(180+e)/360}function Ah(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function zh(e,t){return e/Ph(t)}function Dh(e){return 360*e-180}function Rh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Lh(e,t){return e*Ph(Rh(t))}class Nh{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Eh.convert(e);return new Nh(Mh(n.lng),Ah(n.lat),zh(t,n.lat))}toLngLat(){return new Eh(Dh(this.x),Rh(this.y))}toAltitude(){return Lh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ih*(e=Rh(this.y),1/Math.cos(e*Math.PI/180));var e}}function jh(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class Fh{constructor(e,t,n){if(i=t,a=n,(r=e)<0||r>25||a<0||a>=Math.pow(2,r)||i<0||i>=Math.pow(2,r))throw new Error(`x=${t}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);var r,i,a;this.z=e,this.x=t,this.y=n,this.key=Vh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){const r=(a=this.y,s=this.z,o=jh(256*(i=this.x),256*(a=Math.pow(2,s)-a-1),s),l=jh(256*(i+1),256*(a+1),s),o[0]+","+o[1]+","+l[0]+","+l[1]);var i,a,s,o,l;const c=function(e,t,n){let r,i="";for(let a=e;a>0;a--)r=1<<a-1,i+=(t&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new r((e.x*t-this.x)*M,(e.y*t-this.y)*M)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Vh(e,t.z,t.z,t.x,t.y)}}class Bh{constructor(e,t,n,r,i){if(this.terrainRttPosMatrix32f=null,e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=t,this.canonical=new Fh(n,+r,+i),this.key=Vh(t,e,n,r,i)}clone(){return new Bh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new Bh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?Vh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Vh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;if(this.overscaledZ-e.overscaledZ<=0)return!1;if(0===e.overscaledZ)return this.overscaledZ>0;const t=this.canonical.z-e.canonical.z;return!(t<0)&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Bh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Bh(t,this.wrap,t,n,r),new Bh(t,this.wrap,t,n+1,r),new Bh(t,this.wrap,t,n,r+1),new Bh(t,this.wrap,t,n+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Nh(e.x-this.wrap,e.y))}}function Vh(e,t,n,r,i){(e*=2)<0&&(e=-1*e-1);const a=1<<n;return(a*a*e+a*i+r).toString(36)+n.toString(36)+t.toString(36)}function Uh(e,t){return t?e.properties[t]:e.id}function qh(e,t){const n={id:e.id};if(t.removeAllProperties&&(delete e.removeProperties,delete e.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(const r of t.removeProperties){const t=e.addOrUpdateProperties.findIndex(e=>e.key===r);t>-1&&e.addOrUpdateProperties.splice(t,1)}return(e.removeAllProperties||t.removeAllProperties)&&(n.removeAllProperties=!0),(e.removeProperties||t.removeProperties)&&(n.removeProperties=[...e.removeProperties||[],...t.removeProperties||[]]),(e.addOrUpdateProperties||t.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...e.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(e.newGeometry||t.newGeometry)&&(n.newGeometry=t.newGeometry||e.newGeometry),n}function $h(e){var t,n;if(!e)return{};const r={};return r.removeAll=e.removeAll,r.remove=new Set(e.remove||[]),r.add=new Map(null===(t=e.add)||void 0===t?void 0:t.map(e=>[e.id,e])),r.update=new Map(null===(n=e.update)||void 0===n?void 0:n.map(e=>[e.id,e])),r}pa("CanonicalTileID",Fh),pa("OverscaledTileID",Bh,{omit:["terrainRttPosMatrix32f"]});class Gh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const t=new Gh;return t.extend(e(new r(this.minX,this.minY))),t.extend(e(new r(this.maxX,this.minY))),t.extend(e(new r(this.minX,this.maxY))),t.extend(e(new r(this.maxX,this.maxY))),t}static fromPoints(e){const t=new Gh;for(const n of e)t.extend(n);return t}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Hh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Zh{constructor(e,t,n,r,i){this.type="Feature",this._vectorTileFeature=e,this._x=n,this._y=r,this._z=t,this.properties=e.properties,this.id=i}projectPoint(e,t,n,r){return[360*(e.x+t)/r-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+n)/r)*Math.PI))-90]}projectLine(e,t,n,r){return e.map(e=>this.projectPoint(e,t,n,r))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,t=e.extent*Math.pow(2,this._z),n=e.extent*this._x,r=e.extent*this._y,i=e.loadGeometry();switch(e.type){case 1:{const e=[];for(const t of i)e.push(t[0]);const a=this.projectLine(e,n,r,t);this._geometry=1===e.length?{type:"Point",coordinates:a[0]}:{type:"MultiPoint",coordinates:a};break}case 2:{const e=i.map(e=>this.projectLine(e,n,r,t));this._geometry=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e};break}case 3:{const e=zc(i),a=[];for(const i of e)a.push(i.map(e=>this.projectLine(e,n,r,t)));this._geometry=1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&"_x"!==t&&"_y"!==t&&"_z"!==t&&(e[t]=this[t]);return e}}class Wh{constructor(e,n,r){t(this,"_name"),t(this,"dataBuffer"),t(this,"nullabilityBuffer"),t(this,"_size"),this._name=e,this.dataBuffer=n,"number"==typeof r?this._size=r:(this.nullabilityBuffer=r,this._size=r.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Xh extends Wh{}class Yh extends Xh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Kh extends Xh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Qh extends Wh{constructor(e,n,r,i){super(e,n,i),t(this,"delta"),this.delta=r}}class Jh extends Qh{constructor(e,t,n,r){super(e,Int32Array.of(t),n,r)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class ed extends Wh{constructor(e,t,n){super(e,Int32Array.of(t),n)}getValueFromBuffer(e){return this.dataBuffer[0]}}class td{constructor(e,n,r,i,a=4096){t(this,"_name"),t(this,"_geometryVector"),t(this,"_idVector"),t(this,"_propertyVectors"),t(this,"_extent"),t(this,"propertyVectorsMap"),this._name=e,this._geometryVector=n,this._idVector=r,this._propertyVectors=i,this._extent=a}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(e=>[e.name,e]))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let t=0;for(;t<this.numFeatures;){let n;this.idVector&&(n=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(t)):this.idVector.getValue(t));const r=e?.next().value,i={};for(const e of this.propertyVectors){if(!e)continue;const n=e.name,r=e.getValue(t);null!==r&&(i[n]=r)}t++,yield{id:n,geometry:r,properties:i}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],t=this.geometryVector.getGeometries();for(let n=0;n<this.numFeatures;n++){let r;this.idVector&&(r=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const i={coordinates:t[n],type:this.geometryVector.geometryType(n)},a={};for(const e of this.propertyVectors){if(!e)continue;const t=e.name,r=e.getValue(n);null!==r&&(a[t]=r)}e.push({id:r,geometry:i,properties:a})}return e}containsMaxSaveIntegerValues(e){return e instanceof Yh||e instanceof ed&&e instanceof Jh||e instanceof Kh}}class nd{constructor(e){t(this,"value"),this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var rd,id,ad,sd,od,ld,cd,ud,hd,dd,pd;function fd(e,t,n){const r=new Int32Array(n);let i=0,a=t.get();for(let s=0;s<r.length;s++){let t=e[a++],n=127&t;t<128||(t=e[a++],n|=(127&t)<<7,t<128||(t=e[a++],n|=(127&t)<<14,t<128||(t=e[a++],n|=(127&t)<<21,t<128||(t=e[a++],n|=(15&t)<<28)))),r[i++]=n}return t.set(a),r}function md(e,t,n){const r=new BigInt64Array(n);for(let i=0;i<r.length;i++)r[i]=xd(e,t);return r}function gd(e,t){let n,r;return r=e[t.get()],t.increment(),n=127&r,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<7,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<14,r<128?n:(r=e[t.get()],t.increment(),n|=(127&r)<<21,r<128?n:(r=e[t.get()],n|=(15&r)<<28,function(e,t,n){let r,i;if(i=t[n.get()],n.increment(),r=(112&i)>>4,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<3,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<10,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<17,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(127&i)<<24,i<128)return 4294967296*r+(e>>>0);if(i=t[n.get()],n.increment(),r|=(1&i)<<31,i<128)return 4294967296*r+(e>>>0);throw new Error("Expected varint not more than 10 bytes")}(n,e,t)))))}function yd(e,t,n,r){throw new Error("FastPFor is not implemented yet.")}function _d(e){return e>>>1^-(1&e)}function vd(e){return e>>1n^-(1n&e)}function xd(e,t){let n=0n,r=0,i=t.get();for(;i<e.length;){const t=e[i++];if(n|=BigInt(127&t)<<BigInt(r),!(128&t))break;if(r+=7,r>=64)throw new Error("Varint too long")}return t.set(i),n}function bd(e,t,n){const r=new Int32Array(n);let i=0;for(let a=0;a<t;a++){const n=e[a];r.fill(e[a+t],i,i+n),i+=n}return r}function wd(e,t,n){const r=new BigInt64Array(n);let i=0;for(let a=0;a<t;a++){const n=Number(e[a]);r.fill(e[a+t],i,i+n),i+=n}return r}function Sd(e,t,n){const r=new Float64Array(n);let i=0;for(let a=0;a<t;a++){const n=e[a];r.fill(e[a+t],i,i+n),i+=n}return r}function kd(e){const t=e.length/4*4;let n=1;if(t>=4)for(let r=e[0];n<t-4;n+=4)r=e[n]+=r,r=e[n+1]+=r,r=e[n+2]+=r,r=e[n+3]+=r;for(;n!=e.length;)e[n]+=e[n-1],++n}function Td(e){e[0]=e[0]>>>1^-(1&e[0]),e[1]=e[1]>>>1^-(1&e[1]);const t=e.length/4*4;let n=2;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],a=e[n+3];e[n]=(t>>>1^-(1&t))+e[n-2],e[n+1]=(r>>>1^-(1&r))+e[n-1],e[n+2]=(i>>>1^-(1&i))+e[n],e[n+3]=(a>>>1^-(1&a))+e[n+1]}for(;n!=e.length;n+=2)e[n]=(e[n]>>>1^-(1&e[n]))+e[n-2],e[n+1]=(e[n+1]>>>1^-(1&e[n+1]))+e[n-1]}(pd=rd||(rd={})).NONE="NONE",pd.DELTA="DELTA",pd.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",pd.RLE="RLE",pd.MORTON="MORTON",pd.PDE="PDE",function(e){e.NONE="NONE",e.FAST_PFOR="FAST_PFOR",e.VARINT="VARINT",e.ALP="ALP"}(id||(id={})),function(e){e.PRESENT="PRESENT",e.DATA="DATA",e.OFFSET="OFFSET",e.LENGTH="LENGTH"}(ad||(ad={}));class Cd{constructor(e,n,r){t(this,"_dictionaryType"),t(this,"_offsetType"),t(this,"_lengthType"),this._dictionaryType=e,this._offsetType=n,this._lengthType=r}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ed(e,t){const n=function(e,t){const n=e[t.get()],r=Object.values(ad)[n>>4];let i=null;switch(r){case ad.DATA:i=new Cd(Object.values(sd)[15&n]);break;case ad.OFFSET:i=new Cd(null,Object.values(od)[15&n]);break;case ad.LENGTH:i=new Cd(null,null,Object.values(ld)[15&n])}t.increment();const a=e[t.get()],s=Object.values(rd)[a>>5],o=Object.values(rd)[a>>2&7],l=Object.values(id)[3&a];t.increment();const c=fd(e,t,2),u=c[0];return{physicalStreamType:r,logicalStreamType:i,logicalLevelTechnique1:s,logicalLevelTechnique2:o,physicalLevelTechnique:l,numValues:u,byteLength:c[1],decompressedCount:u}}(e,t);return n.logicalLevelTechnique1===rd.MORTON?function(e,t,n){const r=fd(t,n,2);return{physicalStreamType:e.physicalStreamType,logicalStreamType:e.logicalStreamType,logicalLevelTechnique1:e.logicalLevelTechnique1,logicalLevelTechnique2:e.logicalLevelTechnique2,physicalLevelTechnique:e.physicalLevelTechnique,numValues:e.numValues,byteLength:e.byteLength,decompressedCount:e.decompressedCount,numBits:r[0],coordinateShift:r[1]}}(n,e,t):rd.RLE!==n.logicalLevelTechnique1&&rd.RLE!==n.logicalLevelTechnique2||id.NONE===n.physicalLevelTechnique?n:function(e,t,n){const r=fd(t,n,2);return{physicalStreamType:e.physicalStreamType,logicalStreamType:e.logicalStreamType,logicalLevelTechnique1:e.logicalLevelTechnique1,logicalLevelTechnique2:e.logicalLevelTechnique2,physicalLevelTechnique:e.physicalLevelTechnique,numValues:e.numValues,byteLength:e.byteLength,decompressedCount:r[1],runs:r[0],numRleValues:r[1]}}(n,e,t)}!function(e){e.NONE="NONE",e.SINGLE="SINGLE",e.SHARED="SHARED",e.VERTEX="VERTEX",e.MORTON="MORTON",e.FSST="FSST"}(sd||(sd={})),function(e){e.VERTEX="VERTEX",e.INDEX="INDEX",e.STRING="STRING",e.KEY="KEY"}(od||(od={})),function(e){e.VAR_BINARY="VAR_BINARY",e.GEOMETRIES="GEOMETRIES",e.PARTS="PARTS",e.RINGS="RINGS",e.TRIANGLES="TRIANGLES",e.SYMBOL="SYMBOL",e.DICTIONARY="DICTIONARY"}(ld||(ld={})),function(e){e[e.FLAT=0]="FLAT",e[e.CONST=1]="CONST",e[e.SEQUENCE=2]="SEQUENCE",e[e.DICTIONARY=3]="DICTIONARY",e[e.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(cd||(cd={}));class Id{constructor(e,n){t(this,"values"),t(this,"_size"),this.values=e,this._size=n}get(e){const t=Math.floor(e/8);return 1==(this.values[t]>>e%8&1)}set(e,t){const n=Math.floor(e/8);this.values[n]=this.values[n]|(t?1:0)<<e%8}getInt(e){const t=Math.floor(e/8);return this.values[t]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Pd(e,t,n,r,i){return function(e,t,n){switch(t.logicalLevelTechnique1){case rd.DELTA:return t.logicalLevelTechnique2===rd.RLE?function(e,t,n){const r=new Int32Array(n);let i=0,a=0;for(let s=0;s<t;s++){const n=e[s],o=_d(e[s+t]);for(let e=0;e<n;e++)a+=o,r[i++]=a}return r}(e,t.runs,t.numRleValues):(function(e){e[0]=e[0]>>>1^-(1&e[0]);const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],a=e[n+3];e[n]=(t>>>1^-(1&t))+e[n-1],e[n+1]=(r>>>1^-(1&r))+e[n],e[n+2]=(i>>>1^-(1&i))+e[n+1],e[n+3]=(a>>>1^-(1&a))+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]>>>1^-(1&e[n]))+e[n-1]}(e),e);case rd.RLE:return r=e,i=t,n?function(e,t,n){const r=new Int32Array(n);let i=0;for(let a=0;a<t;a++){const n=e[a];let s=e[a+t];s=s>>>1^-(1&s),r.fill(s,i,i+n),i+=n}return r}(r,i.runs,i.numRleValues):bd(r,i.runs,i.numRleValues);case rd.MORTON:return kd(e),e;case rd.COMPONENTWISE_DELTA:return Td(e),e;case rd.NONE:return n&&function(e){for(let t=0;t<e.length;t++){const n=e[t];e[t]=n>>>1^-(1&n)}}(e),e;default:throw new Error(`The specified Logical level technique is not supported: ${t.logicalLevelTechnique1}`)}var r,i}(Ad(e,t,n),n,r)}function Md(e,t,n){return function(e,t){if(t.logicalLevelTechnique1===rd.DELTA&&t.logicalLevelTechnique2===rd.NONE)return function(e){const t=new Int32Array(e.length+1);t[0]=0,t[1]=_d(e[0]);let n=t[1],r=2;for(;r!=t.length;++r){const i=e[r-1];n+=i>>>1^-(1&i),t[r]=t[r-1]+n}return t}(e);if(t.logicalLevelTechnique1===rd.RLE&&t.logicalLevelTechnique2===rd.NONE)return function(e,t,n){const r=new Int32Array(n+1);r[0]=0;let i=1,a=r[0];for(let s=0;s<t;s++){const n=e[s],o=e[s+t];for(let e=i;e<i+n;e++)r[e]=o+a,a=r[e];i+=n}return r}(e,t.runs,t.numRleValues);if(t.logicalLevelTechnique1===rd.NONE&&t.logicalLevelTechnique2===rd.NONE){!function(e){let t=0;for(let n=0;n<e.length;n++)e[n]+=t,t=e[n]}(e);const n=new Int32Array(t.numValues+1);return n[0]=0,n.set(e,1),n}if(t.logicalLevelTechnique1===rd.DELTA&&t.logicalLevelTechnique2===rd.RLE){const n=function(e,t,n){const r=new Int32Array(n+1);r[0]=0;let i=1,a=r[0];for(let s=0;s<t;s++){const n=e[s];let o=e[s+t];o=o>>>1^-(1&o);for(let e=i;e<i+n;e++)r[e]=o+a,a=r[e];i+=n}return r}(e,t.runs,t.numRleValues);return kd(n),n}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(Ad(e,t,n),n)}function Ad(e,t,n){const r=n.physicalLevelTechnique;if(r===id.FAST_PFOR)return yd();if(r===id.VARINT)return fd(e,t,n.numValues);if(r===id.NONE){const r=t.get();t.add(n.byteLength);const i=e.subarray(r,t.get());return new Int32Array(i)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function zd(e,t,n,r){const i=Ad(e,t,n);if(1===i.length){const e=i[0];return r?_d(e):e}return r?_d(i[1]):function(e){return e[1]}(i)}function Dd(e,t,n){return function(e){if(2==e.length){const t=_d(e[1]);return[t,t]}return[_d(e[2]),_d(e[3])]}(Ad(e,t,n))}function Rd(e,t,n){return function(e){if(2==e.length){const t=vd(e[1]);return[t,t]}return[vd(e[2]),vd(e[3])]}(md(e,t,n.numValues))}function Ld(e,t,n,r){return function(e,t,n){switch(t.logicalLevelTechnique1){case rd.DELTA:return t.logicalLevelTechnique2===rd.RLE?function(e,t,n){const r=new BigInt64Array(n);let i=0,a=0n;for(let s=0;s<t;s++){const n=Number(e[s]),o=vd(e[s+t]);for(let e=0;e<n;e++)a+=o,r[i++]=a}return r}(e,t.runs,t.numRleValues):(function(e){e[0]=e[0]>>1n^-(1n&e[0]);const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],a=e[n+3];e[n]=(t>>1n^-(1n&t))+e[n-1],e[n+1]=(r>>1n^-(1n&r))+e[n],e[n+2]=(i>>1n^-(1n&i))+e[n+1],e[n+3]=(a>>1n^-(1n&a))+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]>>1n^-(1n&e[n]))+e[n-1]}(e),e);case rd.RLE:return r=e,i=t,n?function(e,t,n){const r=new BigInt64Array(n);let i=0;for(let a=0;a<t;a++){const n=Number(e[a]);let s=e[a+t];s=s>>1n^-(1n&s),r.fill(s,i,i+n),i+=n}return r}(r,i.runs,i.numRleValues):wd(r,i.runs,i.numRleValues);case rd.NONE:return n&&function(e){for(let t=0;t<e.length;t++){const n=e[t];e[t]=n>>1n^-(1n&n)}}(e),e;default:throw new Error(`The specified Logical level technique is not supported: ${t.logicalLevelTechnique1}`)}var r,i}(md(e,t,n.numValues),n,r)}function Nd(e,t,n,r){const i=md(e,t,n.numValues);if(1===i.length){const e=i[0];return r?vd(e):e}return r?vd(i[1]):function(e){return e[1]}(i)}function jd(e,t,n,r,i){return function(e,t,n,r){switch(t.logicalLevelTechnique1){case rd.DELTA:return t.logicalLevelTechnique2===rd.RLE&&(e=bd(e,t.runs,t.numRleValues)),function(e,t){const n=new Int32Array(e.size());let r=0;e.get(0)?(n[0]=e.get(0)?t[0]>>>1^-(1&t[0]):0,r=1):n[0]=0;let i=1;for(;i!=n.length;++i)n[i]=e.get(i)?n[i-1]+(t[r]>>>1^-(1&t[r++])):n[i-1];return n}(r,e);case rd.RLE:return function(e,t,n,r){const i=t;return n?function(e,t,n){const r=new Int32Array(e.size());let i=0;for(let a=0;a<n;a++){const s=t[a];let o=t[a+n];o=o>>>1^-(1&o);for(let t=i;t<i+s;t++)e.get(t)?r[t]=o:(r[t]=0,i++);i+=s}return r}(r,e,i.runs):function(e,t,n){const r=new Int32Array(e.size());let i=0;for(let a=0;a<n;a++){const s=t[a],o=t[a+n];for(let t=i;t<i+s;t++)e.get(t)?r[t]=o:(r[t]=0,i++);i+=s}return r}(r,e,i.runs)}(e,t,n,r);case rd.MORTON:return kd(e),e;case rd.COMPONENTWISE_DELTA:return Td(e),e;case rd.NONE:return e=n?function(e,t){const n=new Int32Array(e.size());let r=0,i=0;for(;i!=n.length;++i)if(e.get(i)){const e=t[r++];n[i]=e>>>1^-(1&e)}else n[i]=0;return n}(r,e):function(e,t){const n=new Int32Array(e.size());let r=0,i=0;for(;i!=n.length;++i)n[i]=e.get(i)?t[r++]:0;return n}(r,e);default:throw new Error("The specified Logical level technique is not supported")}}(n.physicalLevelTechnique===id.FAST_PFOR?yd():fd(e,t,n.numValues),n,r,i)}function Fd(e,t,n,r){const i=e.logicalLevelTechnique1;if(i===rd.RLE)return 1===e.runs?cd.CONST:cd.FLAT;const a=t instanceof Id?t.size():t;if(i===rd.DELTA&&e.logicalLevelTechnique2===rd.RLE){const t=e.runs,i=2;if(e.numRleValues!==a)return cd.FLAT;if(1===t)return cd.SEQUENCE;if(2===t){const t=r.get();let a;if(e.physicalLevelTechnique===id.VARINT)a=fd(n,r,4);else{const e=r.get();a=new Int32Array(n.buffer,n.byteOffset+e,4)}if(r.set(t),a[2]===i&&a[3]===i)return cd.SEQUENCE}}return 1===e.numValues?cd.CONST:cd.FLAT}class Od extends Xh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Bd extends Qh{constructor(e,t,n,r){super(e,BigInt64Array.of(t),n,r)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Vd{constructor(e,n,r){t(this,"_geometryOffsets"),t(this,"_partOffsets"),t(this,"_ringOffsets"),this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=r}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Ud(e,t,n){return{x:qd(e,t)-n,y:qd(e>>1,t)-n}}function qd(e,t){let n=0;for(let r=0;r<t;r++)n|=(e&1<<2*r)>>r;return n}!function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON",e[e.MULTIPOINT=3]="MULTIPOINT",e[e.MULTILINESTRING=4]="MULTILINESTRING",e[e.MULTIPOLYGON=5]="MULTIPOLYGON"}(ud||(ud={})),function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON"}(hd||(hd={})),function(e){e[e.MORTON=0]="MORTON",e[e.VEC_2=1]="VEC_2",e[e.VEC_3=2]="VEC_3"}(dd||(dd={}));class $d{createPoint(e){return[[e]]}createMultiPoint(e){return e.map(e=>[e])}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,t){return[e].concat(t)}createMultiPolygon(e){return e.flat()}}function Gd(e){const t=new Array(e.numGeometries);let n=1,i=1,a=1,s=0;const o=new $d;let l=0,c=0;const u=e.mortonSettings,h=e.topologyVector,d=h.geometryOffsets,p=h.partOffsets,f=h.ringOffsets,m=e.vertexOffsets,g=e.containsPolygonGeometry(),y=e.vertexBuffer;for(let _=0;_<e.numGeometries;_++){const h=e.geometryType(_);if(h===ud.POINT){if(m&&0!==m.length)if(e.vertexBufferType===dd.VEC_2){const e=2*m[c++],n=new r(y[e],y[e+1]);t[s++]=o.createPoint(n)}else{const e=Ud(y[m[c++]],u.numBits,u.coordinateShift),n=new r(e.x,e.y);t[s++]=o.createPoint(n)}else{const e=new r(y[l++],y[l++]);t[s++]=o.createPoint(e)}d&&a++,p&&n++,f&&i++}else if(h===ud.MULTIPOINT){const e=d[a]-d[a-1];a++;const n=new Array(e);if(m&&0!==m.length){for(let t=0;t<e;t++){const e=2*m[c++];n[t]=new r(y[e],y[e+1])}t[s++]=o.createMultiPoint(n)}else{for(let t=0;t<e;t++){const e=y[l++],i=y[l++];n[t]=new r(e,i)}t[s++]=o.createMultiPoint(n)}}else if(h===ud.LINESTRING){let r,h=0;g?(h=f[i]-f[i-1],i++):h=p[n]-p[n-1],n++,m&&0!==m.length?(r=e.vertexBufferType===dd.VEC_2?Yd(y,m,c,h,!1):Kd(y,m,c,h,!1,u),c+=h):(r=Xd(y,l,h,!1),l+=2*h),t[s++]=o.createLineString(r),d&&a++}else if(h===ud.POLYGON){const r=p[n]-p[n-1];n++;const h=new Array(r-1);let g=f[i]-f[i-1];if(i++,m&&0!==m.length){const n=e.vertexBufferType===dd.VEC_2?Zd(y,m,c,g):Wd(y,m,c,g,0,u);c+=g;for(let t=0;t<h.length;t++)g=f[i]-f[i-1],i++,h[t]=e.vertexBufferType===dd.VEC_2?Zd(y,m,c,g):Wd(y,m,c,g,0,u),c+=g;t[s++]=o.createPolygon(n,h)}else{const e=Hd(y,l,g);l+=2*g;for(let t=0;t<h.length;t++)g=f[i]-f[i-1],i++,h[t]=Hd(y,l,g),l+=2*g;t[s++]=o.createPolygon(e,h)}d&&a++}else if(h===ud.MULTILINESTRING){const r=d[a]-d[a-1];a++;const h=new Array(r);if(m&&0!==m.length){for(let t=0;t<r;t++){let r=0;g?(r=f[i]-f[i-1],i++):r=p[n]-p[n-1],n++;const a=e.vertexBufferType===dd.VEC_2?Yd(y,m,c,r,!1):Kd(y,m,c,r,!1,u);h[t]=a,c+=r}t[s++]=o.createMultiLineString(h)}else{for(let e=0;e<r;e++){let t=0;g?(t=f[i]-f[i-1],i++):t=p[n]-p[n-1],n++,h[e]=Xd(y,l,t,!1),l+=2*t}t[s++]=o.createMultiLineString(h)}}else{if(h!==ud.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const r=d[a]-d[a-1];a++;const h=new Array(r);let g=0;if(m&&0!==m.length){for(let t=0;t<r;t++){const r=p[n]-p[n-1];n++;const a=new Array(r-1);g=f[i]-f[i-1],i++;const s=e.vertexBufferType===dd.VEC_2?Zd(y,m,c,g):Wd(y,m,c,g,0,u);c+=g;for(let t=0;t<a.length;t++)g=f[i]-f[i-1],i++,a[t]=e.vertexBufferType===dd.VEC_2?Zd(y,m,c,g):Wd(y,m,c,g,0,u),c+=g;h[t]=o.createPolygon(s,a)}t[s++]=o.createMultiPolygon(h)}else{for(let e=0;e<r;e++){const t=p[n]-p[n-1];n++;const r=new Array(t-1);g=f[i]-f[i-1],i++;const a=Hd(y,l,g);l+=2*g;for(let e=0;e<r.length;e++){const t=f[i]-f[i-1];i++,r[e]=Hd(y,l,t),l+=2*t}h[e]=o.createPolygon(a,r)}t[s++]=o.createMultiPolygon(h)}}}}return t}function Hd(e,t,n){return Xd(e,t,n,!0)}function Zd(e,t,n,r){return Yd(e,t,n,r,!0)}function Wd(e,t,n,r,i,a){return Kd(e,t,n,r,!0,a)}function Xd(e,t,n,i){const a=new Array(i?n+1:n);for(let s=0;s<2*n;s+=2)a[s/2]=new r(e[t+s],e[t+s+1]);return i&&(a[a.length-1]=a[0]),a}function Yd(e,t,n,i,a){const s=new Array(a?i+1:i);for(let o=0;o<2*i;o+=2){const i=2*t[n+o/2];s[o/2]=new r(e[i],e[i+1])}return a&&(s[s.length-1]=s[0]),s}function Kd(e,t,n,i,a,s){const o=new Array(a?i+1:i);for(let l=0;l<i;l++){const i=Ud(e[t[n+l]],s.numBits,s.coordinateShift);o[l]=new r(i.x,i.y)}return a&&(o[o.length-1]=o[0]),o}class Qd{constructor(e,n,r,i,a){t(this,"_vertexBufferType"),t(this,"_topologyVector"),t(this,"_vertexOffsets"),t(this,"_vertexBuffer"),t(this,"_mortonSettings"),this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=r,this._vertexBuffer=i,this._mortonSettings=a}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Gd(this);let t=0;for(;t<this.numGeometries;)yield{coordinates:e[t],type:this.geometryType(t)},t++}getSimpleEncodedVertex(e){const t=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[t],this.vertexBuffer[t+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const t=Ud(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[t.x,t.y]}const t=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[t],this.vertexBuffer[t+1]]}getGeometries(){return Gd(this)}get mortonSettings(){return this._mortonSettings}}class Jd extends Qd{constructor(e,n,r,i,a,s,o){super(r,i,a,s,o),t(this,"_numGeometries"),t(this,"_geometryType"),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ud.POLYGON||this._geometryType===ud.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class ep extends Qd{constructor(e,n,r,i,a,s){super(e,r,i,a,s),t(this,"_geometryTypes"),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===ud.POLYGON||this.geometryType(e)===ud.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class tp{constructor(e,n,r,i){t(this,"_triangleOffsets"),t(this,"_indexBuffer"),t(this,"_vertexBuffer"),t(this,"_topologyVector"),this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=r,this._topologyVector=i}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),t=this._topologyVector,n=t.partOffsets,i=t.ringOffsets,a=t.geometryOffsets;let s=0,o=1,l=1,c=1;for(let u=0;u<this.numGeometries;u++)switch(this.geometryType(u)){case ud.POLYGON:{const t=n[o]-n[o-1];o++;const h=[];for(let e=0;e<t;e++){const e=i[l]-i[l-1];l++;const t=[];for(let n=0;n<e;n++){const e=this._vertexBuffer[s++],n=this._vertexBuffer[s++];t.push(new r(e,n))}t.length>0&&t.push(t[0]),h.push(t)}e[u]=h,a&&c++}break;case ud.MULTIPOLYGON:{const t=a[c]-a[c-1];c++;const h=[];for(let e=0;e<t;e++){const e=n[o]-n[o-1];o++;for(let t=0;t<e;t++){const e=i[l]-i[l-1];l++;const t=[];for(let n=0;n<e;n++){const e=this._vertexBuffer[s++],n=this._vertexBuffer[s++];t.push(new r(e,n))}t.length>0&&t.push(t[0]),h.push(t)}}e[u]=h}}return e}[Symbol.iterator](){return null}}function np(e,t,n,r,i,a){return new rp(e,t,n,r,i,a)}class rp extends tp{constructor(e,n,r,i,a,s){super(r,i,a,s),t(this,"_numGeometries"),t(this,"_geometryType"),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function ip(e,t,n,r,i){return new ap(e,t,n,r,i)}class ap extends tp{constructor(e,n,r,i,a){super(n,r,i,a),t(this,"_geometryTypes"),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function sp(e,t,n,r,i){const a=Ed(e,n);let s=null,o=null,l=null,c=null,u=null,h=null,d=null,p=null;if(Fd(a,r,e,n)===cd.CONST){const i=zd(e,n,a,!1);for(let r=0;r<t-1;r++){const t=Ed(e,n);switch(t.physicalStreamType){case ad.LENGTH:switch(t.logicalStreamType.lengthType){case ld.GEOMETRIES:s=Md(e,n,t);break;case ld.PARTS:o=Md(e,n,t);break;case ld.RINGS:l=Md(e,n,t);break;case ld.TRIANGLES:d=Md(e,n,t)}break;case ad.OFFSET:switch(t.logicalStreamType.offsetType){case od.VERTEX:c=Pd(e,n,t,!1);break;case od.INDEX:p=Pd(e,n,t,!1)}break;case ad.DATA:sd.VERTEX===t.logicalStreamType.dictionaryType?u=Pd(e,n,t,!0):(h={numBits:t.numBits,coordinateShift:t.coordinateShift},u=Pd(e,n,t,!1))}}return null!==p?null!=s||null!=o?np(r,i,d,p,u,new Vd(s,o,l)):np(r,i,d,p,u):null===h?(f=r,m=i,g=new Vd(s,o,l),y=c,_=u,new Jd(f,m,dd.VEC_2,g,y,_)):function(e,t,n,r,i,a){return new Jd(e,t,dd.MORTON,n,r,i,a)}(r,i,new Vd(s,o,l),c,u,h)}var f,m,g,y,_;const v=Pd(e,n,a,!1);for(let x=0;x<t-1;x++){const t=Ed(e,n);switch(t.physicalStreamType){case ad.LENGTH:switch(t.logicalStreamType.lengthType){case ld.GEOMETRIES:s=Pd(e,n,t,!1);break;case ld.PARTS:o=Pd(e,n,t,!1);break;case ld.RINGS:l=Pd(e,n,t,!1);break;case ld.TRIANGLES:d=Md(e,n,t)}break;case ad.OFFSET:switch(t.logicalStreamType.offsetType){case od.VERTEX:c=Pd(e,n,t,!1);break;case od.INDEX:p=Pd(e,n,t,!1)}break;case ad.DATA:sd.VERTEX===t.logicalStreamType.dictionaryType?u=Pd(e,n,t,!0):(h={numBits:t.numBits,coordinateShift:t.coordinateShift},u=Pd(e,n,t,!1))}}return null!==p&&null===o?ip(v,d,p,u):(null!==s?(s=op(v,s,2),null!==o&&null!==l?(o=lp(v,s,o,!1),l=function(e,t,n,r){const i=new Int32Array(n[n.length-1]+1);let a=0;i[0]=a;let s=1,o=1,l=0;for(let c=0;c<e.length;c++){const u=e[c],h=t[c+1]-t[c];if(0!==u&&3!==u)for(let e=0;e<h;e++){const e=n[s]-n[s-1];s++;for(let t=0;t<e;t++)a=i[o++]=a+r[l++]}else for(let e=0;e<h;e++)i[o++]=++a,s++}return i}(v,s,o,l)):null!==o&&(o=function(e,t,n){const r=new Int32Array(t[t.length-1]+1);let i=0;r[0]=i;let a=1,s=0;for(let o=0;o<e.length;o++){const l=e[o],c=t[o+1]-t[o];if(4===l||1===l)for(let e=0;e<c;e++)i=r[a++]=i+n[s++];else for(let e=0;e<c;e++)r[a++]=++i}return r}(v,s,o))):null!==o&&null!==l?(o=op(v,o,1),l=lp(v,o,l,!0)):null!==o&&(o=op(v,o,0)),null!==p?ip(v,d,p,u,new Vd(s,o,l)):null===h?function(e,t,n,r){return new ep(dd.VEC_2,e,t,n,r)}(v,new Vd(s,o,l),c,u):function(e,t,n,r,i){return new ep(dd.MORTON,e,t,n,r,i)}(v,new Vd(s,o,l),c,u,h))}function op(e,t,n){const r=new Int32Array(e.length+1);let i=0;r[0]=i;let a=0;for(let s=0;s<e.length;s++)i=r[s+1]=i+(e[s]>n?t[a++]:1);return r}function lp(e,t,n,r){const i=new Int32Array(t[t.length-1]+1);let a=0;i[0]=a;let s=1,o=0;for(let l=0;l<e.length;l++){const c=e[l],u=t[l+1]-t[l];if(5===c||2===c||r&&(4===c||1===c))for(let e=0;e<u;e++)a=i[s++]=a+n[o++];else for(let e=0;e<u;e++)i[s++]=++a}return i}class cp extends Wh{constructor(e,n,r){super(e,n.getBuffer(),r),t(this,"dataVector"),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class up extends Xh{getValueFromBuffer(e){return this.dataBuffer[e]}}class hp extends Wh{constructor(e,t,n){super(e,BigInt64Array.of(t),n)}getValueFromBuffer(e){return this.dataBuffer[0]}}function dp(e,t,n){return pp(e,Math.ceil(t/8),n)}function pp(e,t,n){const r=new Uint8Array(t);let i=0;for(;i<t;){const t=e[n.increment()];if(t<=127){const a=t+3,s=e[n.increment()],o=i+a;r.fill(s,i,o),i=o}else{const a=256-t;for(let t=0;t<a;t++)r[i++]=e[n.increment()]}}return r}const fp=new TextDecoder;function mp(e,t,n){return n-t>=12?fp.decode(e.subarray(t,n)):function(e,t,n){let r="",i=t;for(;i<n;){const t=e[i];let a,s,o,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>n)break;1===c?t<128&&(l=t):2===c?(a=e[i+1],128==(192&a)&&(l=(31&t)<<6|63&a,l<=127&&(l=null))):3===c?(a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&t)<<12|(63&a)<<6|63&s,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&t)<<18|(63&a)<<12|(63&s)<<6|63&o,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(e,t,n)}class gp extends Wh{constructor(e,n,r,i){super(e,r,i),t(this,"offsetBuffer"),this.offsetBuffer=n}}class yp extends gp{constructor(e,n,r,i){super(e,n,r,i??n.length-1),t(this,"textEncoder"),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return mp(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class _p extends gp{constructor(e,n,r,i,a){super(e,r,i,a??n.length),t(this,"indexBuffer"),t(this,"textEncoder"),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const t=this.indexBuffer[e];return mp(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class vp extends gp{constructor(e,n,r,i,a,s,o){super(e,r,i,o),t(this,"indexBuffer"),t(this,"symbolOffsetBuffer"),t(this,"symbolTableBuffer"),t(this,"textEncoder"),t(this,"symbolLengthBuffer"),t(this,"lengthBuffer"),t(this,"decodedDictionary"),this.indexBuffer=n,this.symbolOffsetBuffer=a,this.symbolTableBuffer=s,this.textEncoder=new TextEncoder}getValueFromBuffer(e){null==this.decodedDictionary&&(null==this.symbolLengthBuffer&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(e,t,n){const r=[],i=new Array(t.length).fill(0);for(let a=1;a<t.length;a++)i[a]=i[a-1]+t[a-1];for(let a=0;a<n.length;a++)if(255===n[a])r.push(n[++a]);else{const s=t[n[a]],o=i[n[a]];for(let t=0;t<s;t++)r.push(e[o+t])}return new Uint8Array(r)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const t=this.indexBuffer[e];return mp(this.decodedDictionary,this.offsetBuffer[t],this.offsetBuffer[t+1])}offsetToLengthBuffer(e){const t=new Uint32Array(e.length-1);let n=e[0];for(let r=1;r<e.length;r++){const i=e[r];t[r-1]=i-n,n=i}return t}}function xp(e,t,n,r,i,a){return"scalarType"===n.type?function(e,t,n,r,i,a){let s=null,o=0;if(0===e)return null;if(a.nullable){const e=Ed(t,n);o=e.numValues;const r=n.get(),i=dp(t,o,n);n.set(r+e.byteLength),s=new Id(i,e.numValues)}const l=s??r;switch(i.physicalType){case 4:case 3:return function(e,t,n,r,i){const a=Ed(e,t),s=Fd(a,i,e,t),o=3===r.physicalType;if(s===cd.FLAT){const r=bp(i)?jd(e,t,a,o,i):Pd(e,t,a,o);return new Yh(n.name,r,i)}if(s===cd.SEQUENCE){const r=Dd(e,t,a);return new Jh(n.name,r[0],r[1],a.numRleValues)}{const r=zd(e,t,a,o);return new ed(n.name,r,i)}}(t,n,a,i,l);case 9:return function(e,t,n,r,i){let a=null,s=null,o=null,l=null,c=null,u=null,h=null,d=null;for(let x=0;x<r;x++){const e=Ed(t,n);if(0!==e.byteLength)switch(e.physicalStreamType){case ad.PRESENT:{const r=dp(t,e.numValues,n);u=new Id(r,e.numValues);break}case ad.OFFSET:s=null!=i||null!=u?jd(t,n,e,!1,i??u):Pd(t,n,e,!1);break;case ad.LENGTH:{const r=Md(t,n,e);ld.DICTIONARY===e.logicalStreamType.lengthType?a=r:ld.SYMBOL===e.logicalStreamType.lengthType?l=r:h=r;break}case ad.DATA:{const r=t.subarray(n.get(),n.get()+e.byteLength);n.add(e.byteLength);const i=e.logicalStreamType.dictionaryType;sd.FSST===i?c=r:sd.SINGLE===i||sd.SHARED===i?o=r:sd.NONE===i&&(d=r);break}}}return p=e,m=s,g=a,y=o,_=l,v=i??u,((f=c)?new vp(p,m,g,y,_,f,v):null)??function(e,t,n,r,i){return t?i?new _p(e,n,r,t,i):new _p(e,n,r,t):null}(e,o,s,a,i??u)??function(e,t,n,r,i){if(!t||!n)return null;if(r)return i?new _p(e,r,t,n,i):new _p(e,r,t,n);if(i&&i.size()!==t.length-1){const r=new Int32Array(i.size());let a=0;for(let e=0;e<i.size();e++)r[e]=i.get(e)?a++:0;return new _p(e,r,t,n,i)}return i?new yp(e,t,n,i):new yp(e,t,n)}(e,h,d,s,i??u);var p,f,m,g,y,_,v}(a.name,t,n,a.nullable?e-1:e,s);case 0:return function(e,t,n,r,i){const a=Ed(e,t),s=a.numValues,o=t.get(),l=bp(i)?function(e,t,n,r){const i=pp(e,Math.ceil(t/8),n),a=new Id(i,t),s=r.size(),o=new Id(new Uint8Array(s),s);let l=0;for(let c=0;c<r.size();c++){const e=!!r.get(c)&&a.get(l++);o.set(c,e)}return o.getBuffer()}(e,s,t,i):dp(e,s,t);t.set(o+a.byteLength);const c=new Id(l,s);return new cp(n.name,c,i)}(t,n,a,0,l);case 6:case 5:return function(e,t,n,r,i){const a=Ed(e,t),s=Fd(a,r,e,t),o=5===i.physicalType;if(s===cd.FLAT){const i=bp(r)?(c=o,u=r,function(e,t,n,r){switch(t.logicalLevelTechnique1){case rd.DELTA:return t.logicalLevelTechnique2===rd.RLE&&(e=wd(e,t.runs,t.numRleValues)),function(e,t){const n=new BigInt64Array(e.size());let r=0;e.get(0)?(n[0]=e.get(0)?t[0]>>1n^-(1n&t[0]):0n,r=1):n[0]=0n;let i=1;for(;i!=n.length;++i)n[i]=e.get(i)?n[i-1]+(t[r]>>1n^-(1n&t[r++])):n[i-1];return n}(r,e);case rd.RLE:return function(e,t,n,r){const i=t;return n?function(e,t,n){const r=new BigInt64Array(e.size());let i=0;for(let a=0;a<n;a++){const s=Number(t[a]);let o=t[a+n];o=o>>1n^-(1n&o);for(let t=i;t<i+s;t++)e.get(t)?r[t]=o:(r[t]=0n,i++);i+=s}return r}(r,e,i.runs):function(e,t,n){const r=new BigInt64Array(e.size());let i=0;for(let a=0;a<n;a++){const s=Number(t[a]),o=t[a+n];for(let t=i;t<i+s;t++)e.get(t)?r[t]=o:(r[t]=0n,i++);i+=s}return r}(r,e,i.runs)}(e,t,n,r);case rd.NONE:return e=n?function(e,t){const n=new BigInt64Array(e.size());let r=0,i=0;for(;i!=n.length;++i)if(e.get(i)){const e=t[r++];n[i]=e>>1n^-(1n&e)}else n[i]=0n;return n}(r,e):function(e,t){const n=new BigInt64Array(e.size());let r=0,i=0;for(;i!=n.length;++i)n[i]=e.get(i)?t[r++]:0n;return n}(r,e);default:throw new Error("The specified Logical level technique is not supported")}}(md(e,t,(l=a).numValues),l,c,u)):Ld(e,t,a,o);return new Od(n.name,i,r)}var l,c,u;if(s===cd.SEQUENCE){const r=Rd(e,t,a);return new Bd(n.name,r[0],r[1],a.numRleValues)}{const i=Nd(e,t,a,o);return new hp(n.name,i,r)}}(t,n,a,l,i);case 7:return function(e,t,n,r){const i=Ed(e,t),a=bp(r)?function(e,t,n,r){const i=t.get(),a=i+r*Float32Array.BYTES_PER_ELEMENT,s=new Uint8Array(e.subarray(i,a)).buffer,o=new Float32Array(s);t.set(a);const l=n.size(),c=new Float32Array(l);let u=0;for(let h=0;h<l;h++)c[h]=n.get(h)?o[u++]:0;return c}(e,t,r,i.numValues):function(e,t,n){const r=t.get(),i=r+n*Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(e.subarray(r,i)).buffer,s=new Float32Array(a);return t.set(i),s}(e,t,i.numValues);return new up(n.name,a,r)}(t,n,a,l);case 8:return function(e,t,n,r){const i=Ed(e,t),a=bp(r)?function(e,t,n,r){const i=t.get(),a=i+r*Float64Array.BYTES_PER_ELEMENT,s=new Uint8Array(e.subarray(i,a)).buffer,o=new Float64Array(s);t.set(a);const l=n.size(),c=new Float64Array(l);let u=0;for(let h=0;h<l;h++)c[h]=n.get(h)?o[u++]:0;return c}(e,t,r,i.numValues):function(e,t,n){const r=t.get(),i=r+n*Float64Array.BYTES_PER_ELEMENT,a=new Uint8Array(e.subarray(r,i)).buffer,s=new Float64Array(a);return t.set(i),s}(e,t,i.numValues);return new Kh(n.name,a,r)}(t,n,a,l);default:throw new Error(`The specified data type for the field is currently not supported: ${i}`)}}(r,e,t,i,n.scalarType,n):1!=r?null:function(e,t,n,r){let i=null,a=null,s=null,o=null,l=!1;for(;!l;){const n=Ed(e,t);switch(n.physicalStreamType){case ad.LENGTH:ld.DICTIONARY===n.logicalStreamType.lengthType?i=Md(e,t,n):s=Md(e,t,n);break;case ad.DATA:sd.SINGLE===n.logicalStreamType.dictionaryType||sd.SHARED===n.logicalStreamType.dictionaryType?(a=e.subarray(t.get(),t.get()+n.byteLength),l=!0):o=e.subarray(t.get(),t.get()+n.byteLength),t.add(n.byteLength)}}const c=n.complexType.children,u=[];let h=0;for(const d of c){const l=fd(e,t,1)[0];if(0==l)continue;const c=`${n.name}${"default"===d.name?"":":"+d.name}`;if(2!==l||"scalarField"!==d.type||9!==d.scalarField.physicalType)throw new Error("Currently only optional string fields are implemented for a struct.");const p=Ed(e,t),f=dp(e,p.numValues,t),m=Ed(e,t),g=m.decompressedCount!==r?jd(e,t,m,!1,new Id(f,p.numValues)):Pd(e,t,m,!1);u[h++]=o?new vp(c,g,i,a,s,o,new Id(f,p.numValues)):new _p(c,g,i,a,new Id(f,p.numValues))}return u}(e,t,n,i)}function bp(e){return e instanceof Id}function wp(e){if("id"===e.name)return!1;if("scalarType"===e.type){const t=e.scalarType;if("physicalType"===t.type)switch(t.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if("logicalType"===t.type)return!1}else if("complexType"===e.type){const t=e.complexType;if("physicalType"===t.type)switch(t.physicalType){case 0:case 1:return!0;default:return!1}}return!1}const Sp=new TextDecoder;function kp(e,t){const n=fd(e,t,1)[0];if(0===n)return"";const r=t.get(),i=e.subarray(r,r+n);return t.add(n),Sp.decode(i)}function Tp(e,t){const n=fd(e,t,1)[0]>>>0,r=!!(4&n),i=!!(2&n),a=fd(e,t,1)[0]>>>0,s={};if(1&n&&(s.nullable=!0),i){const i={};if(r?(i.type="logicalType",i.logicalType=a):(i.type="physicalType",i.physicalType=a),8&n){const n=fd(e,t,1)[0]>>>0;i.children=new Array(n);for(let r=0;r<n;r++)i.children[r]=Tp(e,t)}s.type="complexField",s.complexField=i}else{const e={};r?(e.type="logicalType",e.logicalType=a):(e.type="physicalType",e.physicalType=a),s.type="scalarField",s.scalarField=e}return s}function Cp(e,t){const n=fd(e,t,1)[0]>>>0,r=function(e){switch(e){case 0:case 1:case 2:case 3:{const t={};t.nullable=!!(1&e),t.columnScope=0;const n={};return n.physicalType=e>1?6:4,n.type="physicalType",t.scalarType=n,t.type="scalarType",t}case 4:{const e={nullable:!1,columnScope:0},t={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=t,e}case 30:{const e={nullable:!1,columnScope:0},t={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=t,e}default:return function(e){let t=null;switch(e){case 10:case 11:t=0;break;case 12:case 13:t=1;break;case 14:case 15:t=2;break;case 16:case 17:t=3;break;case 18:case 19:t=4;break;case 20:case 21:t=5;break;case 22:case 23:t=6;break;case 24:case 25:t=7;break;case 26:case 27:t=8;break;case 28:case 29:t=9;break;default:return null}const n={};n.nullable=!!(1&e),n.columnScope=0;const r={type:"physicalType"};return r.physicalType=t,n.type="scalarType",n.scalarType=r,n}(e)}}(n);if(!r)throw new Error(`Unsupported column type code: ${n}`);if(n>=10?r.name=kp(e,t):n>=0&&n<=3?r.name="id":4===n&&(r.name="geometry"),function(e){return 30===e}(n)){const n=fd(e,t,1)[0]>>>0,i=r.complexType;i.children=new Array(n);for(let r=0;r<n;r++)i.children[r]=Tp(e,t)}return r}function Ep(e,t){const n={featureTables:[]},r={};r.name=kp(e,t);const i=fd(e,t,1)[0]>>>0,a=fd(e,t,1)[0]>>>0;r.columns=new Array(a);for(let s=0;s<a;s++)r.columns[s]=Cp(e,t);return n.featureTables.push(r),[n,i]}function Ip(e,t,n,r,i,a,s=!1){const o=t.scalarType.physicalType,l=Fd(i,a,e,n);if(4===o)switch(l){case cd.FLAT:{const t=Pd(e,n,i,!1);return new Yh(r,t,a)}case cd.SEQUENCE:{const t=Dd(e,n,i);return new Jh(r,t[0],t[1],i.numRleValues)}case cd.CONST:{const t=zd(e,n,i,!1);return new ed(r,t,a)}}else switch(l){case cd.FLAT:{if(s){const t=(c=n,function(e,t){switch(t.logicalLevelTechnique1){case rd.DELTA:return t.logicalLevelTechnique2===rd.RLE&&(e=Sd(e,t.runs,t.numRleValues)),function(e){e[0]=e[0]%2==1?(e[0]+1)/-2:e[0]/2;const t=e.length/4*4;let n=1;if(t>=4)for(;n<t-4;n+=4){const t=e[n],r=e[n+1],i=e[n+2],a=e[n+3];e[n]=(t%2==1?(t+1)/-2:t/2)+e[n-1],e[n+1]=(r%2==1?(r+1)/-2:r/2)+e[n],e[n+2]=(i%2==1?(i+1)/-2:i/2)+e[n+1],e[n+3]=(a%2==1?(a+1)/-2:a/2)+e[n+2]}for(;n!=e.length;++n)e[n]=(e[n]%2==1?(e[n]+1)/-2:e[n]/2)+e[n-1]}(e),e;case rd.RLE:return Sd(e,(n=t).runs,n.numRleValues);case rd.NONE:return e;default:throw new Error(`The specified Logical level technique is not supported: ${t.logicalLevelTechnique1}`)}var n}(function(e,t,n){const r=new Float64Array(t);for(let i=0;i<t;i++)r[i]=gd(e,n);return r}(e,(u=i).numValues,c),u));return new Kh(r,t,a)}const t=Ld(e,n,i,!1);return new Od(r,t,a)}case cd.SEQUENCE:{const t=Rd(e,n,i);return new Bd(r,t[0],t[1],i.numRleValues)}case cd.CONST:{const t=Nd(e,n,i,!1);return new hp(r,t,a)}}var c,u;throw new Error("Vector type not supported for id column.")}class Pp{constructor(e,t){var n;switch(this._featureData=e,this.properties=this._featureData.properties||{},null===(n=this._featureData.geometry)||void 0===n?void 0:n.type){case ud.POINT:case ud.MULTIPOINT:this.type=1;break;case ud.LINESTRING:case ud.MULTILINESTRING:this.type=2;break;case ud.POLYGON:case ud.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=t,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const t of this._featureData.geometry.coordinates){const n=[];for(const e of t)n.push(new r(e.x,e.y));e.push(n)}return e}}class Mp{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Pp(this.features[e],this.extent)}}class Ap{constructor(e){this.layers={};const t=function(e,t,n=!0){const r=new nd(0),i=[];for(;r.get()<e.length;){const t=fd(e,r,1)[0]>>>0,a=r.get()+t;if(a>e.length)throw new Error(`Block overruns tile: ${a} > ${e.length}`);if(1!=fd(e,r,1)[0]>>>0){r.set(a);continue}const s=Ep(e,r),o=s[1],l=s[0].featureTables[0];let c=null,u=null;const h=[];let d=0;for(const i of l.columns){const t=i.name;if("id"===t){let a=null;if(i.nullable){const t=Ed(e,r),n=r.get(),i=dp(e,t.numValues,r);r.set(n+t.byteLength),a=new Id(i,t.numValues)}const s=Ed(e,r);d=s.decompressedCount,c=Ip(e,i,r,t,s,a??d,n)}else if("geometry"===t){const t=fd(e,r,1)[0];if(0===d){const t=r.get();d=Ed(e,r).decompressedCount,r.set(t)}u=sp(e,t,r,d)}else{const t=wp(i)?fd(e,r,1)[0]:1;if(0===t&&"scalarType"===i.type)continue;const n=xp(e,r,i,t,d);if(n)if(Array.isArray(n))for(const e of n)h.push(e);else h.push(n)}}const p=new td(l.name,u,c,h,o);i.push(p),r.set(a)}return i}(new Uint8Array(e));this.layers=t.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:new Mp(t)}),{})}}class zp{constructor(e,t){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=t,"id"in e&&("string"==typeof e.id?this.id=parseInt(e.id,10):"number"!=typeof e.id||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],t=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const n of t){const t=[];for(const e of n)t.push(new r(e[0],e[1]));e.push(t)}return e}}const Dp="_geojsonTileLayer";function Rp(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let a=0;a<e.length;a++)n.feature=e.feature(a),t.writeMessage(2,Lp,n);const r=n.keys;for(const a of r)t.writeStringField(3,a);const i=n.values;for(const a of i)t.writeMessage(4,Bp,a)}function Lp(e,t){if(!e.feature)return;const n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,Np,e),t.writeVarintField(3,n.type),t.writeMessage(4,Op,n)}function Np(e,t){for(const n in e.feature?.properties){let r=e.feature.properties[n],i=e.keycache[n];if(null==r)continue;void 0===i&&(e.keys.push(n),i=e.keys.length-1,e.keycache[n]=i),t.writeVarint(i),"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r&&(r=JSON.stringify(r));const a=typeof r+":"+r;let s=e.valuecache[a];void 0===s&&(e.values.push(r),s=e.values.length-1,e.valuecache[a]=s),t.writeVarint(s)}}function jp(e,t){return(t<<3)+(7&e)}function Fp(e){return e<<1^e>>31}function Op(e,t){const n=e.loadGeometry(),r=e.type;let i=0,a=0;for(const s of n){let n=1;1===r&&(n=s.length),t.writeVarint(jp(1,n));const o=3===r?s.length-1:s.length;for(let e=0;e<o;e++){1===e&&1!==r&&t.writeVarint(jp(2,o-1));const n=s[e].x-i,l=s[e].y-a;t.writeVarint(Fp(n)),t.writeVarint(Fp(l)),i+=n,a+=l}3===e.type&&t.writeVarint(jp(7,1))}}function Bp(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}class Vp{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ha(M,16,0),this.grid3D=new ha(M,16,0),this.featureIndexArray=new Vs,this.promoteId=t}insert(e,t,n,r,i,a){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);const o=a?this.grid3D:this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const r=e[t];n[0]=Math.min(n[0],r.x),n[1]=Math.min(n[1],r.y),n[2]=Math.max(n[2],r.x),n[3]=Math.max(n[3],r.y)}n[0]<M&&n[1]<M&&n[2]>=0&&n[3]>=0&&o.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers="mlt"!==this.encoding?new Nc(new Iu(this.rawTileData)).layers:new Ap(this.rawTileData).layers,this.sourceLayerCoder=new Hh(this.vtLayers?Object.keys(this.vtLayers).sort():[Dp])),this.vtLayers}query(e,t,n,i){this.loadVTLayers();const a=e.params,s=M/e.tileSize/e.scale,o=fi(a.filter,a.globalState),l=e.queryGeometry,c=e.queryPadding*s,u=Gh.fromPoints(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Gh.fromPoints(e.cameraQueryGeometry).expandBy(c),p=this.grid3D.query(d.minX,d.minY,d.maxX,d.maxY,(t,n,i,a)=>function(e,t,n,i,a){for(const r of e)if(t<=r.x&&n<=r.y&&i>=r.x&&a>=r.y)return!0;const s=[new r(t,n),new r(t,a),new r(i,a),new r(i,n)];if(e.length>2)for(const r of s)if(tl(e,r))return!0;for(let r=0;r<e.length-1;r++)if(nl(e[r],e[r+1],s))return!0;return!1}(e.cameraQueryGeometry,t-c,n-c,i+c,a+c));for(const r of p)h.push(r);h.sort(qp);const f={};let m;for(let r=0;r<h.length;r++){const c=h[r];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,o,a.layers,a.availableImages,t,n,i,(t,n,r)=>(d||(d=Vo(t)),n.queryIntersectsFeature({queryGeometry:l,feature:t,featureState:r,geometry:d,zoom:this.z,transform:e.transform,pixelsToTileUnits:s,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return f}loadMatchingFeature(e,t,n,r,i,a,s,o,l,c,u){const h=this.bucketLayerIDs[t];if(a&&!h.some(e=>a.has(e)))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(r);if(i.needGeometry){const e=Uo(p,!0);if(!i.filter(new Ra(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Ra(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let m=0;m<h.length;m++){const t=h[m];if(a&&!a.has(t))continue;const n=o[t];if(!n)continue;let i={};f&&c&&(i=c.getState(n.sourceLayer||Dp,f));const d=O({},l[t]);d.paint=Up(d.paint,n.paint,p,i,s),d.layout=Up(d.layout,n.layout,p,i,s);const g=!u||u(p,n,i);if(!g)continue;const y=new Zh(p,this.z,this.x,this.y,f);y.layer=d;let _=e[t];void 0===_&&(_=e[t]=[]),_.push({featureIndex:r,feature:y,intersectionZ:g})}}lookupSymbolFeatures(e,t,n,r,i,a,s,o){const l={};this.loadVTLayers();const c=fi(i.filterSpec,i.globalState);for(const u of e)this.loadMatchingFeature(l,n,r,u,c,a,s,o,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){var n;let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r)),void 0===r&&(null===(n=e.properties)||void 0===n?void 0:n.cluster)&&this.promoteId&&(r=Number(e.properties.cluster_id))),r}}function Up(e,t,n,r,i){return V(e,(e,a)=>{const s=t instanceof $a?t.get(a):null;return s&&s.evaluate?s.evaluate(n,r,i):s})}function qp(e,t){return t-e}function $p(e,t,n,i,a){const s=[];for(let o=0;o<e.length;o++){const l=e[o];let c;for(let e=0;e<l.length-1;e++){let o=l[e],u=l[e+1];o.x<t&&u.x<t||(o.x<t?o=new r(t,o.y+(t-o.x)/(u.x-o.x)*(u.y-o.y))._round():u.x<t&&(u=new r(t,o.y+(t-o.x)/(u.x-o.x)*(u.y-o.y))._round()),o.y<n&&u.y<n||(o.y<n?o=new r(o.x+(n-o.y)/(u.y-o.y)*(u.x-o.x),n)._round():u.y<n&&(u=new r(o.x+(n-o.y)/(u.y-o.y)*(u.x-o.x),n)._round()),o.x>=i&&u.x>=i||(o.x>=i?o=new r(i,o.y+(i-o.x)/(u.x-o.x)*(u.y-o.y))._round():u.x>=i&&(u=new r(i,o.y+(i-o.x)/(u.x-o.x)*(u.y-o.y))._round()),o.y>=a&&u.y>=a||(o.y>=a?o=new r(o.x+(a-o.y)/(u.y-o.y)*(u.x-o.x),a)._round():u.y>=a&&(u=new r(o.x+(a-o.y)/(u.y-o.y)*(u.x-o.x),a)._round()),c&&o.equals(c[c.length-1])||(c=[o],s.push(c)),c.push(u)))))}}return s}function Gp(e,t,n,r,i){switch(t){case 1:return function(e,t,n,r){const i=[];for(const a of e)for(const e of a){const a=0===r?e.x:e.y;a>=t&&a<=n&&i.push([e])}return i}(e,n,r,i);case 2:return Zp(e,n,r,i,!1);case 3:return Zp(e,n,r,i,!0)}return[]}function Hp(e,t,n,i,a){const s=0===i?Wp:Xp;let o=[];const l=[];for(let r=0;r<e.length-1;r++){const c=e[r],u=e[r+1],h=0===i?c.x:c.y,d=0===i?u.x:u.y;let p=!1;h<t?d>t&&o.push(s(c,u,t)):h>n?d<n&&o.push(s(c,u,n)):o.push(c),d<t&&h>=t&&(o.push(s(c,u,t)),p=!0),d>n&&h<=n&&(o.push(s(c,u,n)),p=!0),!a&&p&&(l.push(o),o=[])}const c=e.length-1,u=0===i?e[c].x:e[c].y;return u>=t&&u<=n&&o.push(e[c]),a&&o.length>0&&!o[0].equals(o[o.length-1])&&o.push(new r(o[0].x,o[0].y)),o.length>0&&l.push(o),l}function Zp(e,t,n,r,i){const a=[];for(const s of e){const e=Hp(s,t,n,r,i);e.length>0&&a.push(...e)}return a}function Wp(e,t,n){return new r(n,e.y+(n-e.x)/(t.x-e.x)*(t.y-e.y))}function Xp(e,t,n){return new r(e.x+(n-e.y)/(t.y-e.y)*(t.x-e.x),n)}pa("FeatureIndex",Vp,{omit:["rawTileData","sourceLayerCoder"]});class Yp extends r{constructor(e,t,n,r){super(e,t),this.angle=n,void 0!==r&&(this.segment=r)}clone(){return new Yp(this.x,this.y,this.angle,this.segment)}}function Kp(e,t,n,r,i){if(void 0===t.segment||0===n)return!0;let a=t,s=t.segment+1,o=0;for(;o>-n/2;){if(s--,s<0)return!1;o-=e[s].dist(a),a=e[s]}o+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;o<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let a=e[s-1].angleTo(t)-t.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:a}),c+=a;o-l[0].distance>r;)c-=l.shift().angleDelta;if(c>i)return!1;s++,o+=t.dist(n)}return!0}function Qp(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Jp(e,t,n){return e?.6*t*n:0}function ef(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function tf(e,t,n,r,i,a){const s=Jp(n,i,a),o=ef(n,r)*a;let l=0;const c=Qp(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],r=e[u+1],i=n.dist(r);if(l+i>c){const a=(c-l)/i,h=yn.number(n.x,r.x,a),d=yn.number(n.y,r.y,a),p=new Yp(h,d,r.angleTo(n),u);return p._round(),!s||Kp(e,p,o,s,t)?p:void 0}l+=i}}function nf(e,t,n,r,i,a,s,o,l){const c=Jp(r,a,s),u=ef(r,i),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),rf(e,d?t/2*o%t:(u/2+2*a)*s*o%t,t,c,n,h,d,!1,l)}function rf(e,t,n,r,i,a,s,o,l){const c=a/2,u=Qp(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],s=e[f+1],o=t.dist(s),m=s.angleTo(t);for(;d+n<h+o;){d+=n;const g=(d-h)/o,y=yn.number(t.x,s.x,g),_=yn.number(t.y,s.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const t=new Yp(y,_,m,f);t._round(),r&&!Kp(e,t,a,r,i)||p.push(t)}}h+=o}return o||p.length||s||(p=rf(e,h/2,n,r,i,a,s,!0,l)),p}function af(e,t,n,i){const a=[],s=e.image,o=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,y=c-m;let _=0,v=f,x=0,b=m,w=0,S=g,k=0,T=y;if(s.content&&i){const t=s.content,n=t[2]-t[0],r=t[3]-t[1];(s.textFitWidth||s.textFitHeight)&&(u=nh(e)),_=sf(h,0,t[0]),x=sf(d,0,t[1]),v=sf(h,t[0],t[2]),b=sf(d,t[1],t[3]),w=t[0]-_,k=t[1]-x,S=n-v,T=r-b}const C=u.x1,E=u.y1,I=u.x2-C,P=u.y2-E,M=(e,i,a,l)=>{const c=lf(e.stretch-_,v,I,C),u=cf(e.fixed-w,S,e.stretch,f),h=lf(i.stretch-x,b,P,E),d=cf(i.fixed-k,T,i.stretch,m),p=lf(a.stretch-_,v,I,C),g=cf(a.fixed-w,S,a.stretch,f),y=lf(l.stretch-x,b,P,E),M=cf(l.fixed-k,T,l.stretch,m),A=new r(c,h),z=new r(p,h),D=new r(p,y),R=new r(c,y),L=new r(u/o,d/o),N=new r(g/o,M/o),j=t*Math.PI/180;if(j){const e=Math.sin(j),t=Math.cos(j),n=[t,-e,e,t];A._matMult(n),z._matMult(n),R._matMult(n),D._matMult(n)}const F=e.stretch+e.fixed,O=i.stretch+i.fixed;return{tl:A,tr:z,bl:R,br:D,tex:{x:s.paddedRect.x+1+F,y:s.paddedRect.y+1+O,w:a.stretch+a.fixed-F,h:l.stretch+l.fixed-O},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:N,minFontScaleX:S/o/I,minFontScaleY:T/o/P,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const e=of(h,g,f),t=of(d,y,m);for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)a.push(M(r,t[e],i,t[e+1]))}}else a.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function sf(e,t,n){let r=0;for(const i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function of(e,t,n){const r=[{fixed:-1,stretch:0}];for(const[i,a]of e){const e=r[r.length-1];r.push({fixed:i-e.stretch,stretch:e.stretch}),r.push({fixed:i-e.stretch,stretch:e.stretch+(a-i)})}return r.push({fixed:t+1,stretch:n}),r}function lf(e,t,n,r){return e/t*n+r}function cf(e,t,n,r){return e-t*n/r}pa("Anchor",Yp);class uf{constructor(e,t,n,i,a,s,o,l,c,u){var h;if(this.boxStartIndex=e.length,c){let e=s.top,t=s.bottom;const n=s.collisionPadding;n&&(e-=n[1],t+=n[3]);let r=t-e;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{const c=(null===(h=s.image)||void 0===h?void 0:h.content)&&(s.image.textFitWidth||s.image.textFitHeight)?nh(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};c.y1=c.y1*o-l[0],c.y2=c.y2*o+l[2],c.x1=c.x1*o-l[3],c.x2=c.x2*o+l[1];const d=s.collisionPadding;if(d&&(c.x1-=d[0]*o,c.y1-=d[1]*o,c.x2+=d[2]*o,c.y2+=d[3]*o),u){const e=new r(c.x1,c.y1),t=new r(c.x2,c.y1),n=new r(c.x1,c.y2),i=new r(c.x2,c.y2),a=u*Math.PI/180;e._rotate(a),t._rotate(a),n._rotate(a),i._rotate(a),c.x1=Math.min(e.x,t.x,n.x,i.x),c.x2=Math.max(e.x,t.x,n.x,i.x),c.y1=Math.min(e.y,t.y,n.y,i.y),c.y2=Math.max(e.y,t.y,n.y,i.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,n,i,a)}this.boxEndIndex=e.length}}class hf{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1);const a=r+1;if(a<this.length&&n(t[a],t[r])<0&&(r=a),n(t[r],i)>=0)break;t[e]=t[r],e=r}t[e]=i}}function df(e,t=1,n=!1){const i=Gh.fromPoints(e[0]),a=Math.min(i.width(),i.height());let s=a/2;const o=new hf([],pf),{minX:l,minY:c,maxX:u,maxY:h}=i;if(0===a)return new r(l,c);for(let r=l;r<u;r+=a)for(let t=c;t<h;t+=a)o.push(new ff(r+s,t+s,s,e));let d=function(e){let t=0,n=0,r=0;const i=e[0];for(let a=0,s=i.length,o=s-1;a<s;o=a++){const e=i[a],s=i[o],l=e.x*s.y-s.x*e.y;n+=(e.x+s.x)*l,r+=(e.y+s.y)*l,t+=3*l}return new ff(n/t,r/t,0,e)}(e),p=o.length;for(;o.length;){const n=o.pop();(n.d>d.d||!d.d)&&(d=n),n.max-d.d<=t||(s=n.h/2,o.push(new ff(n.p.x-s,n.p.y-s,s,e)),o.push(new ff(n.p.x+s,n.p.y-s,s,e)),o.push(new ff(n.p.x-s,n.p.y+s,s,e)),o.push(new ff(n.p.x+s,n.p.y+s,s,e)),p+=4)}return d.p}function pf(e,t){return t.max-e.max}function ff(e,t,n,i){this.p=new r(e,t),this.h=n,this.d=function(e,t){let n=!1,r=1/0;for(let i=0;i<t.length;i++){const a=t[i];for(let t=0,i=a.length,s=i-1;t<i;s=t++){const i=a[t],o=a[s];i.y>e.y!=o.y>e.y&&e.x<(o.x-i.x)*(e.y-i.y)/(o.y-i.y)+i.x&&(n=!n),r=Math.min(r,Jo(e,i,o))}}return(n?1:-1)*Math.sqrt(r)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}var mf;e.aP=void 0,(mf=e.aP||(e.aP={}))[mf.center=1]="center",mf[mf.left=2]="left",mf[mf.right=3]="right",mf[mf.top=4]="top",mf[mf.bottom=5]="bottom",mf[mf["top-left"]=6]="top-left",mf[mf["top-right"]=7]="top-right",mf[mf["bottom-left"]=8]="bottom-left",mf[mf["bottom-right"]=9]="bottom-right";const gf=Number.POSITIVE_INFINITY;function yf(e,t){return t[1]!==gf?function(e,t,n){let r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,i]}(e,t[0],t[1]):function(e,t){let n=0,r=0;t<0&&(t=0);const i=t/Math.SQRT2;switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}return[n,r]}(e,t[0])}function _f(e,t,n){var r;const i=e.layout,a=null===(r=i.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(t,{},n);if(a){const e=a.values,t=[];for(let n=0;n<e.length;n+=2){const r=t[n]=e[n],i=e[n+1].map(e=>e*mu);r.startsWith("top")?i[1]-=7:r.startsWith("bottom")&&(i[1]+=7),t[n+1]=i}return new Ft(t)}const s=i.get("text-variable-anchor");if(s){let r;r=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[i.get("text-radial-offset").evaluate(t,{},n)*mu,gf]:i.get("text-offset").evaluate(t,{},n).map(e=>e*mu);const a=[];for(const e of s)a.push(e,yf(e,r));return new Ft(a)}return null}function vf(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xf(t,n,r,i,a,s,o,l,c,u,h,d){let p=s.textMaxSize.evaluate(n,{});void 0===p&&(p=o);const f=t.layers[0].layout,m=f.get("icon-offset").evaluate(n,{},h),g=wf(r.horizontal),y=o/24,_=t.tilePixelRatio*y,v=t.tilePixelRatio*p/24,x=t.tilePixelRatio*l,b=t.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*t.tilePixelRatio,S=function(e,t,n,r=1){const i=e.get("icon-padding").evaluate(t,{},n),a=i&&i.values;return[a[0]*r,a[1]*r,a[2]*r,a[3]*r]}(f,n,h,t.tilePixelRatio),k=f.get("text-max-angle")/180*Math.PI,T="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),C="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),E=f.get("symbol-placement"),I=b/2,P=f.get("icon-text-fit");let A;i&&"none"!==P&&(t.allowVerticalPlacement&&r.vertical&&(A=rh(i,r.vertical,P,f.get("icon-text-fit-padding"),m,y)),g&&(i=rh(i,g,P,f.get("icon-text-fit-padding"),m,y)));const z=h?d.line.getGranularityForZoomLevel(h.z):1,D=(l,d)=>{d.x<0||d.x>=M||d.y<0||d.y>=M||function(t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,k,T){const C=t.addToLineVertexArray(n,r);let E,I,P,M,A=0,z=0,D=0,R=0,L=-1,N=-1;const j={};let F=yo("");if(t.allowVerticalPlacement&&i.vertical){const e=l.layout.get("text-rotate").evaluate(b,{},k)+90;P=new uf(c,n,u,h,d,i.vertical,p,f,m,e),o&&(M=new uf(c,n,u,h,d,o,y,_,m,e))}if(a){const r=l.layout.get("icon-rotate").evaluate(b,{}),i="none"!==l.layout.get("icon-text-fit"),s=af(a,r,S,i),p=o?af(o,r,S,i):void 0;I=new uf(c,n,u,h,d,a,y,_,!1,r),A=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[ih*l.layout.get("icon-size").evaluate(b,{})],m[0]>ah&&G(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[ih*w.compositeIconSizes[0].evaluate(b,{},k),ih*w.compositeIconSizes[1].evaluate(b,{},k)],(m[0]>ah||m[1]>ah)&&G(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,x,v,b,e.az.none,n,C.lineStartIndex,C.lineLength,-1,k),L=t.icon.placedSymbolArray.length-1,p&&(z=4*p.length,t.addSymbols(t.icon,p,m,x,v,b,e.az.vertical,n,C.lineStartIndex,C.lineLength,-1,k),N=t.icon.placedSymbolArray.length-1)}const O=Object.keys(i.horizontal);for(const G of O){const r=i.horizontal[G];if(!E){F=yo(r.text);const e=l.layout.get("text-rotate").evaluate(b,{},k);E=new uf(c,n,u,h,d,r,p,f,m,e)}const a=1===r.positionedLines.length;if(D+=bf(t,n,r,s,l,m,b,g,C,i.vertical?e.az.horizontal:e.az.horizontalOnly,a?O:[G],j,L,w,k),a)break}i.vertical&&(R+=bf(t,n,i.vertical,s,l,m,b,g,C,e.az.vertical,["vertical"],j,N,w,k));const B=E?E.boxStartIndex:t.collisionBoxArray.length,V=E?E.boxEndIndex:t.collisionBoxArray.length,U=P?P.boxStartIndex:t.collisionBoxArray.length,q=P?P.boxEndIndex:t.collisionBoxArray.length,$=I?I.boxStartIndex:t.collisionBoxArray.length,H=I?I.boxEndIndex:t.collisionBoxArray.length,Z=M?M.boxStartIndex:t.collisionBoxArray.length,W=M?M.boxEndIndex:t.collisionBoxArray.length;let X=-1;const Y=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;X=Y(E,X),X=Y(P,X),X=Y(I,X),X=Y(M,X);const K=X>-1?1:0;K&&(X*=T/mu),t.glyphOffsetArray.length>=fh.MAX_GLYPHS&&G("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey);const Q=_f(l,b,k),[J,ee]=function(t,n){const r=t.length,i=null==n?void 0:n.values;if((null==i?void 0:i.length)>0)for(let a=0;a<i.length;a+=2){const n=i[a+1];t.emplaceBack(e.aP[i[a]],n[0],n[1])}return[r,t.length]}(t.textAnchorOffsets,Q);t.symbolInstances.emplaceBack(n.x,n.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical||-1,L,N,F,B,V,U,q,$,H,Z,W,u,D,R,A,z,K,0,p,X,J,ee)}(t,d,l,r,i,a,A,t.layers[0],t.collisionBoxArray,n.index,n.sourceLayerIndex,t.index,_,[w,w,w,w],T,c,x,S,C,m,n,s,u,h,o)};if("line"===E)for(const e of $p(n.geometry,0,0,M,M)){const n=_c(e,z),a=nf(n,b,k,r.vertical||g,i,24,v,t.overscaling,M);for(const e of a)g&&Sf(t,g.text,I,e)||D(n,e)}else if("line-center"===E){for(const e of n.geometry)if(e.length>1){const t=_c(e,z),n=tf(t,k,r.vertical||g,i,24,v);n&&D(t,n)}}else if("Polygon"===n.type)for(const e of nr(n.geometry,0)){const t=df(e,16);D(_c(e[0],z,!0),new Yp(t.x,t.y,0))}else if("LineString"===n.type)for(const e of n.geometry){const t=_c(e,z);D(t,new Yp(t[0].x,t[0].y,0))}else if("Point"===n.type)for(const e of n.geometry)for(const t of e)D([t],new Yp(t.x,t.y,0))}function bf(e,t,n,i,a,s,o,l,c,u,h,d,p,f,m){const g=function(e,t,n,i,a,s,o,l){const c=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const h of t.positionedLines)for(const e of h.positionedGlyphs){if(!e.rect)continue;const i=e.rect||{};let s=4,d=!0,p=1,f=0;const m=(a||l)&&e.vertical,g=e.metrics.advance*e.scale/2;if(l&&t.verticalizable&&(f=h.lineOffset/2-(e.imageName?-(mu-e.metrics.width*e.scale)/2:(e.scale-1)*mu)),e.imageName){const t=o[e.imageName];d=t.sdf,p=t.pixelRatio,s=1/p}const y=a?[e.x+g,e.y]:[0,0];let _=a?[0,0]:[e.x+g+n[0],e.y+n[1]-f],v=[0,0];m&&(v=_,_=[0,0]);const x=e.metrics.isDoubleResolution?2:1,b=(e.metrics.left-s)*e.scale-g+_[0],w=(-e.metrics.top-s)*e.scale+_[1],S=b+i.w/x*e.scale/p,k=w+i.h/x*e.scale/p,T=new r(b,w),C=new r(S,w),E=new r(b,k),I=new r(S,k);if(m){const t=new r(-g,g- -17),n=-Math.PI/2,i=12-g,a=new r(22-i,-(e.imageName?i:0)),s=new r(...v);T._rotateAround(n,t)._add(a)._add(s),C._rotateAround(n,t)._add(a)._add(s),E._rotateAround(n,t)._add(a)._add(s),I._rotateAround(n,t)._add(a)._add(s)}if(c){const e=Math.sin(c),t=Math.cos(c),n=[t,-e,e,t];T._matMult(n),C._matMult(n),E._matMult(n),I._matMult(n)}const P=new r(0,0),M=new r(0,0);u.push({tl:T,tr:C,bl:E,br:I,tex:i,writingMode:t.writingMode,glyphOffset:y,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:P,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,n,l,a,s,o,i,e.allowVerticalPlacement),y=e.textSizeData;let _=null;"source"===y.kind?(_=[ih*a.layout.get("text-size").evaluate(o,{})],_[0]>ah&&G(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(_=[ih*f.compositeTextSizes[0].evaluate(o,{},m),ih*f.compositeTextSizes[1].evaluate(o,{},m)],(_[0]>ah||_[1]>ah)&&G(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,g,_,l,s,o,u,t,c.lineStartIndex,c.lineLength,p,m);for(const r of h)d[r]=e.text.placedSymbolArray.length-1;return 4*g.length}function wf(e){for(const t in e)return e[t];return null}function Sf(e,t,n,r){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<n)return!0}else i[t]=[];return i[t].push(r),!1}const kf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=n>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const i=kf[15&n];if(!i)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new Tf(s,a,i,e)}constructor(e,t=64,n=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=kf.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-s%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${n}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+s+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Cf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:a,nodeSize:s}=this,o=[0,i.length-1,0],l=[];for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const o=a[2*s],c=a[2*s+1];o>=e&&o<=n&&c>=t&&c<=r&&l.push(i[s])}continue}const d=h+u>>1,p=a[2*d],f=a[2*d+1];p>=e&&p<=n&&f>=t&&f<=r&&l.push(i[d]),(0===c?e<=p:t<=f)&&(o.push(h),o.push(d-1),o.push(1-c)),(0===c?n>=p:r>=f)&&(o.push(d+1),o.push(u),o.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:a}=this,s=[0,r.length-1,0],o=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=a){for(let n=h;n<=u;n++)Mf(i[2*n],i[2*n+1],e,t)<=l&&o.push(r[n]);continue}const d=h+u>>1,p=i[2*d],f=i[2*d+1];Mf(p,f,e,t)<=l&&o.push(r[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return o}}function Cf(e,t,n,r,i,a){if(i-r<=n)return;const s=r+i>>1;Ef(e,t,s,r,i,a),Cf(e,t,n,r,s-1,1-a),Cf(e,t,n,s+1,i,1-a)}function Ef(e,t,n,r,i,a){for(;i>r;){if(i-r>600){const s=i-r+1,o=n-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(o-s/2<0?-1:1);Ef(e,t,n,Math.max(r,Math.floor(n-o*c/s+u)),Math.min(i,Math.floor(n+(s-o)*c/s+u)),a)}const s=t[2*n+a];let o=r,l=i;for(If(e,t,r,n),t[2*i+a]>s&&If(e,t,r,i);o<l;){for(If(e,t,o,l),o++,l--;t[2*o+a]<s;)o++;for(;t[2*l+a]>s;)l--}t[2*r+a]===s?If(e,t,r,l):(l++,If(e,t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}}function If(e,t,n,r){Pf(e,n,r),Pf(t,2*n,2*r),Pf(t,2*n+1,2*r+1)}function Pf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Mf(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}var Af;e.cI=void 0,(Af=e.cI||(e.cI={})).create="create",Af.load="load",Af.fullLoad="fullLoad";let zf=null,Df=[];const Rf=1e3/60,Lf="loadTime",Nf="fullLoadTime",jf={mark(e){performance.mark(e)},frame(e){const t=e;null!=zf&&Df.push(t-zf),zf=t},clearMetrics(){zf=null,Df=[],performance.clearMeasures(Lf),performance.clearMeasures(Nf);for(const t in e.cI)performance.clearMarks(e.cI[t])},getPerformanceMetrics(){performance.measure(Lf,e.cI.create,e.cI.load),performance.measure(Nf,e.cI.create,e.cI.fullLoad);const t=performance.getEntriesByName(Lf)[0].duration,n=performance.getEntriesByName(Nf)[0].duration,r=Df.length,i=1/(Df.reduce((e,t)=>e+t,0)/r/1e3),a=Df.filter(e=>e>Rf).reduce((e,t)=>e+(t-Rf)/Rf,0);return{loadTime:t,fullLoadTime:n,fps:i,percentDroppedFrames:a/(r+a)*100,totalFrames:r}}};e.$=h,e.A=f,e.B=ua,e.C=aa,e.D=Ga,e.E=ve,e.F=function([e,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(n),y:e*Math.sin(t)*Math.sin(n),z:e*Math.cos(n)}},e.G=yn,e.H=Ra,e.I=$u,e.J=oa,e.K=function(e){if(null==W){const t=e.navigator?e.navigator.userAgent:null;W=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return W},e.L=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new kh(()=>this.process()),this.subscription=ee(this.target,"message",e=>this.receive(e),!1),this.globalScope=Z(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}unregisterMessageHandler(e){delete this.messageHandlers[e]}sendAsync(e,t){return new Promise((n,r)=>{const i=Math.round(1e18*Math.random()).toString(36).substring(0,10),a=t?ee(t.signal,"abort",()=>{null==a||a.unsubscribe(),delete this.resolveRejects[i];const t={id:i,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)},Th):null;this.resolveRejects[i]={resolve:e=>{null==a||a.unsubscribe(),n(e)},reject:e=>{null==a||a.unsubscribe(),r(e)}};const s=[],o=Object.assign(Object.assign({},e),{id:i,sourceMapId:this.mapId,origin:location.origin,data:ya(e.data,s)});this.target.postMessage(o,{transfer:s})})}receive(e){const t=e.data,n=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&"resource://android"!==t.origin&&"resource://android"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[n];const e=this.abortControllers[n];return delete this.abortControllers[n],void(e&&e.abort())}if(Z(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,t){return n(this,void 0,void 0,function*(){if("<response>"===t.type){const n=this.resolveRejects[e];if(delete this.resolveRejects[e],!n)return;return void(t.error?n.reject(_a(t.error)):n.resolve(_a(t.data)))}if(!this.messageHandlers[t.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=_a(t.data),r=new AbortController;this.abortControllers[e]=r;try{const i=yield this.messageHandlers[t.type](t.sourceMapId,n,r);this.completeTask(e,null,i)}catch(i){this.completeTask(e,i)}})}completeTask(e,t,n){const r=[];delete this.abortControllers[e];const i={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ya(t):null,data:ya(n,r)};this.target.postMessage(i,{transfer:r})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.M=ue,e.N=function(){var e=new f(16);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.O=function(e,t,n){var r,i,a,s,o,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=i,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+o*g+h*y+t[12],e[13]=i*m+l*g+d*y+t[13],e[14]=a*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e},e.P=r,e.Q=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.R=kl,e.S=function(e,t,n){var r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*r+x*o+b*h+w*m,e[1]=v*i+x*l+b*d+w*g,e[2]=v*a+x*c+b*p+w*y,e[3]=v*s+x*u+b*f+w*_,e[4]=(v=n[4])*r+(x=n[5])*o+(b=n[6])*h+(w=n[7])*m,e[5]=v*i+x*l+b*d+w*g,e[6]=v*a+x*c+b*p+w*y,e[7]=v*s+x*u+b*f+w*_,e[8]=(v=n[8])*r+(x=n[9])*o+(b=n[10])*h+(w=n[11])*m,e[9]=v*i+x*l+b*d+w*g,e[10]=v*a+x*c+b*p+w*y,e[11]=v*s+x*u+b*f+w*_,e[12]=(v=n[12])*r+(x=n[13])*o+(b=n[14])*h+(w=n[15])*m,e[13]=v*i+x*l+b*d+w*g,e[14]=v*a+x*c+b*p+w*y,e[15]=v*s+x*u+b*f+w*_,e},e.T=Dl,e.U=function(e,t){const n={};for(let r=0;r<t.length;r++){const i=t[r];i in e&&(n[i]=e[i])}return n},e.V=Eh,e.W=F,e.X=Ah,e.Y=Mh,e.Z=oe,e._=n,e.a=se,e.a$=b,e.a0=d,e.a1=K,e.a2=Bh,e.a3=Dh,e.a4=Rh,e.a5=M,e.a6=function(e,t,n){if(!e)return t||{};if(!t)return e||{};const r=$h(e),i=$h(t);!function(e,t){t.removeAll&&(e.add.clear(),e.update.clear(),e.remove.clear(),t.remove.clear());for(const n of t.remove)e.add.delete(n),e.update.delete(n);for(const[n,r]of t.update){const i=e.update.get(n);i&&(t.update.set(n,qh(i,r)),e.update.delete(n))}}(r,i);const a={};if((r.removeAll||i.removeAll)&&(a.removeAll=!0),a.remove=new Set([...r.remove,...i.remove]),a.add=new Map([...r.add,...i.add]),a.update=new Map([...r.update,...i.update]),a.remove.size&&a.add.size)for(const s of a.add.keys())a.remove.delete(s);return function(e){const t={};return e.removeAll&&(t.removeAll=e.removeAll),e.remove&&(t.remove=Array.from(e.remove)),e.add&&(t.add=Array.from(e.add.values())),e.update&&(t.update=Array.from(e.update.values())),t}(a)},e.a7=function(e,t){const n=new Map;if(null==e)return n;if(null==e.type)return n;if("Feature"===e.type){const r=Uh(e,t);if(null==r)return;return n.set(r,e),n}if("FeatureCollection"===e.type){const r=new Set;for(const i of e.features){const e=Uh(i,t);if(null==e)return;if(r.has(e))return;r.add(e),n.set(e,i)}return n}},e.a8=function(e,t,n){var r,i;const a=[];if(t.removeAll)e.clear();else if(t.remove)for(const s of t.remove){const t=e.get(s);t&&(a.push(t.geometry),e.delete(s))}if(t.add)for(const s of t.add){const t=Uh(s,n);if(null==t)continue;const r=e.get(t);r&&a.push(r.geometry),a.push(s.geometry),e.set(t,s)}if(t.update)for(const s of t.update){const t=e.get(s.id);if(!t)continue;const n=!!s.newGeometry,o=s.removeAllProperties||(null===(r=s.removeProperties)||void 0===r?void 0:r.length)>0||(null===(i=s.addOrUpdateProperties)||void 0===i?void 0:i.length)>0;if(!n&&!o)continue;a.push(t.geometry);const l=Object.assign({},t);if(e.set(s.id,l),n&&(a.push(s.newGeometry),l.geometry=s.newGeometry),o){if(l.properties=s.removeAllProperties?{}:Object.assign({},l.properties||{}),s.removeProperties)for(const e of s.removeProperties)delete l.properties[e];if(s.addOrUpdateProperties)for(const{key:e,value:t}of s.addOrUpdateProperties)l.properties[e]=t}}return a},e.a9=Nh,e.aA=function(e,{uSize:t,uSizeT:n},{lowerSize:r,upperSize:i}){return"source"===e.kind?r/ih:"composite"===e.kind?yn.number(r/ih,i/ih,n):t},e.aB=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=n*o-r*s,v=n*l-i*s,x=n*c-a*s,b=r*l-i*o,w=r*c-a*o,S=i*c-a*l,k=u*m-h*f,T=u*g-d*f,C=u*y-p*f,E=h*g-d*m,I=h*y-p*m,P=d*y-p*g,M=_*P-v*I+x*E+b*C-w*T+S*k;return M?(e[0]=(o*P-l*I+c*E)*(M=1/M),e[1]=(i*I-r*P-a*E)*M,e[2]=(m*S-g*w+y*b)*M,e[3]=(d*w-h*S-p*b)*M,e[4]=(l*C-s*P-c*T)*M,e[5]=(n*P-i*C+a*T)*M,e[6]=(g*x-f*S-y*v)*M,e[7]=(u*S-d*x+p*v)*M,e[8]=(s*I-o*C+c*k)*M,e[9]=(r*C-n*I-a*k)*M,e[10]=(f*w-m*x+y*_)*M,e[11]=(h*x-u*w-p*_)*M,e[12]=(o*T-s*E-l*k)*M,e[13]=(n*E-r*T+i*k)*M,e[14]=(m*v-f*b-g*_)*M,e[15]=(u*b-h*v+d*_)*M,e):null},e.aC=I,e.aD=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},e.aE=function(e){return e[0]=0,e[1]=0,e},e.aF=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.aG=uh,e.aH=T,e.aI=function(e,t,n,i){const a=t.y-e.y,s=t.x-e.x,o=i.y-n.y,l=i.x-n.x,c=o*s-l*a;if(0===c)return null;const u=(l*(e.y-n.y)-o*(e.x-n.x))/c;return new r(e.x+u*s,e.y+u*a)},e.aJ=$p,e.aK=Ho,e.aL=function(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const a of e)t=Math.min(t,a.x),n=Math.min(n,a.y),r=Math.max(r,a.x),i=Math.max(i,a.y);return[t,n,r,i]},e.aM=mu,e.aN=A,e.aO=function(e,t,n,r,i=!1){if(!n[0]&&!n[1])return[0,0];const a=i?"map"===r?-e.bearingInRadians:0:"viewport"===r?e.bearingInRadians:0;if(a){const e=Math.sin(a),t=Math.cos(a);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}return[i?n[0]:A(t,n[0],e.zoom),i?n[1]:A(t,n[1],e.zoom)]},e.aQ=oh,e.aR=vf,e.aS=Wu,e.aT=Tf,e.aU=is,e.aV=pc,e.aW=Us,e.aX=ao,e.aY=to,e.aZ=ne,e.a_=Lh,e.aa=Gh,e.ab=25,e.ac=Fh,e.ad=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const r of e){const e=window.document.createElement("source");fe(r)||(t.crossOrigin="Anonymous"),e.src=r,t.appendChild(e)}})},e.ae=ze,e.af=function(){return B++},e.ag=As,e.ah=fh,e.ai=Dp,e.aj=fi,e.ak=Uo,e.al=Zh,e.am=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,r,i)=>{const a=r||i;return t[n]=!a||a.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.an=j,e.ao=85.051129,e.ap=te,e.aq=function(e){return Math.pow(2,e)},e.ar=g,e.as=zh,e.at=function(e){return Math.log(e)/Math.LN2},e.au=function(e){var t=e[0],n=e[1];return t*t+n*n},e.av=function(e){if(!e.length)return new Set;const t=Math.max(...e.map(e=>e.canonical.z));let n=1/0,r=-1/0,i=1/0,a=-1/0;const s=[];for(const l of e){const{x:e,y:o,z:c}=l.canonical,u=Math.pow(2,t-c),h=e*u,d=o*u;s.push({id:l,x:h,y:d}),h<n&&(n=h),h>r&&(r=h),d<i&&(i=d),d>a&&(a=d)}const o=new Set;for(const l of s)l.x!==n&&l.x!==r&&l.y!==i&&l.y!==a||o.add(l.id);return o},e.aw=function(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x},e.ax=class{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:t,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout(()=>{this.remove(e,i)},n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const r of this.data[n])e(r.value)||t.push(r);for(const n of t)this.remove(n.value.tileID,n)}},e.ay=function(e,t){let n=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:a,maxZoom:s}=e,o=i?j(mn.interpolationFactor(i,t,a,s),0,1):0;"camera"===e.kind?r=yn.number(e.minSize,e.maxSize,o):n=o}return{uSizeT:n,uSize:r}},e.b=X,e.b$=To,e.b0=x,e.b1=function(e){var t=new f(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.b2=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},e.b3=function(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},e.b4=w,e.b5=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.b6=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.b7=_,e.b8=function(e,t,n){const r=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return 0===r?null:(-(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])-n[3])/r},e.b9=k,e.bA=function(){return new Float64Array(3)},e.bB=E,e.bC=function(e,t,n){var r=n[0],i=n[1],a=n[2],s=n[3],o=t[0],l=t[1],c=t[2],u=i*c-a*l,h=a*o-r*c,d=r*l-i*o;return e[0]=o+s*(u+=u)+i*(d+=d)-a*(h+=h),e[1]=l+s*h+a*u-r*d,e[2]=c+s*d+r*h-i*u,e},e.bD=function(e,t,n){const r=(i=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((u=i[8])*(s=i[4])-(o=i[5])*(c=i[7]))+i[1]*(-u*(a=i[3])+o*(l=i[6]))+i[2]*(c*a-s*l);var i,a,s,o,l,c,u;if(0===r)return null;const h=w([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),d=w([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),p=w([],[e[0],e[1],e[2]],[t[0],t[1],t[2]]),f=b([],h,-e[3]);return x(f,f,b([],d,-t[3])),x(f,f,b([],p,-n[3])),b(f,f,1/r),f},e.bE=Ch,e.bF=function(){return new Float64Array(4)},e.bG=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},e.bH=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},e.bI=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},e.bJ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*r,e[1]=s*i-u*r,e[2]=o*i-h*r,e[3]=l*i-d*r,e[8]=a*r+c*i,e[9]=s*r+u*i,e[10]=o*r+h*i,e[11]=l*r+d*i,e},e.bK=function(e,t){const n=z(e,360),r=z(t,360),i=r-n,a=r>n?i-360:i+360;return Math.abs(i)<Math.abs(a)?i:a},e.bL=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bM=function(e,t,n,r){const i=Math.sqrt(e*e+t*t),a=Math.sqrt(n*n+r*r);e/=i,t/=i,n/=a,r/=a;const s=Math.acos(e*n+t*r);return-t*n+e*r>0?s:-s},e.bN=function(e,t){const n=z(e,2*Math.PI),r=z(t,2*Math.PI);return Math.min(Math.abs(n-r),Math.abs(n-r+2*Math.PI),Math.abs(n-r-2*Math.PI))},e.bO=function(){const e={},t=xe.$version;for(const n in xe.$root){const r=xe.$root[n];if(r.required){let i=null;i="version"===n?t:"array"===r.type?[]:{},null!=i&&(e[n]=i)}}return e},e.bP=de,e.bQ=va,e.bR=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const r in t)if(!e(t[r],n[r]))return!1;return!0}return t===n},e.bS=function(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=we(e[n],t[e[n].ref]));return e},e.bT=function(e,t){if("custom"===e.type)return new Sh(e,t);switch(e.type){case"background":return new wh(e,t);case"circle":return new gl(e,t);case"color-relief":return new Nl(e,t);case"fill":return new Cc(e,t);case"fill-extrusion":return new Hc(e,t);case"heatmap":return new El(e,t);case"hillshade":return new Ml(e,t);case"line":return new ou(e,t);case"raster":return new es(e,t);case"symbol":return new vh(e,t)}},e.bU=e=>"raster"===e.type,e.bV=q,e.bW=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Se(e.version,t.version))return[{command:"setStyle",args:[t]}];Se(e.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Se(e.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),Se(e.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Se(e.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Se(e.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Se(e.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Se(e.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),Se(e.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Se(e.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Se(e.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Se(e.light,t.light)||n.push({command:"setLight",args:[t.light]}),Se(e.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Se(e.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Se(e.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const r={},i=[];!function(e,t,n,r){let i;for(i in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)||Ce(i,n,r));for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?Se(e[i],t[i])||("geojson"===e[i].type&&"geojson"===t[i].type&&Ie(e,t,i)?ke(n,{command:"setGeoJSONSourceData",args:[i,t[i].data]}):Ee(i,t,n,r)):Te(i,t,n))}(e.sources,t.sources,i,r);const a=[];e.layers&&e.layers.forEach(e=>{"source"in e&&r[e.source]?n.push({command:"removeLayer",args:[e.id]}):a.push(e)}),n=n.concat(i),function(e,t,n){t=t||[];const r=(e=e||[]).map(Me),i=t.map(Me),a=e.reduce(Ae,{}),s=t.reduce(Ae,{}),o=r.slice(),l=Object.create(null);let c,u,h,d,p;for(let f=0,m=0;f<r.length;f++)c=r[f],Object.prototype.hasOwnProperty.call(s,c)?m++:(ke(n,{command:"removeLayer",args:[c]}),o.splice(o.indexOf(c,m),1));for(let f=0,m=0;f<i.length;f++)c=i[i.length-1-f],o[o.length-1-f]!==c&&(Object.prototype.hasOwnProperty.call(a,c)?(ke(n,{command:"removeLayer",args:[c]}),o.splice(o.lastIndexOf(c,o.length-m),1)):m++,d=o[o.length-f],ke(n,{command:"addLayer",args:[s[c],d]}),o.splice(o.length-f,0,c),l[c]=!0);for(let f=0;f<i.length;f++)if(c=i[f],u=a[c],h=s[c],!l[c]&&!Se(u,h))if(Se(u.source,h.source)&&Se(u["source-layer"],h["source-layer"])&&Se(u.type,h.type)){for(p in Pe(u.layout,h.layout,n,c,null,"setLayoutProperty"),Pe(u.paint,h.paint,n,c,null,"setPaintProperty"),Se(u.filter,h.filter)||ke(n,{command:"setFilter",args:[c,h.filter]}),Se(u.minzoom,h.minzoom)&&Se(u.maxzoom,h.maxzoom)||ke(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Pe(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):Se(u[p],h[p])||ke(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Pe(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):Se(u[p],h[p])||ke(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else ke(n,{command:"removeLayer",args:[c]}),d=o[o.lastIndexOf(c)+1],ke(n,{command:"addLayer",args:[h,d]})}(a,t.layers,n)}catch(r){n=[{command:"setStyle",args:[t]}]}return n},e.bX=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.bY=V,e.bZ=U,e.b_=class extends wo{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.ba=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.bb=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},e.bc=Oh,e.bd=Vh,e.be=function(e,t,n,r,i){var a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0){var s=1/(r-i);e[10]=(i+r)*s,e[14]=2*i*r*s}else e[10]=-1,e[14]=-2*r;return e},e.bf=function(e){var t=new f(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.bg=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+c*r,e[1]=s*i+u*r,e[2]=o*i+h*r,e[3]=l*i+d*r,e[4]=c*i-a*r,e[5]=u*i-s*r,e[6]=h*i-o*r,e[7]=d*i-l*r,e},e.bh=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*r,e[5]=s*i+u*r,e[6]=o*i+h*r,e[7]=l*i+d*r,e[8]=c*i-a*r,e[9]=u*i-s*r,e[10]=h*i-o*r,e[11]=d*i-l*r,e},e.bi=function(){const e=new Float32Array(16);return g(e),e},e.bj=function(){const e=new Float64Array(16);return g(e),e},e.bk=function(){return new Float64Array(16)},e.bl=function(e,t,n){const r=new Float64Array(4);return E(r,e,t-90,n),r},e.bm=function(e,t,n,r){var i,a,s,o,l,c=t[0],u=t[1],h=t[2],d=t[3],f=n[0],m=n[1],g=n[2],y=n[3];return(a=c*f+u*m+h*g+d*y)<0&&(a=-a,f=-f,m=-m,g=-g,y=-y),1-a>p?(i=Math.acos(a),s=Math.sin(i),o=Math.sin((1-r)*i)/s,l=Math.sin(r*i)/s):(o=1-r,l=r),e[0]=o*c+l*f,e[1]=o*u+l*m,e[2]=o*h+l*g,e[3]=o*d+l*y,e},e.bn=function(e){const t=new Float64Array(9);var n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v;h=(i=(r=e)[0])*(l=i+i),d=(a=r[1])*l,f=(s=r[2])*l,m=s*(c=a+a),y=(o=r[3])*l,_=o*c,v=o*(u=s+s),(n=t)[0]=1-(p=a*c)-(g=s*u),n[3]=d-v,n[6]=f+_,n[1]=d+v,n[4]=1-h-g,n[7]=m-y,n[2]=f-_,n[5]=m+y,n[8]=1-h-p;const x=ne(-Math.asin(j(t[2],-1,1)));let b,w;return Math.hypot(t[5],t[8])<.001?(b=0,w=-ne(Math.atan2(t[3],t[4]))):(b=ne(0===t[5]&&0===t[8]?0:Math.atan2(t[5],t[8])),w=ne(0===t[1]&&0===t[0]?0:Math.atan2(t[1],t[0]))),{roll:b,pitch:x+90,bearing:w}},e.bo=function(e,t){return e.roll==t.roll&&e.pitch==t.pitch&&e.bearing==t.bearing},e.bp=It,e.bq=So,e.br=fc,e.bs=mc,e.bt=dc,e.bu=D,e.bv=R,e.bw=Bt,e.bx=function(e,t,n,r,i){return D(r,i,j((e-t)/(n-t),0,1))},e.by=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},e.bz=z,e.c=le,e.c$=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.c0=class extends wo{constructor(e,t){super(e,t),this.current=Co}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.c1=ko,e.c2=class extends wo{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.c3=class extends wo{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.c4=m,e.c5=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.c6=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},e.c7=function(e,t,n,r,i,a,s){var o=1/(t-n),l=1/(r-i),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*o,e[13]=(i+r)*l,e[14]=(s+a)*c,e[15]=1,e},e.c8=class extends wo{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(4*e.length);for(let n=0;n<e.length;n++)t[4*n]=e[n].r,t[4*n+1]=e[n].g,t[4*n+2]=e[n].b,t[4*n+3]=e[n].a;this.gl.uniform4fv(this.location,t)}}},e.c9=class extends wo{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(e);this.gl.uniform1fv(this.location,t)}}},e.cA=function(e,t){var n;if(!ie[t])return!1;const r=null==e?void 0:e.target,i=(null===(n=null==r?void 0:r.ownerDocument)||void 0===n?void 0:n.defaultView)||window;return e instanceof i.MouseEvent||e instanceof i.WheelEvent},e.cB=function(e,t){return re[t]&&"touches"in e},e.cC=function(e){return re[e]||ie[e]},e.cD=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},e.cE=function(e,t){const{x:n,y:r}=Nh.fromLngLat(t);return!(e<0||e>25||r<0||r>=1||n<0||n>=1)},e.cF=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.cG=class extends os{},e.cH=jf,e.cJ=he,e.cK=function(e,t){le.REGISTERED_PROTOCOLS[e]=t},e.cL=function(e){delete le.REGISTERED_PROTOCOLS[e]},e.cM=function(e,t){const n={};for(let i=0;i<e.length;i++){const r=t&&t[e[i].id]||Si(e[i]);t&&(t[e[i].id]=r);let a=n[r];a||(a=n[r]=[]),a.push(e[i])}const r=[];for(const i in n)r.push(n[i]);return r},e.cN=pa,e.cO=Hh,e.cP=Vp,e.cQ=Gu,e.cR=function(t){var n;t.bucket.createArrays(),t.bucket.tilePixelRatio=M/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const r=t.bucket.layers[0],i=r.layout,a=r._unevaluatedLayout._values,s={layoutIconSize:a["icon-size"].possiblyEvaluate(new Ra(t.bucket.zoom+1),t.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Ra(t.bucket.zoom+1),t.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Ra(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.textSizeData;s.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Ra(e),t.canonical),a["text-size"].possiblyEvaluate(new Ra(n),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.iconSizeData;s.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Ra(e),t.canonical),a["icon-size"].possiblyEvaluate(new Ra(n),t.canonical)]}const o=i.get("text-line-height")*mu,l="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),c=i.get("text-keep-upright"),u=i.get("text-size");for(const h of t.bucket.features){const a=i.get("text-font").evaluate(h,{},t.canonical).join(","),d=u.evaluate(h,{},t.canonical),p=s.layoutTextSize.evaluate(h,{},t.canonical),f=s.layoutIconSize.evaluate(h,{},t.canonical),m={horizontal:{},vertical:void 0},g=h.text;let y,_=[0,0];if(g){const n=g.toString(),s=i.get("text-letter-spacing").evaluate(h,{},t.canonical)*mu,u=ka(n)?s:0,f=i.get("text-anchor").evaluate(h,{},t.canonical),y=_f(r,h,t.canonical);if(!y){const e=i.get("text-radial-offset").evaluate(h,{},t.canonical);_=e?yf(f,[e*mu,gf]):i.get("text-offset").evaluate(h,{},t.canonical).map(e=>e*mu)}let v=l?"center":i.get("text-justify").evaluate(h,{},t.canonical);const x="point"===i.get("symbol-placement")?i.get("text-max-width").evaluate(h,{},t.canonical)*mu:1/0,b=()=>{t.bucket.allowVerticalPlacement&&Sa(n)&&(m.vertical=Zu(g,t.glyphMap,t.glyphPositions,t.imagePositions,a,x,o,f,"left",u,_,e.az.vertical,!0,p,d))};if(!l&&y){const n=new Set;if("auto"===v)for(let e=0;e<y.values.length;e+=2)n.add(vf(y.values[e]));else n.add(v);let r=!1;for(const i of n)if(!m.horizontal[i])if(r)m.horizontal[i]=m.horizontal[0];else{const n=Zu(g,t.glyphMap,t.glyphPositions,t.imagePositions,a,x,o,"center",i,u,_,e.az.horizontal,!1,p,d);n&&(m.horizontal[i]=n,r=1===n.positionedLines.length)}b()}else{"auto"===v&&(v=vf(f));const r=Zu(g,t.glyphMap,t.glyphPositions,t.imagePositions,a,x,o,f,v,u,_,e.az.horizontal,!1,p,d);r&&(m.horizontal[v]=r),b(),Sa(n)&&l&&c&&(m.vertical=Zu(g,t.glyphMap,t.glyphPositions,t.imagePositions,a,x,o,f,v,u,_,e.az.vertical,!1,p,d))}}let v=!1;if(h.icon&&h.icon.name){const e=t.imageMap[h.icon.name];e&&(y=th(t.imagePositions[h.icon.name],i.get("icon-offset").evaluate(h,{},t.canonical),i.get("icon-anchor").evaluate(h,{},t.canonical)),v=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=v:t.bucket.sdfIcons!==v&&G("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const x=wf(m.horizontal)||m.vertical;(n=t.bucket).iconsInText||(n.iconsInText=!!x&&x.iconsInText),(x||y)&&xf(t.bucket,h,m,y,t.imageMap,s,p,f,_,v,t.canonical,t.subdivisionGranularity)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.cS=wc,e.cT=Bc,e.cU=tu,e.cV=function(e){const t=new Iu;return function(e,t){for(const n in e.layers)t.writeMessage(3,Rp,e.layers[n])}(e,t),t.finish()},e.cW=function(e,t,n,r,i,a){let s=Gp(e,t,n,i,0);return s=Gp(s,t,r,a,1),s},e.cX=class{constructor(e){this.maxEntries=e,this.map=new Map}get(e){const t=this.map.get(e);return void 0!==t&&(this.map.delete(e),this.map.set(e,t)),t}set(e,t){if(this.map.has(e))this.map.delete(e);else if(this.map.size>=this.maxEntries){const e=this.map.keys().next().value;this.map.delete(e)}this.map.set(e,t)}clear(){this.map.clear()}},e.cY=Nc,e.cZ=Iu,e.c_=Ap,e.ca=class extends vs{},e.cb=pu,e.cc=class extends bs{},e.cd=Cl,e.ce=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.cf=Tl,e.cg=function(e,t,n){var r=t[0],i=t[1],a=t[2],s=n[3]*r+n[7]*i+n[11]*a+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/(s=s||1),e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/s,e},e.ch=class extends ls{},e.ci=class extends Is{},e.cj=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.ck=function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=t[0],x=t[1],b=t[2],w=t[3],S=t[4],k=t[5],T=t[6],C=t[7],E=t[8],I=t[9],P=t[10],M=t[11],A=t[12],z=t[13],D=t[14],R=t[15];return Math.abs(n-v)<=p*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=p*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-b)<=p*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-w)<=p*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-S)<=p*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(o-k)<=p*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(l-T)<=p*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-C)<=p*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-E)<=p*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-I)<=p*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(d-P)<=p*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-M)<=p*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(m-A)<=p*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(g-z)<=p*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(y-D)<=p*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(_-R)<=p*Math.max(1,Math.abs(_),Math.abs(R))},e.cl=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.cm=e=>"symbol"===e.type,e.cn=e=>"circle"===e.type,e.co=e=>"heatmap"===e.type,e.cp=e=>"line"===e.type,e.cq=e=>"fill"===e.type,e.cr=e=>"fill-extrusion"===e.type,e.cs=e=>"hillshade"===e.type,e.ct=e=>"color-relief"===e.type,e.cu=e=>"background"===e.type,e.cv=e=>"custom"===e.type,e.cw=L,e.cx=function(e,t,n){if(t<=0)return e;const r=1/t;return void 0===n||Math.abs(n)<1e-10?Math.round(e*r)/r:(n>0?Math.ceil(e*r-1e-9):Math.floor(e*r+1e-10))/r},e.cy=function(e,t,n){const r=P(t.x-n.x,t.y-n.y),i=P(e.x-n.x,e.y-n.y);var a,s;return ne(Math.atan2(r[0]*i[1]-r[1]*i[0],(a=r)[0]*(s=i)[0]+a[1]*s[1]))},e.cz=N,e.d=fe,e.d0=function(e,t,r,i,a){return n(this,void 0,void 0,function*(){if(d())try{return yield K(e,t,r,i,a)}catch(n){}return function(e,t,n,r,i){const a=e.width,s=e.height;Q&&J||(Q=new OffscreenCanvas(a,s),J=Q.getContext("2d",{willReadFrequently:!0})),Q.width=a,Q.height=s,J.drawImage(e,0,0,a,s);const o=J.getImageData(t,n,r,i);return J.clearRect(0,0,a,s),o.data}(e,t,r,i,a)})},e.d1=Rl,e.d2=i,e.d3=class{constructor(e,t){this.layers={[Dp]:this},this.name=Dp,this.version=t?t.version:1,this.extent=t?t.extent:4096,this.length=e.length,this.features=e}feature(e){return new zp(this.features[e],this.extent)}},e.d4=ii,e.d5=Da,e.e=O,e.f=e=>n(void 0,void 0,void 0,function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),e.g=ce,e.h=e=>new Promise((t,n)=>{const r=new Image;r.onload=()=>{t(r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Y})},r.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(i):Y}),e.i=Z,e.j=(e,t)=>pe(O(e,{type:"json"}),t),e.k=_e,e.l=ye,e.m=pe,e.n=(e,t)=>pe(O(e,{type:"arrayBuffer"}),t),e.o=function(e){return new Iu(e).readFields(Bu,[])},e.p=qu,e.q=function(e){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))},e.r=Sl,e.s=ee,e.t=Ya,e.u=xe,e.v=ia,e.w=G,e.x=Oa,e.y=sa,e.z=Na}),r("worker",["./shared"],function(e){class n{constructor(e,t){this.keyCache={},e&&this.replace(e,t)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,n,r){for(const a of t){this._layerConfigs[a.id]=a;const t=this._layers[a.id]=e.bT(a,r);t._featureFilter=e.aj(t.filter,r),this.keyCache[a.id]&&delete this.keyCache[a.id]}for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const i=e.cM(Object.values(this._layerConfigs),this.keyCache);for(const a of i){const t=a.map(e=>this._layers[e.id]),n=t[0];if(n.isHidden())continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const s=n.sourceLayer||e.ai;let o=i[s];o||(o=i[s]=[]),o.push(t)}}}class r{constructor(t){const n={},r=[];for(const e in t){const i=t[e],a=n[e]={};for(const e in i){const t=i[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(n),a[e]={rect:n,metrics:t.metrics}}}const{w:i,h:a}=e.p(r),s=new e.r({width:i||1,height:a||1});for(const o in t){const r=t[o];for(const t in r){const i=r[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const a=n[o][t].rect;e.r.copy(i.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},i.bitmap)}}this.image=s,this.positions=n}}e.cN("GlyphAtlas",r);class i{constructor(t){this.tileID=new e.a2(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[]}parse(t,n,i,s,o){return e._(this,void 0,void 0,function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.ag;const l=new e.cO(Object.keys(t.layers).sort()),c=new e.cP(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:i,subdivisionGranularity:o},d=n.familiesBySource[this.source];for(const n in d){const r=t.layers[n];if(!r)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(n),o=[];for(let e=0;e<r.length;e++){const t=r.feature(e),i=c.getId(t,n);o.push({feature:t,id:i,index:e,sourceLayerIndex:s})}for(const t of d[n]){const n=t[0];n.source!==this.source&&e.w(`layer.source = ${n.source} does not equal this.source = ${this.source}`),n.isHidden(this.zoom,!0)||(a(t,this.zoom,i),(u[n.id]=n.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(o,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map(e=>e.id)))}}const p=e.bY(h.glyphDependencies,e=>Object.keys(e).map(Number));this.inFlightDependencies.forEach(e=>null==e?void 0:e.abort()),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const e=new AbortController;this.inFlightDependencies.push(e),f=s.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const e=new AbortController;this.inFlightDependencies.push(e),g=s.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},e)}const y=Object.keys(h.patternDependencies);let _=Promise.resolve({});if(y.length){const e=new AbortController;this.inFlightDependencies.push(e),_=s.sendAsync({type:"GI",data:{icons:y,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const v=h.dashDependencies;let x=Promise.resolve({});if(Object.keys(v).length){const e=new AbortController;this.inFlightDependencies.push(e),x=s.sendAsync({type:"GDA",data:{dashes:v}},e)}const[b,w,S,k]=yield Promise.all([f,g,_,x]),T=new r(b),C=new e.cQ(w,S);for(const t in u){const n=u[t];n instanceof e.ah?(a(n.layers,this.zoom,i),e.cR({bucket:n,glyphMap:b,glyphPositions:T.positions,imageMap:w,imagePositions:C.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):n.hasDependencies&&(n instanceof e.cS||n instanceof e.cT||n instanceof e.cU)&&(a(n.layers,this.zoom,i),n.addFeatures(h,this.tileID.canonical,C.patternPositions,k))}return this.status="done",{buckets:Object.values(u).filter(e=>!e.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:T.image,imageAtlas:C,dashPositions:k,glyphMap:this.returnDependencies?b:null,iconMap:this.returnDependencies?w:null,glyphPositions:this.returnDependencies?T.positions:null}})}}function a(t,n,r){const i=new e.H(n);for(const e of t)e.recalculate(i,r)}class s{constructor(e,t,n,r,i){this.type=e,this.properties=n||{},this.extent=i,this.pointsArray=t,this.id=r}loadGeometry(){return this.pointsArray.map(t=>t.map(t=>new e.P(t.x,t.y)))}}class o{constructor(e,t,n){this.version=2,this._myFeatures=e,this.name=t,this.length=e.length,this.extent=n}feature(e){return this._myFeatures[e]}}class l{constructor(){this.layers={}}addLayer(e){this.layers[e.name]=e}}function c(t){let n=e.cV(t);return 0===n.byteOffset&&n.byteLength===n.buffer.byteLength||(n=new Uint8Array(n)),{vectorTile:t,rawData:n.buffer}}function u(t,n,r){const{extent:i}=t,a=Math.pow(2,r.z-n.z),l=(r.x-n.x*a)*i,c=(r.y-n.y*a)*i,u=[];for(let o=0;o<t.length;o++){const n=t.feature(o);let r=n.loadGeometry();for(const e of r)for(const t of e)t.x=t.x*a-l,t.y=t.y*a-c;const h=128;r=e.cW(r,n.type,-h,-h,i+h,i+h),0!==r.length&&u.push(new s(n.type,r,n.properties,n.id,i))}return new o(u,t.name,i)}class h{constructor(t,n,r){this.actor=t,this.layerIndex=n,this.availableImages=r,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new e.cX(1e3)}loadVectorTile(t,n){return e._(this,void 0,void 0,function*(){const r=yield e.n(t.request,n);try{return{vectorTile:"mlt"!==t.encoding?new e.cY(new e.cZ(r.data)):new e.c_(r.data),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(i){const e=new Uint8Array(r.data);let n=`Unable to parse the tile at ${t.request.url}, `;throw n+=31===e[0]&&139===e[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${i.message}`,new Error(n)}})}loadTile(t){return e._(this,void 0,void 0,function*(){const{uid:n,overzoomParameters:r}=t;r&&(t.request=r.overzoomRequest);const a=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.c$(t.request),s=new i(t);this.loading[n]=s;const o=new AbortController;s.abort=o;try{const i=yield this.loadVectorTile(t,o);if(delete this.loading[n],!i)return null;if(r){const e=this._getOverzoomTile(t,i.vectorTile);i.rawData=e.rawData,i.vectorTile=e.vectorTile}const l=i.rawData,c={};i.expires&&(c.expires=i.expires),i.cacheControl&&(c.cacheControl=i.cacheControl);const u={};if(a){const e=a.finish();e&&(u.resourceTiming=JSON.parse(JSON.stringify(e)))}s.vectorTile=i.vectorTile;const h=s.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);this.loaded[n]=s,this.fetching[n]={rawTileData:l,cacheControl:c,resourceTiming:u};try{const n=yield h;return e.e({rawTileData:l.slice(0),encoding:t.encoding},n,c,u)}finally{delete this.fetching[n]}}catch(l){throw delete this.loading[n],s.status="done",this.loaded[n]=s,l}})}_getOverzoomTile(e,t){const{tileID:n,source:r,overzoomParameters:i}=e,{maxZoomTileID:a}=i,s=`${a.key}_${n.key}`,o=this.overzoomedTileResultCache.get(s);if(o)return o;const h=new l,d=this.layerIndex.familiesBySource[r];for(const l in d){const e=t.layers[l];if(!e)continue;const r=u(e,a,n.canonical);r.length>0&&h.addLayer(r)}const p=c(h);return this.overzoomedTileResultCache.set(s,p),p}reloadTile(t){return e._(this,void 0,void 0,function*(){const n=t.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[n];if(r.showCollisionBoxes=t.showCollisionBoxes,"parsing"===r.status){const i=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);let a;if(this.fetching[n]){const{rawTileData:r,cacheControl:s,resourceTiming:o}=this.fetching[n];delete this.fetching[n],a=e.e({rawTileData:r.slice(0),encoding:t.encoding},i,s,o)}else a=i;return a}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity)})}abortTile(t){return e._(this,void 0,void 0,function*(){const e=this.loading,n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort.abort(),delete e[n])})}removeTile(t){return e._(this,void 0,void 0,function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]})}}class d{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,function*(){const{uid:n,encoding:r,rawImageData:i,redFactor:a,greenFactor:s,blueFactor:o,baseShift:l}=t,c=i.width+2,u=i.height+2,h=e.b(i)?new e.R({width:c,height:u},yield e.d0(i,-1,-1,c,u)):i,d=new e.d1(n,h,r,a,s,o,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d})}removeTile(e){const t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}var p,f,m=function(){if(f)return p;function e(e,n){if(0!==e.length){t(e[0],n);for(var r=1;r<e.length;r++)t(e[r],!n)}}function t(e,t){for(var n=0,r=0,i=0,a=e.length,s=a-1;i<a;s=i++){var o=(e[i][0]-e[s][0])*(e[s][1]+e[i][1]),l=n+o;r+=Math.abs(n)>=Math.abs(o)?n-l+o:o-l+n,n=l}n+r>=0!=!!t&&e.reverse()}return f=1,p=function t(n,r){var i,a=n&&n.type;if("FeatureCollection"===a)for(i=0;i<n.features.length;i++)t(n.features[i],r);else if("GeometryCollection"===a)for(i=0;i<n.geometries.length;i++)t(n.geometries[i],r);else if("Feature"===a)t(n.geometry,r);else if("Polygon"===a)e(n.coordinates,r);else if("MultiPolygon"===a)for(i=0;i<n.coordinates.length;i++)e(n.coordinates[i],r);return n}}(),g=e.d2(m);const y={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},_=Math.fround||(v=new Float32Array(1),e=>(v[0]=+e,v[0]));var v;class x{constructor(e){this.options=Object.assign(Object.create(y),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:r}=this.options;e.length,this.points=e;const i=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[n,r]=t.geometry.coordinates,a=_(S(n)),o=_(k(r));i.push(a,o,1/0,s,-1,1),this.options.reduce&&i.push(0)}let a=this.trees[r+1]=this._createTree(i);for(let s=r;s>=n;s--)Date.now(),a=this.trees[s]=this._createTree(this._cluster(a,s));return this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){const e=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],o=s.range(S(n),k(a),S(i),k(r)),l=s.data,c=[];for(const u of o){const e=this.stride*u;c.push(l[e+5]>1?b(l,e,this.clusterProps):this.points[l[e+3]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const a=i.data;if(t*this.stride>=a.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),o=i.within(a[t*this.stride],a[t*this.stride+1],s),l=[];for(const c of o){const t=c*this.stride;a[t+4]===e&&l.push(a[t+5]>1?b(a,t,this.clusterProps):this.points[a[t+3]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,n){const r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r}getTile(e,t,n){const r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:a,radius:s}=this.options,o=s/a,l=(n-o)/i,c=(n+1+o)/i,u={features:[]};return this._addTileFeatures(r.range((t-o)/i,l,(t+1+o)/i,c),r.data,t,n,i,u),0===t&&this._addTileFeatures(r.range(1-o/i,l,1,c),r.data,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,l,o/i,c),r.data,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,i){const a=this.getChildren(t);for(const s of a){const t=s.properties;if(t&&t.cluster?i+t.point_count<=r?i+=t.point_count:i=this._appendLeaves(e,t.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i}_createTree(t){const n=new e.aT(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,r,i,a){for(const s of e){const e=s*this.stride,o=t[e+5]>1;let l,c,u;if(o)l=w(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+3]];l=n.properties;const[r,i]=n.geometry.coordinates;c=S(r),u=k(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:l};let d;d=o||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==d&&(h.id=d),a.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:r,reduce:i,minPoints:a}=this.options,s=n/(r*Math.pow(2,t)),o=e.data,l=[],c=this.stride;for(let u=0;u<o.length;u+=c){if(o[u+2]<=t)continue;o[u+2]=t;const n=o[u],r=o[u+1],h=e.within(o[u],o[u+1],s),d=o[u+5];let p=d;for(const e of h){const n=e*c;o[n+2]>t&&(p+=o[n+5])}if(p>d&&p>=a){let e,a=n*d,s=r*d,f=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const r=n*c;if(o[r+2]<=t)continue;o[r+2]=t;const l=o[r+5];a+=o[r]*l,s+=o[r+1]*l,o[r+4]=m,i&&(e||(e=this._map(o,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(o,r)))}o[u+4]=m,l.push(a/p,s/p,1/0,m,-1,p),i&&l.push(f)}else{for(let e=0;e<c;e++)l.push(o[u+e]);if(p>1)for(const e of h){const n=e*c;if(!(o[n+2]<=t)){o[n+2]=t;for(let e=0;e<c;e++)l.push(o[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){const r=this.clusterProps[e[t+6]];return n?Object.assign({},r):r}const r=this.points[e[t+3]].properties,i=this.options.map(r);return n&&i===r?Object.assign({},i):i}}function b(e,t,n){return{type:"Feature",id:e[t+3],properties:w(e,t,n),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),T(e[t+1])]}};var r}function w(e,t,n){const r=e[t+5],i=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,a=e[t+6],s=-1===a?{}:Object.assign({},n[a]);return Object.assign(s,{cluster:!0,cluster_id:e[t+3],point_count:r,point_count_abbreviated:i})}function S(e){return e/360+.5}function k(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function T(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function C(e,t,n,r){let i=r;const a=t+(n-t>>1);let s,o=n-t;const l=e[t],c=e[t+1],u=e[n],h=e[n+1];for(let d=t+3;d<n;d+=3){const t=E(e[d],e[d+1],l,c,u,h);if(t>i)s=d,i=t;else if(t===i){const e=Math.abs(d-a);e<o&&(s=d,o=e)}}i>r&&(s-t>3&&C(e,t,s,r),e[s+2]=i,n-s>3&&C(e,s,n,r))}function E(e,t,n,r,i,a){let s=i-n,o=a-r;if(0!==s||0!==o){const l=((e-n)*s+(t-r)*o)/(s*s+o*o);l>1?(n=i,r=a):l>0&&(n+=s*l,r+=o*l)}return s=e-n,o=t-r,s*s+o*o}function I(e,t,n,r){const i={type:t,geom:n},a={id:null==e?null:e,type:i.type,geometry:i.geom,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(i.type){case"Point":case"MultiPoint":case"LineString":P(a,i.geom);break;case"Polygon":P(a,i.geom[0]);break;case"MultiLineString":for(const e of i.geom)P(a,e);break;case"MultiPolygon":for(const e of i.geom)P(a,e[0])}return a}function P(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function M(e,t){const n=[];switch(e.type){case"FeatureCollection":for(let r=0;r<e.features.length;r++)A(n,e.features[r],t,r);break;case"Feature":A(n,e,t);break;default:A(n,{geometry:e,properties:void 0},t)}return n}function A(e,t,n,r){if(!t.geometry)return;if("GeometryCollection"===t.geometry.type){for(const i of t.geometry.geometries)A(e,{id:t.id,geometry:i,properties:t.properties},n,r);return}const i=t.geometry.coordinates;if(!i?.length)return;const a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let s=t.id;switch(n.promoteId?s=t.properties?.[n.promoteId]:n.generateId&&(s=r||0),t.geometry.type){case"Point":{const n=[];return z(t.geometry.coordinates,n),void e.push(I(s,t.geometry.type,n,t.properties))}case"MultiPoint":{const n=[];for(const e of t.geometry.coordinates)z(e,n);return void e.push(I(s,t.geometry.type,n,t.properties))}case"LineString":{const n=[];return D(t.geometry.coordinates,n,a,!1),void e.push(I(s,t.geometry.type,n,t.properties))}case"MultiLineString":{if(n.lineMetrics){for(const n of t.geometry.coordinates){const r=[];D(n,r,a,!1),e.push(I(s,"LineString",r,t.properties))}return}const r=[];return R(t.geometry.coordinates,r,a,!1),void e.push(I(s,t.geometry.type,r,t.properties))}case"Polygon":{const n=[];return R(t.geometry.coordinates,n,a,!0),void e.push(I(s,t.geometry.type,n,t.properties))}case"MultiPolygon":{const n=[];for(const e of t.geometry.coordinates){const t=[];R(e,t,a,!0),n.push(t)}return void e.push(I(s,t.geometry.type,n,t.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function z(e,t){t.push(L(e[0]),N(e[1]),0)}function D(e,t,n,r){let i,a,s=0;for(let l=0;l<e.length;l++){const n=L(e[l][0]),o=N(e[l][1]);t.push(n,o,0),l>0&&(s+=r?(i*o-n*a)/2:Math.sqrt(Math.pow(n-i,2)+Math.pow(o-a,2))),i=n,a=o}const o=t.length-3;t[2]=1,n>0&&C(t,0,o,n),t[o+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function R(e,t,n,r){for(let i=0;i<e.length;i++){const a=[];D(e[i],a,n,r),t.push(a)}}function L(e){return e/360+.5}function N(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function j(e,t,n,r,i,a,s,o){if(r/=t,a>=(n/=t)&&s<r)return e;if(s<n||a>=r)return null;const l=[];for(const c of e){const e=0===i?c.minX:c.minY,t=0===i?c.maxX:c.maxY;if(e>=n&&t<r)l.push(c);else if(!(t<n||e>=r))switch(c.type){case"Point":case"MultiPoint":{const e=[];if(F(c.geometry,e,n,r,i),!e.length)continue;l.push(I(c.id,3===e.length?"Point":"MultiPoint",e,c.tags));continue}case"LineString":{const e=[];if(O(c.geometry,e,n,r,i,!1,o.lineMetrics),!e.length)continue;if(o.lineMetrics){for(const t of e)l.push(I(c.id,c.type,t,c.tags));continue}if(e.length>1){l.push(I(c.id,"MultiLineString",e,c.tags));continue}l.push(I(c.id,c.type,e[0],c.tags));continue}case"MultiLineString":{const e=[];if(V(c.geometry,e,n,r,i,!1),!e.length)continue;if(1===e.length){l.push(I(c.id,"LineString",e[0],c.tags));continue}l.push(I(c.id,c.type,e,c.tags));continue}case"Polygon":{const e=[];if(V(c.geometry,e,n,r,i,!0),!e.length)continue;l.push(I(c.id,c.type,e,c.tags));continue}case"MultiPolygon":{const e=[];for(const t of c.geometry){const a=[];V(t,a,n,r,i,!0),a.length&&e.push(a)}if(!e.length)continue;l.push(I(c.id,c.type,e,c.tags));continue}}}return l.length?l:null}function F(e,t,n,r,i){for(let a=0;a<e.length;a+=3){const s=e[a+i];s>=n&&s<=r&&U(t,e[a],e[a+1],e[a+2])}}function O(e,t,n,r,i,a,s){let o=B(e);const l=0===i?q:$;let c,u,h=e.start;for(let g=0;g<e.length-3;g+=3){const d=e[g],p=e[g+1],f=e[g+2],m=e[g+3],y=e[g+4],_=0===i?d:p,v=0===i?m:y;let x=!1;s&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-y,2))),_<n?v>n&&(u=l(o,d,p,m,y,n),s&&(o.start=h+c*u)):_>r?v<r&&(u=l(o,d,p,m,y,r),s&&(o.start=h+c*u)):U(o,d,p,f),v<n&&_>=n&&(u=l(o,d,p,m,y,n),x=!0),v>r&&_<=r&&(u=l(o,d,p,m,y,r),x=!0),!a&&x&&(s&&(o.end=h+c*u),t.push(o),o=B(e)),s&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],m=0===i?p:f;m>=n&&m<=r&&U(o,p,f,e[d+2]),d=o.length-3,a&&d>=3&&(o[d]!==o[0]||o[d+1]!==o[1])&&U(o,o[0],o[1],o[2]),o.length&&t.push(o)}function B(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function V(e,t,n,r,i,a){for(const s of e)O(s,t,n,r,i,a,!1)}function U(e,t,n,r){e.push(t,n,r)}function q(e,t,n,r,i,a){const s=(a-t)/(r-t);return U(e,a,n+(i-n)*s,1),s}function $(e,t,n,r,i,a){const s=(a-n)/(i-n);return U(e,t+(r-t)*s,a,1),s}function G(e,t){const n=t.buffer/t.extent;let r=e;const i=j(e,1,-1-n,n,0,-1,2,t),a=j(e,1,1-n,2+n,0,-1,2,t);return i||a?(r=j(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=H(i,1).concat(r)),a&&(r=r.concat(H(a,-1))),r):r}function H(e,t){const n=[];for(const r of e)switch(r.type){case"Point":case"MultiPoint":case"LineString":{const e=Z(r.geometry,t);n.push(I(r.id,r.type,e,r.tags));continue}case"MultiLineString":case"Polygon":{const e=[];for(const n of r.geometry)e.push(Z(n,t));n.push(I(r.id,r.type,e,r.tags));continue}case"MultiPolygon":{const e=[];for(const n of r.geometry){const r=[];for(const e of n)r.push(Z(e,t));e.push(r)}n.push(I(r.id,r.type,e,r.tags));continue}}return n}function Z(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function W(e,t){if(e.transformed)return e;const n=1<<e.z,r=e.x,i=e.y;for(const a of e.features){if(1===a.type){const e=[];for(let s=0;s<a.geometry.length;s+=2)e.push(X(a.geometry[s],a.geometry[s+1],t,n,r,i));a.geometry=e;continue}const e=[];for(const s of a.geometry){const a=[];for(let e=0;e<s.length;e+=2)a.push(X(s[e],s[e+1],t,n,r,i));e.push(a)}a.geometry=e}return e.transformed=!0,e}function X(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}function Y(e,t,n,r,i){const a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const o of e)K(s,o,a,i);return s}function K(e,t,n,r){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY);let i,a=t.tags||null;switch(t.type){case"Point":case"MultiPoint":{const n=[];for(let r=0;r<t.geometry.length;r+=3)n.push(t.geometry[r],t.geometry[r+1]),e.numPoints++,e.numSimplified++;if(!n.length)return;i={type:1,tags:a,geometry:n};break}case"LineString":{const s=[];if(Q(s,t.geometry,e,n,!1,!1),!s.length)return;if(r.lineMetrics){a={};for(const e in t.tags)a[e]=t.tags[e];a.mapbox_clip_start=t.geometry.start/t.geometry.size,a.mapbox_clip_end=t.geometry.end/t.geometry.size}i={type:2,tags:a,geometry:s};break}case"MultiLineString":case"Polygon":{const r=[];for(let i=0;i<t.geometry.length;i++)Q(r,t.geometry[i],e,n,"Polygon"===t.type,0===i);if(!r.length)return;i={type:"Polygon"===t.type?3:2,tags:a,geometry:r};break}case"MultiPolygon":{const r=[];for(let i=0;i<t.geometry.length;i++){const a=t.geometry[i];for(let t=0;t<a.length;t++)Q(r,a[t],e,n,!0,0===t)}if(!r.length)return;i={type:3,tags:a,geometry:r};break}}null!==t.id&&(i.id=t.id),e.features.push(i)}function Q(e,t,n,r,i,a){const s=r*r;if(r>0&&t.size<(i?s:r))return void(n.numPoints+=t.length/3);const o=[];for(let l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(n.numSimplified++,o.push(t[l],t[l+1])),n.numPoints++;i&&function(e,t){let n=0;for(let r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(let r=0,i=e.length;r<i/2;r+=2){const t=e[r],n=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=t,e[i-1-r]=n}}(o,a),e.push(o)}function J(e,t,n){const r=!!t.newGeometry,i=t.removeAllProperties||t.removeProperties?.length>0||t.addOrUpdateProperties?.length>0;if(r){let r=M({type:"FeatureCollection",features:[{type:"Feature",id:e.id,geometry:t.newGeometry,properties:i?ee(e.tags,t):e.tags}]},n);return r=G(r,n),r[0]}if(i){const n={...e};return n.tags=ee(n.tags,t),n}return null}function ee(e,t){if(t.removeAllProperties)return{};const n={...e||{}};if(t.removeProperties)for(const r of t.removeProperties)delete n[r];if(t.addOrUpdateProperties)for(const{key:r,value:i}of t.addOrUpdateProperties)n[r]=i;return n}const te={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class ne{constructor(e,n){t(this,"options"),t(this,"tiles"),t(this,"tileCoords"),t(this,"stats",{}),t(this,"total",0),t(this,"source");const r=(n=this.options=Object.assign({},te,n)).debug;if(n.maxZoom<0||n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(n.promoteId&&n.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=M(e,n);this.tiles={},this.tileCoords=[],r&&(this.stats={},this.total=0),i=G(i,n),i.length&&this.splitTile(i,0,0,0),n.updateable&&(this.source=i),r&&i.length}splitTile(e,t,n,r,i,a,s){const o=[e,t,n,r],l=this.options,c=l.debug;for(;o.length;){r=o.pop(),n=o.pop(),t=o.pop(),e=o.pop();const u=1<<t,h=re(t,n,r);let d=this.tiles[h];if(!d&&(d=this.tiles[h]=Y(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r,id:h}),c)){const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==i){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===i)continue;if(null!=i){const e=i-t;if(n!==a>>e||r!==s>>e)continue}}if(d.source=null,!e.length)continue;const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let y=null,_=null,v=null,x=null;const b=j(e,u,n-p,n+m,0,d.minX,d.maxX,l),w=j(e,u,n+f,n+g,0,d.minX,d.maxX,l);b&&(y=j(b,u,r-p,r+m,1,d.minY,d.maxY,l),_=j(b,u,r+f,r+g,1,d.minY,d.maxY,l)),w&&(v=j(w,u,r-p,r+m,1,d.minY,d.maxY,l),x=j(w,u,r+f,r+g,1,d.minY,d.maxY,l)),o.push(y||[],t+1,2*n,2*r),o.push(_||[],t+1,2*n,2*r+1),o.push(v||[],t+1,2*n+1,2*r),o.push(x||[],t+1,2*n+1,2*r+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const r=this.options,{extent:i,debug:a}=r;if(e<0||e>24)return null;const s=1<<e,o=re(e,t=t+s&s-1,n);if(this.tiles[o])return W(this.tiles[o],i);let l,c=e,u=t,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[re(c,u,h)];return l?.source?(this.splitTile(l.source,c,u,h,e,t,n),this.tiles[o]?W(this.tiles[o],i):null):null}invalidateTiles(e){const t=this.options,{debug:n}=t;let r=1/0,i=-1/0,a=1/0,s=-1/0;for(const c of e)r=Math.min(r,c.minX),i=Math.max(i,c.maxX),a=Math.min(a,c.minY),s=Math.max(s,c.maxY);const o=t.buffer/t.extent,l=new Set;for(const c in this.tiles){const t=this.tiles[c],u=1<<t.z,h=(t.x-o)/u,d=(t.x+1+o)/u,p=(t.y-o)/u,f=(t.y+1+o)/u;if(i<h||r>=d||s<p||a>=f)continue;let m=!1;for(const n of e)if(n.maxX>=h&&n.minX<d&&n.maxY>=p&&n.minY<f){m=!0;break}if(m){if(n){const e=`z${t.z}`;this.stats[e]=(this.stats[e]||0)-1,this.total--}delete this.tiles[c],l.add(c)}}l.size&&(this.tileCoords=this.tileCoords.filter(e=>!l.has(e.id)))}updateData(e){const t=this.options,n=t.debug;if(!t.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:r,source:i}=function(e,t,n){const r=(i=t)?{removeAll:i.removeAll,remove:new Set(i.remove||[]),add:new Map(i.add?.map(e=>[e.id,e])),update:new Map(i.update?.map(e=>[e.id,e]))}:{remove:new Set,add:new Map,update:new Map};var i;let a=[];if(r.removeAll&&(a=e,e=[]),r.remove.size||r.add.size){const t=[];for(const n of e){const{id:e}=n;(r.remove.has(e)||r.add.has(e))&&t.push(n)}if(t.length){a.push(...t);const n=new Set(t.map(e=>e.id));e=e.filter(e=>!n.has(e.id))}if(r.add.size){let t=M({type:"FeatureCollection",features:Array.from(r.add.values())},n);t=G(t,n),a.push(...t),e.push(...t)}}if(r.update.size)for(const[s,o]of r.update){const t=e.findIndex(e=>e.id===s);if(-1===t)continue;const r=e[t],i=J(r,o,n);i&&(a.push(r,i),e[t]=i)}return{affected:a,source:e}}(this.source,e,t);if(!r.length)return;this.source=i,this.invalidateTiles(r);const[a,s,o]=[0,0,0],l=Y(this.source,a,s,o,this.options);l.source=this.source;const c=re(a,s,o);if(this.tiles[c]=l,this.tileCoords.push({z:a,x:s,y:o,id:c}),n){const e=`z${a}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}}}function re(e,t,n){return 32*((1<<e)*n+t)+e}class ie extends h{constructor(e,t,n,r=ae){super(e,t,n),this._dataUpdateable=new Map,this._createGeoJSONIndex=r}loadVectorTile(t,n){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const r=this._geoJSONIndex.getTile(n.z,n.x,n.y);return r?c(new e.d3(r.features,{version:2,extent:e.a5})):null})}loadData(t){return e._(this,void 0,void 0,function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const r=this._startPerformance(t);this._pendingRequest=new AbortController;try{(!this._pendingData||t.request||t.data||t.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest));const e=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(e,t),this.loaded={};const n={};return t.request&&(n.data=e),this._finishPerformance(r,t,n),n}catch(i){if(delete this._pendingRequest,e.Z(i))return{abandoned:!0};throw i}})}_startPerformance(t){var n;if(null===(n=null==t?void 0:t.request)||void 0===n?void 0:n.collectResourceTiming)return new e.c$(t.request)}_finishPerformance(e,t,n){if(!e)return;const r=e.finish();r&&(n.resourceTiming={},n.resourceTiming[t.source]=JSON.parse(JSON.stringify(r)))}getData(){return e._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,n){return e._(this,void 0,void 0,function*(){let e;if(t.request?e=yield this.loadGeoJSONFromUrl(t.request,t.promoteId,n):t.data?e=this._loadGeoJSONFromObject(t.data,t.promoteId):t.dataDiff&&(e=this._loadGeoJSONFromDiff(t.dataDiff,t.promoteId,t.source)),delete this._pendingRequest,"object"!=typeof e)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);return g(e,!0),t.filter&&(e=this._filterGeoJSON(e,t.filter)),e})}loadGeoJSONFromUrl(t,n,r){return e._(this,void 0,void 0,function*(){const i=yield e.j(t,r);return this._dataUpdateable=e.a7(i.data,n),i.data})}_loadGeoJSONFromObject(t,n){return this._dataUpdateable=e.a7(t,n),t}_loadGeoJSONFromDiff(t,n,r){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${r}`);e.a8(this._dataUpdateable,t,n);const i=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(i)}_filterGeoJSON(t,n){const r=e.d4(n,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map(e=>`${e.key}: ${e.message}`).join(", "));const i=t.features.filter(e=>r.value.evaluate({zoom:0},e));return this._toFeatureCollection(i)}_toFeatureCollection(e){return{type:"FeatureCollection",features:e}}removeSource(t){return e._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}function ae(t,n){return n.cluster?new x(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const r={},i={},a={accumulated:null,zoom:0},s={properties:null},o=Object.keys(n);for(const l of o){const[t,a]=n[l],s=e.d4(a),o=e.d4("string"==typeof t?[t,["accumulated"],["get",l]]:t);r[l]=s.value,i[l]=o.value}return t.map=e=>{s.properties=e;const t={};for(const n of o)t[n]=r[n].evaluate(a,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const n of o)a.accumulated=e[n],e[n]=i[n].evaluate(a,s)},t}(n)).load(t.features):(r=t,i=n.geojsonVtOptions,new ne(r,i));var r,i}class se{constructor(t){this.self=t,this.actor=new e.L(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.cK,this.self.removeProtocol=e.cL,this.self.registerRTLTextPlugin=t=>{e.d5.setMethods(t)},this.actor.registerMessageHandler("LDT",(e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t)),this.actor.registerMessageHandler("RDT",(t,n)=>e._(this,void 0,void 0,function*(){this._getDEMWorkerSource(t,n.source).removeTile(n)})),this.actor.registerMessageHandler("GCEZ",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterExpansionZoom(n)})),this.actor.registerMessageHandler("GCC",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterChildren(n)})),this.actor.registerMessageHandler("GCL",(t,n)=>e._(this,void 0,void 0,function*(){return this._getWorkerSource(t,n.type,n.source).getClusterLeaves(n)})),this.actor.registerMessageHandler("LD",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t)),this.actor.registerMessageHandler("GD",(e,t)=>this._getWorkerSource(e,t.type,t.source).getData()),this.actor.registerMessageHandler("LT",(e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t)),this.actor.registerMessageHandler("RT",(e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t)),this.actor.registerMessageHandler("AT",(e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t)),this.actor.registerMessageHandler("RMT",(e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t)),this.actor.registerMessageHandler("RS",(t,n)=>e._(this,void 0,void 0,function*(){if(!this.workerSources[t]||!this.workerSources[t][n.type]||!this.workerSources[t][n.type][n.source])return;const e=this.workerSources[t][n.type][n.source];delete this.workerSources[t][n.type][n.source],void 0!==e.removeSource&&e.removeSource(n)})),this.actor.registerMessageHandler("RM",t=>e._(this,void 0,void 0,function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],this.globalStates.delete(t)})),this.actor.registerMessageHandler("SR",(t,n)=>e._(this,void 0,void 0,function*(){this.referrer=n})),this.actor.registerMessageHandler("SRPS",(e,t)=>this._syncRTLPluginState(e,t)),this.actor.registerMessageHandler("IS",(t,n)=>e._(this,void 0,void 0,function*(){this.self.importScripts(n)})),this.actor.registerMessageHandler("SI",(e,t)=>this._setImages(e,t)),this.actor.registerMessageHandler("UL",(t,n)=>e._(this,void 0,void 0,function*(){this._getLayerIndex(t).update(n.layers,n.removedIds,this._getGlobalState(t))})),this.actor.registerMessageHandler("UGS",(t,n)=>e._(this,void 0,void 0,function*(){const e=this._getGlobalState(t);for(const t in n)e[t]=n[t]})),this.actor.registerMessageHandler("SL",(t,n)=>e._(this,void 0,void 0,function*(){this._getLayerIndex(t).replace(n,this._getGlobalState(t))}))}_getGlobalState(e){let t=this.globalStates.get(e);return t||(t={},this.globalStates.set(e,t)),t}_setImages(t,n){return e._(this,void 0,void 0,function*(){this.availableImages[t]=n;for(const e in this.workerSources[t]){const r=this.workerSources[t][e];for(const e in r)r[e].availableImages=n}})}_syncRTLPluginState(t,n){return e._(this,void 0,void 0,function*(){return yield e.d5.syncState(n,this.self.importScripts)})}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new n),t}_getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const r={sendAsync:(t,n)=>(t.targetMapId=e,this.actor.sendAsync(t,n))};switch(t){case"vector":this.workerSources[e][t][n]=new h(r,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][n]=new ie(r,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][n]=new this.externalWorkerSourceTypes[t](r,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][n]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new d),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new se(self)),se}),r("index",["exports","./shared"],function(e,t){var n="5.17.0";function r(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let i,a,s;const o={frame(e,n,r,i){const a=i||window,s=a.requestAnimationFrame(e=>{o(),n(e)}),{unsubscribe:o}=t.s(e.signal,"abort",()=>{o(),a.cancelAnimationFrame(s),r(new t.a(e.signal.reason))},!1)},frameAsync(e,t){return new Promise((n,r)=>{this.frame(e,n,r,t)})},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),n},resolveURL:e=>(i||(i=document.createElement("a")),i.href=e,i.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return void 0!==s?s:!!matchMedia&&(null==a&&(a=matchMedia("(prefers-reduced-motion: reduce)")),a.matches)},set prefersReducedMotion(e){s=e}},l=new class{constructor(){this._realTime="undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return null!==this._frozenAt?this._frozenAt:this._realTime()}setNow(e){this._frozenAt=e}restoreNow(){this._frozenAt=null}isFrozen(){return null!==this._frozenAt}};function c(){return l.getCurrentTime()}class u{static testProp(e){if(!u.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in u.docStyle)return e[t];return e[0]}static create(e,t,n){const r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){u.docStyle&&u.selectProp&&(u.userSelect=u.docStyle[u.selectProp],u.docStyle[u.selectProp]="none")}static enableDrag(){u.docStyle&&u.selectProp&&(u.docStyle[u.selectProp]=u.userSelect)}static setTransform(e,t){e.style[u.transformProp]=t}static addEventListener(e,t,n,r={}){e.addEventListener(t,n,"passive"in r?r:r.capture)}static removeEventListener(e,t,n,r={}){e.removeEventListener(t,n,"passive"in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",u.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",u.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",u.suppressClickInternal,!0)},0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,n,r){const i=n.boundingClientRect;return new t.P((r.clientX-i.left)/n.x-e.clientLeft,(r.clientY-i.top)/n.y-e.clientTop)}static mousePos(e,t){const n=u.getScale(e);return u.getPoint(e,n,t)}static touchPos(e,t){const n=[],r=u.getScale(e);for(let i=0;i<t.length;i++)n.push(u.getPoint(e,r,t[i]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const t=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),n=t.querySelectorAll("script");for(const r of n)r.remove();return u.clean(t),t.innerHTML}static isPossiblyDangerous(e,t){const n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const t=e.children;for(const n of t)u.removeAttributes(n),u.clean(n)}static removeAttributes(e){for(const{name:t,value:n}of e.attributes)u.isPossiblyDangerous(t,n)&&e.removeAttribute(t)}}u.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,u.selectProp=u.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),u.transformProp=u.testProp(["transform","WebkitTransform"]);const h={supported:!1,testSupport:function(e){!f&&p&&(m?g(e):d=e)}};let d,p,f=!1,m=!1;function g(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,p),e.isContextLost())return;h.supported=!0}catch(n){}e.deleteTexture(t),f=!0}var y;"undefined"!=typeof document&&(p=document.createElement("img"),p.onload=()=>{d&&g(d),d=null,m=!0},p.onerror=()=>{f=!0,d=null},p.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let n,r,i,a;e.resetRequestQueue=()=>{n=[],r=0,i=0,a={}},e.addThrottleControl=e=>{const t=i++;return a[t]=e,t},e.removeThrottleControl=e=>{delete a[e],o()},e.getImage=(e,r,i=!0)=>new Promise((a,s)=>{h.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),n.push({abortController:r,requestParameters:e,supportImageRefresh:i,state:"queued",onError:e=>{s(e)},onSuccess:e=>{a(e)}}),o()});const s=e=>t._(this,void 0,void 0,function*(){e.state="running";const{requestParameters:n,supportImageRefresh:i,onError:a,onSuccess:s,abortController:c}=e,u=!1===i&&!t.i(self)&&!t.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce((e,t)=>e&&"accept"===t,!0));r++;const h=u?l(n,c):t.m(n,c);try{const n=yield h;delete e.abortController,e.state="completed",n.data instanceof HTMLImageElement||t.b(n.data)?s(n):n.data&&s({data:yield(d=n.data,"function"==typeof createImageBitmap?t.f(d):t.h(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(p){delete e.abortController,a(p)}finally{r--,o()}var d}),o=()=>{const e=(()=>{for(const e of Object.keys(a))if(a[e]())return!0;return!1})()?t.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=r;t<e&&n.length>0;t++){const e=n.shift();e.abortController.signal.aborted?t--:s(e)}},l=(e,n)=>new Promise((r,i)=>{const a=new Image,s=e.url,o=e.credentials;o&&"include"===o?a.crossOrigin="use-credentials":(o&&"same-origin"===o||!t.d(s))&&(a.crossOrigin="anonymous"),n.signal.addEventListener("abort",()=>{a.src="",i(new t.a(n.signal.reason))}),a.fetchPriority="high",a.onload=()=>{a.onerror=a.onload=null,r({data:a})},a.onerror=()=>{a.onerror=a.onload=null,n.signal.aborted||i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},a.src=s})}(y||(y={})),y.resetRequestQueue();class _{constructor(e){this._transformRequestFn=null!=e?e:null}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function v(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const n=[];for(const{id:r,url:i}of e){const e=`${r}${i}`;-1===n.indexOf(e)&&(n.push(e),t.push({id:r,url:i}))}}return t}function x(e,t,n){try{const r=new URL(e);return r.pathname+=`${t}${n}`,r.toString()}catch(r){throw new Error(`Invalid sprite URL "${e}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function b(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class w extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const e=n.spriteData;n.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),n.spriteData=null}return n}addImage(e,t){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(e,n){let r=!0;const i=n.data||n.spriteData;return this._validateStretch(n.stretchX,i&&i.width)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,i&&i.height)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let n=0;for(const r of e){if(r[0]<n||r[1]<r[0]||t<r[1])return!1;n=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const n=t.spriteData,r=n&&n.width||t.data.width,i=n&&n.height||t.data.height;return!(e[0]<0||r<e[0]||e[1]<0||i<e[1]||e[2]<0||r<e[2]||e[3]<0||i<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n=!0){const r=this.getImage(e);if(n&&(r.data.width!==t.data.width||r.data.height!==t.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=r.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((t,n)=>{let r=!0;if(!this.isLoaded())for(const i of e)this.images[i]||(r=!1);this.isLoaded()||r?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})})}_getImagesForIds(e){const n={};for(const r of e){let e=this.getImage(r);e||(this.fire(new t.l("styleimagemissing",{id:r})),e=this.getImage(r)),e?n[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new t.I(n,r);this.patterns[e]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:r}=t.p(e),i=this.atlasImage;i.resize({width:n||1,height:r||1});for(const a in this.patterns){const{bin:e}=this.patterns[a],n=e.x+1,r=e.y+1,s=this.getImage(a).data,o=s.width,l=s.height;t.R.copy(s,i,{x:0,y:0},{x:n,y:r},{width:o,height:l}),t.R.copy(s,i,{x:0,y:l-1},{x:n,y:r-1},{width:o,height:1}),t.R.copy(s,i,{x:0,y:0},{x:n,y:r+l},{width:o,height:1}),t.R.copy(s,i,{x:o-1,y:0},{x:n-1,y:r},{width:1,height:l}),t.R.copy(s,i,{x:0,y:0},{x:n+o,y:r},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const e=this.getImage(n);e||t.w(`Image with ID: "${n}" was not found`),b(e)&&this.updateImage(n,e)}}cloneImages(){const e={};for(const t in this.images){const n=this.images[t];e[t]=Object.assign(Object.assign({},n),{data:n.data?n.data.clone():null})}return e}}const S=1e20;function k(e,t,n,r,i,a,s,o,l){for(let c=t;c<t+r;c++)T(e,n*a+c,a,i,s,o,l);for(let c=n;c<n+i;c++)T(e,c*a+t,1,r,s,o,l)}function T(e,t,n,r,i,a,s){a[0]=0,s[0]=-S,s[1]=S,i[0]=e[t];for(let o=1,l=0,c=0;o<r;o++){i[o]=e[t+o*n];const r=o*o;do{const e=a[l];c=(i[o]-i[e]+r-e*e)/(o-e)/2}while(c<=s[l]&&--l>-1);l++,a[l]=o,s[l]=c,s[l+1]=S}for(let o=0,l=0;o<r;o++){for(;s[l+1]<o;)l++;const r=a[l],c=o-r;e[t+o*n]=i[r]+c*c}}const C=t.v.layout_symbol["text-font"].default.join(",");class E{constructor(e,t,n){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={},this.lang=n}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,function*(){const t=[];for(const i in e)for(const n of e[i])t.push(this._getAndCacheGlyphsPromise(i,n));const n=yield Promise.all(t),r={};for(const{stack:e,id:i,glyph:a}of n)r[e]||(r[e]={}),r[e][i]=a&&{id:a.id,bitmap:a.bitmap.clone(),metrics:a.metrics};return r})}_getAndCacheGlyphsPromise(e,n){return t._(this,void 0,void 0,function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=t.glyphs[n];return void 0!==r?{stack:e,id:n,glyph:r}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(r=t.glyphs[n]=this._drawGlyph(t,e,n),{stack:e,id:n,glyph:r}):yield this._downloadAndCacheRangePromise(e,n)})}_downloadAndCacheRangePromise(e,n){return t._(this,void 0,void 0,function*(){const t=this.entries[e],r=Math.floor(n/256);if(t.ranges[r])return{stack:e,id:n,glyph:null};if(!t.requests[r]){const n=E.loadGlyphRange(e,r,this.url,this.requestManager);t.requests[r]=n}try{const i=yield t.requests[r];for(const e in i)t.glyphs[+e]=i[+e];return t.ranges[r]=!0,{stack:e,id:n,glyph:i[n]||null}}catch(i){const a=t.glyphs[n]=this._drawGlyph(t,e,n);return this._warnOnMissingGlyphRange(a,r,n,i),{stack:e,id:n,glyph:a}}})}_warnOnMissingGlyphRange(e,n,r,i){const a=256*n,s=a+255,o=r.toString(16).padStart(4,"0").toUpperCase();t.w(`Unable to load glyph range ${n}, ${a}-${s}. Rendering codepoint U+${o} locally instead. ${i}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&t.q(e)}_drawGlyph(e,n,r){const i=n===C&&""!==this.localIdeographFontFamily&&this._charUsesLocalIdeographFontFamily(r),a=i?"ideographTinySDF":"tinySDF";e[a]||(e[a]=this._createTinySDF(i?this.localIdeographFontFamily:n));const s=e[a].draw(String.fromCodePoint(r)),o=/^\p{gc=Cf}+$/u.test(String.fromCodePoint(r));return{id:r,bitmap:new t.r({width:s.width||60,height:s.height||60},s.data),metrics:{width:o?0:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:o?0:s.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const t=e?e.split(","):[];t.push("sans-serif");const n=t.map(e=>/[-\w]+/.test(e)?e:`'${CSS.escape(e)}'`).join(",");return new E.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:this._fontWeight(t[0]),fontStyle:this._fontStyle(t[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const t={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let n;for(const[r,i]of Object.entries(t))new RegExp(`\\b${r}\\b`,"i").test(e)&&(n=`${i}`);return n}destroy(){for(const e in this.entries){const t=this.entries[e];t.tinySDF&&(t.tinySDF=null),t.ideographTinySDF&&(t.ideographTinySDF=null),t.glyphs={},t.requests={},t.ranges={}}this.entries={}}}E.loadGlyphRange=function(e,n,r,i){return t._(this,void 0,void 0,function*(){const a=256*n,s=a+255,o=i.transformRequest(r.replace("{fontstack}",e).replace("{range}",`${a}-${s}`),"Glyphs"),l=yield t.n(o,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${n}, ${a}-${s}`);const c={};for(const e of t.o(l.data))c[e.id]=e;return c})},E.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:a="normal",fontStyle:s="normal",lang:o=null}={}){this.buffer=t,this.cutoff=r,this.radius=n,this.lang=o;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${a} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:a}=this.ctx.measureText(e),s=Math.ceil(n),o=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-i))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=o+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:o,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;this.lang&&(f.lang=this.lang),f.clearRect(m,m,o,l),f.fillText(e,m,m+s);const _=f.getImageData(m,m,o,l);y.fill(S,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<o;e++){const t=_.data[4*(v*o+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)y[n]=0,g[n]=S;else{const e=.5-t;y[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}k(y,0,0,c,u,c,this.f,this.v,this.z),k(g,m,m,o,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(y[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class I{constructor(){this.specification=t.u.light.position}possiblyEvaluate(e,n){return t.F(e.expression.evaluate(n))}interpolate(e,n,r){return{x:t.G.number(e.x,n.x,r),y:t.G.number(e.y,n.y,r),z:t.G.number(e.z,n.z,r)}}}let P;class M extends t.E{constructor(e){super(),P=P||new t.t({anchor:new t.D(t.u.light.anchor),position:new I,color:new t.D(t.u.light.color),intensity:new t.D(t.u.light.intensity)}),this._transitionable=new t.x(P,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.y,e,n))for(const r in e){const n=e[r];r.endsWith(t.z)?this._transitionable.setTransition(r.slice(0,-t.z.length),n):this._transitionable.setValue(r,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,r){return(!r||!1!==r.validate)&&t.B(this,e.call(t.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.u}))}}const A=new t.t({"sky-color":new t.D(t.u.sky["sky-color"]),"horizon-color":new t.D(t.u.sky["horizon-color"]),"fog-color":new t.D(t.u.sky["fog-color"]),"fog-ground-blend":new t.D(t.u.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.u.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.u.sky["atmosphere-blend"])});class z extends t.E{constructor(e){super(),this._transitionable=new t.x(A,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.H(0))}setSky(e,n={}){if(!this._validate(t.J,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const n in e){const r=e[n];n.endsWith(t.z)?this._transitionable.setTransition(n.slice(0,-t.z.length),r):this._transitionable.setValue(n,r)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,r={}){return!1!==(null==r?void 0:r.validate)&&t.B(this,e.call(t.C,t.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class D{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}getDashRanges(e,t,n){const r=[];let i=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,s=!0;r.push({left:i,right:a,isDash:s,zeroLength:0===e[0]});let o=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];i=o*n,o+=t,a=o*n,r.push({left:i,right:a,isDash:s,zeroLength:0===t})}return r}addRoundDash(e,t,n){const r=t/2;for(let i=-n;i<=n;i++){const t=this.width*(this.nextRow+n+i);let a=0,s=e[a];for(let o=0;o<this.width;o++){o/s.right>1&&(s=e[++a]);const l=Math.abs(o-s.left),c=Math.abs(o-s.right),u=Math.min(l,c);let h;const d=i/n*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.data[t+o]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let s=e.length-1;s>=0;--s){const t=e[s],n=e[s+1];t.zeroLength?e.splice(s,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(s,1))}const t=e[0],n=e[e.length-1];t.isDash===n.isDash&&(t.left=n.left-this.width,n.right=t.right+this.width);const r=this.width*this.nextRow;let i=0,a=e[i];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++i]);const t=Math.abs(s-a.left),n=Math.abs(s-a.right),o=Math.min(t,n);this.data[r+s]=Math.max(0,Math.min(255,(a.isDash?o:-o)+128))}}addDash(e,n){const r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.w("LineAtlas out of space"),null;let a=0;for(let t=0;t<e.length;t++)a+=e[t];if(0!==a){const t=this.width/a,i=this.getDashRanges(e,this.width,t);n?this.addRoundDash(i,t,r):this.addRegularDash(i)}const s={y:this.nextRow+r,height:2*r,width:a};return this.nextRow+=i,this.dirty=!0,s}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const R="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(t.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[R]}numActive(){return Object.keys(this.active).length}}const N=Math.floor(o.hardwareConcurrency/2);let j,F;function O(){return j||(j=new L),j}L.workerCount=t.K(globalThis)?Math.max(Math.min(N,3),1):1;class B{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const r=this.workerPool.acquire(n);for(let i=0;i<r.length;i++){const e=new t.L(r[i],n);e.name=`Worker ${i}`,this.actors.push(e)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const n=[];for(const r of this.actors)n.push(r.sendAsync({type:e,data:t}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(e=>{e.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const n of this.actors)n.registerMessageHandler(e,t)}unregisterMessageHandler(e){for(const t of this.actors)t.unregisterMessageHandler(e)}}function V(){return F||(F=new B(O(),t.M),F.registerMessageHandler("GR",(e,n,r)=>t.m(n,r))),F}function U(e,n){const r=t.N();return t.O(r,r,[1,1,0]),t.Q(r,r,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?t.S(r,r,e.calculatePosMatrix(n.toUnwrapped())):r}function q(e,t,n,r,i,a,s){var o;const l=function(e,t,n){if(e)for(const r of e){const e=t[r];if(e&&e.source===n&&"fill-extrusion"===e.type)return!0}else for(const r in t){const e=t[r];if(e.source===n&&"fill-extrusion"===e.type)return!0}return!1}(null!==(o=null==i?void 0:i.layers)&&void 0!==o?o:null,t,e.id),c=a.maxPitchScaleFactor(),u=e.tilesIn(r,c,l);u.sort($);const h=[];for(const d of u)h.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(t,n,e.getState(),d.queryGeometry,d.cameraQueryGeometry,d.scale,i,a,c,U(a,d.tileID),s?(e,t)=>s(d.tileID,e,t):void 0)});return function(e,t){for(const n in e)for(const r of e[n])G(r,t);return e}(function(e){const t={},n={};for(const r of e){const e=r.queryResults,i=r.wrappedTileID,a=n[i]=n[i]||{};for(const n in e){const r=e[n],i=a[n]=a[n]||{},s=t[n]=t[n]||[];for(const e of r)i[e.featureIndex]||(i[e.featureIndex]=!0,s.push(e))}}return t}(h),e)}function $(e,t){const n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function G(e,t){const n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}function H(e,n,r,i){return t._(this,void 0,void 0,function*(){let a=e;if(e.url?a=(yield t.j(n.transformRequest(e.url,"Source"),r)).data:yield o.frameAsync(r,i),!a)return null;const s=t.U(t.e(a,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(s.vectorLayerIds=a.vector_layers.map(e=>e.id)),s})}class Z{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.V?new t.V(e.lng,e.lat):t.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.V?new t.V(e.lng,e.lat):t.V.convert(e),this}extend(e){const n=this._sw,r=this._ne;let i,a;if(e instanceof t.V)i=e,a=e;else{if(!(e instanceof Z))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Z.convert(e)):this.extend(t.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.V.convert(e)):this;if(i=e._sw,a=e._ne,!i||!a)return this}return n||r?(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),r.lng=Math.max(a.lng,r.lng),r.lat=Math.max(a.lat,r.lat)):(this._sw=new t.V(i.lng,i.lat),this._ne=new t.V(a.lng,a.lat)),this}getCenter(){return new t.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.V(this.getWest(),this.getNorth())}getSouthEast(){return new t.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:r}=t.V.convert(e);let i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}intersects(e){if(!((e=Z.convert(e)).getNorth()>=this.getSouth()&&e.getSouth()<=this.getNorth()))return!1;const n=Math.abs(this.getEast()-this.getWest()),r=Math.abs(e.getEast()-e.getWest());if(n>=360||r>=360)return!0;const i=t.W(this.getWest(),-180,180),a=t.W(this.getEast(),-180,180),s=t.W(e.getWest(),-180,180),o=t.W(e.getEast(),-180,180),l=i>=a,c=s>=o;return!(!l||!c)||(l?o>=i||s<=a:c?a>=s||i<=o:s<=a&&o>=i)}static convert(e){return e instanceof Z?e:e?new Z(e):e}static fromLngLat(e,n=0){const r=360*n/40075017,i=r/Math.cos(Math.PI/180*e.lat);return new Z(new t.V(e.lng-i,e.lat-r),new t.V(e.lng+i,e.lat+r))}adjustAntiMeridian(){const e=new t.V(this._sw.lng,this._sw.lat),n=new t.V(this._ne.lng,this._ne.lat);return new Z(e,e.lng>n.lng?new t.V(n.lng+360,n.lat):n)}}class W{constructor(e,t,n){this.bounds=Z.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),r=Math.floor(t.Y(this.bounds.getWest())*n),i=Math.floor(t.X(this.bounds.getNorth())*n),a=Math.ceil(t.Y(this.bounds.getEast())*n),s=Math.ceil(t.X(this.bounds.getSouth())*n);return e.x>=r&&e.x<a&&e.y>=i&&e.y<s}}class X extends t.E{constructor(e,n,r,i){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=t.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i)}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield H(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new W(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(de){this._tileJSONRequest=null,this._loaded=!0,t.Z(de)||this.fire(new t.k(de))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};n.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise((t,n)=>{e.reloadPromise={resolve:t,reject:n}})}else e.actor=this.dispatcher.getActor(),r="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:r,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(i){if(delete e.abortController,e.aborted)return;if(i&&404!==i.status)throw i;this._afterTileLoadWorkerResponse(e,null)}})}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom)return;if(void 0===this.map._zoomLevelsToOverscale)return;const t=e.tileID.scaledTo(this.maxzoom).canonical,n=t.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:t,overzoomRequest:this.map._requestManager.transformRequest(n,"Tile")}}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Y extends t.E{constructor(e,n,r,i){super(),this.id=e,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},n),t.e(this,t.U(n,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield H(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,n&&(t.e(this,n),n.bounds&&(this.tileBounds=new W(n.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,t.Z(n)||this.fire(new t.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const r=yield y.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(r&&r.data){this.map._refreshExpiredTiles&&(r.cacheControl||r.expires)&&e.setExpiryData({cacheControl:r.cacheControl,expires:r.expires});const n=this.map.painter.context,i=n.gl,a=r.data;e.texture=this.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.T(n,a,i.RGBA,{useMipmap:!0}),e.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE,i.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(r){if(delete e.abortController,e.aborted)e.state="unloaded";else if(r)throw e.state="errored",r}})}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class K extends Y{constructor(e,n,r,i){super(e,n,r,i),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const n=yield y.getImage(r,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){const r=n.data;this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const i=t.b(r)&&t.$()?r:yield this.readImageNow(r),a={type:this.type,uid:e.uid,source:this.id,rawImageData:i,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:a});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(i){if(delete e.abortController,e.aborted)e.state="unloaded";else if(i)throw e.state="errored",i}})}readImageNow(e){return t._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&t.a0()){const r=e.width+2,i=e.height+2;try{return new t.R({width:r,height:i},yield t.a1(e,-1,-1,r,i))}catch(n){}}return o.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,a=0===n.x?e.wrap-1:e.wrap,s=(n.x+1+r)%r,o=n.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.a2(e.overscaledZ,a,n.z,i,n.y).key]={backfilled:!1},l[new t.a2(e.overscaledZ,o,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new t.a2(e.overscaledZ,a,n.z,i,n.y-1).key]={backfilled:!1},l[new t.a2(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.a2(e.overscaledZ,o,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<r&&(l[new t.a2(e.overscaledZ,a,n.z,i,n.y+1).key]={backfilled:!1},l[new t.a2(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.a2(e.overscaledZ,o,n.z,s,n.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}function Q(e){return"GeometryCollection"===e.type?e.geometries.map(e=>e.coordinates).flat(1/0):e.coordinates.flat(1/0)}function J(e){const t=new Z;let n;switch(e.type){case"FeatureCollection":n=e.features.map(e=>Q(e.geometry)).flat(1/0);break;case"Feature":n=Q(e.geometry);break;default:n=Q(e)}if(0==n.length)return t;for(let r=0;r<n.length-1;r+=2)t.extend([n[r],n[r+1]]);return t}class ee extends t.E{constructor(e,n,r,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=r.getActor(),this.setEventedParent(i),this._data="string"==typeof n.data?{url:n.data}:{geojson:n.data},this._options=t.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,void 0!==n.clusterMaxZoom&&this.maxzoom<=n.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==n.buffer?n.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==n.tolerance?n.tolerance:.375),extent:t.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return void 0!==this._pendingWorkerUpdate.data||void 0!==this._pendingWorkerUpdate.diff||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(t.a5/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||void 0===e||t.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${n}"`),n}load(){return t._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e,t){this._data="string"==typeof e?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const n=this._updateWorkerData();return t?n:this}updateData(e,n){this._pendingWorkerUpdate.diff=t.a6(this._pendingWorkerUpdate.diff,e);const r=this._updateWorkerData();return n?r:this}getData(){return t._(this,void 0,void 0,function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getBounds(){return t._(this,void 0,void 0,function*(){return J(yield this.getData())})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:n}})}_updateWorkerData(){return t._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void t.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:n}=this._pendingWorkerUpdate,r=this._getLoadGeoJSONParameters(e,n);void 0!==e?this._pendingWorkerUpdate.data=void 0:n&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(r)})}_getLoadGeoJSONParameters(e,n){const r=t.e({type:this.type},this.workerOptions);return"string"==typeof e?(r.request=this.map._requestManager.transformRequest(o.resolveURL(e),"Source"),r.request.collectResourceTiming=this._collectResourceTiming,r):void 0!==e?(r.data=e,r):n?(r.dataDiff=n,r):r}_dispatchWorkerUpdate(e){return t._(this,void 0,void 0,function*(){this._isUpdatingWorker=!0,this.fire(new t.l("dataloading",{dataType:"source"}));try{const n=yield this.actor.sendAsync({type:"LD",data:e});if(this._isUpdatingWorker=!1,this._removed||n.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));n.data&&(this._data={geojson:n.data});const r=this._applyDiffToSource(e.dataDiff),i=this._getShouldReloadTileOptions(r),a={dataType:"source"};this._applyResourceTiming(a,n),this.fire(new t.l("data",Object.assign(Object.assign({},a),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},a),{sourceDataType:"content",shouldReloadTileOptions:i})))}catch(n){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(n))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyResourceTiming(e,n){var r;if(!this._collectResourceTiming)return;const i=null===(r=n.resourceTiming)||void 0===r?void 0:r[this.id];if(!i)return;const a=i.slice(0);(null==a?void 0:a.length)&&t.e(e,{resourceTiming:a})}_applyDiffToSource(e){if(!e)return;const n="string"==typeof this.promoteId?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const e=t.a7(this._data.geojson,n);if(!e)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:e}}if(!this._data.updateable)return;const r=t.a8(this._data.updateable,e,n);return e.removeAll||this._options.cluster?void 0:r}_getShouldReloadTileOptions(e){if(e)return{affectedBounds:e.filter(Boolean).map(e=>J(e))}}shouldReloadTile(e,{affectedBounds:n}){if("loading"===e.state)return!0;if("unloaded"===e.state)return!1;const{buffer:r,extent:i}=this.workerOptions.geojsonVtOptions,a=function({x:e,y:n,z:r},i=0){const a=t.a3((e-i)/Math.pow(2,r)),s=t.a4((n+1+i)/Math.pow(2,r)),o=t.a3((e+1+i)/Math.pow(2,r)),l=t.a4((n-i)/Math.pow(2,r));return new Z([a,s],[o,l])}(e.tileID.canonical,r/i);for(const t of n)if(a.intersects(t))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return t._(this,void 0,void 0,function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const r=yield this.actor.sendAsync({type:t,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(r,this.map.painter,"RT"===t)})}abortTile(e){return t._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return t._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class te extends t.E{constructor(e,t,n,r){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(e){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield y.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,t.Z(n)||this.fire(new t.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(t.a9.fromLngLat);var r;return this.tileID=function(e){const n=t.aa.fromPoints(e),r=n.width(),i=n.height(),a=Math.max(r,i),s=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),o=Math.pow(2,s);return new t.ac(s,Math.floor((n.minX+n.maxX)/2*o),Math.floor((n.minY+n.maxY)/2*o))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(e=>this.tileID.getTilePoint(e)._round()),this.flippedWindingOrder=((r=this.tileCoords)[1].x-r[0].x)*(r[2].y-r[0].y)-(r[1].y-r[0].y)*(r[2].x-r[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new t.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:r,maxX:i,maxY:a}=t.aa.fromPoints(e),s={};for(let o=0;o<=t.ab;o++){const e=Math.pow(2,o),t=Math.floor(n*e),l=Math.floor(r*e),c=Math.floor(i*e),u=Math.floor(a*e),h=(t%e+e)%e,d=c%e,p=Math.floor(t/e),f=Math.floor(c/e);s[o]={minWrap:p,maxWrap:f,minTileXWrapped:h,maxTileXWrapped:d,minTileY:l,maxTileY:u}}return s}}class ne extends te{constructor(e,t,n,r){super(e,t,n,r),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.ad(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new t.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.k(new t.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class re extends te{constructor(e,n,r,i){super(e,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new t.k(new t.ae(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.ae(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.k(new t.ae(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.ae(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.ae(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return t._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,r=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new t.T(n,this.canvas,r.RGBA,{premultiply:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let i=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,i=!0)}i&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ie={},ae=e=>{switch(e){case"geojson":return ee;case"image":return te;case"raster":return Y;case"raster-dem":return K;case"vector":return X;case"video":return ne;case"canvas":return re}return ie[e]},se="RTLPluginLoaded";class oe extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=V()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(e=>{throw this.status="error",e})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,function*(e,t=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=o.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!t)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()})}_requestImport(){return t._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(se))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let le=null;function ce(){return le||(le=new oe),le}var ue,he,de;(de=ue||(ue={}))[de.Base=0]="Base",de[de.Parent=1]="Parent",function(e){e[e.Departing=0]="Departing",e[e.Incoming=1]="Incoming"}(he||(he={}));class pe{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=t.af(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:t,fadingParentID:n,fadeEndTime:r}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=t,this.fadingParentID=n,this.fadeEndTime=r}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=c(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const r of e){const e=r.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.id]=r}}return n}(e.buckets,null==n?void 0:n.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.ah){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.ah&&n.hasRTLText){this.hasRTLText=!0,ce().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new t.ag}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new t.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,r,i,a,s,o,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:a,tileSize:this.tileSize,pixelPosMatrix:c,transform:o,params:s,queryPadding:this.queryPadding*l,getElevation:u},e,t,n):{}}querySourceFeatures(e,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const i=r.loadVTLayers(),a=n&&n.sourceLayer?n.sourceLayer:"",s=i[t.ai]||i[a];if(!s)return;const o=t.aj(null==n?void 0:n.filter,null==n?void 0:n.globalState),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<s.length;d++){const n=s.feature(d);if(o.needGeometry){const e=t.ak(n,!0);if(!o.filter(new t.H(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new t.H(this.tileID.overscaledZ),n))continue;const i=r.getId(n,a),p=new t.al(n,l,c,u,i);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const n=t.am(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const r=this.expirationTime-n;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const r=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!n.style.hasLayer(i))continue;const a=this.buckets[i],s=a.layers[0].sourceLayer||t.ai,o=r[s],l=e[s];if(!o||!l||0===Object.keys(l).length)continue;a.update(l,o,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const c=n&&n.style&&n.style.getLayer(i);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}holdingForSymbolFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=c()+e}setDependencies(e,t){const n={};for(const r of t)n[r]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}}class fe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,r){const i=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},t.e(this.stateChanges[e][i],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])r[t]||(this.deletedStates[e][i][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][t]&&delete this.deletedStates[e][i][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,n){const r=String(n),i=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][n];if(null===t)return{};for(const e in t)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,n){const r={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const n in this.stateChanges[i])this.state[i][n]||(this.state[i][n]={}),t.e(this.state[i][n],this.stateChanges[i][n]),e[n]=this.state[i][n];r[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}r[i]=r[i]||{},t.e(r[i],e)}this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length&&e.setFeatureState(r,n)}}const me=89.25;function ge(e,n){const r=t.an(n.lat,-t.ao,t.ao);return new t.P(t.Y(n.lng)*e,t.X(r)*e)}function ye(e,n){return new t.a9(n.x/e,n.y/e).toLngLat()}function _e(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(t.ap(90-e.pitch)),Math.tan(t.ap(me-e.pitch)))}function ve(e,n){const r=e.canonical,i=n/t.aq(r.z),a=r.x+Math.pow(2,r.z)*e.wrap,s=t.ar(new Float64Array(16));return t.O(s,s,[a*i,r.y*i,0]),t.Q(s,s,[i/t.a5,i/t.a5,1]),s}function xe(e,n,r,i,a){const s=t.a9.fromLngLat(e,n),o=a*t.as(1,e.lat),{x:l,y:c,z:u}=be(r,i);return new t.a9(s.x+o*-l,s.y+o*-c,s.z+o*-u)}function be(e,n){const r=t.ap(e),i=t.ap(n),a=Math.cos(-r),s=Math.sin(r);return{x:s*Math.sin(i),y:-s*Math.cos(i),z:a}}function we(e,t,n){const r=t.intersectsFrustum(e);if(!n||0===r)return r;const i=t.intersectsPlane(n);return 0===i?0:2===r&&2===i?2:1}function Se(e,t,n){let r=0;const i=(n-t)/10;for(let a=0;a<10;a++)r+=i*Math.pow(Math.cos(t+(a+.5)/10*(n-t)),e);return r}function ke(e,n){return function(r,i,a,s,o){const l=2*((e-1)/t.at(Math.cos(t.ap(me-o))/Math.cos(t.ap(me)))-1),c=Math.acos(a/s),u=2*Se(l-1,0,t.ap(o/2)),h=Math.min(t.ap(me),c+t.ap(o/2)),d=Se(l-1,Math.min(h,c-t.ap(o/2)),h),p=Math.atan(i/a),f=Math.hypot(i,a);let m=r;return m+=t.at(s/f/Math.max(.5,Math.cos(t.ap(o/2)))),m+=l*t.at(Math.cos(p))/2,m-=t.at(Math.max(1,d/u/n))/2,m}}const Te=ke(9.314,3);function Ce(e,n){const r=(n.roundZoom?Math.round:Math.floor)(e.zoom+t.at(e.tileSize/n.tileSize));return Math.max(0,r)}function Ee(e,n){const r=e.getCameraFrustum(),i=e.getClippingPlane(),a=e.screenPointToMercatorCoordinate(e.getCameraPoint()),s=t.a9.fromLngLat(e.center,e.elevation);a.z=s.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const o=e.getCoveringTilesDetailsProvider(),l=o.allowVariableZoom(e,n),c=Ce(e,n),u=n.minzoom||0,h=void 0!==n.maxzoom?n.maxzoom:e.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*a.x,p*a.y,0],m=[p*s.x,p*s.y,0],g=Math.hypot(s.x-a.x,s.y-a.y),y=Math.abs(s.z-a.z),_=Math.hypot(g,y),v=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),x=[],b=[];if(e.renderWorldCopies&&o.allowWorldCopies())for(let t=1;t<=3;t++)x.push(v(-t)),x.push(v(t));for(x.push(v(0));x.length>0;){const p=x.pop(),g=p.x,v=p.y;let w=p.fullyVisible;const S={x:g,y:v,z:p.zoom},k=o.getTileBoundingVolume(S,p.wrap,e.elevation,n);if(!w){const e=we(r,k,i);if(0===e)continue;w=2===e}const T=o.distanceToTile2d(a.x,a.y,S,k);let C=c;l&&(C=(n.calculateTileZoom||Te)(e.zoom+t.at(e.tileSize/n.tileSize),T,y,_,e.fov)),C=(n.roundZoom?Math.round:Math.floor)(C),C=Math.max(0,C);const E=Math.min(C,h);if(p.wrap=o.getWrap(s,S,p.wrap),p.zoom>=E){if(p.zoom<u)continue;const e=d-p.zoom,r=f[0]-.5-(g<<e),i=f[1]-.5-(v<<e),a=n.reparseOverscaled?Math.max(p.zoom,C):p.zoom;b.push({tileID:new t.a2(p.zoom===h?a:p.zoom,p.wrap,p.zoom,g,v),distanceSq:t.au([m[0]-.5-g,m[1]-.5-v]),tileDistanceToCamera:Math.sqrt(r*r+i*i)})}else for(let e=0;e<4;e++)x.push({zoom:p.zoom+1,x:(g<<1)+e%2,y:(v<<1)+(e>>1),wrap:p.wrap,fullyVisible:w})}return b.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}const Ie=t.aa.fromPoints([new t.P(0,0),new t.P(t.a5,t.a5)]);function Pe(e){return"raster"===e||"image"===e||"video"===e}function Me(e,t,n,r,i,a,s){if(!t.hasData())return!1;const{tileID:o,fadingRole:l,fadingDirection:c,fadingParentID:u}=t;if(l===ue.Base&&c===he.Incoming&&u)return n[u.key]=u,!0;const h=Math.max(o.overscaledZ-i,a);for(let d=o.overscaledZ-1;d>=h;d--){const i=o.scaledTo(d),a=e.getLoadedTile(i);if(a)return t.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:he.Incoming,fadingParentID:a.tileID,fadeEndTime:r+s}),a.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:he.Departing,fadeEndTime:r+s}),n[i.key]=i,!0}return!1}function Ae(e,t,n,r,i,a){if(!t.hasData())return!1;const s=t.tileID.children(i);let o=ze(e,t,s,n,r,i,a);if(o)return!0;for(const l of s)ze(e,t,l.children(i),n,r,i,a)&&(o=!0);return o}function ze(e,t,n,r,i,a,s){if(n[0].overscaledZ>=a)return!1;let o=!1;for(const l of n){const n=e.getLoadedTile(l);if(!n)continue;const{fadingRole:a,fadingDirection:c,fadingParentID:u}=n;a===ue.Base&&c===he.Departing&&u||(n.setCrossFadeLogic({fadingRole:ue.Base,fadingDirection:he.Departing,fadingParentID:t.tileID,fadeEndTime:i+s}),t.setCrossFadeLogic({fadingRole:ue.Parent,fadingDirection:he.Incoming,fadeEndTime:i+s})),r[l.key]=l,o=!0}return o}function De(e,t,n,r){const i=e.tileID;return!!e.selfFading||!e.hasData()&&!!t.has(i)&&(e.setSelfFadeLogic(n+r),!0)}function Re(e,t){var n;e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,a=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+a)?r+=a:1===Math.abs(r-a)&&(r-=a)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,i),(null===(n=e.neighboringTiles)||void 0===n?void 0:n[s])&&(e.neighboringTiles[s].backfilled=!0)))}class Le{constructor(){this._tiles={}}handleWrapJump(e){const t={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t}setFeatureState(e,t){for(const n in this._tiles)this._tiles[n].setFeatureState(e,t)}getAllTiles(){return Object.values(this._tiles)}getAllIds(e=!1){return e?Object.values(this._tiles).map(e=>e.tileID).sort(t.aw).map(e=>e.key):Object.keys(this._tiles)}getTileById(e){return this._tiles[e]}setTile(e,t){this._tiles[e]=t}deleteTileById(e){delete this._tiles[e]}getLoadedTile(e){const t=this.getTileById(e.key);return(null==t?void 0:t.hasData())?t:null}isIdRenderable(e,t=!1){var n;return null===(n=this.getTileById(e))||void 0===n?void 0:n.isRenderable(t)}getRenderableIds(e=0,n){const r=[];for(const t of this.getAllIds())this.isIdRenderable(t,n)&&r.push(this.getTileById(t));return n?r.sort((n,r)=>{const i=n.tileID,a=r.tileID,s=new t.P(i.canonical.x,i.canonical.y)._rotate(-e),o=new t.P(a.canonical.x,a.canonical.y)._rotate(-e);return i.overscaledZ-a.overscaledZ||o.y-s.y||o.x-s.x}).map(e=>e.tileID.key):r.map(e=>e.tileID).sort(t.aw).map(e=>e.key)}}class Ne extends t.E{constructor(e,n,r){super(),this.id=e,this.dispatcher=r,this.on("data",e=>this._dataHandler(e)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((e,t,n,r)=>{const i=new(ae(t.type))(e,t,n,r);if(i.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${i.id}`);return i})(e,n,r,this),this._inViewTiles=new Le,this._outOfViewCache=new t.ax(0,e=>this._unloadTile(e)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new fe,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){for(const t of this._inViewTiles.getAllTiles())t.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e),this._inViewTiles=new Le}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e of this._inViewTiles.getAllTiles())if("loaded"!==e.state&&"errored"!==e.state)return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,r){return t._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,r)}catch(i){e.state="errored",404!==i.status?this._source.fire(new t.k(i,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const t of this._inViewTiles.getAllTiles())t.upload(e),t.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(e){var t;return this._inViewTiles.getRenderableIds(null===(t=this.transform)||void 0===t?void 0:t.bearingInRadians,e)}hasRenderableParent(e){const t=e.overscaledZ-1;if(t>=this._source.minzoom){const n=this.getLoadedTile(e.scaledTo(t));if(n)return this._inViewTiles.isIdRenderable(n.tileID.key)}return!1}reload(e,t=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const n of this._inViewTiles.getAllIds()){const r=this._inViewTiles.getTileById(n);t&&!this._source.shouldReloadTile(r,t)||(e?this._reloadTile(n,"expired"):"errored"!==r.state&&this._reloadTile(n,"reloading"))}}}_reloadTile(e,n){return t._(this,void 0,void 0,function*(){const t=this._inViewTiles.getTileById(e);t&&("loading"!==t.state&&(t.state=n),yield this._loadTile(t,e,n))})}_tileLoaded(e,n,r){e.timeAdded=c(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&function(e,t){var n,r;const i=t.getRenderableIds();for(const a of i){if(!e.neighboringTiles||!e.neighboringTiles[a])continue;const i=t.getTileById(a);e.neighboringTiles[a].backfilled||Re(e,i),(null===(r=null===(n=i.neighboringTiles)||void 0===n?void 0:n[e.tileID.key])||void 0===r?void 0:r.backfilled)||Re(i,e)}}(e,this._inViewTiles),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:e,coord:e.tileID}))}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._inViewTiles.getTileById(e)}_retainLoadedChildren(e,t){const n=this._getLoadedDescendents(t),r=new Set;for(const i of t){const t=n[i.key];if(!(null==t?void 0:t.length)){r.add(i);continue}const a=i.overscaledZ+Ne.maxOverzooming,s=t.filter(e=>e.tileID.overscaledZ<=a);if(!s.length){r.add(i);continue}const o=Math.min(...s.map(e=>e.tileID.overscaledZ)),l=s.filter(e=>e.tileID.overscaledZ===o).map(e=>e.tileID);for(const n of l)e[n.key]=n;this._areDescendentsComplete(l,o,i.overscaledZ)||r.add(i)}return r}_getLoadedDescendents(e){var t;const n={};for(const r of this._inViewTiles.getAllTiles().filter(e=>e.hasData()))for(const i of e)r.tileID.isChildOf(i)&&(n[t=i.key]||(n[t]=[])).push(r);return n}_areDescendentsComplete(e,t,n){return 1===e.length&&e[0].isOverscaled()?e[0].overscaledZ===t:Math.pow(4,t-n)===e.length}getLoadedTile(e){return this._inViewTiles.getLoadedTile(e)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,i=Math.floor(n*r*(null===this._maxTileCacheZoomLevels?t.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._outOfViewCache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);this._prevLng=e,t&&(this._inViewTiles.handleWrapJump(t),this._resetTileReloadTimers())}update(e,n){if(!this._sourceLoaded||this._paused)return;let r;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new t.a2(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)):(r=Ee(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:"vector"===this._source.type&&void 0!==this.map._zoomLevelsToOverscale?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(r=r.filter(e=>this._source.hasTile(e)))):r=[],this.usedForTerrain&&(r=this._addTerrainIdealTiles(r));const i=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,i&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const a=Ce(e,this._source),s=this._updateRetainedTiles(r,a),o=Pe(this._source.type);o&&this._rasterFadeDuration>0&&!n&&function(e,n,r,i,a,s,o){const l=c(),u=t.av(n);for(const t of n){const n=e.getTileById(t.key);n.fadingDirection!==he.Departing&&0!==n.fadeOpacity||n.resetFadeLogic(),Me(e,n,r,l,i,a,o)||Ae(e,n,r,l,s,o)||De(n,u,l,o)||n.resetFadeLogic()}}(this._inViewTiles,r,s,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),o?this._cleanUpRasterTiles(s):this._cleanUpVectorTiles(s)}_cleanUpRasterTiles(e){for(const t of this._inViewTiles.getAllIds())e[t]||this._removeTile(t)}_cleanUpVectorTiles(e){for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);e[t]?n.clearSymbolFadeHold():n.hasSymbolBuckets?n.holdingForSymbolFade()?n.symbolFadeFinished()&&this._removeTile(t):n.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(t)}}_addTerrainIdealTiles(e){const t=[];for(const n of e)if(n.canonical.z>this._source.minzoom){const e=n.scaledTo(n.canonical.z-1);t.push(e);const r=n.scaledTo(Math.max(this._source.minzoom,Math.min(n.canonical.z,5)));t.push(r)}return e.concat(t)}releaseSymbolFadeTiles(){for(const e of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(e).holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var n;const r=new Set;for(const l of e)this._addTile(l).hasData()||r.add(l);const i=e.reduce((e,t)=>(e[t.key]=t,e),{}),a=this._retainLoadedChildren(i,r),s={},o=Math.max(t-Ne.maxUnderzooming,this._source.minzoom);for(const l of a){let e=this._inViewTiles.getTileById(l.key),t=null==e?void 0:e.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const a=l.scaledTo(r);if(s[a.key])break;if(s[a.key]=!0,e=this.getTile(a),!e&&t&&(e=this._addTile(a)),e){const r=e.hasData();if((r||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||t)&&(i[a.key]=a),t=e.wasRequested(),r)break}}}return i}_addTile(e){let n=this._inViewTiles.getTileById(e.key);if(n)return n;n=this._outOfViewCache.getAndRemove(e),n&&(n.resetFadeLogic(),this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null));const r=n;return n||(n=new pe(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._inViewTiles.setTile(e.key,n),r||this._source.fire(new t.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){this._clearTileReloadTimer(e);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_clearTileReloadTimer(e){const t=this._timers[e];t&&(clearTimeout(t),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e of this._inViewTiles.getAllIds()){const t=this._inViewTiles.getTileById(e);this._setTileReloadTimer(e,t)}}refreshTiles(e){for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);(this._inViewTiles.isIdRenderable(t)||"errored"==n.state)&&e.some(e=>e.equals(n.tileID.canonical))&&this._reloadTile(t,"expired")}}_removeTile(e){const t=this._inViewTiles.getTileById(e);t&&(t.uses--,this._inViewTiles.deleteTileById(e),this._clearTileReloadTimer(e),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._outOfViewCache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){"source"===e.dataType&&("metadata"!==e.sourceDataType?"content"===e.sourceDataType&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e of this._inViewTiles.getAllIds())this._removeTile(e);this._outOfViewCache.reset()}tilesIn(e,n,r){const i=[],a=this.transform;if(!a)return i;const s=a.getCoveringTilesDetailsProvider().allowWorldCopies(),o=r?a.getCameraQueryGeometry(e):e,l=e=>a.screenPointToMercatorCoordinate(e,this.terrain),c=this.transformBbox(e,l,!s),u=this.transformBbox(o,l,!s),h=this.getIds(),d=t.aa.fromPoints(u);for(let p=0;p<h.length;p++){const e=this._inViewTiles.getTileById(h[p]);if(e.holdingForSymbolFade())continue;const r=s?[e.tileID]:[e.tileID.unwrapTo(-1),e.tileID.unwrapTo(0)],o=Math.pow(2,a.zoom-e.tileID.overscaledZ),l=n*e.queryPadding*t.a5/e.tileSize/o;for(const n of r){const r=d.map(e=>n.getTilePoint(new t.a9(e.x,e.y)));if(r.expandBy(l),r.intersects(Ie)){const t=c.map(e=>n.getTilePoint(e)),r=u.map(e=>n.getTilePoint(e));i.push({tile:e,tileID:s?n:n.unwrapTo(0),queryGeometry:t,cameraQueryGeometry:r,scale:o})}}}return i}transformBbox(e,n,r){let i=e.map(n);if(r){const r=t.aa.fromPoints(e);r.shrinkBy(.001*Math.min(r.width(),r.height()));const a=r.map(n);t.aa.fromPoints(i).covers(a)||(i=i.map(e=>e.x>.5?new t.a9(e.x-1,e.y,e.z):e))}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(e=>this._inViewTiles.getTileById(e).tileID);return this.transform&&this.transform.populateCache(t),t}hasTransition(){return!!this._source.hasTransition()||!(!Pe(this._source.type)||!function(e,t){if(t<=0)return!1;const n=c();for(const r of e.getAllTiles())if(r.fadeEndTime>=n)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,n,r){this._state.updateState(e=e||t.ai,n,r)}removeFeatureState(e,n,r){this._state.removeFeatureState(e=e||t.ai,n,r)}getFeatureState(e,n){return this._state.getState(e=e||t.ai,n)}setDependencies(e,t,n){const r=this._inViewTiles.getTileById(e);r&&r.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(n).hasDependency(e,t)&&this._reloadTile(n,"reloading");this._outOfViewCache.filter(n=>!n.hasDependency(e,t))}areTilesLoaded(){for(const e of this._inViewTiles.getAllTiles())if("loaded"!==e.state&&"errored"!==e.state)return!1;return!0}}Ne.maxUnderzooming=10,Ne.maxOverzooming=3;class je{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.an(e,0,1);let n=1,r=this._distances[n];const i=e*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const a=n-1,s=this._distances[a],o=r-s,l=o>0?(i-s)/o:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}function Fe(e,t){let n=!0;return"always"===e||"never"!==e&&"never"!==t||(n=!1),n}class Oe{constructor(e,t,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let a=0;a<this.xCellCount*this.yCellCount;a++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}_insertBoxCell(e,t,n,r,i,a){this.boxCells[i].push(a)}_insertCircleCell(e,t,n,r,i,a){this.circleCells[i].push(a)}_query(e,t,n,r,i,a,s){if(n<0||e>this.width||r<0||t>this.height)return[];const o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return[{key:null,x1:e,y1:t,x2:n,y2:r}];for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],r=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-r,y1:n-r,x2:t+r,y2:n+r})}}else this._forEachCell(e,t,n,r,this._queryCell,o,{hitTest:i,overlapMode:a,seenUids:{box:{},circle:{}}},s);return o}query(e,t,n,r){return this._query(e,t,n,r,!1,null)}hitTest(e,t,n,r,i,a){return this._query(e,t,n,r,!0,i,a).length>0}hitTestCircle(e,t,n,r,i){const a=e-n,s=e+n,o=t-n,l=t+n;if(s<0||a>this.width||l<0||o>this.height)return!1;const c=[];return this._forEachCell(a,o,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),c.length>0}_queryCell(e,t,n,r,i,a,s,o){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[i];if(null!==h){const i=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(e<=i[h+2]&&t<=i[h+3]&&n>=i[h+0]&&r>=i[h+1]&&(!o||o(d))&&(!c||!Fe(u,d.overlapMode))&&(a.push({key:d,x1:i[h],y1:i[h+1],x2:i[h+2],y2:i[h+3]}),c))return!0}}const d=this.circleCells[i];if(null!==d){const i=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(i[h],i[h+1],i[h+2],e,t,n,r)&&(!o||o(d))&&(!c||!Fe(u,d.overlapMode))){const e=i[h],t=i[h+1],n=i[h+2];if(a.push({key:d,x1:e-n,y1:t-n,x2:e+n,y2:t+n}),c)return!0}}}return!1}_queryCellCircle(e,t,n,r,i,a,s,o){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[i];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const n=4*t,r=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!o||o(r))&&!Fe(u,r.overlapMode))return a.push(!0),!0}}const d=this.circleCells[i];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const n=3*t,r=this.circleKeys[t];if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!o||o(r))&&!Fe(u,r.overlapMode))return a.push(!0),!0}}}_forEachCell(e,t,n,r,i,a,s,o){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(i.call(this,e,t,n,r,this.xCellCount*l+d,a,s,o))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,r,i,a){const s=r-e,o=i-t,l=n+a;return l*l>s*s+o*o}_circleAndRectCollide(e,t,n,r,i,a,s){const o=(a-r)/2,l=Math.abs(e-(r+o));if(l>o+n)return!1;const c=(s-i)/2,u=Math.abs(t-(i+c));if(u>c+n)return!1;if(l<=o||u<=c)return!0;const h=l-o,d=u-c;return h*h+d*d<=n*n}}function Be(e,n,i){const a=t.N();if(!e){const{vecSouth:e,vecEast:t}=Ue(n),i=r();i[0]=t[0],i[1]=t[1],i[2]=e[0],i[3]=e[1],s=i,(d=(l=(o=i)[0])*(h=o[3])-(u=o[2])*(c=o[1]))&&(s[0]=h*(d=1/d),s[1]=-c*d,s[2]=-u*d,s[3]=l*d),a[0]=i[0],a[1]=i[1],a[4]=i[2],a[5]=i[3]}var s,o,l,c,u,h,d;return t.Q(a,a,[1/i,1/i,1]),a}function Ve(e,n,r,i){if(e){const e=t.N();if(!n){const{vecSouth:t,vecEast:n}=Ue(r);e[0]=n[0],e[1]=n[1],e[4]=t[0],e[5]=t[1]}return t.Q(e,e,[i,i,1]),e}return r.pixelsToClipSpaceMatrix}function Ue(e){const n=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),i=Math.cos(e.pitchInRadians),a=Math.cos(e.bearingInRadians),s=Math.sin(e.bearingInRadians),o=t.aC();o[0]=-a*i*r-s*n,o[1]=-s*i*r+a*n;const l=t.aD(o);l<1e-9?t.aE(o):t.aF(o,o,1/l);const c=t.aC();c[0]=a*i*n-s*r,c[1]=s*i*n+a*r;const u=t.aD(c);return u<1e-9?t.aE(c):t.aF(c,c,1/u),{vecEast:c,vecSouth:o}}function qe(e,n,r,i){let a;i?(a=[e,n,i(e,n),1],t.aH(a,a,r)):(a=[e,n,0,1],st(a,a,r));const s=a[3];return{point:new t.P(a[0]/s,a[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function $e(e,t){return.5+e/t*.5}function Ge(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function He(e,n,r,i,a,s,o,l,c,u,h,d,p){const f=r?e.textSizeData:e.iconSizeData,m=t.ay(f,n.transform.zoom),g=[256/n.width*2+1,256/n.height*2+1],y=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;y.clear();const _=e.lineVertexArray,v=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b=!1;for(let w=0;w<v.length;w++){const r=v.get(w);if(r.hidden||r.writingMode===t.az.vertical&&!b){at(r.numGlyphs,y);continue}b=!1;const S=new t.P(r.anchorX,r.anchorY),k={getElevation:p,pitchedLabelPlaneMatrix:i,lineVertexArray:_,pitchWithMap:s,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:S,unwrappedTileID:c,width:u,height:h,translation:d},T=et(r.anchorX,r.anchorY,k);if(!Ge(T.point,g)){at(r.numGlyphs,y);continue}const C=$e(n.transform.cameraToCenterDistance,T.signedDistanceFromCamera),E=t.aA(f,m,r),I=s?E*n.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,c)/C:E*C,P=Xe({projectionContext:k,pitchedLabelPlaneMatrixInverse:a,symbol:r,fontSize:I,flip:!1,keepUpright:o,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l});b=P.useVertical,(P.notEnoughRoom||b||P.needsFlipping&&Xe({projectionContext:k,pitchedLabelPlaneMatrixInverse:a,symbol:r,fontSize:I,flip:!0,keepUpright:o,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l}).notEnoughRoom)&&at(r.numGlyphs,y)}r?e.text.dynamicLayoutVertexBuffer.updateData(y):e.icon.dynamicLayoutVertexBuffer.updateData(y)}function Ze(e,t,n,r,i,a,s,o){const l=a.glyphStartIndex+a.numGlyphs,c=a.lineStartIndex,u=a.lineStartIndex+a.lineLength,h=t.getoffsetX(a.glyphStartIndex),d=t.getoffsetX(l-1),p=rt(e*h,n,r,i,a.segment,c,u,o,s);if(!p)return null;const f=rt(e*d,n,r,i,a.segment,c,u,o,s);return f?o.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function We(e,n,r,i){return e===t.az.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.az.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function Xe(e){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:r,symbol:i,fontSize:a,flip:s,keepUpright:o,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=e,d=a/24,p=i.lineOffsetX*d,f=i.lineOffsetY*d;let m;if(i.numGlyphs>1){const e=i.glyphStartIndex+i.numGlyphs,t=i.lineStartIndex,a=i.lineStartIndex+i.lineLength,c=Ze(d,l,p,f,s,i,h,n);if(!c)return{notEnoughRoom:!0};const g=Je(c.first.point.x,c.first.point.y,n,r),y=Je(c.last.point.x,c.last.point.y,n,r);if(o&&!s){const e=We(i.writingMode,g,y,u);if(e)return e}m=[c.first];for(let r=i.glyphStartIndex+1;r<e-1;r++){const e=rt(d*l.getoffsetX(r),p,f,s,i.segment,t,a,n,h);if(!e)return{notEnoughRoom:!0};m.push(e)}m.push(c.last)}else{if(o&&!s){const e=Qe(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,a=i.lineStartIndex+i.segment+1,s=new t.P(n.lineVertexArray.getx(a),n.lineVertexArray.gety(a)),o=Qe(s.x,s.y,n),l=o.signedDistanceFromCamera>0?o.point:Ye(n.tileAnchorPoint,s,e,1,n),c=Je(e.x,e.y,n,r),h=Je(l.x,l.y,n,r),d=We(i.writingMode,c,h,u);if(d)return d}const e=rt(d*l.getoffsetX(i.glyphStartIndex),p,f,s,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,n,h);if(!e||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[e]}for(const g of m)t.aG(c,g.point,g.angle);return{}}function Ye(e,t,n,r,i){const a=e.add(e.sub(t)._unit()),s=Qe(a.x,a.y,i).point,o=n.sub(s);return n.add(o._mult(r/o.mag()))}function Ke(e,n,r){const i=n.projectionCache;if(i.projections[e])return i.projections[e];const a=new t.P(n.lineVertexArray.getx(e),n.lineVertexArray.gety(e)),s=Qe(a.x,a.y,n);if(s.signedDistanceFromCamera>0)return i.projections[e]=s.point,i.anyProjectionOccluded=i.anyProjectionOccluded||s.isOccluded,s.point;const o=e-r.direction;return Ye(0===r.distanceFromAnchor?n.tileAnchorPoint:new t.P(n.lineVertexArray.getx(o),n.lineVertexArray.gety(o)),a,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,n)}function Qe(e,t,n){const r=e+n.translation[0],i=t+n.translation[1];let a;return n.pitchWithMap?(a=qe(r,i,n.pitchedLabelPlaneMatrix,n.getElevation),a.isOccluded=!1):(a=n.transform.projectTileCoordinates(r,i,n.unwrappedTileID,n.getElevation),a.point.x=(.5*a.point.x+.5)*n.width,a.point.y=(.5*-a.point.y+.5)*n.height),a}function Je(e,n,r,i){if(r.pitchWithMap){const a=[e,n,0,1];return t.aH(a,a,i),r.transform.projectTileCoordinates(a[0]/a[3],a[1]/a[3],r.unwrappedTileID,r.getElevation).point}return{x:e/r.width*2-1,y:1-n/r.height*2}}function et(e,t,n){return n.transform.projectTileCoordinates(e,t,n.unwrappedTileID,n.getElevation)}function tt(e,t,n){return e._unit()._perp()._mult(t*n)}function nt(e,n,r,i,a,s,o,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=r.add(n);if(e+c.direction<i||e+c.direction>=a)return l.projectionCache.offsets[e]=u,u;const h=Ke(e+c.direction,l,c),d=tt(h.sub(r),o,c.direction),p=r.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.aI(s,u,p,f)||u,l.projectionCache.offsets[e]}function rt(e,t,n,r,i,a,s,o,l){const c=r?e-t:e+t;let u=c>0?1:-1,h=0;r&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?a+i:a+i+1;o.projectionCache.cachedAnchorPoint?d=o.projectionCache.cachedAnchorPoint:(d=Qe(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,o.projectionCache.cachedAnchorPoint=d);let f,m,g=d,y=d,_=0,v=0;const x=Math.abs(c),b=[];let w;for(;_+v<=x;){if(p+=u,p<a||p>=s)return null;_+=v,y=g,m=f;const e={absOffsetX:x,direction:u,distanceFromAnchor:_,previousVertex:y};if(g=Ke(p,o,e),0===n)b.push(y),w=g.sub(y);else{let t;const r=g.sub(y);t=0===r.mag()?tt(Ke(p+u,o,e).sub(g),n,u):tt(r,n,u),m||(m=y.add(t)),f=nt(p,t,g,a,s,m,n,o,e),b.push(m),w=f.sub(m)}v=w.mag()}const S=w._mult((x-_)/v)._add(m||y),k=h+Math.atan2(g.y-y.y,g.x-y.x);return b.push(S),{point:S,angle:l?k:0,path:b}}const it=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function at(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(it,3*e)}}function st(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}const ot=100;class lt{constructor(e,t=new Oe(e.width+200,e.height+200,25),n=new Oe(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ot,this.screenBottomBoundary=e.height+ot,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,n,r,i,a,s,o,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(e.anchorPointX+o[0],e.anchorPointY+o[1],i,c,h),p=n*d.perspectiveRatio;let f;if(a||s)f=this._projectCollisionBox(e,p,r,i,a,s,o,d,c,u,h);else{const t=d.x+(u?u.x*p:0),n=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[t+e.x1*p,n+e.y1*p,t+e.x2*p,n+e.y2*p]}}const[m,g,y,_]=f.box,v=a?f.allPointsOccluded:d.isOccluded;let x=v;return x||(x=d.perspectiveRatio<this.perspectiveRatioCutoff),x||(x=!this.isInsideGrid(m,g,y,_)),x||"always"!==t&&this.grid.hitTest(m,g,y,_,t,l)?{box:[m,g,y,_],placeable:!1,offscreen:!1,occluded:v}:{box:[m,g,y,_],placeable:!0,offscreen:this.isOffscreen(m,g,y,_),occluded:v}}placeCollisionCircles(e,n,r,i,a,s,o,l,c,u,h,d,p,f){const m=[],g=new t.P(n.anchorX,n.anchorY),y=this.getPerspectiveRatio(g.x,g.y,s,f),_=(c?a*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,s)/y:a*y)/t.aM,v={getElevation:f,pitchedLabelPlaneMatrix:o,lineVertexArray:r,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:s,width:this.transform.width,height:this.transform.height,translation:p},x=Ze(_,i,n.lineOffsetX*_,n.lineOffsetY*_,!1,n,!1,v);let b=!1,w=!1,S=!0;if(x){const n=.5*h*y+d,r=new t.P(-100,-100),i=new t.P(this.screenRightBoundary,this.screenBottomBoundary),a=new je,s=x.first,o=x.last;let p=[];for(let e=s.path.length-1;e>=1;e--)p.push(s.path[e]);for(let e=1;e<o.path.length;e++)p.push(o.path[e]);const f=2.5*n;if(c){const e=this.projectPathToScreenSpace(p,v);p=e.some(e=>e.signedDistanceFromCamera<=0)?[]:e.map(e=>e.point)}let g=[];if(p.length>0){const e=p[0].clone(),n=p[0].clone();for(let t=1;t<p.length;t++)e.x=Math.min(e.x,p[t].x),e.y=Math.min(e.y,p[t].y),n.x=Math.max(n.x,p[t].x),n.y=Math.max(n.y,p[t].y);g=e.x>=r.x&&n.x<=i.x&&e.y>=r.y&&n.y<=i.y?[p]:n.x<r.x||e.x>i.x||n.y<r.y||e.y>i.y?[]:t.aJ([p],r.x,r.y,i.x,i.y)}for(const t of g){a.reset(t,.25*n);let r=0;r=a.length<=.5*n?1:Math.ceil(a.paddedLength/f)+1;for(let t=0;t<r;t++){const i=t/Math.max(r-1,1),s=a.lerp(i),o=s.x+ot,c=s.y+ot;m.push(o,c,n,0);const h=o-n,d=c-n,p=o+n,f=c+n;if(S=S&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==e&&this.grid.hitTestCircle(o,c,n,e,u)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:S,collisionDetected:b}}projectPathToScreenSpace(e,n){return function(e){let t=0,n=0,r=0,i=0;for(let a=0;a<e.length;a++)e[a].isOccluded?(r=a+1,i=0):(i++,i>n&&(n=i,t=r));return e.slice(t,t+n)}(function(e,n){const r=t.N();return t.aB(r,n.pitchedLabelPlaneMatrix),e.map(e=>{const t=qe(e.x,e.y,r,n.getElevation),i=n.transform.projectTileCoordinates(t.point.x,t.point.y,n.unwrappedTileID,n.getElevation);return i.point.x=(.5*i.point.x+.5)*n.width,i.point.y=(.5*-i.point.y+.5)*n.height,i})}(e,n))}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[],r=new t.aa;for(const h of e){const e=new t.P(h.x+ot,h.y+ot);r.extend(e),n.push(e)}const{minX:i,minY:a,maxX:s,maxY:o}=r,l=this.grid.query(i,a,s,o).concat(this.ignoredGrid.query(i,a,s,o)),c={},u={};for(const h of l){const e=h.key;if(void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]={}),c[e.bucketInstanceId][e.featureIndex])continue;const r=[new t.P(h.x1,h.y1),new t.P(h.x2,h.y1),new t.P(h.x2,h.y2),new t.P(h.x1,h.y2)];t.aK(n,r)&&(c[e.bucketInstanceId][e.featureIndex]=!0,void 0===u[e.bucketInstanceId]&&(u[e.bucketInstanceId]=[]),u[e.bucketInstanceId].push(e.featureIndex))}return u}insertCollisionBox(e,t,n,r,i,a){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:a,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,r,i,a){const s=n?this.ignoredGrid:this.grid,o={bucketInstanceId:r,featureIndex:i,collisionGroupID:a,overlapMode:t};for(let l=0;l<e.length;l+=4)s.insertCircle(o,e[l],e[l+1],e[l+2])}projectAndGetPerspectiveRatio(e,n,r,i,a){if(a){let r;i?(r=[e,n,i(e,n),1],t.aH(r,r,a)):(r=[e,n,0,1],st(r,r,a));const s=r[3];return{x:(r[0]/s+1)/2*this.transform.width+ot,y:(-r[1]/s+1)/2*this.transform.height+ot,perspectiveRatio:.5+this.transform.cameraToCenterDistance/s*.5,isOccluded:!1,signedDistanceFromCamera:s}}{const t=this.transform.projectTileCoordinates(e,n,r,i);return{x:(t.point.x+1)/2*this.transform.width+ot,y:(1-t.point.y)/2*this.transform.height+ot,perspectiveRatio:.5+this.transform.cameraToCenterDistance/t.signedDistanceFromCamera*.5,isOccluded:t.isOccluded,signedDistanceFromCamera:t.signedDistanceFromCamera}}}getPerspectiveRatio(e,t,n,r){const i=this.transform.projectTileCoordinates(e,t,n,r);return.5+this.transform.cameraToCenterDistance/i.signedDistanceFromCamera*.5}isOffscreen(e,t,n,r){return n<ot||e>=this.screenRightBoundary||r<ot||t>this.screenBottomBoundary}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.ar([]);return t.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,r,i,a,s,o,l,c,u,h){let d=1,p=0,f=0,m=1;const g=e.anchorPointX+o[0],y=e.anchorPointY+o[1];if(s&&!a){const e=this.projectAndGetPerspectiveRatio(g+1,y,i,c,h),t=e.x-l.x,n=Math.atan((e.y-l.y)/t)+(t<0?Math.PI:0),r=Math.sin(n),a=Math.cos(n);d=a,p=r,f=-r,m=a}else if(!s&&a){const e=Ue(this.transform);d=e.vecEast[0],p=e.vecEast[1],f=e.vecSouth[0],m=e.vecSouth[1]}let _=l.x,v=l.y,x=n;a&&(_=g,v=y,x=Math.pow(2,-(this.transform.zoom-r.overscaledZ)),x*=this.transform.getPitchedTextCorrection(g,y,i),u||(x*=t.an(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(_+=d*u.x*x+f*u.y*x,v+=p*u.x*x+m*u.y*x);const b=e.x1*x,w=e.x2*x,S=(b+w)/2,k=e.y1*x,T=e.y2*x,C=(k+T)/2,E=[{offsetX:b,offsetY:k},{offsetX:S,offsetY:k},{offsetX:w,offsetY:k},{offsetX:w,offsetY:C},{offsetX:w,offsetY:T},{offsetX:S,offsetY:T},{offsetX:b,offsetY:T},{offsetX:b,offsetY:C}];let I=[];for(const{offsetX:M,offsetY:A}of E)I.push(new t.P(_+d*M+f*A,v+p*M+m*A));let P=!1;if(a){const e=I.map(e=>this.projectAndGetPerspectiveRatio(e.x,e.y,i,c,h));P=e.some(e=>!e.isOccluded),I=e.map(e=>new t.P(e.x,e.y))}else P=!0;return{box:t.aL(I),allPointsOccluded:!P}}}class ct{constructor(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class ut{constructor(e,t,n,r,i){this.text=new ct(e?e.text:null,t,n,i),this.icon=new ct(e?e.icon:null,t,r,i)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ht{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class dt{constructor(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class pt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function ft(e,n,r,i,a){const{horizontalAlign:s,verticalAlign:o}=t.aS(e);return new t.P(-(s-.5)*n+i[0]*a,-(o-.5)*r+i[1]*a)}class mt{constructor(e,t,n,r,i){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new lt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new pt(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(n,r)=>t.getElevation(e,n,r):null}getBucketParts(e,n,r,i){const a=r.getBucket(n),s=r.latestFeatureIndex;if(!a||!s||n.id!==a.layerIds[0])return;const o=r.collisionBoxArray,l=a.layers[0].layout,c=a.layers[0].paint,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/t.a5,d=r.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=t.aN(r,1,this.transform.zoom),m=t.aO(this.collisionIndex.transform,r,c.get("text-translate"),c.get("text-translate-anchor")),g=t.aO(this.collisionIndex.transform,r,c.get("icon-translate"),c.get("icon-translate-anchor")),y=Be(p,this.transform,f);this.retainedQueryData[a.bucketInstanceId]=new dt(a.bucketInstanceId,s,a.sourceLayerIndex,a.index,r.tileID);const _={bucket:a,layout:l,translationText:m,translationIcon:g,unwrappedTileID:d,pitchedLabelPlaneMatrix:y,scale:u,textPixelRatio:h,holdingForFade:r.holdingForSymbolFade(),collisionBoxArray:o,partiallyEvaluatedTextSize:t.ay(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(i)for(const t of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=t;e.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:_})}attemptAnchorPlacement(e,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_,v,x){const b=t.aP[e.textAnchor],w=[e.textOffset0,e.textOffset1],S=ft(b,r,i,w,a),k=this.collisionIndex.placeCollisionBox(n,d,l,c,u,o,s,g,h.predicate,v,S,x);if((!_||this.collisionIndex.placeCollisionBox(_,d,l,c,u,o,s,y,h.predicate,v,S,x).placeable)&&k.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:r,height:i,anchor:b,textBoxScale:a,prevAnchor:e},this.markUsedJustification(f,b,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:S,placedGlyphBoxes:k}}}placeLayerBucketPart(e,n,r){const{bucket:i,layout:a,translationText:s,translationIcon:o,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=e.parameters,m=a.get("text-optional"),g=a.get("icon-optional"),y=t.aQ(a,"text-overlap","text-allow-overlap"),_="always"===y,v=t.aQ(a,"icon-overlap","icon-allow-overlap"),x="always"===v,b="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),S="none"!==a.get("icon-text-fit"),k="viewport-y"===a.get("symbol-z-order"),T=_&&(x||!i.hasIconData()||g),C=x&&(_||!i.hasTextData()||m);!i.collisionArrays&&d&&i.deserializeCollisionBoxes(d);const E=this.retainedQueryData[i.bucketInstanceId].tileID,I=this._getTerrainElevationFunc(E),P=this.transform.getFastPathSimpleProjectionMatrix(E),M=(e,d,x)=>{var k,M;if(n[e.crossTileID])return;if(h)return void(this.placements[e.crossTileID]=new ht(!1,!1,!1));let A=!1,z=!1,D=!0,R=null,L={box:null,placeable:!1,offscreen:null,occluded:!1},N={placeable:!1},j=null,F=null,O=null,B=0,V=0,U=0;d.textFeatureIndex?B=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(B=e.featureIndex),d.verticalTextFeatureIndex&&(V=d.verticalTextFeatureIndex);const q=d.textBox;if(q){const n=n=>{let r=t.az.horizontal;if(i.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(i,r,e))}return r},a=(n,r)=>{if(i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of i.writingModes)if(e===t.az.vertical?(L=r(),N=L):L=n(),L&&L.placeable)break}else L=n()},c=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===c){const r=(t,n)=>{const r=this.collisionIndex.placeCollisionBox(t,y,u,E,l,w,b,s,f.predicate,I,void 0,P);return r&&r.placeable&&(this.markUsedOrientation(i,n,e),this.placedOrientations[e.crossTileID]=n),r};a(()=>r(q,t.az.horizontal),()=>{const n=d.verticalTextBox;return i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?r(n,t.az.vertical):{box:null,offscreen:null}}),n(L&&L.placeable)}else{let p=t.aP[null===(M=null===(k=this.prevPlacement)||void 0===k?void 0:k.variableOffsets[e.crossTileID])||void 0===M?void 0:M.anchor];const m=(t,n,a)=>{const d=t.x2-t.x1,m=t.y2-t.y1,g=e.textBoxScale,_=S&&"never"===v?n:null;let x=null,k="never"===y?1:2,T="never";p&&k++;for(let r=0;r<k;r++){for(let n=c;n<h;n++){const r=i.textAnchorOffsets.get(n);if(p&&r.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(r,t,d,m,g,b,w,u,E,l,f,T,e,i,a,s,o,_,I);if(c&&(x=c.placedGlyphBoxes,x&&x.placeable))return A=!0,R=c.shift,x}p?p=null:T=y}return r&&!x&&(x={box:this.collisionIndex.placeCollisionBox(q,"always",u,E,l,w,b,s,f.predicate,I,void 0,P).box,offscreen:!1,placeable:!1,occluded:!1}),x};a(()=>m(q,d.iconBox,t.az.horizontal),()=>{const n=d.verticalTextBox;return i.allowVerticalPlacement&&(!L||!L.placeable)&&e.numVerticalGlyphVertices>0&&n?m(n,d.verticalIconBox,t.az.vertical):{box:null,occluded:!0,offscreen:null}}),L&&(A=L.placeable,D=L.offscreen);const g=n(L&&L.placeable);if(!A&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(i,t.anchor,e,g))}}}if(j=L,A=j&&j.placeable,D=j&&j.offscreen,e.useRuntimeCollisionCircles&&e.centerJustifiedTextSymbolIndex>=0){const n=i.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),o=t.aA(i.textSizeData,p,n),u=a.get("text-padding");F=this.collisionIndex.placeCollisionCircles(y,n,i.lineVertexArray,i.glyphOffsetArray,o,l,c,r,w,f.predicate,e.collisionCircleDiameter,u,s,I),F.circles.length&&F.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),A=_||F.circles.length>0&&!F.collisionDetected,D=D&&F.offscreen}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,v,u,E,l,w,b,o,f.predicate,I,S&&R?R:void 0,P);N&&N.placeable&&d.verticalIconBox?(O=e(d.verticalIconBox),z=O.placeable):(O=e(d.iconBox),z=O.placeable),D=D&&O.offscreen}const $=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,G=g||0===e.numIconVertices;$||G?G?$||(z=z&&A):A=z&&A:z=A=z&&A;const H=z&&O.placeable;if(A&&j.placeable&&this.collisionIndex.insertCollisionBox(j.box,y,a.get("text-ignore-placement"),i.bucketInstanceId,N&&N.placeable&&V?V:B,f.ID),H&&this.collisionIndex.insertCollisionBox(O.box,v,a.get("icon-ignore-placement"),i.bucketInstanceId,U,f.ID),F&&A&&this.collisionIndex.insertCollisionCircles(F.circles,y,a.get("text-ignore-placement"),i.bucketInstanceId,B,f.ID),r&&this.storeCollisionData(i.bucketInstanceId,x,d,j,O,F),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===i.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new ht((A||T)&&!(null==j?void 0:j.occluded),(z||C)&&!(null==O?void 0:O.occluded),D||i.justReloaded),n[e.crossTileID]=!0};if(k){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=i.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=t.length-1;e>=0;--e){const n=t[e];M(i.symbolInstances.get(n),i.collisionArrays[n],n)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)M(i.symbolInstances.get(t),i.collisionArrays[t],t);i.justReloaded=!1}storeCollisionData(e,t,n,r,i,a){if(n.textBox||n.iconBox){let a,s;this.collisionBoxArrays.has(e)?a=this.collisionBoxArrays.get(e):(a=new Map,this.collisionBoxArrays.set(e,a)),a.has(t)?s=a.get(t):(s={text:null,icon:null},a.set(t,s)),n.textBox&&(s.text=r.box),n.iconBox&&(s.icon=i.box)}if(a){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=[]);for(let e=0;e<a.circles.length;e+=4)t.push(a.circles[e+0]-ot),t.push(a.circles[e+1]-ot),t.push(a.circles[e+2]),t.push(a.collisionDetected?1:0)}}markUsedJustification(e,n,r,i){let a;a=i===t.az.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.aR(n)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=a>=0&&t!==a?0:r.crossTileID)}markUsedOrientation(e,n,r){const i=n===t.az.horizontal||n===t.az.horizontalOnly?n:0,a=n===t.az.vertical?n:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},a=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const o in this.placements){const e=this.placements[o],t=i[o];t?(this.opacities[o]=new ut(t,r,e.text,e.icon),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[o]=new ut(null,r,e.text,e.icon,e.skipFade),n=n||e.text||e.icon)}for(const o in i){const e=i[o];if(!this.opacities[o]){const t=new ut(e,r,!1,!1);t.isHidden()||(this.opacities[o]=t,n=n||e.text.placed||e.icon.placed)}}for(const o in a)this.variableOffsets[o]||!this.opacities[o]||this.opacities[o].isHidden()||(this.variableOffsets[o]=a[o]);for(const o in s)this.placedOrientations[o]||!this.opacities[o]||this.opacities[o].isHidden()||(this.placedOrientations[o]=s[o]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r.tileID,n,r.collisionBoxArray)}}updateBucketOpacities(e,n,r,i){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const a=e.layers[0],s=a.layout,o=new ut(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new ut(null,0,l&&(c||!e.hasIconData()||s.get("icon-optional")),c&&(l||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const m=(e,t,n)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n);e.hasVisibleVertices=e.hasVisibleVertices||n!==Tt},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let y=0;y<e.symbolInstances.length;y++){const n=e.symbolInstances.get(y),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:a,crossTileID:s}=n;let l=this.opacities[s];r[s]?l=o:l||(l=f,this.opacities[s]=l),r[s]=!0;const c=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],v=_===t.az.vertical,x=_===t.az.horizontal||_===t.az.horizontalOnly;if(i>0||a>0){const t=kt(l.text);m(e.text,i,v?Tt:t),m(e.text,a,x?Tt:t);const r=l.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=r||v?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=r||x?1:0);const s=this.variableOffsets[n.crossTileID];s&&this.markUsedJustification(e,s.anchor,n,_);const o=this.placedOrientations[n.crossTileID];o&&(this.markUsedJustification(e,"left",n,o),this.markUsedOrientation(e,o,n))}if(c){const t=kt(l.icon),r=!(p&&n.verticalPlacedIconSymbolIndex&&v);n.placedIconSymbolIndex>=0&&(m(e.icon,n.numIconVertices,r?t:Tt),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=l.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,n.numVerticalIconVertices,r?Tt:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=l.icon.isHidden())}const b=g&&g.has(y)?g.get(y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[y];if(n){let r=new t.P(0,0);if(n.textBox||n.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[s];e?(r=ft(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&r._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):t=!1}if(n.textBox||n.verticalTextBox){let i;n.textBox&&(i=v),n.verticalTextBox&&(i=x),gt(e.textCollisionBox.collisionVertexArray,l.text.placed,!t||i,b.text,r.x,r.y)}}if(n.iconBox||n.verticalIconBox){const t=Boolean(!x&&n.verticalIconBox);let i;n.iconBox&&(i=t),n.verticalIconBox&&(i=!t),gt(e.iconCollisionBox.collisionVertexArray,l.icon.placed,i,b.icon,p?r.x:0,p?r.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function gt(e,t,n,r,i,a){r&&0!==r.length||(r=[0,0,0,0]);const s=r[0]-ot,o=r[1]-ot,l=r[2]-ot,c=r[3]-ot;e.emplaceBack(t?1:0,n?1:0,i||0,a||0,s,o),e.emplaceBack(t?1:0,n?1:0,i||0,a||0,l,o),e.emplaceBack(t?1:0,n?1:0,i||0,a||0,l,c),e.emplaceBack(t?1:0,n?1:0,i||0,a||0,s,c)}const yt=Math.pow(2,25),_t=Math.pow(2,24),vt=Math.pow(2,17),xt=Math.pow(2,16),bt=Math.pow(2,9),wt=Math.pow(2,8),St=Math.pow(2,1);function kt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*yt+t*_t+n*vt+t*xt+n*bt+t*wt+n*St+t}const Tt=0;class Ct{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,r,i){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1}}class Et{constructor(e,t,n,r,i,a,s,o){this.placement=new mt(e,t,a,s,o),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n){const r=c(),i=()=>!this._forceFullPlacement&&c()-r>2;for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=a)&&(!r.maxzoom||r.maxzoom>a)){if(this._inProgressLayer||(this._inProgressLayer=new Ct(r)),this._inProgressLayer.continuePlacement(n[r.source],this.placement,this._showCollisionBoxes,r,i))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const It=512/t.a5/2;class Pt{constructor(e,n,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const i=new Map;for(let t=0;t<n.length;t++){const e=n.get(t),r=e.key,a=i.get(r);a?a.push(e):i.set(r,[e])}for(const[a,s]of i){const e={positions:s.map(e=>({x:Math.floor(e.anchorX*It),y:Math.floor(e.anchorY*It)})),crossTileIDs:s.map(e=>e.crossTileID)};if(e.positions.length>128){const n=new t.aT(e.positions.length,16,Uint16Array);for(const{x:t,y:r}of e.positions)n.add(t,r);n.finish(),delete e.positions,e.index=n}this._symbolsByKey[a]=e}}getScaledCoordinates(e,n){const{x:r,y:i,z:a}=this.tileID.canonical,{x:s,y:o,z:l}=n.canonical,c=It/Math.pow(2,l-a),u=(o*t.a5+e.anchorY)*c,h=i*t.a5*It;return{x:Math.floor((s*t.a5+e.anchorX)*c-r*t.a5*It),y:Math.floor(u-h)}}findMatches(e,t,n){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let i=0;i<e.length;i++){const a=e.get(i);if(a.crossTileID)continue;const s=this._symbolsByKey[a.key];if(!s)continue;const o=this.getScaledCoordinates(a,t);if(s.index){const e=s.index.range(o.x-r,o.y-r,o.x+r,o.y+r).sort();for(const t of e){const e=s.crossTileIDs[t];if(!n[e]){n[e]=!0,a.crossTileID=e;break}}}else if(s.positions)for(let e=0;e<s.positions.length;e++){const t=s.positions[e],i=s.crossTileIDs[e];if(Math.abs(t.x-o.x)<=r&&Math.abs(t.y-o.y)<=r&&!n[i]){n[i]=!0,a.crossTileID=i;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Mt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class At{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],r={};for(const n in e){const i=e[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}this.indexes[n]=r}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const a=n[i];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,r)}else{const a=n[e.scaledTo(Number(i)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let i=0;i<t.symbolInstances.length;i++){const e=t.symbolInstances.get(i);e.crossTileID||(e.crossTileID=n.generate(),r[e.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Pt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.getCrossTileIDsLists())for(const t of n)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class zt{constructor(){this.layerIndexes={},this.crossTileIDs=new Mt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new At);let i=!1;const a={};r.handleWrapJump(n);for(const s of t){const t=s.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(s.tileID,t,this.crossTileIDs)&&(i=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(i=!0),i}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}var Dt="void main() {fragColor=vec4(1.0);}";const Rt={prelude:Lt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:Lt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Lt("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:Lt("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Lt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Lt(Dt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Lt("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:Lt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Lt(Dt,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:Lt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:Lt("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:Lt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Lt("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Lt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Lt("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:Lt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Lt("uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),lineGradientSDF:Lt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),raster:Lt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Lt("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:Lt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Lt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:Lt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Lt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Lt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nin vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Lt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Lt(e,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/in ([\w]+) ([\w]+)/g),i=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=a?a.concat(i):i,o={};return{fragmentSource:e=e.replace(n,(e,t,n,r,i)=>(o[i]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nin ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`)),vertexSource:t=t.replace(n,(e,t,n,r,i)=>{const a="float"===r?"vec2":"vec4",s=i.match(/color/)?"color":a;return o[i]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nin ${n} ${a} a_${i};\nout ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nin ${n} ${a} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`}),staticAttributes:r,staticUniforms:s}}class Nt{constructor(e,t,n){this.vertexBuffer=e,this.indexBuffer=t,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var jt=t.aU([{name:"a_pos",type:"Int16",components:2}]);const Ft="#define PROJECTION_MERCATOR",Ot="mercator";class Bt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ot}get shaderDefine(){return Ft}get shaderPreludeCode(){return Rt.projectionMercator}get vertexShaderPreludeCode(){return Rt.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,r,i,a){if(this._cachedMesh)return this._cachedMesh;const s=new t.aW;s.emplaceBack(0,0),s.emplaceBack(t.a5,0),s.emplaceBack(0,t.a5),s.emplaceBack(t.a5,t.a5);const o=e.createVertexBuffer(s,jt.members),l=t.aX.simpleSegment(0,0,4,2),c=new t.aY;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=e.createIndexBuffer(c);return this._cachedMesh=new Nt(o,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Vt{constructor(e=0,t=0,n=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.G.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.G.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.G.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.G.number(e.right,n.right,r)),this}getCenter(e,n){const r=t.an((this.left+e-this.right)/2,0,e),i=t.an((this.top+n-this.bottom)/2,0,n);return new t.P(r,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ut(e,t){if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}function qt(e){return Math.max(0,Math.floor(e))}class $t{constructor(e,n){var r;this.applyConstrain=(e,t)=>null!==this._constrainOverride?this._constrainOverride(e,t):this._callbacks.defaultConstrain(e,t),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===(null==n?void 0:n.renderWorldCopies)||!!(null==n?void 0:n.renderWorldCopies),this._minZoom=(null==n?void 0:n.minZoom)||0,this._maxZoom=(null==n?void 0:n.maxZoom)||22,this._minPitch=null==(null==n?void 0:n.minPitch)?0:null==n?void 0:n.minPitch,this._maxPitch=null==(null==n?void 0:n.maxPitch)?60:null==n?void 0:n.maxPitch,this._constrainOverride=null!==(r=null==n?void 0:n.constrainOverride)&&void 0!==r?r:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=qt(this._zoom),this._scale=t.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Vt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,r){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=qt(this._zoom),this._scale=t.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Vt(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!r&&e.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){void 0===e&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=t.W(e,-180,180)*Math.PI/180;var i,a,s,o,l,c,u,h,d;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=r(),i=this._rotationMatrix,s=-this._bearingInRadians,o=(a=this._rotationMatrix)[0],l=a[1],c=a[2],u=a[3],h=Math.sin(s),d=Math.cos(s),i[0]=o*d+c*h,i[1]=l*d+u*h,i[2]=o*-h+c*d,i[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=t.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const t=e/180*Math.PI;this._rollInRadians!==t&&(this._unmodified=!1,this._rollInRadians=t,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aZ(this._fovInRadians)}setFov(e){e=t.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=t.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.applyConstrain(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=t.aq(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,t){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=t,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this.constrainInternal(),this._calcMatrices()}resize(e,t,n=!0){this._width=e,this._height=t,n&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new Z([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-t.ao,t.ao])}getCameraQueryGeometry(e,n){if(1===n.length)return[n[0],e];{const{minX:r,minY:i,maxX:a,maxY:s}=t.aa.fromPoints(n).extend(e);return[new t.P(r,i),new t.P(a,i),new t.P(a,s),new t.P(r,s),new t.P(r,i)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:n}=this.applyConstrain(this.center,this.zoom);this.setCenter(t),this.setZoom(n),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=t.ar(new Float64Array(16));t.Q(e,e,[this._width/2,-this._height/2,1]),t.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=t.ar(new Float64Array(16)),t.Q(e,e,[1,-1,1]),t.O(e,e,[-1,-1,0]),t.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,r,i){const a=void 0!==r?r:this.bearing,s=i=void 0!==i?i:this.pitch,{distanceToCenter:o,clampedElevation:l}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,s),{x:c,y:u}=be(s,a),h=t.a9.fromLngLat(e,n);let d,p,f=t.a_(1,h.y),m=0;do{if(m+=1,m>10)break;p=o/f,d=new t.a9(h.x+c*p,h.y+u*p),f=1/d.meterInMercatorCoordinateUnits()}while(Math.abs(o-p*f)>1e-12);return{center:d.toLngLat(),elevation:l,zoom:t.at(this.height/2/Math.tan(this.fovInRadians/2)/p/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=1/this.worldSize,r=t.as(1,this.center.lat)*this.worldSize,i=t.a9.fromLngLat(this.center,this.elevation),a=i.x/n,s=i.y/n,o=i.z/n,l=this.pitch,c=this.bearing,{x:u,y:h,z:d}=be(l,c),p=this.cameraToCenterDistance,f=a+p*-u,m=s+p*-h,g=o+p*d,{distanceToCenter:y,clampedElevation:_}=this._distanceToCenterFromAltElevationPitch(g/r,e,l),v=y*r,x=new t.a9((f+u*v)*n,(m+h*v)*n,0).toLngLat(),b=t.as(1,x.lat),w=t.at(this.height/2/Math.tan(this.fovInRadians/2)/y/b/this.tileSize);this._elevation=_,this._center=x,this.setZoom(w)}_distanceToCenterFromAltElevationPitch(e,n,r){const i=-Math.cos(t.ap(r)),a=e-n;let s,o=n;return i*a>=0||Math.abs(i)<.1?(s=1e4,o=e+s*i):s=-a/i,{distanceToCenter:s,clampedElevation:o}}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=t.as(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/t.a5,1/n/t.a5]}}class Gt{constructor(e,n){this.min=e,this.max=n,this.center=t.a$([],t.b0([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],r=t.b1(this.min),i=t.b1(this.max);for(let t=0;t<n.length;t++)r[t]=n[t]?this.min[t]:this.center[t],i[t]=n[t]?this.center[t]:this.max[t];return i[2]=this.max[2],new Gt(r,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let t=!0;for(let n=0;n<e.planes.length;n++){const r=this.intersectsPlane(e.planes[n]);if(0===r)return 0;1===r&&(t=!1)}return t?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let t=e[3],n=e[3];for(let r=0;r<3;r++)e[r]>0?(t+=e[r]*this.min[r],n+=e[r]*this.max[r]):(n+=e[r]*this.min[r],t+=e[r]*this.max[r]);return t>=0?2:n<0?0:1}}class Ht{distanceToTile2d(e,t,n,r){const i=r.distanceX([e,t]),a=r.distanceY([e,t]);return Math.hypot(i,a)}getWrap(e,t,n){return n}getTileBoundingVolume(e,n,r,i){var a,s;let o=0,l=0;if(null==i?void 0:i.terrain){const c=new t.a2(e.z,n,e.z,e.x,e.y),u=i.terrain.getMinMaxElevation(c);o=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,r),l=null!==(s=u.maxElevation)&&void 0!==s?s:Math.max(0,r)}const c=1<<e.z;return new Gt([n+e.x/c,e.y/c,o],[n+(e.x+1)/c,(e.y+1)/c,l])}allowVariableZoom(e,n){const r=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,i=t.an(78.5-r/2,0,60);return!!n.terrain||e.pitch>i}allowWorldCopies(){return!0}prepareNextFrame(){}}class Zt{constructor(e,t,n){this.points=e,this.planes=t,this.aabb=n}static fromInvProjectionMatrix(e,n=1,r=0,i,a){const s=a?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],o=Math.pow(2,r),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>function(e,n,r,i){const a=t.aH([],e,n),s=1/a[3]/r*i;return t.b6(a,a,[s,s,1/a[3],s])}(r,e,n,o));i&&function(e,n,r,i){const a=i?4:0,s=i?0:4;let o=0;const l=[],c=[];for(let d=0;d<4;d++){const n=t.b2([],e[d+s],e[d+a]),r=t.b7(n);t.a$(n,n,1/r),l.push(r),c.push(n)}for(let d=0;d<4;d++){const n=t.b8(e[d+a],c[d],r);o=null!==n&&n>=0?Math.max(o,n):Math.max(o,l[d])}const u=function(e,n){const r=t.b2([],e[n[0]],e[n[1]]),i=t.b2([],e[n[2]],e[n[1]]),a=[0,0,0,0];return t.b3(a,t.b4([],r,i)),a[3]=-t.b5(a,e[n[0]]),a}(e,n),h=function(e,n){const r=t.b9(e),i=t.ba([],e,1/r),a=t.b2([],n,t.a$([],i,t.b5(n,i))),s=t.b9(a);if(s>0){const e=Math.sqrt(1-i[3]*i[3]),r=t.a$([],i,-i[3]),o=t.b0([],r,t.a$([],a,e/s));return t.bb(n,o)}return null}(r,u);if(null!==h){const e=h/t.b5(c[0],u);o=Math.min(o,e)}for(let t=0;t<4;t++){const n=Math.min(o,l[t]);e[t+s]=[e[t+a][0]+c[t][0]*n,e[t+a][1]+c[t][1]*n,e[t+a][2]+c[t][2]*n,1]}}(l,s[0],i,a);const c=s.map(e=>{const n=t.b2([],l[e[0]],l[e[1]]),r=t.b2([],l[e[2]],l[e[1]]),i=t.b3([],t.b4([],n,r)),a=-t.b5(i,l[e[1]]);return i.concat(a)}),u=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],h=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const t of l)for(let e=0;e<3;e++)u[e]=Math.min(u[e],t[e]),h[e]=Math.max(h[e],t[e]);return new Zt(l,c,new Gt(u,h))}}class Wt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,n=!0){this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,t){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(e,n)=>{n=t.an(+n,this.minZoom,this.maxZoom);const r={center:new t.V(e.lng,e.lat),zoom:n};let i=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===i){const e=180-1e-10;i=[-e,e]}const a=this.tileSize*t.aq(r.zoom);let s=0,o=a,l=0,c=a,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const e=this._helper._latRange;s=t.X(e[1])*a,o=t.X(e[0])*a,o-s<p&&(u=p/(o-s))}i&&(l=t.W(t.Y(i[0])*a,0,a),c=t.W(t.Y(i[1])*a,0,a),c<l&&(c+=a),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=ge(a,e);let g,y;const _=Math.max(h||0,u||0);if(_){const e=new t.P(h?(c+l)/2:f,u?(o+s)/2:m);return r.center=ye(a,e).wrap(),r.zoom+=t.at(_),r}if(this._helper._latRange){const e=p/2;m-e<s&&(y=s+e),m+e>o&&(y=o-e)}if(i){const e=(l+c)/2;let n=f;this._helper._renderWorldCopies&&(n=t.W(f,e-a/2,e+a/2));const r=d/2;n-r<l&&(g=l+r),n+r>c&&(g=c-r)}if(void 0!==g||void 0!==y){const e=new t.P(null!=g?g:f,null!=y?y:m);r.center=ye(a,e).wrap()}return r},this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new $t({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._coveringTilesDetailsProvider=new Ht}clone(){const e=new Wt;return e.apply(this,!1),e}apply(e,t,n){this._helper.apply(e,t,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new t.bc(0,e)];if(this._helper._renderWorldCopies){const r=this.screenPointToMercatorCoordinate(new t.P(0,0)),i=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),a=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),s=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),o=Math.floor(Math.min(r.x,i.x,a.x,s.x)),l=Math.floor(Math.max(r.x,i.x,a.x,s.x)),c=1;for(let u=o-c;u<=l+c;u++)0!==u&&n.push(new t.bc(u,e))}return n}getCameraFrustum(){return Zt.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const t=this.screenPointToLocation(this.centerPoint,e),n=e?e.getElevationForLngLatZoom(t,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(e,n){const r=t.as(this.elevation,this.center.lat),i=this.screenPointToMercatorCoordinateAtZ(n,r),a=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,r),s=t.a9.fromLngLat(e),o=new t.a9(s.x-(i.x-a.x),s.y-(i.y-a.y));this.setCenter(null==o?void 0:o.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(t.a9.fromLngLat(e),n.getElevationForLngLat(e,this),this._pixelMatrix3D):this.coordinatePoint(t.a9.fromLngLat(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}screenPointToMercatorCoordinate(e,t){if(t){const n=t.pointCoordinate(e);if(null!=n)return n}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const r=n||0,i=[e.x,e.y,0,1],a=[e.x,e.y,1,1];t.aH(i,i,this._pixelMatrixInverse),t.aH(a,a,this._pixelMatrixInverse);const s=i[3],o=a[3],l=i[1]/s,c=a[1]/o,u=i[2]/s,h=a[2]/o,d=u===h?0:(r-u)/(h-u);return new t.a9(t.G.number(i[0]/s,a[0]/o,d)/this.worldSize,t.G.number(l,c,d)/this.worldSize,r)}coordinatePoint(e,n=0,r=this._pixelMatrix){const i=[e.x*this.worldSize,e.y*this.worldSize,n,1];return t.aH(i,i,r),new t.P(i[0]/i[3],i[1]/i[3])}getBounds(){const e=Math.max(0,this._helper._height/2-_e(this));return(new Z).extend(this.screenPointToLocation(new t.P(0,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(e,t){return t?null!=t.pointCoordinate(e):e.y>this.height/2-_e(this)}calculatePosMatrix(e,n=!1,r){var i;const a=null!==(i=e.key)&&void 0!==i?i:t.bd(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),s=n?this._alignedPosMatrixCache:this._posMatrixCache;if(s.has(a)){const e=s.get(a);return r?e.f32:e.f64}const o=ve(e,this.worldSize);t.S(o,n?this._alignedProjMatrix:this._viewProjMatrix,o);const l={f64:o,f32:new Float32Array(o)};return s.set(a,l),r?l.f32:l.f64}calculateFogMatrix(e){const n=e.key,r=this._fogMatrixCacheF32;if(r.has(n))return r.get(n);const i=ve(e,this.worldSize);return t.S(i,this._fogMatrix,i),r.set(n,new Float32Array(i)),r.get(n)}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}_calculateNearFarZIfNeeded(e,n,r){if(!this._helper.autoCalculateNearFarZ)return;const i=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),a=e-i*this._helper._pixelPerMeter/Math.cos(n),s=i<0?a:e,o=Math.PI/2+this.pitchInRadians,l=t.ap(this.fov)*(Math.abs(Math.cos(t.ap(this.roll)))*this.height+Math.abs(Math.sin(t.ap(this.roll)))*this.width)/this.height*(.5+r.y/this.height),c=Math.sin(l)*s/Math.sin(t.an(Math.PI-o-l,.01,Math.PI-.01)),u=_e(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=t.ap(.75),p=h>d?2*h*(.5+r.y/(2*u)):d,f=Math.sin(p)*s/Math.sin(t.an(Math.PI-o-p,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*m+s),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=ge(this.worldSize,this.center),r=n.x,i=n.y;this._helper._pixelPerMeter=t.as(1,this.center.lat)*this.worldSize;const a=t.ap(Math.min(this.pitch,me)),s=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(a));let o;this._calculateNearFarZIfNeeded(s,a,e),o=new Float64Array(16),t.be(o,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.aB(this._invProjMatrix,o),o[8]=2*-e.x/this._helper._width,o[9]=2*e.y/this._helper._height,this._projectionMatrix=t.bf(o),t.Q(o,o,[1,-1,1]),t.O(o,o,[0,0,-this._helper.cameraToCenterDistance]),t.bg(o,o,-this.rollInRadians),t.bh(o,o,this.pitchInRadians),t.bg(o,o,-this.bearingInRadians),t.O(o,o,[-r,-i,0]),this._mercatorMatrix=t.Q([],o,[this.worldSize,this.worldSize,this.worldSize]),t.Q(o,o,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,o),t.O(o,o,[0,0,-this.elevation]),this._viewProjMatrix=o,this._invViewProjMatrix=t.aB([],o);const l=[0,0,-1,1];t.aH(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),t.be(this._fogMatrix,this.fovInRadians,this.width/this.height,s,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,t.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.O(this._fogMatrix,this._fogMatrix,[-r,-i,0]),t.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,o);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=r-Math.round(r)+h*c+d*u,f=i-Math.round(i)+h*u+d*c,m=new Float64Array(o);if(t.O(m,m,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=m,o=t.aB(new Float64Array(16),this._pixelMatrix),!o)throw new Error("failed to invert matrix");this._pixelMatrixInverse=o,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new t.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.aH(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=t.as(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const r=t.a9.fromLngLat(e),i=[r.x*this.worldSize,r.y*this.worldSize,n,1];return t.aH(i,i,this._viewProjMatrix),i[2]/i[3]}getProjectionData(e){const{overscaledTileID:n,aligned:r,applyTerrainMatrix:i}=e,a=this._helper.getMercatorTileCoordinates(n),s=n?this.calculatePosMatrix(n,r,!0):null;let o;return o=n&&n.terrainRttPosMatrix32f&&i?n.terrainRttPosMatrix32f:s||t.bi(),{mainMatrix:o,tileMercatorCoords:a,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:o}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,t,n){return 1}transformLightDirection(e){return t.b1(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,r,i){const a=this.calculatePosMatrix(r);let s;i?(s=[e,n,i(e,n),1],t.aH(s,s,a)):(s=[e,n,0,1],st(s,s,a));const o=s[3];return{point:new t.P(s[0]/o,s[1]/o),signedDistanceFromCamera:o,isOccluded:!1}}populateCache(e){for(const t of e)this.calculatePosMatrix(t)}getMatrixForModel(e,n){const r=t.a9.fromLngLat(e,n),i=r.meterInMercatorCoordinateUnits(),a=t.bj();return t.O(a,a,[r.x,r.y,r.z]),t.bg(a,a,Math.PI),t.bh(a,a,Math.PI/2),t.Q(a,a,[-i,i,i]),a}getProjectionDataForCustomLayer(e=!0){const n=new t.a2(0,0,0,0,0),r=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),i=ve(n,this.worldSize);t.S(i,this._viewProjMatrix,i),r.tileMercatorCoords=[0,0,1,1];const a=[t.a5,t.a5,this.worldSize/this._helper.pixelsPerMeter],s=t.bk();return t.Q(s,i,a),r.fallbackMatrix=s,r.mainMatrix=s,r}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Xt(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Yt(e){if(e.useSlerp)if(e.k<1){const n=t.bl(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),r=t.bl(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),i=new Float64Array(4);t.bm(i,n,r,e.k);const a=t.bn(i);e.tr.setRoll(a.roll),e.tr.setPitch(a.pitch),e.tr.setBearing(a.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(t.G.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(t.G.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(t.G.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function Kt(e,n,r,i,a){const s=a.padding,o=ge(a.worldSize,r.getNorthWest()),l=ge(a.worldSize,r.getNorthEast()),c=ge(a.worldSize,r.getSouthEast()),u=ge(a.worldSize,r.getSouthWest()),h=t.ap(-i),d=o.rotate(h),p=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new t.P(Math.max(d.x,p.x,m.x,f.x),Math.max(d.y,p.y,m.y,f.y)),y=new t.P(Math.min(d.x,p.x,m.x,f.x),Math.min(d.y,p.y,m.y,f.y)),_=g.sub(y),v=(a.width-(s.left+s.right+n.left+n.right))/_.x,x=(a.height-(s.top+s.bottom+n.top+n.bottom))/_.y;if(x<0||v<0)return void Xt();const b=Math.min(t.at(a.scale*Math.min(v,x)),e.maxZoom),w=t.P.convert(e.offset),S=new t.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(t.ap(i)),k=w.add(S).mult(a.scale/t.aq(b));return{center:ye(a.worldSize,o.add(c).div(2).sub(k)),zoom:b,bearing:i}}class Qt{get useGlobeControls(){return!1}handlePanInertia(e,t){const n=e.mag(),r=Math.abs(_e(t));return{easingOffset:e.mult(Math.min(.75*r/n,1)),easingCenter:t.center}}handleMapControlsRollPitchBearingZoom(e,t){e.bearingDelta&&t.setBearing(t.bearing+e.bearingDelta),e.pitchDelta&&t.setPitch(t.pitch+e.pitchDelta),e.rollDelta&&t.setRoll(t.roll+e.rollDelta),e.zoomDelta&&t.setZoom(t.zoom+e.zoomDelta)}handleMapControlsPan(e,t,n){e.around.distSqr(t.centerPoint)<.01||t.setLocationAtPoint(n,e.around)}cameraForBoxAndBearing(e,t,n,r,i){return Kt(e,t,n,r,i)}handleJumpToCenterZoom(e,n){e.zoom!==(void 0!==n.zoom?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),void 0!==n.center&&e.setCenter(t.V.convert(n.center))}handleEaseTo(e,n){const r=e.zoom,i=e.padding,a={roll:e.roll,pitch:e.pitch,bearing:e.bearing},s={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},o=void 0!==n.zoom,l=!e.isPaddingEqual(n.padding);let c=!1;const u=o?+n.zoom:e.zoom;let h=e.centerPoint.add(n.offsetAsPoint);const d=e.screenPointToLocation(h),{center:p,zoom:f}=e.applyConstrain(t.V.convert(n.center||d),null!=u?u:r);Ut(e,p);const m=ge(e.worldSize,d),g=ge(e.worldSize,p).sub(m),y=t.aq(f-r);return c=f!==r,{easeFunc:o=>{if(c&&e.setZoom(t.G.number(r,f,o)),t.bo(a,s)||Yt({startEulerAngles:a,endEulerAngles:s,tr:e,k:o,useSlerp:a.roll!=s.roll}),l&&(e.interpolatePadding(i,n.padding,o),h=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const n=t.aq(e.zoom-r),i=f>r?Math.min(2,y):Math.max(.5,y),a=Math.pow(i,1-o),s=ye(e.worldSize,m.add(g.mult(o*a)).mult(n));e.setLocationAtPoint(e.renderWorldCopies?s.wrap():s,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(e,n){const r=void 0!==n.zoom,i=e.zoom,a=e.applyConstrain(t.V.convert(n.center||n.locationAtOffset),r?+n.zoom:i),s=a.center,o=a.zoom;Ut(e,s);const l=ge(e.worldSize,n.locationAtOffset),c=ge(e.worldSize,s).sub(l),u=c.mag(),h=t.aq(o-i);let d;if(void 0!==n.minZoom){const r=Math.min(+n.minZoom,i,o),a=e.applyConstrain(s,r).zoom;d=t.aq(a-i)}return{easeFunc:(n,r,a,u)=>{e.setZoom(1===n?o:i+t.at(r));const h=1===n?s:ye(e.worldSize,l.add(c.mult(a)).mult(r));e.setLocationAtPoint(e.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:s,scaleOfMinZoom:d,pixelPathLength:u}}}class Jt{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Jt.Replace=[1,0],Jt.disabled=new Jt(Jt.Replace,t.bp.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,t.bp.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,771],t.bp.transparent,[!0,!0,!0,!0]);const en=2305;class tn{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}tn.disabled=new tn(!1,1029,en),tn.backCCW=new tn(!0,1029,en),tn.frontCCW=new tn(!0,1028,en);class nn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}nn.ReadOnly=!1,nn.ReadWrite=!0,nn.disabled=new nn(519,nn.ReadOnly,[0,1]);const rn=7680;class an{constructor(e,t,n,r,i,a){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=a}}an.disabled=new an({func:519,mask:0},0,0,rn,rn,rn);const sn=new WeakMap;function on(e){var t;if(sn.has(e))return sn.get(e);{const n=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return sn.set(e,n),n}}class ln{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,r=n.gl;this._texFormat=r.RGBA,this._texType=r.UNSIGNED_BYTE;const i=new t.aW;i.emplaceBack(-1,-1),i.emplaceBack(2,-1),i.emplaceBack(-1,2);const a=new t.aY;a.emplaceBack(0,1,2),this._fullscreenTriangle=new Nt(n.createVertexBuffer(i,jt.members),n.createIndexBuffer(a),t.aX.simpleSegment(0,0,i.length,a.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(r.TEXTURE1);const s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(s),on(r)&&(this._pbo=r.createBuffer(),r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.bufferData(r.PIXEL_PACK_BUFFER,4,r.STREAM_READ),r.bindBuffer(r.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,t){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,t),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,t=e.gl;e.activeTexture.set(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const r=this._cachedRenderContext.context,i=r.gl;if(this._bindFramebuffer(),r.viewport.set([0,0,this._texWidth,this._texHeight]),r.clear({color:t.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(r,i.TRIANGLES,nn.disabled,an.disabled,Jt.unblended,tn.disabled,((e,t)=>({u_input:e,u_output_expected:t}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&on(i)){i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.readBuffer(i.COLOR_ATTACHMENT0),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);const e=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);i.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&on(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ln._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let t=0;return t+=e[0]/256,t+=e[1]/65536,t+=e[2]/16777216,e[3]<127&&(t=-t),t/128}}const cn=t.a5/128;function un(e,n){const r=void 0!==e.granularity?Math.max(e.granularity,1):1,i=r+(e.generateBorders?2:0),a=r+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),s=i+1,o=a+1,l=e.generateBorders?-1:0,c=e.generateBorders||e.extendToNorthPole?-1:0,u=r+(e.generateBorders?1:0),h=r+(e.generateBorders||e.extendToSouthPole?1:0),d=s*o,p=i*a*6,f=s*o>65536;if(f&&"16bit"===n)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===n,g=new Int16Array(2*d);let y=0;for(let x=c;x<=h;x++)for(let n=l;n<=u;n++){let i=n/r*t.a5;-1===n&&(i=-cn),n===r+1&&(i=t.a5+cn);let a=x/r*t.a5;-1===x&&(a=e.extendToNorthPole?t.br:-cn),x===r+1&&(a=e.extendToSouthPole?t.bs:t.a5+cn),g[y++]=i,g[y++]=a}const _=m?new Uint32Array(p):new Uint16Array(p);let v=0;for(let t=0;t<a;t++)for(let e=0;e<i;e++){const n=e+1+t*s,r=e+(t+1)*s,i=e+1+(t+1)*s;_[v++]=e+t*s,_[v++]=r,_[v++]=n,_[v++]=n,_[v++]=r,_[v++]=i}return{vertices:g.buffer.slice(0),indices:_.buffer.slice(0),uses32bitIndices:m}}const hn=new t.aV({fill:new t.bt(128,2),line:new t.bt(512,0),tile:new t.bt(128,32),stencil:new t.bt(128,1),circle:3});class dn{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Rt.projectionGlobe}get vertexShaderPreludeCode(){return Rt.projectionMercator.vertexSource}get subdivisionGranularity(){return hn}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ln(e));const n=t.X(this._errorQueryLatitudeDegrees),r=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,i=this._errorMeasurement.updateErrorLoop(n,r),a=c();i!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=i,this._errorMeasurementLastChangeTime=a);const s=Math.min(Math.max((a-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bv(s))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,t,n,r,i){const a=("stencil"===i?hn.stencil:hn.tile).getGranularityForZoomLevel(t.z);return this._getMesh(e,{granularity:a,generateBorders:n,extendToNorthPole:0===t.y&&r,extendToSouthPole:t.y===(1<<t.z)-1&&r})}_getMesh(e,n){const r=this._getMeshKey(n);if(r in this._tileMeshCache)return this._tileMeshCache[r];const i=function(e,n){const r=un(n,"16bit"),i=t.aW.deserialize({arrayBuffer:r.vertices,length:r.vertices.byteLength/2/2}),a=t.aY.deserialize({arrayBuffer:r.indices,length:r.indices.byteLength/2/3});return new Nt(e.createVertexBuffer(i,jt.members),e.createIndexBuffer(a),t.aX.simpleSegment(0,0,i.length,a.length))}(e,n);return this._tileMeshCache[r]=i,i}recalculate(e){}hasTransition(){const e=c();let t=!1;return t=t||(e-this._errorMeasurementLastChangeTime)/1e3<.7,t=t||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,t}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const pn=new t.t({type:new t.D(t.u.projection.type)});class fn extends t.E{constructor(e){super(),this._transitionable=new t.x(pn,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.H(0)),this._mercatorProjection=new Bt,this._verticalPerspectiveProjection=new dn}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof t.bw){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,t,n,r,i){return this.currentProjection.getMeshFromTileID(e,t,n,r,i)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function mn(e){const t=_n(e.worldSize,e.center.lat);return 2*Math.PI*t}function gn(e,n,r,i,a){const s=1/(1<<a),o=n/t.a5*s+i*s,l=t.bz((e/t.a5*s+r*s)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function yn(e){return function(e,t){const n=Math.cos(t),r=new Float64Array(3);return r[0]=Math.sin(e)*n,r[1]=Math.sin(t),r[2]=Math.cos(e)*n,r}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function _n(e,t){return e/(2*Math.PI)/Math.cos(t*Math.PI/180)}function vn(e){const n=Math.asin(e[1])/Math.PI*180,r=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(r>1e-6){const i=e[0]/r,a=Math.acos(e[2]/r),s=(i>0?a:-a)/Math.PI*180;return new t.V(t.W(s,-180,180),n)}return new t.V(0,n)}function xn(e){return Math.cos(e*Math.PI/180)}function bn(e,n){const r=xn(e),i=xn(n);return t.at(i/r)}function wn(e,n){const r=e.rotate(n.bearingInRadians),i=n.zoom+bn(n.center.lat,0),a=t.bu(1/xn(n.center.lat),1/xn(Math.min(Math.abs(n.center.lat),60)),t.bx(i,7,3,0,1)),s=360/mn({worldSize:n.worldSize,center:{lat:n.center.lat}});return new t.V(n.center.lng-r.x*s*a,t.an(n.center.lat+r.y*s,-t.ao,t.ao))}function Sn(e){const t=.5*e,n=Math.sin(t),r=Math.cos(t);return Math.log(n+r)-Math.log(r-n)}function kn(e,n,r,i){const a=e.lat+r*i;if(Math.abs(r)>1){const s=(Math.sign(e.lat+r)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,o=Math.abs(e.lat+r)*Math.PI/180,l=Sn(s+i*(o-s)),c=Sn(s),u=Sn(o);return new t.V(e.lng+n*((l-c)/(u-c)),a)}return new t.V(e.lng+n*i,a)}class Tn{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,t,n,r){const i=`${e.z}_${e.x}_${e.y}_${(null==r?void 0:r.terrain)?"t":""}`,a=this._cache.get(i);if(a)return a;const s=this._cachePrevious.get(i);if(s)return this._cache.set(i,s),s;const o=this._boundingVolumeFactory(e,t,n,r);return this._cache.set(i,o),this._hadAnyChanges=!0,o}}class Cn{constructor(e,t,n,r){this.min=n,this.max=r,this.points=e,this.planes=t}static fromAabb(e,t){const n=[];for(let r=0;r<8;r++)n.push([1&~r?e[0]:t[0],1==(r>>1&1)?t[1]:e[1],1==(r>>2&1)?t[2]:e[2]]);return new Cn(n,[[-1,0,0,t[0]],[1,0,0,-e[0]],[0,-1,0,t[1]],[0,1,0,-e[1]],[0,0,-1,t[2]],[0,0,1,-e[2]]],e,t)}static fromCenterSizeAngles(e,n,r){const i=t.bB([],r[0],r[1],r[2]),a=t.bC([],[n[0],0,0],i),s=t.bC([],[0,n[1],0],i),o=t.bC([],[0,0,n[2]],i),l=[...e],c=[...e];for(let t=0;t<8;t++)for(let n=0;n<3;n++){const r=e[n]+a[n]*(1&~t?-1:1)+s[n]*(1==(t>>1&1)?1:-1)+o[n]*(1==(t>>2&1)?1:-1);l[n]=Math.min(l[n],r),c[n]=Math.max(c[n],r)}const u=[];for(let h=0;h<8;h++){const n=[...e];t.b0(n,n,t.a$([],a,1&~h?-1:1)),t.b0(n,n,t.a$([],s,1==(h>>1&1)?1:-1)),t.b0(n,n,t.a$([],o,1==(h>>2&1)?1:-1)),u.push(n)}return new Cn(u,[[...a,-t.b5(a,u[0])],[...s,-t.b5(s,u[0])],[...o,-t.b5(o,u[0])],[-a[0],-a[1],-a[2],-t.b5(a,u[7])],[-s[0],-s[1],-s[2],-t.b5(s,u[7])],[-o[0],-o[1],-o[2],-t.b5(o,u[7])]],l,c)}intersectsFrustum(e){let t=!0;const n=this.points.length,r=this.planes.length,i=e.planes.length,a=e.points.length;for(let s=0;s<i;s++){const r=e.planes[s];let i=0;for(let e=0;e<n;e++){const t=this.points[e];r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0&&i++}if(0===i)return 0;i<n&&(t=!1)}if(t)return 2;for(let s=0;s<r;s++){const t=this.planes[s];let n=0;for(let r=0;r<a;r++){const i=e.points[r];t[0]*i[0]+t[1]*i[1]+t[2]*i[2]+t[3]>=0&&n++}if(0===n)return 0}return 1}intersectsPlane(e){const t=this.points.length;let n=0;for(let r=0;r<t;r++){const t=this.points[r];e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0&&n++}return n===t?2:0===n?0:1}}function En(e,t,n){const r=e-t;return r<0?-r:Math.max(0,r-n)}function In(e,t,n,r,i){const a=e-n;let s;return s=a<0?Math.min(-a,1+a-i):a>1?Math.min(Math.max(a-i,0),1-a):0,Math.max(s,En(t,r,i))}class Pn{constructor(){this._boundingVolumeCache=new Tn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,t,n,r){const i=1<<n.z,a=1/i,s=n.x/i,o=n.y/i;let l=2;return l=Math.min(l,In(e,t,s,o,a)),l=Math.min(l,In(e,t,s+.5,-o-a,a)),l=Math.min(l,In(e,t,s+.5,2-o-a,a)),l}getWrap(e,t,n){const r=1<<t.z,i=1/r,a=t.x/r,s=En(e.x,a,i),o=En(e.x,a-1,i),l=En(e.x,a+1,i),c=Math.min(s,o,l);return c===l?1:c===o?-1:0}allowVariableZoom(e,t){return Ce(e,t)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,t,n,r){return this._boundingVolumeCache.getTileBoundingVolume(e,t,n,r)}_computeTileBoundingVolume(e,n,r,i){var a,s;let o=0,l=0;if(null==i?void 0:i.terrain){const c=new t.a2(e.z,n,e.z,e.x,e.y),u=i.terrain.getMinMaxElevation(c);o=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,r),l=null!==(s=u.maxElevation)&&void 0!==s?s:Math.max(0,r)}if(o/=t.bE,l/=t.bE,o+=1,l+=1,e.z<=0)return Cn.fromAabb([-l,-l,-l],[l,l,l]);if(1===e.z)return Cn.fromAabb([0===e.x?-l:0,0===e.y?0:-l,-l],[0===e.x?0:l,0===e.y?l:0,l]);{const n=[gn(0,0,e.x,e.y,e.z),gn(t.a5,0,e.x,e.y,e.z),gn(t.a5,t.a5,e.x,e.y,e.z),gn(0,t.a5,e.x,e.y,e.z)],r=[];for(const e of n)r.push(t.a$([],e,l));if(l!==o)for(const e of n)r.push(t.a$([],e,o));0===e.y&&r.push([0,1,0]),e.y===(1<<e.z)-1&&r.push([0,-1,0]);const i=[1,1,1],a=[-1,-1,-1];for(const e of r)for(let t=0;t<3;t++)i[t]=Math.min(i[t],e[t]),a[t]=Math.max(a[t],e[t]);const s=gn(t.a5/2,t.a5/2,e.x,e.y,e.z),c=t.b4([],[0,1,0],s);t.b3(c,c);const u=t.b4([],s,c);t.b3(u,u);const h=t.b4([],n[2],n[1]);t.b3(h,h);const d=t.b4([],n[0],n[3]);t.b3(d,d),r.push(t.a$([],s,l)),e.y>=(1<<e.z)/2&&r.push(t.a$([],gn(t.a5/2,0,e.x,e.y,e.z),l)),e.y<(1<<e.z)/2&&r.push(t.a$([],gn(t.a5/2,t.a5,e.x,e.y,e.z),l));const p=Mn(s,r),f=Mn(u,r),m=[-s[0],-s[1],-s[2],p.max],g=[s[0],s[1],s[2],-p.min],y=[-u[0],-u[1],-u[2],f.max],_=[u[0],u[1],u[2],-f.min],v=[...h,0],x=[...d,0],b=[];return 0===e.y?b.push(t.bD(x,v,m),t.bD(x,v,g)):b.push(t.bD(y,v,m),t.bD(y,v,g),t.bD(y,x,m),t.bD(y,x,g)),e.y===(1<<e.z)-1?b.push(t.bD(x,v,m),t.bD(x,v,g)):b.push(t.bD(_,v,m),t.bD(_,v,g),t.bD(_,x,m),t.bD(_,x,g)),new Cn(b,[m,g,y,_,v,x],i,a)}}}function Mn(e,n){let r=1/0,i=-1/0;for(const a of n){const n=t.b5(e,a);r=Math.min(r,n),i=Math.max(i,n)}return{min:r,max:i}}class An{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){this._helper.resize(e,t)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=t.bF(),this._projectionMatrix=t.bj(),this._globeViewProjMatrix32f=t.bi(),this._globeViewProjMatrixNoCorrection=t.bj(),this._globeViewProjMatrixNoCorrectionInverted=t.bj(),this._globeProjMatrixInverted=t.bj(),this._cameraPosition=t.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(e,n)=>{const r=t.an(e.lat,-t.ao,t.ao),i=t.an(+n,this.minZoom+bn(0,r),this.maxZoom);return{center:new t.V(e.lng,r),zoom:i}},this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new $t({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._coveringTilesDetailsProvider=new Pn}clone(){const e=new An;return e.apply(this,!1),e}apply(e,t,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e,t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=t.bA();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:t,applyGlobeMatrix:n}=e,r=this._helper.getMercatorTileCoordinates(t);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:r,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,r=this.cameraToCenterDistance/e,i=Math.sin(n)*r,a=Math.cos(n)*r+1,s=1/Math.sqrt(i*i+a*a)*1;let o=-i,l=a;const c=Math.sqrt(o*o+l*l);o/=c,l/=c;const u=[0,o,l];t.bG(u,u,[0,0,0],-this.bearingInRadians),t.bH(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),t.bI(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/t.b7(u);return t.a$(u,u,h),[...u,-s*h]}isLocationOccluded(e){return!this.isSurfacePointVisible(yn(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,r=this._helper._center.lat*Math.PI/180,i=Math.cos(r),a=[Math.sin(n)*i,Math.sin(r),Math.cos(n)*i],s=[a[2],0,-a[0]],o=[0,0,0];t.b4(o,s,a),t.b3(s,s),t.b3(o,o);const l=[0,0,0];return t.b3(l,[s[0]*e[0]+o[0]*e[1]+a[0]*e[2],s[1]*e[0]+o[1]*e[1]+a[1]*e[2],s[2]*e[0]+o[2]*e[1]+a[2]*e[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,r){const i=function(e,n,r){const i=1/(1<<r.z);return new t.a9(e/t.a5*i+r.x*i,n/t.a5*i+r.y*i)}(e,n,r.canonical),a=(s=i.y,[t.bz(i.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI]);var s;return this.getCircleRadiusCorrection()/Math.cos(a[1])}projectTileCoordinates(e,n,r,i){const a=r.canonical,s=gn(e,n,a.x,a.y,a.z),o=1+(i?i(e,n):0)/t.bE,l=[s[0]*o,s[1]*o,s[2]*o,1];t.aH(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]<0;return{point:new t.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=_n(this.worldSize,this.center.lat),n=t.bk(),r=t.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),t.be(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const i=this.centerOffset;n[8]=2*-i.x/this._helper._width,n[9]=2*i.y/this._helper._height,this._projectionMatrix=t.bf(n),this._globeProjMatrixInverted=t.bk(),t.aB(this._globeProjMatrixInverted,n),t.O(n,n,[0,0,-this.cameraToCenterDistance]),t.bg(n,n,this.rollInRadians),t.bh(n,n,-this.pitchInRadians),t.bg(n,n,this.bearingInRadians),t.O(n,n,[0,0,-e]);const a=t.bA();a[0]=e,a[1]=e,a[2]=e,t.bh(r,n,this.center.lat*Math.PI/180),t.bJ(r,r,-this.center.lng*Math.PI/180),t.Q(r,r,a),this._globeViewProjMatrixNoCorrection=r,t.bh(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bJ(n,n,-this.center.lng*Math.PI/180),t.Q(n,n,a),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=t.bk(),t.aB(this._globeViewProjMatrixNoCorrectionInverted,r);const s=t.bA();this._cameraPosition=t.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/e,t.bG(this._cameraPosition,this._cameraPosition,s,-this.rollInRadians),t.bH(this._cameraPosition,this._cameraPosition,s,this.pitchInRadians),t.bG(this._cameraPosition,this._cameraPosition,s,-this.bearingInRadians),t.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bH(this._cameraPosition,this._cameraPosition,s,-this.center.lat*Math.PI/180),t.bI(this._cameraPosition,this._cameraPosition,s,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const o=t.bf(this._globeViewProjMatrixNoCorrectionInverted);t.Q(o,o,[1,1,-1]),this._cachedFrustum=Zt.fromInvProjectionMatrix(o,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){t.w("calculateFogMatrix is not supported on globe projection.");const n=t.bk();return t.ar(n),n}getVisibleUnwrappedCoordinates(e){return[new t.bc(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const r=yn(e);t.a$(r,r,1+n/t.bE);const i=t.bF();return t.aH(i,[r[0],r[1],r[2],1],this._globeViewProjMatrixNoCorrection),i[2]/i[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,r=[new t.P(0,0),new t.P(e,0),new t.P(this.width,0),new t.P(this.width,n),new t.P(this.width,this.height),new t.P(e,this.height),new t.P(0,this.height),new t.P(0,n)],i=[];for(const t of r)i.push(this.unprojectScreenPoint(t));let a=0,s=0,o=0,l=0;const c=this.center;for(const h of i){const e=t.bK(c.lng,h.lng),n=t.bK(c.lat,h.lat);e<s&&(s=e),e>a&&(a=e),n<l&&(l=n),n>o&&(o=n)}const u=[c.lng+s,c.lat+l,c.lng+a,c.lat+o];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new Z(u)}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}setLocationAtPoint(e,n){const r=yn(this.unprojectScreenPoint(n)),i=yn(e),a=t.bA();t.bL(a);const s=t.bA();t.bI(s,r,a,-this.center.lng*Math.PI/180),t.bH(s,s,a,this.center.lat*Math.PI/180);const o=i[0]*i[0]+i[2]*i[2],l=s[0]*s[0];if(o<l)return;const c=Math.sqrt(o-l),u=-c,h=t.bM(i[0],i[2],s[0],c),d=t.bM(i[0],i[2],s[0],u),p=t.bA();t.bI(p,i,a,-h);const f=t.bM(p[1],p[2],s[1],s[2]),m=t.bA();t.bI(m,i,a,-d);const g=t.bM(m[1],m[2],s[1],s[2]),y=.5*Math.PI,_=f>=-y&&f<=y,v=g>=-y&&g<=y;let x,b;if(_&&v){const e=this.center.lng*Math.PI/180,n=this.center.lat*Math.PI/180;t.bN(h,e)+t.bN(f,n)<t.bN(d,e)+t.bN(g,n)?(x=h,b=f):(x=d,b=g)}else if(_)x=h,b=f;else{if(!v)return;x=d,b=g}const w=x/Math.PI*180,S=b/Math.PI*180,k=this.center.lat;this.setCenter(new t.V(w,t.an(S,-90,90))),this.setZoom(this.zoom+bn(k,this.center.lat))}locationToScreenPoint(e,n){const r=yn(e);if(n){const i=n.getElevationForLngLatZoom(e,this._helper._tileZoom);t.a$(r,r,1+i/t.bE)}return this._projectSurfacePointToScreen(r)}_projectSurfacePointToScreen(e){const n=t.bF();return t.aH(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new t.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const t=n.pointCoordinate(e);if(t)return t}return t.a9.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}isPointOnMapSurface(e,t){const n=this._cameraPosition,r=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(n,r)}getRayDirectionFromPixel(e){const n=t.bF();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,t.aH(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const r=t.bA();r[0]=n[0]-this._cameraPosition[0],r[1]=n[1]-this._cameraPosition[1],r[2]=n[2]-this._cameraPosition[2];const i=t.bA();return t.b3(i,r),i}isSurfacePointVisible(e){const t=this._cachedClippingPlane;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=t.bF();return t.aH(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const r=t.b5(e,n),i=t.bA(),a=t.bA();t.a$(a,n,r),t.b2(i,e,a);const s=1-t.b5(i,i);if(s<0)return null;const o=t.b5(e,e)-1,l=-r+(r<0?1:-1)*Math.sqrt(s),c=o/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(e){const n=this._cameraPosition,r=this.getRayDirectionFromPixel(e),i=this.rayPlanetIntersection(n,r);if(i){const e=t.bA();t.b0(e,n,[r[0]*i.tMin,r[1]*i.tMin,r[2]*i.tMin]);const a=t.bA();return t.b3(a,e),vn(a)}const a=this._cachedClippingPlane,s=a[0]*r[0]+a[1]*r[1]+a[2]*r[2],o=-t.bb(a,n)/s,l=t.bA();if(o>0)t.b0(l,n,[r[0]*o,r[1]*o,r[2]*o]);else{const e=t.bA();t.b0(e,n,[2*r[0],2*r[1],2*r[2]]);const i=t.bb(this._cachedClippingPlane,e);t.b2(l,e,[this._cachedClippingPlane[0]*i,this._cachedClippingPlane[1]*i,this._cachedClippingPlane[2]*i])}const c=function(e){const n=t.bA();return n[0]=e[0]*-e[3],n[1]=e[1]*-e[3],n[2]=e[2]*-e[3],{center:n,radius:Math.sqrt(1-e[3]*e[3])}}(a);return vn(function(e,n,r){const i=t.bA();t.b2(i,r,e);const a=t.bA();return t.by(a,e,i,n/t.b9(i)),a}(c.center,c.radius,l))}getMatrixForModel(e,n){const r=t.V.convert(e),i=1/t.bE,a=t.bj();return t.bJ(a,a,r.lng/180*Math.PI),t.bh(a,a,-r.lat/180*Math.PI),t.O(a,a,[0,0,1+n/t.bE]),t.bh(a,a,.5*Math.PI),t.Q(a,a,[i,i,i]),a}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new t.a2(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class zn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,n=!0){this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,t){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=t,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(e,t)=>this.currentTransform.defaultConstrain(e,t),this.applyConstrain=(e,t)=>this._helper.applyConstrain(e,t),this._helper=new $t({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,t)=>this.defaultConstrain(e,t)},e),this._globeness=1,this._mercatorTransform=new Wt,this._verticalPerspectiveTransform=new An}clone(){const e=new zn;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this,!1),e}apply(e,t){this._helper.apply(e,t),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const t=this._mercatorTransform.getProjectionData(e),n=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:t.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:t.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return t.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,r){const i=this._mercatorTransform.getPitchedTextCorrection(e,n,r),a=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,r);return t.bu(i,a,this._globeness)}projectTileCoordinates(e,t,n,r){return this.currentTransform.projectTileCoordinates(e,t,n,r)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,t){return this.currentTransform.lngLatToCameraDepth(e,t)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,t,n,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,r)}setLocationAtPoint(e,t){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,t),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(e,t),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(e,t){return this.currentTransform.locationToScreenPoint(e,t)}screenPointToMercatorCoordinate(e,t){return this.currentTransform.screenPointToMercatorCoordinate(e,t)}screenPointToLocation(e,t){return this.currentTransform.screenPointToLocation(e,t)}isPointOnMapSurface(e,t){return this.currentTransform.isPointOnMapSurface(e,t)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,t){return this.currentTransform.getMatrixForModel(e,t)}getProjectionDataForCustomLayer(e=!0){const t=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return t;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return n.fallbackMatrix=t.mainMatrix,n}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Dn{get useGlobeControls(){return!0}handlePanInertia(e,n){const r=wn(e,n);return Math.abs(r.lng-n.center.lng)>180&&(r.lng=n.center.lng+179.5*Math.sign(r.lng-n.center.lng)),{easingCenter:r,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const r=e.around,i=n.screenPointToLocation(r);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const a=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const s=n.zoom-a;if(0===s)return;const o=t.bK(n.center.lng,i.lng),l=o/(Math.abs(o/180)+1),c=t.bK(n.center.lat,i.lat),u=n.getRayDirectionFromPixel(r),h=n.cameraPosition,d=-1*t.b5(h,u),p=t.bA();t.b0(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=t.b7(p)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=_n(n.worldSize,n.center.lat)/Math.min(n.width,n.height),y=t.bx(g,.9,.5,1,.25),_=(1-t.aq(-s))*Math.min(m,y),v=n.center.lat,x=n.zoom,b=new t.V(n.center.lng+l*_,t.an(n.center.lat+c*_,-t.ao,t.ao));n.setLocationAtPoint(i,r);const w=n.center,S=t.bx(Math.abs(o),45,85,0,1),k=t.bx(g,.75,.35,0,1),T=Math.pow(Math.max(S,k),.25),C=t.bK(w.lng,b.lng),E=t.bK(w.lat,b.lat);n.setCenter(new t.V(w.lng+C*T,w.lat+E*T).wrap()),n.setZoom(x+bn(v,n.center.lat))}handleMapControlsPan(e,t,n){if(!e.panDelta)return;const r=t.center.lat,i=t.zoom;t.setCenter(wn(e.panDelta,t).wrap()),t.setZoom(i+bn(r,t.center.lat))}cameraForBoxAndBearing(e,n,r,i,a){const s=Kt(e,n,r,i,a),o=n.left/a.width*2-1,l=(a.width-n.right)/a.width*2-1,c=n.top/a.height*-2+1,u=(a.height-n.bottom)/a.height*-2+1,h=t.bK(r.getWest(),r.getEast())<0,d=h?r.getEast():r.getWest(),p=h?r.getWest():r.getEast(),f=Math.max(r.getNorth(),r.getSouth()),m=Math.min(r.getNorth(),r.getSouth()),g=d+.5*t.bK(d,p),y=f+.5*t.bK(f,m),_=a.clone();_.setCenter(s.center),_.setBearing(s.bearing),_.setPitch(0),_.setRoll(0),_.setZoom(s.zoom);const v=_.modelViewProjectionMatrix,x=[yn(r.getNorthWest()),yn(r.getNorthEast()),yn(r.getSouthWest()),yn(r.getSouthEast()),yn(new t.V(p,y)),yn(new t.V(d,y)),yn(new t.V(g,f)),yn(new t.V(g,m))],b=yn(s.center);let w=Number.POSITIVE_INFINITY;for(const t of x)o<0&&(w=Dn.getLesserNonNegativeNonNull(w,Dn.solveVectorScale(t,b,v,"x",o))),l>0&&(w=Dn.getLesserNonNegativeNonNull(w,Dn.solveVectorScale(t,b,v,"x",l))),c>0&&(w=Dn.getLesserNonNegativeNonNull(w,Dn.solveVectorScale(t,b,v,"y",c))),u<0&&(w=Dn.getLesserNonNegativeNonNull(w,Dn.solveVectorScale(t,b,v,"y",u)));if(Number.isFinite(w)&&0!==w)return s.zoom=_.zoom+t.at(w),s;Xt()}handleJumpToCenterZoom(e,n){const r=e.center.lat,i=e.applyConstrain(n.center?t.V.convert(n.center):e.center,e.zoom).center;e.setCenter(i.wrap());const a=void 0!==n.zoom?+n.zoom:e.zoom+bn(r,i.lat);e.zoom!==a&&e.setZoom(a)}handleEaseTo(e,n){const r=e.zoom,i=e.center,a=e.padding,s={roll:e.roll,pitch:e.pitch,bearing:e.bearing},o={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},l=void 0!==n.zoom,c=!e.isPaddingEqual(n.padding);let u=!1;const h=n.center?t.V.convert(n.center):i,d=e.applyConstrain(h,r).center;Ut(e,d);const p=e.clone();p.setCenter(d),p.setZoom(l?+n.zoom:r+bn(i.lat,h.lat)),p.setBearing(n.bearing);const f=new t.P(t.an(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.an(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));p.setLocationAtPoint(d,f);const m=(n.offset&&n.offsetAsPoint.mag())>0?p.center:d,g=l?+n.zoom:r+bn(i.lat,m.lat),y=r+bn(i.lat,0),_=g+bn(m.lat,0),v=t.bK(i.lng,m.lng),x=t.bK(i.lat,m.lat),b=t.aq(_-y);return u=g!==r,{easeFunc:r=>{if(t.bo(s,o)||Yt({startEulerAngles:s,endEulerAngles:o,tr:e,k:r,useSlerp:s.roll!=o.roll}),c&&e.interpolatePadding(a,n.padding,r),n.around)t.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const t=_>y?Math.min(2,b):Math.max(.5,b),n=Math.pow(t,1-r),a=kn(i,v,x,r*n);e.setCenter(a.wrap())}if(u){const n=t.G.number(y,_,r)+bn(0,e.center.lat);e.setZoom(n)}},isZooming:u,elevationCenter:m}}handleFlyTo(e,n){const r=void 0!==n.zoom,i=e.center,a=e.zoom,s=e.padding,o=!e.isPaddingEqual(n.padding),l=e.applyConstrain(t.V.convert(n.center||n.locationAtOffset),a).center,c=r?+n.zoom:e.zoom+bn(e.center.lat,l.lat),u=e.clone();u.setCenter(l),u.setZoom(c),u.setBearing(n.bearing);const h=new t.P(t.an(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.an(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));u.setLocationAtPoint(l,h);const d=u.center;Ut(e,d);const p=function(e,n,r){const i=yn(n),a=yn(r),s=t.b5(i,a),o=Math.acos(s),l=mn(e);return o/(2*Math.PI)*l}(e,i,d),f=a+bn(i.lat,0),m=c+bn(d.lat,0),g=t.aq(m-f);let y;if("number"==typeof n.minZoom){const r=+n.minZoom+bn(d.lat,0),i=Math.min(r,f,m)+bn(0,d.lat),a=e.applyConstrain(d,i).zoom+bn(d.lat,0);y=t.aq(a-f)}const _=t.bK(i.lng,d.lng),v=t.bK(i.lat,d.lat);return{easeFunc:(r,a,l,u)=>{const h=kn(i,_,v,l);o&&e.interpolatePadding(s,n.padding,r);const p=1===r?d:h;e.setCenter(p.wrap());const m=f+t.at(a);e.setZoom(1===r?c:m+bn(0,p.lat))},scaleOfZoom:g,targetCenter:d,scaleOfMinZoom:y,pixelPathLength:p}}static solveVectorScale(e,t,n,r,i){const a="x"===r?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],s=[n[3],n[7],n[11],n[15]],o=e[0]*a[0]+e[1]*a[1]+e[2]*a[2],l=e[0]*s[0]+e[1]*s[1]+e[2]*s[2],c=t[0]*a[0]+t[1]*a[1]+t[2]*a[2],u=t[0]*s[0]+t[1]*s[1]+t[2]*s[2];return c+i*l===o+i*u||s[3]*(o-c)+a[3]*(u-l)+o*u==c*l?null:(c+a[3]-i*u-i*s[3])/(c-o-i*u+i*l)}static getLesserNonNegativeNonNull(e,t){return null!==t&&t>=0&&t<e?t:e}}class Rn{constructor(e){this._globe=e,this._mercatorCameraHelper=new Qt,this._verticalPerspectiveCameraHelper=new Dn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,t){return this.currentHelper.handlePanInertia(e,t)}handleMapControlsRollPitchBearingZoom(e,t){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,t)}handleMapControlsPan(e,t,n){this.currentHelper.handleMapControlsPan(e,t,n)}cameraForBoxAndBearing(e,t,n,r,i){return this.currentHelper.cameraForBoxAndBearing(e,t,n,r,i)}handleJumpToCenterZoom(e,t){this.currentHelper.handleJumpToCenterZoom(e,t)}handleEaseTo(e,t){return this.currentHelper.handleEaseTo(e,t)}handleFlyTo(e,t){return this.currentHelper.handleFlyTo(e,t)}}const Ln=(e,n)=>t.B(e,n&&n.filter(e=>"source.canvas"!==e.identifier)),Nn=t.bO();class jn extends t.E{constructor(e,n={}){var r,i;super(),this._rtlPluginLoaded=()=>{for(const e in this.tileManagers){const t=this.tileManagers[e].getSource().type;"vector"!==t&&"geojson"!==t||this.tileManagers[e].reload()}},this.map=e,this.dispatcher=new B(O(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(e,t)=>this.getGlyphs(e,t)),this.dispatcher.registerMessageHandler("GI",(e,t)=>this.getImages(e,t)),this.dispatcher.registerMessageHandler("GDA",(e,t)=>this.getDashes(e,t)),this.imageManager=new w,this.imageManager.setEventedParent(this);const a=(null===(r=e._container)||void 0===r?void 0:r.lang)||"undefined"!=typeof document&&(null===(i=document.documentElement)||void 0===i?void 0:i.lang)||void 0;this.glyphManager=new E(e._requestManager,n.localIdeographFontFamily,a),this.lineAtlas=new D(256,512),this.crossTileSymbolIndex=new zt,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",t.bP()),ce().on(se,this._rtlPluginLoaded),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.tileManagers[e.sourceId];if(!t)return;const n=t.getSource();if(n&&n.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===n.id&&this._validateLayer(e)}})}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new t.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new((null===(e=this.crossTileSymbolIndex)||void 0===e?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,n){var r,i,a;this._checkLoaded();const s=null===n?null!==(a=null===(i=null===(r=this.stylesheet.state)||void 0===r?void 0:r[e])||void 0===i?void 0:i.default)&&void 0!==a?a:null:n;if(t.bR(s,this._globalState[e]))return this;this._globalState[e]=s,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const r in e)!t.bR(this._globalState[r],e[r].default)&&(n.push(r),this._globalState[r]=e[r].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(e){if(0===e.length)return;const t=new Set,n={};for(const r of e){n[r]=this._globalState[r];for(const e in this._layers){const n=this._layers[e],i=n.getLayoutAffectingGlobalStateRefs(),a=n.getPaintAffectingGlobalStateRefs(),s=n.getVisibilityAffectingGlobalStateRefs();if(i.has(r)&&t.add(n.source),a.has(r))for(const{name:e,value:t}of a.get(r))this._updatePaintProperty(n,e,t);(null==s?void 0:s.has(r))&&(n.recalculateVisibility(),this._updateLayer(n))}}this.dispatcher.broadcast("UGS",n);for(const r in this.tileManagers)t.has(r)&&(this._reloadSource(r),this._changed=!0)}loadURL(e,n={},r){this.fire(new t.l("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const i=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const a=this._loadStyleRequest;t.j(i,this._loadStyleRequest).then(e=>{this._loadStyleRequest=null,this._load(e.data,n,r)}).catch(e=>{this._loadStyleRequest=null,e&&!a.signal.aborted&&this.fire(new t.k(e))})}loadJSON(e,n={},r){this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest,this.map._ownerWindow).then(()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(e,n,r)}).catch(()=>{})}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(Nn,{validate:!1})}_load(e,n,r){var i,a;let s=n.transformStyle?n.transformStyle(r,e):e;if(!n.validate||!Ln(this,t.C(s))){s=Object.assign({},s),this._loaded=!0,this.stylesheet=s;for(const e in s.sources)this.addSource(e,s.sources[e],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new M(this.stylesheet.light),this._setProjectionInternal((null===(i=this.stylesheet.projection)||void 0===i?void 0:i.type)||"mercator"),this.sky=new z(this.stylesheet.sky),this.map.setTerrain(null!==(a=this.stylesheet.terrain)&&void 0!==a?a:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){var e,n,r;const i=t.bS(this.stylesheet.layers);this.setGlobalState(null!==(e=this.stylesheet.state)&&void 0!==e?e:null),this.dispatcher.broadcast("SL",i),this._order=i.map(e=>e.id),this._layers={},this._serializedLayers=null;for(const a of i){const e=t.bT(a,this._globalState);if(e.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=e,t.bU(e)&&this.tileManagers[e.source]){const t=null!==(r=null===(n=a.paint)||void 0===n?void 0:n["raster-fade-duration"])&&void 0!==r?r:e.paint.get("raster-fade-duration");this.tileManagers[e.source].setRasterFadeDuration(t)}}}_loadSprite(e,n=!1,r=void 0){this.imageManager.setLoaded(!1);const i=new AbortController;let a;this._spriteRequest=i,function(e,n,r,i){return t._(this,void 0,void 0,function*(){const a=v(e),s=r>1?"@2x":"",l={},c={};for(const{id:e,url:r}of a){const a=n.transformRequest(x(r,s,".json"),"SpriteJSON");l[e]=t.j(a,i);const o=n.transformRequest(x(r,s,".png"),"SpriteImage");c[e]=y.getImage(o,i)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,n){return t._(this,void 0,void 0,function*(){const t={};for(const r in e){t[r]={};const i=o.getImageCanvasContext((yield n[r]).data),a=(yield e[r]).data;for(const e in a){const{width:n,height:s,x:o,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=a[e];t[r][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:n,height:s,x:o,y:l,context:i}}}}return t})}(l,c)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const r=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter(t=>!(t in e)):[];for(const e of r)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const i in e[t]){const r="default"===t?i:`${t}:${i}`;this._spritesImagesIds[t].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,e[t][i],!1):this.imageManager.addImage(r,e[t][i]),n&&(this._changedImages[r]=!0)}}}).catch(e=>{this._spriteRequest=null,a=e,i.signal.aborted||this.fire(new t.k(a))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),r&&r(a)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.tileManagers[e.source];if(!n)return;const r=e.sourceLayer;if(!r)return;const i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.k(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const r=this._serializedAllLayers();if(!e||0===e.length)return Object.values(n?t.bV(r):r);const i=[];for(const a of e)if(r[a]){const e=n?t.bV(r[a]):r[a];i.push(e)}return i}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const n of t){const t=this._layers[n];"custom"!==t.type&&(e[n]=t.serialize())}return e}hasTransitions(){var e,t,n;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(t=this.sky)||void 0===t?void 0:t.hasTransition())return!0;if(null===(n=this.projection)||void 0===n?void 0:n.hasTransition())return!0;for(const r in this.tileManagers)if(this.tileManagers[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const r in this._updatedPaintProps)this._layers[r].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this.tileManagers){const e=this.tileManagers[t];r[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)&&n.source&&(this.tileManagers[n.source].used=!0)}for(const i in r){const e=this.tileManagers[i];!!r[i]!=!!e.used&&e.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:i}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var r;this._checkLoaded();const i=this.serialize();if(e=n.transformStyle?n.transformStyle(i,e):e,(null===(r=n.validate)||void 0===r||r)&&Ln(this,t.C(e)))return!1;(e=t.bV(e)).layers=t.bS(e.layers);const a=t.bW(i,e),s=this._getOperationsToPerform(a);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const t of s.operations)t();return this.stylesheet=e,this._serializedLayers=null,this.fire(new t.l("style.load",{style:this})),!0}_getOperationsToPerform(e){const t=[],n=[];for(const r of e)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":t.push(()=>this.addLayer.apply(this,r.args));break;case"removeLayer":t.push(()=>this.removeLayer.apply(this,r.args));break;case"setPaintProperty":t.push(()=>this.setPaintProperty.apply(this,r.args));break;case"setLayoutProperty":t.push(()=>this.setLayoutProperty.apply(this,r.args));break;case"setFilter":t.push(()=>this.setFilter.apply(this,r.args));break;case"addSource":t.push(()=>this.addSource.apply(this,r.args));break;case"removeSource":t.push(()=>this.removeSource.apply(this,r.args));break;case"setLayerZoomRange":t.push(()=>this.setLayerZoomRange.apply(this,r.args));break;case"setLight":t.push(()=>this.setLight.apply(this,r.args));break;case"setGeoJSONSourceData":t.push(()=>this.setGeoJSONSourceData.apply(this,r.args));break;case"setGlyphs":t.push(()=>this.setGlyphs.apply(this,r.args));break;case"setSprite":t.push(()=>this.setSprite.apply(this,r.args));break;case"setTerrain":t.push(()=>this.map.setTerrain.apply(this,r.args));break;case"setSky":t.push(()=>this.setSky.apply(this,r.args));break;case"setProjection":this.setProjection.apply(this,r.args);break;case"setGlobalState":t.push(()=>this.setGlobalState.apply(this,r.args));break;case"setTransition":t.push(()=>{});break;default:n.push(r.command)}return{operations:t,unimplemented:n}}addImage(e,n){if(this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,r={}){if(this._checkLoaded(),void 0!==this.tileManagers[e])throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.C.source,`sources.${e}`,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=this.tileManagers[e]=new Ne(e,n,this.dispatcher);i.style=this,i.setEventedParent(this,()=>({isSourceLoaded:i.loaded(),source:i.serialize(),sourceId:e})),i.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===e)return this.fire(new t.k(new Error(`Source "${e}" cannot be removed while layer "${r}" is using it.`)));const n=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],n.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error(`There is no source with this ID=${e}`);const n=this.tileManagers[e].getSource();if("geojson"!==n.type)throw new Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(t),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,n,r={}){this._checkLoaded();const i=e.id;if(this.getLayer(i))return void this.fire(new t.k(new Error(`Layer "${i}" already exists on this map.`)));let a;if("custom"===e.type){if(Ln(this,t.bX(e)))return;a=t.bT(e,this._globalState)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(i,e.source),e=t.bV(e),e=t.e(e,{source:i})),this._validate(t.C.layer,`layers.${i}`,e,{arrayIndex:-1},r))return;a=t.bT(e,this._globalState),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}})}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)this.fire(new t.k(new Error(`Cannot add layer "${i}" before non-existing layer "${n}".`)));else{if(this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=a,this._removedLayers[i]&&a.source&&"custom"!==a.type){const e=this._removedLayers[i];delete this._removedLayers[i],e.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.tileManagers[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const r=this._order.indexOf(e);this._order.splice(r,1);const i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,r){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,r={}){this._checkLoaded();const i=this.getLayer(e);if(i){if(!t.bR(i.filter,n))return null==n?(i.setFilter(void 0),void this._updateLayer(i)):void(this._validate(t.C.filter,`layers.${i.id}.filter`,n,null,r)||(i.setFilter(t.bV(n)),this._updateLayer(i)))}else this.fire(new t.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.bV(this.getLayer(e).filter)}setLayoutProperty(e,n,r,i={}){this._checkLoaded();const a=this.getLayer(e);a?t.bR(a.getLayoutProperty(n),r)||(a.setLayoutProperty(n,r,i),this._updateLayer(a)):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,r,i={}){this._checkLoaded();const a=this.getLayer(e);a?t.bR(a.getPaintProperty(n),r)||this._updatePaintProperty(a,n,r,i):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,n,r,i={}){e.setPaintProperty(n,r,i)&&this._updateLayer(e),t.bU(e)&&"raster-fade-duration"===n&&this.tileManagers[e.source].setRasterFadeDuration(r),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,n){this._checkLoaded();const r=e.source,i=e.sourceLayer,a=this.tileManagers[r];if(void 0===a)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const s=a.getSource().type;"geojson"===s&&i?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||i?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),a.setFeatureState(i,e.id,n)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const r=e.source,i=this.tileManagers[r];if(void 0===i)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const a=i.getSource().type,s="vector"===a?e.sourceLayer:void 0;"vector"!==a||s?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(s,e.id,n):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,r=e.sourceLayer,i=this.tileManagers[n];if(void 0!==i)return"vector"!==i.getSource().type||r?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.bY(this.tileManagers,e=>e.serialize()),n=this._serializeByIds(this._order,!0),r=this.map.getTerrain()||void 0,i=this.stylesheet;return t.bZ({version:i.version,name:i.name,metadata:i.metadata,light:i.light,sky:i.sky,center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch,sprite:i.sprite,glyphs:i.glyphs,transition:i.transition,projection:i.projection,sources:e,layers:n,terrain:r},e=>void 0!==e)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.tileManagers[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},r=[];for(let a=this._order.length-1;a>=0;a--){const i=this._order[a];if(t(i)){n[i]=a;for(const t of e){const e=t[i];if(e)for(const t of e)r.push(t)}}}r.sort((e,t)=>t.intersectionZ-e.intersectionZ);const i=[];for(let a=this._order.length-1;a>=0;a--){const s=this._order[a];if(t(s))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(n[t.layer.id]<a)break;i.push(t),r.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)i.push(t.feature)}}return i}queryRenderedFeatures(e,n,r){n&&n.filter&&this._validate(t.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const i={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];i[n.source]=!0}}const a=[];n.availableImages=this._availableImages;const s=this._serializedAllLayers(),o=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,l=Object.assign(Object.assign({},n),{layers:o,globalState:this._globalState});for(const t in this.tileManagers)n.layers&&!i[t]||a.push(q(this.tileManagers[t],this._layers,s,e,l,r,this.map.terrain?(e,t,n)=>this.map.terrain.getElevation(e,t,n):void 0));return this.placement&&a.push(function(e,t,n,r,i,a,s){const o={},l=a.queryRenderedSymbols(r),c=[];for(const u of Object.keys(l).map(Number))c.push(s[u]);c.sort($);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,{filterSpec:i.filter,globalState:i.globalState},i.layers,i.availableImages,e);for(const e in n){const t=o[e]=o[e]||[],r=n[e];r.sort((e,t)=>{const n=u.featureSortOrder;if(n){const r=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex});for(const e of r)t.push(e)}}return function(e,t,n){for(const r in e)for(const i of e[r])G(i,n[t[r].source]);return e}(o,e,n)}(this._layers,s,this.tileManagers,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(e,n){(null==n?void 0:n.filter)&&this._validate(t.C.filter,"querySourceFeatures.filter",n.filter,null,n);const r=this.tileManagers[e];return r?function(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),r=[],i={};for(let a=0;a<n.length;a++){const e=n[a],s=e.tileID.canonical.key;i[s]||(i[s]=!0,e.querySourceFeatures(r,t))}return r}(r,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const r=this.light.getLight();let i=!1;for(const s in e)if(!t.bR(e[s],r[s])){i=!0;break}if(!i)return;const a={now:c(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const r=this.getSky();let i=!1;if(!e&&!r)return;if(e&&!r)i=!0;else if(!e&&r)i=!0;else for(const s in e)if(!t.bR(e[s],r[s])){i=!0;break}if(!i)return;const a={now:c(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(a)}_setProjectionInternal(e){const n=function(e,n){const r={constrainOverride:n};if(Array.isArray(e)){const t=new fn({type:e});return{projection:t,transform:new zn(r),cameraHelper:new Rn(t)}}switch(e){case"mercator":return{projection:new Bt,transform:new Wt(r),cameraHelper:new Qt};case"globe":{const e=new fn({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new zn(r),cameraHelper:new Rn(e)}}case"vertical-perspective":return{projection:new dn,transform:new An(r),cameraHelper:new Dn};default:return t.w(`Unknown projection name: ${e}. Falling back to mercator projection.`),{projection:new Bt,transform:new Wt(r),cameraHelper:new Qt}}}(e,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const t in this.tileManagers)this.tileManagers[t].reload()}_validate(e,n,r,i,a={}){return(!a||!1!==a.validate)&&Ln(this,e.call(t.C,t.e({key:n,style:this.serialize(),value:r,styleSpec:t.u},i)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ce().off(se,this._rtlPluginLoaded);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.tileManagers){const e=this.tileManagers[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const t in this.tileManagers)this.tileManagers[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,t,n,r,i=!1){let a=!1,s=!1;const o={};for(const l of this._order){const t=this._layers[l];if("symbol"!==t.type)continue;if(!o[t.source]){const e=this.tileManagers[t.source];o[t.source]=e.getRenderableIds(!0).map(t=>e.getTileByID(t)).sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(t,o[t.source],e.center.lng);a=a||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((i=i||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c(),e.zoom))&&(this.pauseablePlacement=new Et(e,this.map.terrain,this._order,i,t,n,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,o),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const l of this._order){const e=this._layers[l];"symbol"===e.type&&this.placement.updateLayerOpacities(e,o[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,n){return t._(this,void 0,void 0,function*(){const e=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const t=this.tileManagers[n.source];return t&&t.setDependencies(n.tileID.key,n.type,n.icons),e})}getGlyphs(e,n){return t._(this,void 0,void 0,function*(){const e=yield this.glyphManager.getGlyphs(n.stacks),t=this.tileManagers[n.source];return t&&t.setDependencies(n.tileID.key,n.type,[""]),e})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(t.C.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,n){return t._(this,void 0,void 0,function*(){const e={};for(const[t,r]of Object.entries(n.dashes))e[t]=this.lineAtlas.getDash(r.dasharray,r.round);return e})}addSprite(e,n,r={},i){this._checkLoaded();const a=[{id:e,url:n}],s=[...v(this.stylesheet.sprite),...a];this._validate(t.C.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(a,!0,i))}removeSprite(e){this._checkLoaded();const n=v(this.stylesheet.sprite);if(n.find(t=>t.id===e)){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;n.splice(n.findIndex(t=>t.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return v(this.stylesheet.sprite)}setSprite(e,n={},r){this._checkLoaded(),e&&this._validate(t.C.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const t=this.tileManagers[e];t.setEventedParent(null),t.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const t=this._layers[e];t.setEventedParent(null),t.onRemove&&t.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Fn=t.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class On{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,r,i,a,s,o,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==r.length;for(let u=0;!c&&u<r.length;u++)this.boundPaintVertexBuffers[u]!==r[u]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==o||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,n,r,i,a,s,o,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),i&&i.dynamicDraw&&i.bind(),o&&o.bind(),l&&l.bind())}freshBind(e,t,n,r,i,a,s,o){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=o,t.enableAttributes(u,e);for(const h of n)h.enableAttributes(u,e);a&&a.enableAttributes(u,e),s&&s.enableAttributes(u,e),o&&o.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const h of n)h.bind(),h.setVertexAttribPointers(u,e,i);a&&(a.bind(),a.setVertexAttribPointers(u,e,i)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,i)),o&&(o.bind(),o.setVertexAttribPointers(u,e,i)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Bn=(e,n,r,i,a)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:r?r.properties.get("fog-color"):t.bp.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?0:r?r.calculateFogBlendOpacity(i):0,u_horizon_color:r?r.properties.get("horizon-color"):t.bp.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:a?1:0}),Vn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Un(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const r=e[n].split(" ");t.push(r.pop())}return t}class qn{constructor(e,n,r,i,a,s,o,l,c=[]){const u=e.gl;this.program=u.createProgram();const h=Un(n.staticAttributes),d=r?r.getBinderAttributes():[],p=h.concat(d),f=Rt.prelude.staticUniforms?Un(Rt.prelude.staticUniforms):[],m=o.staticUniforms?Un(o.staticUniforms):[],g=n.staticUniforms?Un(n.staticUniforms):[],y=r?r.getBinderUniforms():[],_=f.concat(m).concat(g).concat(y),v=[];for(const t of _)v.indexOf(t)<0&&v.push(t);const x=r?r.defines():[];on(u)&&x.unshift("#version 300 es"),a&&x.push("#define OVERDRAW_INSPECTOR;"),s&&x.push("#define TERRAIN3D;"),l&&x.push(l),c&&x.push(...c);let b=x.concat(Rt.prelude.fragmentSource,o.fragmentSource,n.fragmentSource).join("\n"),w=x.concat(Rt.prelude.vertexSource,o.vertexSource,n.vertexSource).join("\n");on(u)||(b=b.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("),w=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const S=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,b),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(S)}`);u.attachShader(this.program,S);const k=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(k,w),u.compileShader(k),!u.getShaderParameter(k,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(k)}`);u.attachShader(this.program,k),this.attributes={};const T={};this.numAttributes=p.length;for(let t=0;t<this.numAttributes;t++)p[t]&&(u.bindAttribLocation(this.program,t,p[t]),this.attributes[p[t]]=t);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(k),u.deleteShader(S);for(let t=0;t<v.length;t++){const e=v[t];if(e&&!T[e]){const t=u.getUniformLocation(this.program,e);t&&(T[e]=t)}}this.fixedUniforms=i(e,T),this.terrainUniforms=((e,n)=>({u_depth:new t.b_(e,n.u_depth),u_terrain:new t.b_(e,n.u_terrain),u_terrain_dim:new t.bq(e,n.u_terrain_dim),u_terrain_matrix:new t.c0(e,n.u_terrain_matrix),u_terrain_unpack:new t.c1(e,n.u_terrain_unpack),u_terrain_exaggeration:new t.bq(e,n.u_terrain_exaggeration)}))(e,T),this.projectionUniforms=((e,n)=>({u_projection_matrix:new t.c0(e,n.u_projection_matrix),u_projection_tile_mercator_coords:new t.c1(e,n.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.c1(e,n.u_projection_clipping_plane),u_projection_transition:new t.bq(e,n.u_projection_transition),u_projection_fallback_matrix:new t.c0(e,n.u_projection_fallback_matrix)}))(e,T),this.binderUniforms=r?r.getUniforms(e,T):[]}draw(e,t,n,r,i,a,s,o,l,c,u,h,d,p,f,m,g,y,_){const v=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(i),e.setCullFace(a),o){e.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,o.depthTexture),e.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,o.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(o[e])}if(l)for(const b in l)this.projectionUniforms[Vn[b]].set(l[b]);if(s)for(const b in this.fixedUniforms)this.fixedUniforms[b].set(s[b]);m&&m.setUniforms(e,this.binderUniforms,p,{zoom:f});let x=0;switch(t){case v.LINES:x=2;break;case v.TRIANGLES:x=3;break;case v.LINE_STRIP:x=1}for(const b of d.get()){const n=b.vaos||(b.vaos={});(n[c]||(n[c]=new On)).bind(e,this,u,m?m.getPaintVertexBuffers():[],h,b.vertexOffset,g,y,_),v.drawElements(t,b.primitiveLength*x,v.UNSIGNED_SHORT,b.primitiveOffset*x*2)}}}function $n(e,n,r){const i=1/t.aN(r,1,n.transform.tileZoom),a=Math.pow(2,r.tileID.overscaledZ),s=r.tileSize*Math.pow(2,n.transform.tileZoom)/a,o=s*(r.tileID.canonical.x+r.tileID.wrap*a),l=s*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,l>>16],u_pixel_coord_lower:[65535&o,65535&l]}}const Gn=(e,n,r,i)=>{const a=e.style.light,s=a.properties.get("position"),o=[s.x,s.y,s.z],l=t.c4();"viewport"===a.properties.get("anchor")&&t.c5(l,e.transform.bearingInRadians),t.c6(o,o,l);const c=e.transform.transformLightDirection(o),u=a.properties.get("color");return{u_lightpos:o,u_lightpos_globe:c,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:r,u_fill_translate:i}},Hn=(e,n,r,i,a,s,o)=>t.e(Gn(e,n,r,i),$n(s,e,o),{u_height_factor:-Math.pow(2,a.overscaledZ)/o.tileSize/8}),Zn=(e,n,r,i)=>t.e($n(n,e,r),{u_fill_translate:i}),Wn=(e,t)=>({u_world:e,u_fill_translate:t}),Xn=(e,n,r,i,a)=>t.e(Zn(e,n,r,a),{u_world:i}),Yn=(e,n,r,i,a)=>{const s=e.transform;let o,l,c=0;if("map"===r.paint.get("circle-pitch-alignment")){const e=t.aN(n,1,s.zoom);o=!0,l=[e,e],c=e/(t.a5*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*a}else o=!1,l=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_pitch_with_map:+o,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:i}},Kn=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),Qn=e=>({u_viewport_size:[e.width,e.height]}),Jn=(e,t=1)=>({u_color:e,u_overlay:0,u_overlay_scale:t}),er=(e,n,r,i)=>{const a=t.aN(e,1,n)/(t.a5*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*i;return{u_extrude_scale:t.aN(e,1,n),u_intensity:r,u_globe_extrude_scale:a}},tr=(e,n,r,i)=>{const a=t.N();t.c7(a,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:a,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:r,u_color_ramp:i,u_opacity:n.paint.get("heatmap-opacity")}},nr=(e,t,n)=>{const r=n.paint.get("hillshade-accent-color");let i;switch(n.paint.get("hillshade-method")){case"basic":i=4;break;case"combined":i=1;break;case"igor":i=2;break;case"multidirectional":i=3;break;default:i=0}const a=n.getIlluminationProperties();for(let s=0;s<a.directionRadians.length;s++)"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a.directionRadians[s]+=e.transform.bearingInRadians);return{u_image:0,u_latrange:ir(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:a.altitudeRadians,u_azimuths:a.directionRadians,u_accent:r,u_method:i,u_highlights:a.highlightColor,u_shadows:a.shadowColor}},rr=(e,n)=>{const r=n.stride,i=t.N();return t.c7(i,0,t.a5,-t.a5,0,0,1),t.O(i,i,[0,-t.a5,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}};function ir(e,n){const r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new t.a9(0,i/r).toLngLat().lat,new t.a9(0,(i+1)/r).toLngLat().lat]}const ar=(e,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:e.paint.get("color-relief-opacity")}),sr=(e,n,r,i)=>{const a=e.transform;return{u_translation:dr(e,n,r),u_ratio:i/t.aN(n,1,a.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},or=(e,n,r,i,a)=>t.e(sr(e,n,r,i),{u_image:0,u_image_height:a}),lr=(e,n,r,i,a)=>{const s=e.transform,o=hr(n,s);return{u_translation:dr(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:i/t.aN(n,1,s.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[o,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},cr=(e,n,r,i,a)=>{const s=hr(n,e.transform);return t.e(sr(e,n,r,i),{u_tileratio:s,u_crossfade_from:a.fromScale,u_crossfade_to:a.toScale,u_image:0,u_mix:a.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})},ur=(e,n,r,i,a,s)=>{const o=hr(n,e.transform);return t.e(sr(e,n,r,i),{u_image:0,u_image_height:s,u_tileratio:o,u_crossfade_from:a.fromScale,u_crossfade_to:a.toScale,u_image_dash:1,u_mix:a.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})};function hr(e,n){return 1/t.aN(e,1,n.tileZoom)}function dr(e,n,r){return t.aO(e.transform,n,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const pr=(e,t,n,r,i)=>{return{u_tl_parent:e,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:fr(r.paint.get("raster-hue-rotate")),u_coords_top:[i[0].x,i[0].y,i[1].x,i[1].y],u_coords_bottom:[i[3].x,i[3].y,i[2].x,i[2].y]};var a,s};function fr(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const mr=(e,t,n,r,i,a,s,o,l,c,u,h,d)=>{const p=s.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_label_plane_matrix:o,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+r,u_is_along_line:i,u_is_variable_anchor:a,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},gr=(e,n,r,i,a,s,o,l,c,u,h,d,p,f)=>{const m=o.transform;return t.e(mr(e,n,r,i,a,s,o,l,c,u,h,d,f),{u_gamma_scale:i?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:o.pixelRatio,u_is_halo:1})},yr=(e,n,r,i,a,s,o,l,c,u,h,d,p)=>t.e(gr(e,n,r,i,a,s,o,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),_r=(e,t)=>({u_opacity:e,u_color:t}),vr=(e,n,r,i,a)=>t.e(function(e,n,r,i){const a=r.imageManager.getPattern(e.from.toString()),s=r.imageManager.getPattern(e.to.toString()),{width:o,height:l}=r.imageManager.getPixelSize(),c=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(i.tileID.canonical.x+i.tileID.wrap*c),d=u*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:a.tl,u_pattern_br_a:a.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[o,l],u_mix:n.t,u_pattern_size_a:a.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:n.fromScale,u_scale_b:n.toScale,u_tile_units_to_pixels:1/t.aN(i,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(r,a,n,i),{u_opacity:e}),xr=(e,t)=>{},br={fillExtrusion:(e,n)=>({u_lightpos:new t.c2(e,n.u_lightpos),u_lightpos_globe:new t.c2(e,n.u_lightpos_globe),u_lightintensity:new t.bq(e,n.u_lightintensity),u_lightcolor:new t.c2(e,n.u_lightcolor),u_vertical_gradient:new t.bq(e,n.u_vertical_gradient),u_opacity:new t.bq(e,n.u_opacity),u_fill_translate:new t.c3(e,n.u_fill_translate)}),fillExtrusionPattern:(e,n)=>({u_lightpos:new t.c2(e,n.u_lightpos),u_lightpos_globe:new t.c2(e,n.u_lightpos_globe),u_lightintensity:new t.bq(e,n.u_lightintensity),u_lightcolor:new t.c2(e,n.u_lightcolor),u_vertical_gradient:new t.bq(e,n.u_vertical_gradient),u_height_factor:new t.bq(e,n.u_height_factor),u_opacity:new t.bq(e,n.u_opacity),u_fill_translate:new t.c3(e,n.u_fill_translate),u_image:new t.b_(e,n.u_image),u_texsize:new t.c3(e,n.u_texsize),u_pixel_coord_upper:new t.c3(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(e,n.u_pixel_coord_lower),u_scale:new t.c2(e,n.u_scale),u_fade:new t.bq(e,n.u_fade)}),fill:(e,n)=>({u_fill_translate:new t.c3(e,n.u_fill_translate)}),fillPattern:(e,n)=>({u_image:new t.b_(e,n.u_image),u_texsize:new t.c3(e,n.u_texsize),u_pixel_coord_upper:new t.c3(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(e,n.u_pixel_coord_lower),u_scale:new t.c2(e,n.u_scale),u_fade:new t.bq(e,n.u_fade),u_fill_translate:new t.c3(e,n.u_fill_translate)}),fillOutline:(e,n)=>({u_world:new t.c3(e,n.u_world),u_fill_translate:new t.c3(e,n.u_fill_translate)}),fillOutlinePattern:(e,n)=>({u_world:new t.c3(e,n.u_world),u_image:new t.b_(e,n.u_image),u_texsize:new t.c3(e,n.u_texsize),u_pixel_coord_upper:new t.c3(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(e,n.u_pixel_coord_lower),u_scale:new t.c2(e,n.u_scale),u_fade:new t.bq(e,n.u_fade),u_fill_translate:new t.c3(e,n.u_fill_translate)}),circle:(e,n)=>({u_camera_to_center_distance:new t.bq(e,n.u_camera_to_center_distance),u_scale_with_map:new t.b_(e,n.u_scale_with_map),u_pitch_with_map:new t.b_(e,n.u_pitch_with_map),u_extrude_scale:new t.c3(e,n.u_extrude_scale),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_globe_extrude_scale:new t.bq(e,n.u_globe_extrude_scale),u_translate:new t.c3(e,n.u_translate)}),collisionBox:(e,n)=>({u_pixel_extrude_scale:new t.c3(e,n.u_pixel_extrude_scale)}),collisionCircle:(e,n)=>({u_viewport_size:new t.c3(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.b$(e,n.u_color),u_overlay:new t.b_(e,n.u_overlay),u_overlay_scale:new t.bq(e,n.u_overlay_scale)}),depth:xr,clippingMask:xr,heatmap:(e,n)=>({u_extrude_scale:new t.bq(e,n.u_extrude_scale),u_intensity:new t.bq(e,n.u_intensity),u_globe_extrude_scale:new t.bq(e,n.u_globe_extrude_scale)}),heatmapTexture:(e,n)=>({u_matrix:new t.c0(e,n.u_matrix),u_world:new t.c3(e,n.u_world),u_image:new t.b_(e,n.u_image),u_color_ramp:new t.b_(e,n.u_color_ramp),u_opacity:new t.bq(e,n.u_opacity)}),hillshade:(e,n)=>({u_image:new t.b_(e,n.u_image),u_latrange:new t.c3(e,n.u_latrange),u_exaggeration:new t.bq(e,n.u_exaggeration),u_altitudes:new t.c9(e,n.u_altitudes),u_azimuths:new t.c9(e,n.u_azimuths),u_accent:new t.b$(e,n.u_accent),u_method:new t.b_(e,n.u_method),u_shadows:new t.c8(e,n.u_shadows),u_highlights:new t.c8(e,n.u_highlights)}),hillshadePrepare:(e,n)=>({u_matrix:new t.c0(e,n.u_matrix),u_image:new t.b_(e,n.u_image),u_dimension:new t.c3(e,n.u_dimension),u_zoom:new t.bq(e,n.u_zoom),u_unpack:new t.c1(e,n.u_unpack)}),colorRelief:(e,n)=>({u_image:new t.b_(e,n.u_image),u_unpack:new t.c1(e,n.u_unpack),u_dimension:new t.c3(e,n.u_dimension),u_elevation_stops:new t.b_(e,n.u_elevation_stops),u_color_stops:new t.b_(e,n.u_color_stops),u_color_ramp_size:new t.b_(e,n.u_color_ramp_size),u_opacity:new t.bq(e,n.u_opacity)}),line:(e,n)=>({u_translation:new t.c3(e,n.u_translation),u_ratio:new t.bq(e,n.u_ratio),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.c3(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_translation:new t.c3(e,n.u_translation),u_ratio:new t.bq(e,n.u_ratio),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.c3(e,n.u_units_to_pixels),u_image:new t.b_(e,n.u_image),u_image_height:new t.bq(e,n.u_image_height)}),linePattern:(e,n)=>({u_translation:new t.c3(e,n.u_translation),u_texsize:new t.c3(e,n.u_texsize),u_ratio:new t.bq(e,n.u_ratio),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_image:new t.b_(e,n.u_image),u_units_to_pixels:new t.c3(e,n.u_units_to_pixels),u_scale:new t.c2(e,n.u_scale),u_fade:new t.bq(e,n.u_fade)}),lineSDF:(e,n)=>({u_translation:new t.c3(e,n.u_translation),u_ratio:new t.bq(e,n.u_ratio),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.c3(e,n.u_units_to_pixels),u_image:new t.b_(e,n.u_image),u_mix:new t.bq(e,n.u_mix),u_tileratio:new t.bq(e,n.u_tileratio),u_crossfade_from:new t.bq(e,n.u_crossfade_from),u_crossfade_to:new t.bq(e,n.u_crossfade_to),u_lineatlas_width:new t.bq(e,n.u_lineatlas_width),u_lineatlas_height:new t.bq(e,n.u_lineatlas_height)}),lineGradientSDF:(e,n)=>({u_translation:new t.c3(e,n.u_translation),u_ratio:new t.bq(e,n.u_ratio),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.c3(e,n.u_units_to_pixels),u_image:new t.b_(e,n.u_image),u_image_height:new t.bq(e,n.u_image_height),u_tileratio:new t.bq(e,n.u_tileratio),u_crossfade_from:new t.bq(e,n.u_crossfade_from),u_crossfade_to:new t.bq(e,n.u_crossfade_to),u_image_dash:new t.b_(e,n.u_image_dash),u_mix:new t.bq(e,n.u_mix),u_lineatlas_width:new t.bq(e,n.u_lineatlas_width),u_lineatlas_height:new t.bq(e,n.u_lineatlas_height)}),raster:(e,n)=>({u_tl_parent:new t.c3(e,n.u_tl_parent),u_scale_parent:new t.bq(e,n.u_scale_parent),u_buffer_scale:new t.bq(e,n.u_buffer_scale),u_fade_t:new t.bq(e,n.u_fade_t),u_opacity:new t.bq(e,n.u_opacity),u_image0:new t.b_(e,n.u_image0),u_image1:new t.b_(e,n.u_image1),u_brightness_low:new t.bq(e,n.u_brightness_low),u_brightness_high:new t.bq(e,n.u_brightness_high),u_saturation_factor:new t.bq(e,n.u_saturation_factor),u_contrast_factor:new t.bq(e,n.u_contrast_factor),u_spin_weights:new t.c2(e,n.u_spin_weights),u_coords_top:new t.c1(e,n.u_coords_top),u_coords_bottom:new t.c1(e,n.u_coords_bottom)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.b_(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(e,n.u_is_size_feature_constant),u_size_t:new t.bq(e,n.u_size_t),u_size:new t.bq(e,n.u_size),u_camera_to_center_distance:new t.bq(e,n.u_camera_to_center_distance),u_pitch:new t.bq(e,n.u_pitch),u_rotate_symbol:new t.b_(e,n.u_rotate_symbol),u_aspect_ratio:new t.bq(e,n.u_aspect_ratio),u_fade_change:new t.bq(e,n.u_fade_change),u_label_plane_matrix:new t.c0(e,n.u_label_plane_matrix),u_coord_matrix:new t.c0(e,n.u_coord_matrix),u_is_text:new t.b_(e,n.u_is_text),u_pitch_with_map:new t.b_(e,n.u_pitch_with_map),u_is_along_line:new t.b_(e,n.u_is_along_line),u_is_variable_anchor:new t.b_(e,n.u_is_variable_anchor),u_texsize:new t.c3(e,n.u_texsize),u_texture:new t.b_(e,n.u_texture),u_translation:new t.c3(e,n.u_translation),u_pitched_scale:new t.bq(e,n.u_pitched_scale)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.b_(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(e,n.u_is_size_feature_constant),u_size_t:new t.bq(e,n.u_size_t),u_size:new t.bq(e,n.u_size),u_camera_to_center_distance:new t.bq(e,n.u_camera_to_center_distance),u_pitch:new t.bq(e,n.u_pitch),u_rotate_symbol:new t.b_(e,n.u_rotate_symbol),u_aspect_ratio:new t.bq(e,n.u_aspect_ratio),u_fade_change:new t.bq(e,n.u_fade_change),u_label_plane_matrix:new t.c0(e,n.u_label_plane_matrix),u_coord_matrix:new t.c0(e,n.u_coord_matrix),u_is_text:new t.b_(e,n.u_is_text),u_pitch_with_map:new t.b_(e,n.u_pitch_with_map),u_is_along_line:new t.b_(e,n.u_is_along_line),u_is_variable_anchor:new t.b_(e,n.u_is_variable_anchor),u_texsize:new t.c3(e,n.u_texsize),u_texture:new t.b_(e,n.u_texture),u_gamma_scale:new t.bq(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_is_halo:new t.b_(e,n.u_is_halo),u_translation:new t.c3(e,n.u_translation),u_pitched_scale:new t.bq(e,n.u_pitched_scale)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.b_(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(e,n.u_is_size_feature_constant),u_size_t:new t.bq(e,n.u_size_t),u_size:new t.bq(e,n.u_size),u_camera_to_center_distance:new t.bq(e,n.u_camera_to_center_distance),u_pitch:new t.bq(e,n.u_pitch),u_rotate_symbol:new t.b_(e,n.u_rotate_symbol),u_aspect_ratio:new t.bq(e,n.u_aspect_ratio),u_fade_change:new t.bq(e,n.u_fade_change),u_label_plane_matrix:new t.c0(e,n.u_label_plane_matrix),u_coord_matrix:new t.c0(e,n.u_coord_matrix),u_is_text:new t.b_(e,n.u_is_text),u_pitch_with_map:new t.b_(e,n.u_pitch_with_map),u_is_along_line:new t.b_(e,n.u_is_along_line),u_is_variable_anchor:new t.b_(e,n.u_is_variable_anchor),u_texsize:new t.c3(e,n.u_texsize),u_texsize_icon:new t.c3(e,n.u_texsize_icon),u_texture:new t.b_(e,n.u_texture),u_texture_icon:new t.b_(e,n.u_texture_icon),u_gamma_scale:new t.bq(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bq(e,n.u_device_pixel_ratio),u_is_halo:new t.b_(e,n.u_is_halo),u_translation:new t.c3(e,n.u_translation),u_pitched_scale:new t.bq(e,n.u_pitched_scale)}),background:(e,n)=>({u_opacity:new t.bq(e,n.u_opacity),u_color:new t.b$(e,n.u_color)}),backgroundPattern:(e,n)=>({u_opacity:new t.bq(e,n.u_opacity),u_image:new t.b_(e,n.u_image),u_pattern_tl_a:new t.c3(e,n.u_pattern_tl_a),u_pattern_br_a:new t.c3(e,n.u_pattern_br_a),u_pattern_tl_b:new t.c3(e,n.u_pattern_tl_b),u_pattern_br_b:new t.c3(e,n.u_pattern_br_b),u_texsize:new t.c3(e,n.u_texsize),u_mix:new t.bq(e,n.u_mix),u_pattern_size_a:new t.c3(e,n.u_pattern_size_a),u_pattern_size_b:new t.c3(e,n.u_pattern_size_b),u_scale_a:new t.bq(e,n.u_scale_a),u_scale_b:new t.bq(e,n.u_scale_b),u_pixel_coord_upper:new t.c3(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.bq(e,n.u_tile_units_to_pixels)}),terrain:(e,n)=>({u_texture:new t.b_(e,n.u_texture),u_ele_delta:new t.bq(e,n.u_ele_delta),u_fog_matrix:new t.c0(e,n.u_fog_matrix),u_fog_color:new t.b$(e,n.u_fog_color),u_fog_ground_blend:new t.bq(e,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.bq(e,n.u_fog_ground_blend_opacity),u_horizon_color:new t.b$(e,n.u_horizon_color),u_horizon_fog_blend:new t.bq(e,n.u_horizon_fog_blend),u_is_globe_mode:new t.bq(e,n.u_is_globe_mode)}),terrainDepth:(e,n)=>({u_ele_delta:new t.bq(e,n.u_ele_delta)}),terrainCoords:(e,n)=>({u_texture:new t.b_(e,n.u_texture),u_terrain_coords_id:new t.bq(e,n.u_terrain_coords_id),u_ele_delta:new t.bq(e,n.u_ele_delta)}),projectionErrorMeasurement:(e,n)=>({u_input:new t.bq(e,n.u_input),u_output_expected:new t.bq(e,n.u_output_expected)}),atmosphere:(e,n)=>({u_sun_pos:new t.c2(e,n.u_sun_pos),u_atmosphere_blend:new t.bq(e,n.u_atmosphere_blend),u_globe_position:new t.c2(e,n.u_globe_position),u_globe_radius:new t.bq(e,n.u_globe_radius),u_inv_proj_matrix:new t.c0(e,n.u_inv_proj_matrix)}),sky:(e,n)=>({u_sky_color:new t.b$(e,n.u_sky_color),u_horizon_color:new t.b$(e,n.u_horizon_color),u_horizon:new t.c3(e,n.u_horizon),u_horizon_normal:new t.c3(e,n.u_horizon_normal),u_sky_horizon_blend:new t.bq(e,n.u_sky_horizon_blend),u_sky_blend:new t.bq(e,n.u_sky_blend)})};class wr{constructor(e,t,n){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kr{constructor(e,t,n,r){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],a=t.attributes[i.name];void 0!==a&&e.vertexAttribPointer(a,i.components,e[Sr[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cr extends Tr{getDefault(){return t.bp.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Er extends Tr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ir extends Tr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Pr extends Tr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Mr extends Tr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ar extends Tr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class zr extends Tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Dr extends Tr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Rr extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Lr extends Tr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Nr extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class jr extends Tr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fr extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Or extends Tr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Br extends Tr{getDefault(){return t.bp.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Vr extends Tr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ur extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class qr extends Tr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class $r extends Tr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Gr extends Tr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Hr extends Tr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Zr extends Tr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Wr extends Tr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Xr extends Tr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Yr extends Tr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Kr extends Tr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Qr extends Tr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Jr extends Tr{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const n=this.gl;on(n)?n.bindVertexArray(e):null===(t=n.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ei extends Tr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ti extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ni extends Tr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ri extends Tr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ii extends ri{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ai extends ri{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class si extends ri{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const oi="Framebuffer is not complete";class li{constructor(e,t,n,r,i){this.context=e,this.width=t,this.height=n;const a=e.gl,s=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new ii(e,s),r)this.depthAttachment=i?new si(e,s):new ai(e,s);else if(i)throw new Error("Stencil cannot be set without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error(oi)}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class ci{constructor(e){var t,n;if(this.gl=e,this.clearColor=new Cr(this),this.clearDepth=new Er(this),this.clearStencil=new Ir(this),this.colorMask=new Pr(this),this.depthMask=new Mr(this),this.stencilMask=new Ar(this),this.stencilFunc=new zr(this),this.stencilOp=new Dr(this),this.stencilTest=new Rr(this),this.depthRange=new Lr(this),this.depthTest=new Nr(this),this.depthFunc=new jr(this),this.blend=new Fr(this),this.blendFunc=new Or(this),this.blendColor=new Br(this),this.blendEquation=new Vr(this),this.cullFace=new Ur(this),this.cullFaceSide=new qr(this),this.frontFace=new $r(this),this.program=new Gr(this),this.activeTexture=new Hr(this),this.viewport=new Zr(this),this.bindFramebuffer=new Wr(this),this.bindRenderbuffer=new Xr(this),this.bindTexture=new Yr(this),this.bindVertexBuffer=new Kr(this),this.bindElementBuffer=new Qr(this),this.bindVertexArray=new Jr(this),this.pixelStoreUnpack=new ei(this),this.pixelStoreUnpackPremultiplyAlpha=new ti(this),this.pixelStoreUnpackFlipY=new ni(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),on(e)){this.HALF_FLOAT=e.HALF_FLOAT;const r=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(n=e.RGB16F)&&void 0!==n?n:null==r?void 0:r.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new wr(this,e,t)}createVertexBuffer(e,t,n){return new kr(this,e,t,n)}createRenderbuffer(e,t,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,n,r){return new li(this,e,t,n,r)}clear({color:e,depth:t,stencil:n}){const r=this.gl;let i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(i|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),r.clear(i)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bR(e.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return on(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return on(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let ui;function hi(e,n,r,i,a){const s=e.context,o=e.transform,l=s.gl,c=e.useProgram("collisionBox"),u=[];let h=0,d=0;for(let t=0;t<i.length;t++){const p=i[t],f=n.getTile(p).getBucket(r);if(!f)continue;const m=a?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:d,coord:p}),h+=g.length/4,d=h),m&&c.draw(s,l.LINES,nn.disabled,an.disabled,e.colorModeForRenderPass(),tn.disabled,Kn(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),o.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,e.transform.zoom,null,null,m.collisionVertexBuffer)}if(!a||!u.length)return;const p=e.useProgram("collisionCircle"),f=new t.ca;f.resize(4*h),f._trim();let m=0;for(const t of u)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,r=t.circleArray[n+0],i=t.circleArray[n+1],a=t.circleArray[n+2],s=t.circleArray[n+3];f.emplace(m++,r,i,a,s,0),f.emplace(m++,r,i,a,s,1),f.emplace(m++,r,i,a,s,2),f.emplace(m++,r,i,a,s,3)}(!ui||ui.length<2*h)&&(ui=function(e){const n=2*e,r=new t.cc;r.resize(n),r._trim();for(let t=0;t<n;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(h));const g=s.createIndexBuffer(ui,!0),y=s.createVertexBuffer(f,t.cb.members,!0);for(const _ of u){const n=Qn(e.transform);p.draw(s,l.TRIANGLES,nn.disabled,an.disabled,e.colorModeForRenderPass(),tn.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(_.coord),null,r.id,y,g,t.aX.simpleSegment(0,2*_.circleOffset,_.circleArray.length,_.circleArray.length/2),null,e.transform.zoom,null,null,null)}y.destroy(),g.destroy()}const di=t.ar(new Float32Array(16));function pi(e,n,r,i,a,s){const{horizontalAlign:o,verticalAlign:l}=t.aS(e);return new t.P((-(o-.5)*n/a+i[0])*s,(-(l-.5)*r/a+i[1])*s)}function fi(e,n,r,i,a,s){const o=n.tileAnchorPoint.add(new t.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let e=i.mult(s);r||(e=e.rotate(-a));const t=o.add(e);return qe(t.x,t.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(r){const t=Qe(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(e),r=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(i.rotate(r))}return e.add(i)}function mi(e,n,r,i,a,s,o,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let y=0;y<p.length;y++){const m=p.get(y),_=m.hidden||!m.crossTileID||e.allowVerticalPlacement&&!m.placedOrientation?null:i[m.crossTileID];if(_){const i=new t.P(m.anchorX,m.anchorY),p={getElevation:d,width:a.width,height:a.height,pitchedLabelPlaneMatrix:s,pitchWithMap:r,transform:a,tileAnchorPoint:i,translation:u,unwrappedTileID:h},y=r?et(i.x,i.y,p):Qe(i.x,i.y,p),v=$e(a.cameraToCenterDistance,y.signedDistanceFromCamera);let x=t.aA(e.textSizeData,l,m)*v/t.aM;r&&(x*=e.tilePixelRatio/o);const{width:b,height:w,anchor:S,textOffset:k,textBoxScale:T}=_,C=pi(S,b,w,k,T,x),E=a.getPitchedTextCorrection(i.x+u[0],i.y+u[1],h),I=fi(y.point,p,n,C,-a.bearingInRadians,E),P=e.allowVerticalPlacement&&m.placedOrientation===t.az.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.aG(f,I,P);c&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:I,angle:P})}else at(m.numGlyphs,f)}if(c){m.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const r=n.get(e);if(r.hidden)at(r.numGlyphs,m);else{const n=g[e];if(n)for(let e=0;e<r.numGlyphs;e++)t.aG(m,n.shiftedAnchor,n.angle);else at(r.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function gi(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function yi(e,n,r,i,a,s,o,l,c,u,h,d,p){const f=e.context,m=f.gl,g=e.transform,y="map"===l,_="map"===c,v="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),x=y&&!_&&!v,b=!r.layout.get("symbol-sort-key").isConstant();let w=!1;const S=e.getDepthModeForSublayer(0,nn.ReadOnly),k=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=[],C=g.getCircleRadiusCorrection();for(const E of i){const i=n.getTile(E),l=i.getBucket(r);if(!l)continue;const c=a?l.text:l.icon;if(!c||!c.segments.get().length||!c.hasVisibleVertices)continue;const h=c.programConfigurations.get(r.id),d=a||l.sdfIcons,f=a?l.textSizeData:l.iconSizeData,S=_||0!==g.pitch,I=e.useProgram(gi(d,a,l),h),P=t.ay(f,g.zoom),M=e.style.map.terrain&&e.style.map.terrain.getTerrainData(E);let A,z,D,R,L=[0,0],N=null;if(a)z=i.glyphAtlasTexture,D=m.LINEAR,A=i.glyphAtlasTexture.size,l.iconsInText&&(L=i.imageAtlasTexture.size,N=i.imageAtlasTexture,R=S||e.options.rotating||e.options.zooming||"composite"===f.kind||"camera"===f.kind?m.LINEAR:m.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;z=i.imageAtlasTexture,D=d||e.options.rotating||e.options.zooming||t||S?m.LINEAR:m.NEAREST,A=i.imageAtlasTexture.size}const j=t.aN(i,1,e.transform.zoom),F=Be(y,e.transform,j),O=t.N();t.aB(O,F);const B=Ve(_,y,e.transform,j),V=t.aO(g,i,s,o),U=g.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),q=k&&l.hasTextData(),$="none"!==r.layout.get("icon-text-fit")&&q&&l.hasIconData();if(v){const t=e.style.map.terrain?(t,n)=>e.style.map.terrain.getElevation(E,t,n):null,n="map"===r.layout.get("text-rotation-alignment");He(l,e,a,F,O,_,u,n,E.toUnwrapped(),g.width,g.height,V,t)}const G=a&&k||$,H=v||G?di:_?F:e.transform.clipSpaceToPixelsMatrix,Z=d&&0!==r.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let W;W=d?l.iconsInText?yr(f.kind,P,x,_,v,G,e,H,B,V,A,L,C):gr(f.kind,P,x,_,v,G,e,H,B,V,a,A,0,C):mr(f.kind,P,x,_,v,G,e,H,B,V,a,A,C);const X={program:I,buffers:c,uniformValues:W,projectionData:U,atlasTexture:z,atlasTextureIcon:N,atlasInterpolation:D,atlasInterpolationIcon:R,isSDF:d,hasHalo:Z};if(b&&l.canOverlap){w=!0;const e=c.segments.get();for(const n of e)T.push({segments:new t.aX([n]),sortKey:n.sortKey,state:X,terrainData:M})}else T.push({segments:c.segments,sortKey:0,state:X,terrainData:M})}w&&T.sort((e,t)=>e.sortKey-t.sortKey);for(const t of T){const n=t.state;if(f.activeTexture.set(m.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,_i(n.buffers,t.segments,r,e,n.program,S,h,d,i,n.projectionData,t.terrainData)),i.u_is_halo=0}_i(n.buffers,t.segments,r,e,n.program,S,h,d,n.uniformValues,n.projectionData,t.terrainData)}}function _i(e,t,n,r,i,a,s,o,l,c,u){const h=r.context;i.draw(h,h.gl.TRIANGLES,a,s,o,tn.backCCW,l,u,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function vi(e,n,r,i,a){const s=e.context,o=s.gl,l=an.disabled,c=new Jt([o.ONE,o.ONE],t.bp.transparent,[!0,!0,!0,!0]),u=n.getBucket(r);if(!u)return;const h=i.key;let d=r.heatmapFbos.get(h);d||(d=bi(s,n.tileSize,n.tileSize),r.heatmapFbos.set(h,d)),s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,n.tileSize,n.tileSize]),s.clear({color:t.bp.transparent});const p=u.programConfigurations.get(r.id),f=e.useProgram("heatmap",p,!a),m=e.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=e.style.map.terrain.getTerrainData(i);f.draw(s,o.TRIANGLES,nn.disabled,l,c,tn.disabled,er(n,e.transform.zoom,r.paint.get("heatmap-intensity"),1),g,m,r.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,r.paint,e.transform.zoom,p)}function xi(e,t,n,r,i){const a=e.context,s=a.gl,o=e.transform;a.setColorMode(e.colorModeForRenderPass());const l=wi(a,t),c=n.key,u=t.heatmapFbos.get(c);if(!u)return;a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get()),a.activeTexture.set(s.TEXTURE1),l.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=o.getProjectionData({overscaledTileID:n,applyTerrainMatrix:i,applyGlobeMatrix:!r});e.useProgram("heatmapTexture").draw(a,s.TRIANGLES,nn.disabled,an.disabled,e.colorModeForRenderPass(),tn.disabled,tr(e,t,0,1),null,h,t.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,t.paint,o.zoom),u.destroy(),t.heatmapFbos.delete(c)}function bi(e,t,n){var r,i;const a=e.gl,s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);const o=null!==(r=e.HALF_FLOAT)&&void 0!==r?r:a.UNSIGNED_BYTE,l=null!==(i=e.RGBA16F)&&void 0!==i?i:a.RGBA;a.texImage2D(a.TEXTURE_2D,0,l,t,n,0,a.RGBA,o,null);const c=e.createFramebuffer(t,n,!1,!1);return c.colorAttachment.set(s),c}function wi(e,n){return n.colorRampTexture||(n.colorRampTexture=new t.T(e,n.colorRamp,e.gl.RGBA)),n.colorRampTexture}function Si(e,n,r,i,a,s,o,l){let c=256;if(a.stepInterpolant){const i=n.getSource().maxzoom,a=o.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;c=t.an(t.ce(s.maxLineLength/t.a5*1024*a),256,r.maxTextureSize)}return l.gradient=t.cf({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:c,image:l.gradient||void 0,clips:s.lineClipsArray}),l.texture?l.texture.update(l.gradient):l.texture=new t.T(r,l.gradient,i.RGBA),l.version=a.gradientVersion,l.texture}function ki(e,t,n,r,i){e.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),r.updatePaintBuffers(i)}function Ti(e,t,n,r,i,a){(i||e.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),e.lineAtlas.bind(t)),r.updatePaintBuffers(a)}function Ci(e,t,n,r,i,a,s){const o=a.gradients[i.id];let l=o.texture;i.gradientVersion!==o.version&&(l=Si(e,t,n,r,i,a,s,o)),n.activeTexture.set(r.TEXTURE0),l.bind(i.stepInterpolant?r.NEAREST:r.LINEAR,r.CLAMP_TO_EDGE)}function Ei(e,t,n,r,i,a,s,o,l){const c=a.gradients[i.id];let u=c.texture;i.gradientVersion!==c.version&&(u=Si(e,t,n,r,i,a,s,c)),n.activeTexture.set(r.TEXTURE0),u.bind(i.stepInterpolant?r.NEAREST:r.LINEAR,r.CLAMP_TO_EDGE),n.activeTexture.set(r.TEXTURE1),e.lineAtlas.bind(n),o.updatePaintBuffers(l)}function Ii(e,t,n,r,i){if(!n||!r||!r.imageAtlas)return;const a=r.imageAtlas.patternPositions;let s=a[n.to.toString()],o=a[n.from.toString()];if(!s&&o&&(s=o),!o&&s&&(o=s),!s||!o){const e=i.getPaintProperty(t);s=a[e],o=a[e]}s&&o&&e.setConstantPatternPositions(s,o)}function Pi(e,n,r,i,a,s,o,l){const c=e.context.gl,u="fill-pattern",h=r.paint.get(u),d=h&&h.constantOr(1),p=r.getCrossfadeParameters();let f,m,g,y,_;const v=e.transform,x=r.paint.get("fill-translate"),b=r.paint.get("fill-translate-anchor");o?(m=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const S of i){const i=n.getTile(S);if(d&&!i.patternsLoaded())continue;const h=i.getBucket(r);if(!h)continue;const k=h.programConfigurations.get(r.id),T=e.useProgram(m,k),C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(S);d&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),k.updatePaintBuffers(p)),Ii(k,u,w,i,r);const E=v.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),I=t.aO(v,i,x,b);if(o){y=h.indexBuffer2,_=h.segments2;const t=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&d?Xn(e,p,i,t,I):Wn(t,I)}else y=h.indexBuffer,_=h.segments,g=d?Zn(e,p,i,I):{u_fill_translate:I};const P=e.stencilModeForClipping(S);T.draw(e.context,f,a,P,s,tn.backCCW,g,C,E,r.id,h.layoutVertexBuffer,y,_,r.paint,e.transform.zoom,k)}}function Mi(e,n,r,i,a,s,o,l){const c=e.context,u=c.gl,h="fill-extrusion-pattern",d=r.paint.get(h),p=d.constantOr(1),f=r.getCrossfadeParameters(),m=r.paint.get("fill-extrusion-opacity"),g=d.constantOr(null),y=e.transform;for(const _ of i){const i=n.getTile(_),d=i.getBucket(r);if(!d)continue;const v=e.style.map.terrain&&e.style.map.terrain.getTerrainData(_),x=d.programConfigurations.get(r.id),b=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",x);p&&(e.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers(f));const w=y.getProjectionData({overscaledTileID:_,applyGlobeMatrix:!l,applyTerrainMatrix:!0});Ii(x,h,g,i,r);const S=t.aO(y,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),k=r.paint.get("fill-extrusion-vertical-gradient"),T=p?Hn(e,k,m,S,_,f,i):Gn(e,k,m,S);b.draw(c,c.gl.TRIANGLES,a,s,o,tn.backCCW,T,v,w,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,e.transform.zoom,x,e.style.map.terrain&&d.centroidVertexBuffer)}}function Ai(e,t,n,r,i,a,s,o,l){var c;const u=e.style.projection,h=e.context,d=e.transform,p=h.gl,f=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],m=e.useProgram("hillshade",null,!1,f),g=!e.options.moving;for(const y of r){const r=t.getTile(y),f=r.fbo;if(!f)continue;const _=u.getMeshFromTileID(h,y.canonical,o,!0,"raster"),v=null===(c=e.style.map.terrain)||void 0===c?void 0:c.getTerrainData(y);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get());const x=d.getProjectionData({overscaledTileID:y,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,p.TRIANGLES,a,i[y.overscaledZ],s,tn.backCCW,nr(e,r,n),v,x,n.id,_.vertexBuffer,_.indexBuffer,_.segments)}}function zi(e,n,r,i,a,s,o,l,c){var u;const h=e.style.projection,d=e.context,p=e.transform,f=d.gl,m=e.useProgram("colorRelief"),g=!e.options.moving;let y=!0,_=0;for(const v of i){const i=n.getTile(v),x=i.dem;if(y){const e=f.getParameter(f.MAX_TEXTURE_SIZE),{elevationTexture:t,colorTexture:n}=r.getColorRampTextures(d,e,x.getUnpackVector());d.activeTexture.set(f.TEXTURE1),t.bind(f.NEAREST,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE4),n.bind(f.LINEAR,f.CLAMP_TO_EDGE),y=!1,_=t.size[0]}if(!x||!x.data)continue;const b=x.stride,w=x.getPixels();if(d.activeTexture.set(f.TEXTURE0),d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(b),i.demTexture){const e=i.demTexture;e.update(w,{premultiply:!1}),e.bind(f.LINEAR,f.CLAMP_TO_EDGE)}else i.demTexture=new t.T(d,w,f.RGBA,{premultiply:!1}),i.demTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=h.getMeshFromTileID(d,v.canonical,l,!0,"raster"),k=null===(u=e.style.map.terrain)||void 0===u?void 0:u.getTerrainData(v),T=p.getProjectionData({overscaledTileID:v,aligned:g,applyGlobeMatrix:!c,applyTerrainMatrix:!0});m.draw(d,f.TRIANGLES,s,a[v.overscaledZ],o,tn.backCCW,ar(r,i.dem,_),k,T,r.id,S.vertexBuffer,S.indexBuffer,S.segments)}}const Di=[new t.P(0,0),new t.P(t.a5,0),new t.P(t.a5,t.a5),new t.P(0,t.a5)];function Ri(e,t,n,r,i,a,s,o,l=!1,c=!1){const u=r[r.length-1].overscaledZ,h=e.context,d=h.gl,p=e.useProgram("raster"),f=e.transform,m=e.style.projection,g=e.colorModeForRenderPass(),y=!e.options.moving,_=n.paint.get("raster-opacity"),v=n.paint.get("raster-resampling"),x=n.paint.get("raster-fade-duration"),b=!!e.style.map.terrain;for(const w of r){const r=e.getDepthModeForSublayer(w.overscaledZ-u,1===_?nn.ReadWrite:nn.ReadOnly,d.LESS),S=t.getTile(w),k="nearest"===v?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),S.texture.bind(k,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1);const{parentTile:T,parentScaleBy:C,parentTopLeft:E,fadeValues:I}=Li(S,t,x,b);S.fadeOpacity=I.tileOpacity,T?(T.fadeOpacity=I.parentTileOpacity,T.texture.bind(k,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)):S.texture.bind(k,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),S.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const P=e.style.map.terrain&&e.style.map.terrain.getTerrainData(w),M=f.getProjectionData({overscaledTileID:w,aligned:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),A=pr(E,C,I.fadeMix,n,o),z=m.getMeshFromTileID(h,w.canonical,a,s,"raster");p.draw(h,d.TRIANGLES,r,i?i[w.overscaledZ]:an.disabled,g,l?tn.frontCCW:tn.backCCW,A,P,M,n.id,z.vertexBuffer,z.indexBuffer,z.segments)}}function Li(e,n,r,i){const a={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(0===r||i)return a;if(e.fadingParentID){const i=n.getLoadedTile(e.fadingParentID);if(!i)return a;const s=Math.pow(2,i.tileID.overscaledZ-e.tileID.overscaledZ);return{parentTile:i,parentScaleBy:s,parentTopLeft:[e.tileID.canonical.x*s%1,e.tileID.canonical.y*s%1],fadeValues:function(e,n,r){const i=c(),a=(i-n.timeAdded)/r,s=e.fadingDirection===he.Incoming,o=t.an((i-e.timeAdded)/r,0,1),l=t.an(1-a,0,1),u=s?o:l;return{tileOpacity:u,parentTileOpacity:s?l:o,fadeMix:{opacity:1,mix:1-u}}}(e,i,r)}}return e.selfFading?{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:function(e,n){const r=(c()-e.timeAdded)/n,i=t.an(r,0,1);return{tileOpacity:i,fadeMix:{opacity:i,mix:0}}}(e,r)}:a}const Ni=new t.bp(1,0,0,1),ji=new t.bp(0,1,0,1),Fi=new t.bp(0,0,1,1),Oi=new t.bp(1,0,1,1),Bi=new t.bp(0,1,1,1);function Vi(e,t,n,r){qi(e,0,t+n/2,e.transform.width,n,r)}function Ui(e,t,n,r){qi(e,t-n/2,0,n,e.transform.height,r)}function qi(e,t,n,r,i,a){const s=e.context,o=s.gl;o.enable(o.SCISSOR_TEST),o.scissor(t*e.pixelRatio,n*e.pixelRatio,r*e.pixelRatio,i*e.pixelRatio),s.clear({color:a}),o.disable(o.SCISSOR_TEST)}function $i(e,n,r){const i=e.context,a=i.gl,s=e.useProgram("debug"),o=nn.disabled,l=an.disabled,c=e.colorModeForRenderPass(),u="$debug",h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);i.activeTexture.set(a.TEXTURE0);const d=n.getTileByID(r.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(r).tileSize,m=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${g} ${p}kB`);const y=e.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});s.draw(i,a.TRIANGLES,o,l,Jt.alphaBlended,tn.disabled,Jn(t.bp.transparent,m),null,y,u,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),s.draw(i,a.LINE_STRIP,o,l,c,tn.disabled,Jn(t.bp.red),h,y,u,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function Gi(e,t,n,r){const{isRenderingGlobe:i}=r,a=e.context,s=a.gl,o=e.transform,l=e.colorModeForRenderPass(),c=e.getDepthModeFor3D(),u=e.useProgram("terrain");a.bindFramebuffer.set(null),a.viewport.set([0,0,e.width,e.height]);for(const h of n){const n=t.getTerrainMesh(h.tileID),r=e.renderToTexture.getTexture(h),d=t.getTerrainData(h.tileID);a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r.texture);const p=t.getMeshFrameDelta(o.zoom),f=o.calculateFogMatrix(h.tileID.toUnwrapped()),m=Bn(p,f,e.style.sky,o.pitch,i),g=o.getProjectionData({overscaledTileID:h.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(a,s.TRIANGLES,c,an.disabled,l,tn.backCCW,m,d,g,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}function Hi(e,n){if(!n.mesh){const r=new t.aW;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const i=new t.aY;i.emplaceBack(0,1,2),i.emplaceBack(0,2,3),n.mesh=new Nt(e.createVertexBuffer(r,jt.members),e.createIndexBuffer(i),t.aX.simpleSegment(0,0,r.length,i.length))}return n.mesh}class Zi{constructor(e,n){this.context=new ci(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ne.maxOverzooming+Ne.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zt}resize(e,t,n){if(this.width=Math.floor(e*n),this.height=Math.floor(t*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style._order)this.style._layers[r].resize()}setup(){const e=this.context,n=new t.aW;n.emplaceBack(0,0),n.emplaceBack(t.a5,0),n.emplaceBack(0,t.a5),n.emplaceBack(t.a5,t.a5),this.tileExtentBuffer=e.createVertexBuffer(n,jt.members),this.tileExtentSegments=t.aX.simpleSegment(0,0,4,2);const r=new t.aW;r.emplaceBack(0,0),r.emplaceBack(t.a5,0),r.emplaceBack(0,t.a5),r.emplaceBack(t.a5,t.a5),this.debugBuffer=e.createVertexBuffer(r,jt.members),this.debugSegments=t.aX.simpleSegment(0,0,4,5);const i=new t.ch;i.emplaceBack(0,0,0,0),i.emplaceBack(t.a5,0,t.a5,0),i.emplaceBack(0,t.a5,0,t.a5),i.emplaceBack(t.a5,t.a5,t.a5,t.a5),this.rasterBoundsBuffer=e.createVertexBuffer(i,Fn.members),this.rasterBoundsSegments=t.aX.simpleSegment(0,0,4,2);const a=new t.aW;a.emplaceBack(0,0),a.emplaceBack(t.a5,0),a.emplaceBack(0,t.a5),a.emplaceBack(t.a5,t.a5),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(a,jt.members),this.rasterBoundsSegmentsPosOnly=t.aX.simpleSegment(0,0,4,5);const s=new t.aW;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,jt.members),this.viewportSegments=t.aX.simpleSegment(0,0,4,2);const o=new t.ci;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);const l=new t.aY;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new an({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new Nt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.N();t.c7(r,0,this.width,this.height,0,0,1),t.Q(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const i={mainMatrix:r,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:r};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,nn.disabled,this.stencilClearMode,Jt.disabled,tn.disabled,null,null,i,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source,this.nextStencilID+t.length>256&&this.clearStencil();const r=this.context;r.setColorMode(Jt.disabled),r.setDepthMode(nn.disabled);const i={};for(const a of t)i[a.key]=this.nextStencilID++;this._renderTileMasks(i,t,n,!0),this._renderTileMasks(i,t,n,!1),this._tileClippingMaskIDs=i}_renderTileMasks(e,t,n,r){const i=this.context,a=i.gl,s=this.style.projection,o=this.transform,l=this.useProgram("clippingMask");for(const c of t){const t=e[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=s.getMeshFromTileID(this.context,c.canonical,r,!0,"stencil"),d=o.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!n,applyTerrainMatrix:!0});l.draw(i,a.TRIANGLES,nn.disabled,new an({func:a.ALWAYS,mask:0},t,255,a.KEEP,a.KEEP,a.REPLACE),Jt.disabled,n?tn.disabled:tn.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const e=this.context,t=e.gl,n=this.style.projection,r=this.transform,i=this.useProgram("depth"),a=this.getDepthModeFor3D(),s=Ee(r,{tileSize:r.tileSize});for(const o of s){const s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(o),l=n.getMeshFromTileID(this.context,o.canonical,!0,!0,"raster"),c=r.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});i.draw(e,t.TRIANGLES,a,an.disabled,Jt.disabled,tn.backCCW,null,s,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new an({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new an({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let n=0;n<i;n++)e[n+r]=new an({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,n]}return[{[r]:an.disabled},n]}stencilConfigForOverlapTwoPass(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(this.clearStencil(),i>1){const e={},a={};for(let n=0;n<i;n++)e[n+r]=new an({func:t.GREATER,mask:255},i+1+n,255,t.KEEP,t.KEEP,t.REPLACE),a[n+r]=new an({func:t.GREATER,mask:255},1+n,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID=2*i+1,[e,a,n]}return this.nextStencilID=3,[{[r]:new an({func:t.GREATER,mask:255},2,255,t.KEEP,t.KEEP,t.REPLACE)},{[r]:new an({func:t.GREATER,mask:255},1,255,t.KEEP,t.KEEP,t.REPLACE)},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Jt([e.CONSTANT_COLOR,e.ONE],new t.bp(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Jt.unblended:Jt.alphaBlended}getDepthModeForSublayer(e,t,n){if(!this.opaquePassEnabledForLayer())return nn.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new nn(n||this.context.gl.LEQUAL,t,[r,r])}getDepthModeFor3D(){return new nn(this.context.gl.LEQUAL,nn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var r,i;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(c()),this.imageManager.beginFrame();const a=this.style._order,s=this.style.tileManagers,o={},l={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(r=e.projection)||void 0===r?void 0:r.transitionState)>0};for(const t in s){const e=s[t];e.used&&e.prepare(this.context),o[t]=e.getVisibleCoordinates(!1),l[t]=o[t].slice().reverse(),u[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<a.length;t++)if(this.style._layers[a[t]].is3D()){this.opaquePassCutoff=t;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of a){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=l[e.source];("custom"===e.type||n.length)&&this.renderLayer(this,s[e.source],e,n,h)}if(null===(i=this.style.projection)||void 0===i||i.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.bp.black:t.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,t){const n=e.context,r=n.gl,i=((e,t,n)=>{const r=Math.cos(t.rollInRadians),i=Math.sin(t.rollInRadians),a=_e(t),s=t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(t.width/2-a*i)*n,(t.height/2+a*r)*n],u_horizon_normal:[-i,r],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*t.height/2*n,u_sky_blend:s}})(t,e.style.map.transform,e.pixelRatio),a=new nn(r.LEQUAL,nn.ReadWrite,[0,1]),s=an.disabled,o=e.colorModeForRenderPass(),l=e.useProgram("sky"),c=Hi(n,t);l.draw(n,r.TRIANGLES,a,s,o,tn.disabled,i,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[a[this.currentLayer]],t=s[e.source],n=o[e.source];this._renderTileClippingMasks(e,n,!1),this.renderLayer(this,t,e,n,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=this.style._layers[a[this.currentLayer]],t=s[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const n=("symbol"===e.type?u:l)[e.source];this._renderTileClippingMasks(e,o[e.source],!!this.renderToTexture),this.renderLayer(this,t,e,n,h)}if(h.isRenderingGlobe&&function(e,n,r){const i=e.context,a=i.gl,s=e.useProgram("atmosphere"),o=new nn(a.LEQUAL,nn.ReadOnly,[0,1]),l=e.transform,c=function(e,n){const r=e.properties.get("position"),i=[-r.x,-r.y,-r.z],a=t.ar(new Float64Array(16));return"map"===e.properties.get("anchor")&&(t.bg(a,a,n.rollInRadians),t.bh(a,a,-n.pitchInRadians),t.bg(a,a,n.bearingInRadians),t.bh(a,a,n.center.lat*Math.PI/180),t.bJ(a,a,-n.center.lng*Math.PI/180)),t.cg(i,i,a),i}(r,e.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=n.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=_n(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,t.aH(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,t.aH(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((e,t,n,r,i)=>({u_sun_pos:e,u_atmosphere_blend:t,u_globe_position:n,u_globe_radius:r,u_inv_proj_matrix:i}))(c,h,[f[0],f[1],f[2]],d,p),g=Hi(i,n);s.draw(i,a.TRIANGLES,o,an.disabled,Jt.alphaBlended,tn.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,t){let n=null;const r=Object.values(e._layers).flatMap(n=>n.source&&!n.isHidden(t)?[e.tileManagers[n.source]]:[]),i=r.filter(e=>"vector"===e.getSource().type),a=r.filter(e=>"vector"!==e.getSource().type),s=e=>{(!n||n.getSource().maxzoom<e.getSource().maxzoom)&&(n=e)};return i.forEach(e=>s(e)),n||a.forEach(e=>s(e)),n}(this.style,this.transform.zoom);e&&function(e,t,n){for(let r=0;r<n.length;r++)$i(e,t,n[r])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;Vi(e,e.transform.height-(t.top||0),3,Ni),Vi(e,t.bottom||0,3,ji),Ui(e,t.left||0,3,Fi),Ui(e,e.transform.width-(t.right||0),3,Oi);const n=e.transform.centerPoint;var r,i,a,s;r=e,i=n.x,a=e.transform.height-n.y,qi(r,i-1,a-10,2,20,s=Bi),qi(r,i-10,a-1,20,2,s)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,r=this.transform.modelViewProjectionMatrix;let i=this.terrainFacilitator.dirty;i||(i=e?!t.cj(n,r):!t.ck(n,r)),i||(i=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),i&&(t.cl(n,r),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,n){const r=e.context,i=r.gl,a=e.transform,s=Jt.unblended,o=new nn(i.LEQUAL,nn.ReadWrite,[0,1]),l=n.tileManager.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.bp.transparent,depth:1});for(const t of l){const e=n.getTerrainMesh(t.tileID),l=n.getTerrainData(t.tileID),u=a.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:n.getMeshFrameDelta(a.zoom)};c.draw(r,i.TRIANGLES,o,an.disabled,s,tn.backCCW,h,l,u,"terrain",e.vertexBuffer,e.indexBuffer,e.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,n){const r=e.context,i=r.gl,a=e.transform,s=Jt.unblended,o=new nn(i.LEQUAL,nn.ReadWrite,[0,1]),l=n.getCoordsTexture(),c=n.tileManager.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.bp.transparent,depth:1}),n.coordsIndex=[];for(const t of c){const e=n.getTerrainMesh(t.tileID),c=n.getTerrainData(t.tileID);r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(a.zoom)},d=a.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(r,i.TRIANGLES,o,an.disabled,s,tn.backCCW,h,c,d,"terrain",e.vertexBuffer,e.indexBuffer,e.segments),n.coordsIndex.push(t.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,n,r,i,a){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||(i||[]).length)&&(this.id=r.id,t.cm(r)?function(e,n,r,i,a,s){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:o}=s,l=an.disabled,c=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,n,r,i,a,s,o,l,c){const u=n.transform,h=n.style.map.terrain,d="map"===a,p="map"===s;for(const f of e){const e=i.getTile(f),a=e.getBucket(r);if(!a||!a.text||!a.text.segments.get().length)continue;const s=t.ay(a.textSizeData,u.zoom),m=t.aN(e,1,n.transform.zoom),g=Be(d,n.transform,m),y="none"!==r.layout.get("icon-text-fit")&&a.hasIconData();if(s){const n=Math.pow(2,u.zoom-e.tileID.overscaledZ),r=h?(e,t)=>h.getElevation(f,e,t):null;mi(a,d,p,c,u,g,n,s,y,t.aO(u,e,o,l),f.toUnwrapped(),r)}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),a),0!==r.paint.get("icon-opacity").constantOr(1)&&yi(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),l,c,o),0!==r.paint.get("text-opacity").constantOr(1)&&yi(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),l,c,o),n.map.showCollisionBoxes&&(hi(e,n,r,i,!0),hi(e,n,r,i,!1))}(e,n,r,i,this.style.placement.variableOffsets,a):t.cn(r)?function(e,n,r,i,a){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=a,o=r.paint.get("circle-opacity"),l=r.paint.get("circle-stroke-width"),c=r.paint.get("circle-stroke-opacity"),u=!r.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=e.context,d=h.gl,p=e.transform,f=e.getDepthModeForSublayer(0,nn.ReadOnly),m=an.disabled,g=e.colorModeForRenderPass(),y=[],_=p.getCircleRadiusCorrection();for(let v=0;v<i.length;v++){const a=i[v],o=n.getTile(a),l=o.getBucket(r);if(!l)continue;const c=r.paint.get("circle-translate"),h=r.paint.get("circle-translate-anchor"),d=t.aO(p,o,c,h),f=l.programConfigurations.get(r.id),m=e.useProgram("circle",f),g=l.layoutVertexBuffer,x=l.indexBuffer,b=e.style.map.terrain&&e.style.map.terrain.getTerrainData(a),w={programConfiguration:f,program:m,layoutVertexBuffer:g,indexBuffer:x,uniformValues:Yn(e,o,r,d,_),terrainData:b,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!s,applyTerrainMatrix:!0})};if(u){const e=l.segments.get();for(const n of e)y.push({segments:new t.aX([n]),sortKey:n.sortKey,state:w})}else y.push({segments:l.segments,sortKey:0,state:w})}u&&y.sort((e,t)=>e.sortKey-t.sortKey);for(const t of y){const{programConfiguration:n,program:i,layoutVertexBuffer:a,indexBuffer:s,uniformValues:o,terrainData:l,projectionData:c}=t.state;i.draw(h,d.TRIANGLES,f,m,g,tn.backCCW,o,l,c,r.id,a,s,t.segments,r.paint,e.transform.zoom,n)}}(e,n,r,i,a):t.co(r)?function(e,n,r,i,a){if(0===r.paint.get("heatmap-opacity"))return;const s=e.context,{isRenderingToTexture:o,isRenderingGlobe:l}=a;if(e.style.map.terrain){for(const t of i){const i=n.getTile(t);n.hasRenderableParent(t)||("offscreen"===e.renderPass?vi(e,i,r,t,l):"translucent"===e.renderPass&&xi(e,r,t,o,l))}s.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,n,r,i){const a=e.context,s=a.gl,o=e.transform,l=an.disabled,c=new Jt([s.ONE,s.ONE],t.bp.transparent,[!0,!0,!0,!0]);(function(e,n,r){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,n.width/4,n.height/4]);let a=r.heatmapFbos.get(t.cd);a?(i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)):(a=bi(e,n.width/4,n.height/4),r.heatmapFbos.set(t.cd,a))})(a,e,r),a.clear({color:t.bp.transparent});for(let t=0;t<i.length;t++){const u=i[t];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(r);if(!d)continue;const p=d.programConfigurations.get(r.id),f=e.useProgram("heatmap",p),m=o.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=o.getCircleRadiusCorrection();f.draw(a,s.TRIANGLES,nn.disabled,l,c,tn.backCCW,er(h,o.zoom,r.paint.get("heatmap-intensity"),g),null,m,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,o.zoom,p)}a.viewport.set([0,0,e.width,e.height])}(e,n,r,i):"translucent"===e.renderPass&&function(e,n){const r=e.context,i=r.gl;r.setColorMode(e.colorModeForRenderPass());const a=n.heatmapFbos.get(t.cd);a&&(r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1),wi(r,n).bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,nn.disabled,an.disabled,e.colorModeForRenderPass(),tn.disabled,tr(e,n,0,1),null,null,n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom))}(e,r)}(e,n,r,i,a):t.cp(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=i,s=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===s.constantOr(1)||0===o.constantOr(1))return;const l=e.getDepthModeForSublayer(0,nn.ReadOnly),c=e.colorModeForRenderPass(),u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.paint.get("line-pattern"),p=d.constantOr(1),f=n.paint.get("line-gradient"),m=n.getCrossfadeParameters();let g;g=p?"linePattern":h&&f?"lineGradientSDF":h?"lineSDF":f?"lineGradient":"line";const y=e.context,_=y.gl,v=e.transform;let x=!0;for(const b of r){const r=t.getTile(b);if(p&&!r.patternsLoaded())continue;const i=r.getBucket(n);if(!i)continue;const s=i.programConfigurations.get(n.id),o=e.context.program.get(),w=e.useProgram(g,s),S=x||w.program!==o,k=e.style.map.terrain&&e.style.map.terrain.getTerrainData(b),T=d.constantOr(null),C=u&&u.constantOr(null);if(T&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[T.to.toString()],n=e.patternPositions[T.from.toString()];t&&n&&s.setConstantPatternPositions(t,n)}else if(C){const t="round"===n.layout.get("line-cap"),r=e.lineAtlas.getDash(C.to,t),i=e.lineAtlas.getDash(C.from,t);s.setConstantDashPositions(r,i)}const E=v.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!a,applyTerrainMatrix:!0}),I=v.getPixelScale();let P;p?(P=lr(e,r,n,I,m),ki(y,_,r,s,m)):h&&f?(P=ur(e,r,n,I,m,i.lineClipsArray.length),Ei(e,t,y,_,n,i,b,s,m)):h?(P=cr(e,r,n,I,m),Ti(e,y,_,s,S,m)):f?(P=or(e,r,n,I,i.lineClipsArray.length),Ci(e,t,y,_,n,i,b)):P=sr(e,r,n,I);const M=e.stencilModeForClipping(b);w.draw(y,_.TRIANGLES,l,M,c,tn.disabled,P,k,E,n.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,n.paint,e.transform.zoom,s,i.layoutVertexBuffer2),x=!1}}(e,n,r,i,a):t.cq(r)?function(e,n,r,i,a){const s=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0===o.constantOr(1))return;const{isRenderingToTexture:l}=a,c=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===s.constantOr(t.bp.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===h){const t=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?nn.ReadWrite:nn.ReadOnly);Pi(e,n,r,i,t,c,!1,l)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.getDepthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,nn.ReadOnly);Pi(e,n,r,i,t,c,!0,l)}}(e,n,r,i,a):t.cr(r)?function(e,t,n,r,i){const a=n.paint.get("fill-extrusion-opacity");if(0===a)return;const{isRenderingToTexture:s}=i;if("translucent"===e.renderPass){const i=new nn(e.context.gl.LEQUAL,nn.ReadWrite,e.depthRangeFor3D);if(1!==a||n.paint.get("fill-extrusion-pattern").constantOr(1))Mi(e,t,n,r,i,an.disabled,Jt.disabled,s),Mi(e,t,n,r,i,e.stencilModeFor3D(),e.colorModeForRenderPass(),s);else{const a=e.colorModeForRenderPass();Mi(e,t,n,r,i,an.disabled,a,s)}}}(e,n,r,i,a):t.cs(r)?function(e,n,r,i,a){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=a,o=e.context,l=e.style.projection.useSubdivision,c=e.getDepthModeForSublayer(0,nn.ReadOnly),u=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,n,r,i,a,s,o){const l=e.context,c=l.gl;for(const u of r){const r=n.getTile(u),h=r.dem;if(!h||!h.data)continue;if(!r.needsHillshadePrepare)continue;const d=h.dim,p=h.stride,f=h.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(p),r.demTexture){const e=r.demTexture;e.update(f,{premultiply:!1}),e.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else r.demTexture=new t.T(l,f,c.RGBA,{premultiply:!1}),r.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);let m=r.fbo;if(!m){const e=new t.T(l,{width:d,height:d,data:null},c.RGBA);e.bind(c.LINEAR,c.CLAMP_TO_EDGE),m=r.fbo=l.createFramebuffer(d,d,!0,!1),m.colorAttachment.set(e.texture)}l.bindFramebuffer.set(m.framebuffer),l.viewport.set([0,0,d,d]),e.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,a,s,o,tn.disabled,rr(r.tileID,h),null,null,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}(e,n,i,r,c,an.disabled,u),o.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(l){const[t,a,o]=e.stencilConfigForOverlapTwoPass(i);Ai(e,n,r,o,t,c,u,!1,s),Ai(e,n,r,o,a,c,u,!0,s)}else{const[t,a]=e.getStencilConfigForOverlapAndUpdateStencilID(i);Ai(e,n,r,a,t,c,u,!1,s)}}(e,n,r,i,a):t.ct(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;if(!r.length)return;const{isRenderingToTexture:a}=i,s=e.style.projection.useSubdivision,o=e.getDepthModeForSublayer(0,nn.ReadOnly),l=e.colorModeForRenderPass();if(s){const[i,s,c]=e.stencilConfigForOverlapTwoPass(r);zi(e,t,n,c,i,o,l,!1,a),zi(e,t,n,c,s,o,l,!0,a)}else{const[i,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);zi(e,t,n,s,i,o,l,!1,a)}}(e,n,r,i,a):t.bU(r)?function(e,t,n,r,i){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const{isRenderingToTexture:a}=i,s=t.getSource(),o=e.style.projection.useSubdivision;if(s instanceof te)Ri(e,t,n,r,null,!1,!1,s.tileCoords,s.flippedWindingOrder,a);else if(o){const[i,s,o]=e.stencilConfigForOverlapTwoPass(r);Ri(e,t,n,o,i,!1,!0,Di,!1,a),Ri(e,t,n,o,s,!0,!0,Di,!1,a)}else{const[i,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);Ri(e,t,n,s,i,!1,!0,Di,!1,a)}}(e,n,r,i,a):t.cu(r)?function(e,t,n,r,i){const a=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const{isRenderingToTexture:o}=i,l=e.context,c=l.gl,u=e.style.projection,h=e.transform,d=h.tileSize,p=n.paint.get("background-pattern");if(e.isPatternMissing(p))return;const f=!p&&1===a.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const m=an.disabled,g=e.getDepthModeForSublayer(0,"opaque"===f?nn.ReadWrite:nn.ReadOnly),y=e.colorModeForRenderPass(),_=e.useProgram(p?"backgroundPattern":"background"),v=r||Ee(h,{tileSize:d,terrain:e.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const x=n.getCrossfadeParameters();for(const b of v){const t=h.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!o,applyTerrainMatrix:!0}),r=p?vr(s,e,p,{tileID:b,tileSize:d},x):_r(s,a),i=e.style.map.terrain&&e.style.map.terrain.getTerrainData(b),f=u.getMeshFromTileID(l,b.canonical,!1,!0,"raster");_.draw(l,c.TRIANGLES,g,m,y,tn.backCCW,r,i,t,n.id,f.vertexBuffer,f.indexBuffer,f.segments)}}(e,0,r,i,a):t.cv(r)&&function(e,t,n,r){const{isRenderingGlobe:i}=r,a=e.context,s=n.implementation,o=e.style.projection,l=e.transform,c=l.getProjectionDataForCustomLayer(i),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:o.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${o.shaderPreludeCode.vertexSource}`,define:o.shaderDefine},defaultProjectionData:c},h=s.renderingMode?s.renderingMode:"2d";if("offscreen"===e.renderPass){const t=s.prerender;t&&(e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),t.call(s,a.gl,u),a.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),a.setStencilMode(an.disabled);const t="3d"===h?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,nn.ReadOnly);a.setDepthMode(t),s.render(a.gl,u),a.setDirty(),e.setBaseState(),a.bindFramebuffer.set(null)}}(e,0,r,a))}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}useProgram(e,t,n=!1,r=[]){this.cache=this.cache||{};const i=!!this.style.map.terrain,a=this.style.projection,s=n?Rt.projectionMercator:a.shaderPreludeCode,o=n?Ft:a.shaderDefine,l=e+(t?t.cacheKey:"")+`/${n?Ot:a.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(i?"/terrain":"")+(r?`/${r.join("/")}`:"");return this.cache[l]||(this.cache[l]=new qn(this.context,Rt[e],t,br[e],this._showOverdrawInspector,i,s,o,r)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,t;if(this._tileTextures){for(const e in this._tileTextures){const t=this._tileTextures[e];if(t)for(const e of t)e.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&(null===(e=this.tileExtentMesh.vertexBuffer)||void 0===e||e.destroy()),this.tileExtentMesh&&(null===(t=this.tileExtentMesh.indexBuffer)||void 0===t||t.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const e in this.cache){const t=this.cache[e];t&&t.program&&this.context.gl.deleteProgram(t.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}function Wi(e,t){let n,r=!1,i=null,a=null;const s=()=>{i=null,r&&(e.apply(a,n),i=setTimeout(s,t),r=!1)};return(...e)=>(r=!0,a=this,n=e,i||s(),i)}class Xi{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const t=e.join("/");let n=t;n.split("&").length>0&&(n=n.split("&")[0]),this._hashName&&(n=`${this._hashName}=${t}`);let r=window.location.hash.replace(n,"");r.startsWith("#&")?r=r.slice(0,1)+r.slice(2):"#"===r&&(r="");let i=window.location.href.replace(/(#.+)?$/,r);i=i.replace("&&","&"),window.history.replaceState(window.history.state,null,i)},this._updateHash=Wi(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const t=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),a=Math.round(t.lng*i)/i,s=Math.round(t.lat*i)/i,o=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?`/${a}/${s}/${n}`:`${n}/${s}/${a}`,(o||l)&&(c+="/"+Math.round(10*o)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const e=this._hashName;let t=!1;const n=window.location.hash.slice(1).split("&").map(n=>{const r=n.split("=")[0];return r===e?(t=!0,`${r}=${c}`):n}).filter(e=>e);return t||n.push(`${e}=${c}`),`#${n.join("&")}`}return`#${c}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new t.V(+e[2],+e[1])}catch(a){return!1}const n=+e[0],r=+(e[3]||0),i=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&r>=-180&&r<=180&&i>=this._map.getMinPitch()&&i<=this._map.getMaxPitch()}}const Yi={linearity:.3,easing:t.cw(0,0,.3,1)},Ki=t.e({deceleration:2500,maxSpeed:1400},Yi),Qi=t.e({deceleration:20,maxSpeed:1400},Yi),Ji=t.e({deceleration:1e3,maxSpeed:360},Yi),ea=t.e({deceleration:1e3,maxSpeed:90},Yi),ta=t.e({deceleration:1e3,maxSpeed:360},Yi);class na{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=c();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,n.roll+=t.rollDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const a=ia(n.pan.mag(),r,t.e({},Ki,e||{})),s=n.pan.mult(a.amount/n.pan.mag()),o=this._map.cameraHelper.handlePanInertia(s,this._map.transform);i.center=o.easingCenter,i.offset=o.easingOffset,ra(i,a)}if(n.zoom){const e=ia(n.zoom,r,Qi),a=t.cx(this._map.transform.zoom+e.amount,this._map.getZoomSnap(),e.amount);i.zoom=a,ra(i,e)}if(n.bearing){const e=ia(n.bearing,r,Ji);i.bearing=this._map.transform.bearing+t.an(e.amount,-179,179),ra(i,e)}if(n.pitch){const e=ia(n.pitch,r,ea);i.pitch=this._map.transform.pitch+e.amount,ra(i,e)}if(n.roll){const e=ia(n.roll,r,ta);i.roll=this._map.transform.roll+t.an(e.amount,-179,179),ra(i,e)}if(i.zoom||i.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(i,{noMoveStart:!0})}}function ra(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ia(e,n,r){const{maxSpeed:i,linearity:a,deceleration:s}=r,o=t.an(e*a/(n/1e3),-i,i),l=Math.abs(o)/(s*a);return{easing:r.easing,duration:1e3*l,amount:o*(l/2)}}class aa extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r,i={}){r=r instanceof MouseEvent?r:new MouseEvent(e,r);const a=u.mousePos(n.getCanvas(),r),s=n.unproject(a);super(e,t.e({point:a,lngLat:s,originalEvent:r},i)),this._defaultPrevented=!1,this.target=n}}class sa extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r){const i="touchend"===e?r.changedTouches:r.touches,a=u.touchPos(n.getCanvasContainer(),i),s=a.map(e=>n.unproject(e)),o=a.reduce((e,t,n,r)=>e.add(t.div(r.length)),new t.P(0,0));super(e,{points:a,point:o,lngLats:s,lngLat:n.unproject(o),originalEvent:r}),this._defaultPrevented=!1}}class oa extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class la{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new oa(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new aa(e.type,this._map,e))}mouseup(e){this._map.fire(new aa(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new aa(e.type,this._map,e))}dblclick(e){return this._firePreventable(new aa(e.type,this._map,e))}mouseover(e){this._map.fire(new aa(e.type,this._map,e))}mouseout(e){this._map.fire(new aa(e.type,this._map,e))}touchstart(e){return this._firePreventable(new sa(e.type,this._map,e))}touchmove(e){this._map.fire(new sa(e.type,this._map,e))}touchend(e){this._map.fire(new sa(e.type,this._map,e))}touchcancel(e){this._map.fire(new sa(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new aa(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new aa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new aa(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ua{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this._map.terrain)}}class ha{constructor(e,t){this._map=e,this._tr=new ua(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=n,this._box||(this._box=u.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const i=Math.min(r.x,n.x),a=Math.max(r.x,n.x),s=Math.min(r.y,n.y),o=Math.max(r.y,n.y);u.setTransform(this._box,`translate(${i}px,${s}px)`),this._box.style.width=a-i+"px",this._box.style.height=o-s+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,i=n;if(this.reset(),u.suppressClick(),r.x!==i.x||r.y!==i.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,i,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(u.remove(this._box),this._box=null),u.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.l(e,{originalEvent:n}))}}function da(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class pa{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const n=new t.P(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=da(r,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const r=da(n,t);for(const i in this.touches){const e=r[i];(!e||e.dist(this.touches[i])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class fa{constructor(e){this.singleTap=new pa(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const r=this.singleTap.touchend(e,t,n);if(r){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class ma{constructor(e){this._tr=new ua(e),this._zoomIn=new fa({numTouches:1,numTaps:2}),this._zoomOut=new fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,n,r){const i=this._zoomIn.touchend(e,n,r),a=this._zoomOut.touchend(e,n,r),s=this._tr;return i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:n=>n.easeTo({duration:300,zoom:t.cx(s.zoom+1,n.getZoomSnap()),around:s.unproject(i)},{originalEvent:e})}):a?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:n=>n.easeTo({duration:300,zoom:t.cx(s.zoom-1,n.getZoomSnap()),around:s.unproject(a)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ga{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(t)?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const r=Array.isArray(t)?t[0]:t;return!this._moved&&r.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(n,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&u.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ya=0,_a=2,va={[ya]:1,[_a]:2};class xa{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=u.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const n=va[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton)}isValidEndEvent(e){return u.mouseButton(e)===this._eventButton}}class ba{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class wa{constructor(e=new xa({checkCorrectEvent:()=>!0}),t=new ba){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=t}_executeRelevantHandler(e,t,n){return e instanceof MouseEvent?t(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?n(e):void 0}startMove(e){this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.startMove(e),e=>this.oneFingerTouchMoveStateManager.startMove(e))}endMove(e){this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.endMove(e),e=>this.oneFingerTouchMoveStateManager.endMove(e))}isValidStartEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidStartEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e))}isValidMoveEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidMoveEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e))}isValidEndEvent(e){return this._executeRelevantHandler(e,e=>this.mouseMoveStateManager.isValidEndEvent(e),e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e))}}const Sa=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class ka{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active){if(!this._shouldBePrevented(n.length))return e.preventDefault(),this._calculateTransform(e,t,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,r){r.length>0&&(this._active=!0);const i=da(r,n),a=new t.P(0,0),s=new t.P(0,0);let o=0;for(const t in i){const e=i[t],n=this._touches[t];n&&(a._add(e),s._add(e.sub(n)),o++,i[t]=e)}if(this._touches=i,this._shouldBePrevented(o)||!s.mag())return;const l=s.div(o);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(o),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ta{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[r,i]=this._firstTwoTouches,a=Ca(n,t,r),s=Ca(n,t,i);if(!a||!s)return;const o=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],o,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[r,i]=this._firstTwoTouches,a=Ca(n,t,r),s=Ca(n,t,i);a&&s||(this._active&&u.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ca(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Ea(e,t){return Math.log(e/t)/Math.LN2}class Ia extends Ta{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ea(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ea(this._distance,n),pinchAround:t}}}function Pa(e,t){return 180*e.angleWith(t)/Math.PI}class Ma extends Ta{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,n){const r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pa(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=Pa(e,this._startVector);return Math.abs(n)<t}}function Aa(e){return Math.abs(e.y)>Math.abs(e.x)}class za extends Ta{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,Aa(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return Aa(e)&&Aa(t)&&a}}const Da={panStep:100,bearingStep:15,pitchStep:10};class Ra{constructor(e){this._tr=new ua(e);const t=Da;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,r=0,i=0,a=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:o=>{const l=this._tr;o.easeTo({duration:300,easeId:"keyboardHandler",easing:La,zoom:n?t.cx(l.zoom+n*(e.shiftKey?2:1),o.getZoomSnap()):l.zoom,bearing:l.bearing+r*this._bearingStep,pitch:l.pitch+i*this._pitchStep,offset:[-a*this._panStep,-s*this._panStep],center:l.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function La(e){return e*(2-e)}const Na=4.000244140625,ja=1/450;class Fa{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new ua(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ja}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=c(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==t&&t%Na==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=u.mousePos(this._map.getCanvas(),e),r=this._tr;this._aroundPoint=this._aroundCenter?r.transform.locationToScreenPoint(t.V.convert(r.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const t=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=t),"number"==typeof this._targetZoom&&(this._targetZoom+=t)}if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>Na?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==r&&(r=1/r);const i="number"!=typeof this._targetZoom?e.scale:t.aq(this._targetZoom),a=e.applyConstrain(e.getCameraLngLat(),t.at(i*r)).zoom,s=this._map.getZoomSnap();if("wheel"===this._type&&s>0){const n=t.cx(e.zoom,s);this._targetZoom=t.cx(a,s,a-n)}else this._targetZoom=a;"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,r=this._startZoom,i=this._easing;let a,s=!1;if("wheel"===this._type&&r&&i){const e=c()-this._lastWheelEventTime,o=Math.min((e+5)/200,1),l=i(o);a=t.G.number(r,n,l),o<1?this._frameId||(this._frameId=!0):s=!0}else a=n,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=a,{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.cz;if(this._prevEase){const e=this._prevEase,r=(c()-e.start)/e.duration,i=e.easing(r+.01)-e.easing(r),a=.27/Math.sqrt(i*i+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.cw(a,s,.25,1)}return this._prevEase={start:c(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Oa{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ba{constructor(e){this._tr=new ua(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:t.cx(this._tr.zoom+(e.shiftKey?-1:1),r.getZoomSnap()),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(){this._tap=new fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(this._tapTime){const r=t[0],i=e.timeStamp-this._tapTime<500,a=this._tapPoint.dist(r)<30;i&&a?n.length>0&&(this._swipePoint=r,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const r=this._tap.touchend(e,t,n);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qa{constructor(e,t,n,r){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=t,this._mousePitch=n,this._mouseRoll=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $a{constructor(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ga{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=u.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=t,this._container.appendChild(r);const i=document.createElement("div");i.className="maplibregl-mobile-message",i.textContent=n,this._container.appendChild(i),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(u.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ha=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class Za extends t.l{}function Wa(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class Xa{get _ownerDocument(){var e;return(null===(e=this._el)||void 0===e?void 0:e.ownerDocument)||document}get _ownerWindow(){var e,t;return(null===(t=null===(e=this._el)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||window}constructor(e,n){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,n)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},a={},s={};for(const{handlerName:c,handler:h,allowed:d}of this._handlers){if(!h.isEnabled())continue;let o;if(this._blockedByActive(s,d,c))h.reset();else if(h[n||e.type]){if(t.cA(e,n||e.type)){const t=u.mousePos(this._map.getCanvas(),e);o=h[n||e.type](e,t)}else if(t.cB(e,n||e.type)){const t=this._getMapTouches(e.touches),r=u.touchPos(this._map.getCanvas(),t);o=h[n||e.type](e,r,t)}else t.cC(n||e.type)||(o=h[n||e.type](e));this.mergeHandlerResult(i,a,o,c,r),o&&o.needsRenderFrame&&this._triggerRenderFrame()}(o||h.isActive())&&(s[c]=h)}const o={};for(const t in this._previousActiveHandlers)s[t]||(o[t]=r);this._previousActiveHandlers=s,(Object.keys(o).length||Wa(i))&&(this._changes.push([i,a,o]),this._triggerRenderFrame()),(Object.keys(s).length||Wa(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:l}=i;l&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],l(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new na(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[t,i,a]of this._listeners)u.addEventListener(t,i,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[e,t,n]of this._listeners)u.removeEventListener(e,t,e===this._ownerDocument?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const n=this._map,r=n.getCanvasContainer();this._add("mapEvent",new la(n,e));const i=n.boxZoom=new ha(n,e);this._add("boxZoom",i),e.interactive&&e.boxZoom&&i.enable();const a=n.cooperativeGestures=new Ga(n,e.cooperativeGestures);this._add("cooperativeGestures",a),e.cooperativeGestures&&a.enable();const s=new ma(n),o=new Ba(n);n.doubleClickZoom=new Oa(o,s),this._add("tapZoom",s),this._add("clickZoom",o),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const l=new Va;this._add("tapDragZoom",l);const c=n.touchPitch=new za(n);this._add("touchPitch",c),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const h=()=>n.project(n.getCenter()),d=function({enable:e,clickTolerance:n,aroundCenter:r=!0,minPixelCenterThreshold:i=100,rotateDegreesPerPixelMoved:a=.8},s){const o=new xa({checkCorrectEvent:e=>0===u.mouseButton(e)&&e.ctrlKey||2===u.mouseButton(e)&&!e.ctrlKey});return new ga({clickTolerance:n,move:(e,n)=>{const o=s();if(r&&Math.abs(o.y-e.y)>i)return{bearingDelta:t.cy(new t.P(e.x,n.y),n,o)};let l=(n.x-e.x)*a;return r&&n.y<o.y&&(l=-l),{bearingDelta:l}},moveStateManager:o,enable:e,assignEvents:Sa})}(e,h),p=function({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5}){const r=new xa({checkCorrectEvent:e=>0===u.mouseButton(e)&&e.ctrlKey||2===u.mouseButton(e)});return new ga({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:r,enable:e,assignEvents:Sa})}(e),f=function({enable:e,clickTolerance:t,rollDegreesPerPixelMoved:n=.3},r){const i=new xa({checkCorrectEvent:e=>2===u.mouseButton(e)&&e.ctrlKey});return new ga({clickTolerance:t,move:(e,t)=>{const i=r();let a=(t.x-e.x)*n;return t.y<i.y&&(a=-a),{rollDelta:a}},moveStateManager:i,enable:e,assignEvents:Sa})}(e,h);n.dragRotate=new qa(e,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const m=function({enable:e,clickTolerance:t}){const n=new xa({checkCorrectEvent:e=>0===u.mouseButton(e)&&!e.ctrlKey});return new ga({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:n,enable:e,assignEvents:Sa})}(e),g=new ka(e,n);n.dragPan=new Ua(r,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const y=new Ma,_=new Ia;n.touchZoomRotate=new $a(r,_,y,l),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new ca(n));const v=n.scrollZoom=new Fa(n,()=>this._triggerRenderFrame());this._add("scrollZoom",v,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const x=n.keyboard=new Ra(n);this._add("keyboard",x),e.interactive&&e.keyboard&&n.keyboard.enable()}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ha(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}mergeHandlerResult(e,n,r,i,a){if(!r)return;t.e(e,r);const s={handlerName:i,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(n.zoom=s),void 0!==r.panDelta&&(n.drag=s),void 0!==r.rollDelta&&(n.roll=s),void 0!==r.pitchDelta&&(n.pitch=s),void 0!==r.bearingDelta&&(n.rotate=s)}_applyChanges(){const e={},n={},r={};for(const[i,a,s]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),i.rollDelta&&(e.rollDelta=(e.rollDelta||0)+i.rollDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),t.e(n,a),t.e(r,s);this._updateMapTransform(e,n,r),this._changes=[]}_updateMapTransform(e,t,n){const r=this._map,i=r._getTransformForUpdate(),a=r.terrain;if(!(Wa(e)||a&&this._terrainMovement))return this._fireEvents(t,n,!0);r._stop(!0);let{panDelta:s,zoomDelta:o,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=e;void 0!==d&&(h=d),h=h||r.transform.centerPoint,a&&!i.isPointOnMapSurface(h)&&(h=i.centerPoint);const p={panDelta:s,zoomDelta:o,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!i.isPointOnMapSurface(h)&&(h=i.centerPoint);const f=h.distSqr(i.centerPoint)<.01?i.center:i.screenPointToLocation(s?h.sub(s):h);this._handleMapControls({terrain:a,tr:i,deltasForHelper:p,preZoomAroundLoc:f,combinedEventsInProgress:t,panDelta:s}),r._applyUpdatedTransform(i),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_handleMapControls({terrain:e,tr:t,deltasForHelper:n,preZoomAroundLoc:r,combinedEventsInProgress:i,panDelta:a}){const s=this._map.cameraHelper;if(s.handleMapControlsRollPitchBearingZoom(n,t),e)return s.useGlobeControls?(this._terrainMovement||!i.drag&&!i.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void s.handleMapControlsPan(n,t,r)):this._terrainMovement||!i.drag&&!i.zoom?void(i.drag&&this._terrainMovement&&a?t.setCenter(t.screenPointToLocation(t.centerPoint.sub(a))):s.handleMapControlsPan(n,t,r)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void s.handleMapControlsPan(n,t,r));s.handleMapControlsPan(n,t,r)}_fireEvents(e,n,r){const i=Ha(this._eventsInProgress),a=Ha(e),s={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!i&&a&&this._fireEvent("movestart",a.originalEvent);for(const t in s)this._fireEvent(t,s[t]);a&&this._fireEvent("move",a.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const l={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=n[e]||r,l[`${t}end`]=c)}for(const t in l)this._fireEvent(t,l[t]);const u=Ha(this._eventsInProgress),h=(i||a)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(r&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&o.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Za("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Ya extends t.E{constructor(e,t,n){super(),this._renderFrameCallback=()=>{const e=Math.min((c()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._zoomSnap=n.zoomSnap,this.cameraHelper=t,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,t){e.apply(this.transform,!0),this.transform=e,this.cameraHelper=t}getCenter(){return new t.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,t){return this.jumpTo({elevation:e},t),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},n),r)}panTo(e,n,r){return this.easeTo(t.e({center:e},n),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,n,r){return this.easeTo(t.e({zoom:e},n),r)}zoomIn(e,n){return this.zoomTo(t.cx(this.getZoom()+1,this._zoomSnap),e,n),this}zoomOut(e,n){return this.zoomTo(t.cx(this.getZoom()-1,this._zoomSnap),e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)).fire(new t.l("moveend",n))),this}getBearing(){return this.transform.bearing}setZoomSnap(e){return this._zoomSnap=e,this}getZoomSnap(){return this._zoomSnap}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,n,r){return this.easeTo(t.e({bearing:e},n),r)}resetNorth(e,n){return this.rotateTo(0,t.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.roll}setRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(e,t){e=Z.convert(e).adjustAntiMeridian();const n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(e,n,r,i){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const e=i.padding;i.padding={top:e,bottom:e,right:e,left:e}}const s=t.e(a,i.padding);i.padding=s;const o=this.transform,l=new Z(e,n);return this.cameraHelper.cameraForBoxAndBearing(i,s,l,r,o)}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(e,n,r,i,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(e)),this.transform.screenPointToLocation(t.P.convert(n)),r,i),i,a)}_fitInternal(e,n,r){return e?(delete(n=t.e(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(e,n){this.stop();const r=this._getTransformForUpdate();let i=!1,a=!1,s=!1;const o=r.zoom;this.cameraHelper.handleJumpToCenterZoom(r,e);const l=r.zoom!==o;return"elevation"in e&&r.elevation!==+e.elevation&&r.setElevation(+e.elevation),"bearing"in e&&r.bearing!==+e.bearing&&(i=!0,r.setBearing(+e.bearing)),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.setPitch(+e.pitch)),"roll"in e&&r.roll!==+e.roll&&(s=!0,r.setRoll(+e.roll)),null==e.padding||r.isPaddingEqual(e.padding)||r.setPadding(e.padding),this._applyUpdatedTransform(r),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)),l&&this.fire(new t.l("zoomstart",n)).fire(new t.l("zoom",n)).fire(new t.l("zoomend",n)),i&&this.fire(new t.l("rotatestart",n)).fire(new t.l("rotate",n)).fire(new t.l("rotateend",n)),a&&this.fire(new t.l("pitchstart",n)).fire(new t.l("pitch",n)).fire(new t.l("pitchend",n)),s&&this.fire(new t.l("rollstart",n)).fire(new t.l("roll",n)).fire(new t.l("rollend",n)),this.fire(new t.l("moveend",n))}calculateCameraOptionsFromTo(e,n,r,i=0){const a=t.a9.fromLngLat(e,n),s=t.a9.fromLngLat(r,i),o=s.x-a.x,l=s.y-a.y,c=s.z-a.z,u=Math.hypot(o,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(o,l),d=t.at(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(o,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),elevation:i,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(e,t,n,r,i){const a=this.transform.calculateCenterFromCameraLngLatAlt(e,t,n,r);return{center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:n,pitch:r,roll:i}}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.cz},e)).animate||!e.essential&&o.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),i=this.getBearing(),a=r.pitch,s=r.roll,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,c="pitch"in e?+e.pitch:a,u="roll"in e?this._normalizeBearing(e.roll,s):s,h="padding"in e?e.padding:r.padding,d=t.P.convert(e.offset);let p,f;e.around&&(p=t.V.convert(e.around),f=r.locationToScreenPoint(p));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(r,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||i!==l,this._pitching=this._pitching||c!==a,this._rolling=this._rolling||u!==s,this._padding=!r.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease(t=>{g.easeFunc(t),this.terrain&&!e.freezeElevation&&this._updateElevation(t),this._applyUpdatedTransform(r),this._fireMoveEvents(n)},t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,t)},e),this}_prepareEase(e,n,r={}){this._moving=!0,n||r.moving||this.fire(new t.l("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.l("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.l("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.l("pitchstart",e)),this._rolling&&!r.rolling&&this.fire(new t.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){void 0!==this._elevationStart&&void 0!==this._elevationCenter||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(n-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(t.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const t=e.getCameraLngLat(),n=e.getCameraAltitude(),r=this.terrain?this.terrain.getElevationForLngLatZoom(t,e.zoom):0;if(n<r){const n=this.calculateCameraOptionsFromTo(t,r,e.center,e.elevation);return{pitch:n.pitch,zoom:n.zoom}}return{}}_applyUpdatedTransform(e){const t=[];if(t.push(e=>this._elevateCameraIfInsideTerrain(e)),this.transformCameraUpdate&&t.push(e=>this.transformCameraUpdate(e)),!t.length)return;const n=e.clone();for(const r of t){const e=n.clone(),{center:t,zoom:i,roll:a,pitch:s,bearing:o,elevation:l}=r(e);t&&e.setCenter(t),void 0!==l&&e.setElevation(l),void 0!==i&&e.setZoom(i),void 0!==a&&e.setRoll(a),void 0!==s&&e.setPitch(s),void 0!==o&&e.setBearing(o),n.apply(e,!1)}this.transform.apply(n,!1)}_fireMoveEvents(e){this.fire(new t.l("move",e)),this._zooming&&this.fire(new t.l("zoom",e)),this._rotating&&this.fire(new t.l("rotate",e)),this._pitching&&this.fire(new t.l("pitch",e)),this._rolling&&this.fire(new t.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const r=this._zooming,i=this._rotating,a=this._pitching,s=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,r&&this.fire(new t.l("zoomend",e)),i&&this.fire(new t.l("rotateend",e)),a&&this.fire(new t.l("pitchend",e)),s&&this.fire(new t.l("rollend",e)),this.fire(new t.l("moveend",e))}flyTo(e,n){if(!e.essential&&o.prefersReducedMotion){const r=t.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(r,n)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.cz},e);const r=this._getTransformForUpdate(),i=r.bearing,a=r.pitch,s=r.roll,l=r.padding,c="bearing"in e?this._normalizeBearing(e.bearing,i):i,u="pitch"in e?+e.pitch:a,h="roll"in e?this._normalizeBearing(e.roll,s):s,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const m=r.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(r,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:m,offsetAsPoint:p,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let y=e.curve;const _=Math.max(r.width,r.height),v=_/g.scaleOfZoom,x=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(y=Math.sqrt(_/g.scaleOfMinZoom/x*2));const b=y*y;function w(e){const t=(v*v-_*_+(e?-1:1)*b*b*x*x)/(2*(e?v:_)*b*x);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}const T=w(!1);let C=function(e){return k(T)/k(T+y*e)},E=function(e){return _*((k(T)*(S(t=T+y*e)/k(t))-S(T))/b)/x;var t},I=(w(!0)-T)/y;if(Math.abs(x)<2e-6||!isFinite(I)){if(Math.abs(_-v)<1e-6)return this.easeTo(e,n);const t=v<_?-1:1;I=Math.abs(Math.log(v/_))/y,E=()=>0,C=e=>Math.exp(t*y*e)}return e.duration="duration"in e?+e.duration:1e3*I/("screenSpeed"in e?+e.screenSpeed/y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=i!==c,this._pitching=u!==a,this._rolling=h!==s,this._padding=!r.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease(o=>{const m=o*I,y=1/C(m),_=E(m);this._rotating&&r.setBearing(t.G.number(i,c,o)),this._pitching&&r.setPitch(t.G.number(a,u,o)),this._rolling&&r.setRoll(t.G.number(s,h,o)),this._padding&&(r.interpolatePadding(l,d,o),f=r.centerPoint.add(p)),g.easeFunc(o,y,_,f),this.terrain&&!e.freezeElevation&&this._updateElevation(o),this._applyUpdatedTransform(r),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=c(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=t.W(e,-180,180);const r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLat(t.V.convert(e),this.transform):null}}const Ka={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Qa{constructor(e=Ka){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=u.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=u.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=u.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){u.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(e=>"string"!=typeof e?"":e)):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.tileManagers;for(const r in t){const n=t[r];if(n.used||n.usedForTerrain){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter(e=>String(e).trim()),e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0});const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=u.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ja{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=u.create("div","maplibregl-ctrl");const t=u.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){u.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class es{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const r of n)if(r.id===e)return void(r.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ts=t.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ns extends t.E{constructor(e){super(),this._lastTilesetChange=c(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,n){this.tileManager.update(e,n),this._renderableTilesKeys=[];const r={};for(const i of Ee(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))r[i.key]=!0,this._renderableTilesKeys.push(i.key),this._tiles[i.key]||(i.terrainRttPosMatrix32f=new Float64Array(16),t.c7(i.terrainRttPosMatrix32f,0,t.a5,t.a5,0,0,1),this._tiles[i.key]=new pe(i,this.tileSize),this._lastTilesetChange=c());for(const t in this._tiles)r[t]||delete this._tiles[t]}freeRtt(e){for(const t in this._tiles){const n=this._tiles[t];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,t){return t?this._getTerrainCoordsForTileRanges(e,t):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const r of this._renderableTilesKeys){const i=this._tiles[r].tileID,a=e.clone(),s=t.bk();if(i.canonical.equals(e.canonical))t.c7(s,0,t.a5,t.a5,0,0,1);else if(i.canonical.isChildOf(e.canonical)){const n=i.canonical.z-e.canonical.z,r=i.canonical.x-(i.canonical.x>>n<<n),a=i.canonical.y-(i.canonical.y>>n<<n),o=t.a5>>n;t.c7(s,0,o,o,0,0,1),t.O(s,s,[-r*o,-a*o,0])}else{if(!e.canonical.isChildOf(i.canonical))continue;{const n=e.canonical.z-i.canonical.z,r=e.canonical.x-(e.canonical.x>>n<<n),a=e.canonical.y-(e.canonical.y>>n<<n),o=t.a5>>n;t.c7(s,0,t.a5,t.a5,0,0,1),t.O(s,s,[r*o,a*o,0]),t.Q(s,s,[1/2**n,1/2**n,0])}}a.terrainRttPosMatrix32f=new Float32Array(s),n[r]=a}return n}_getTerrainCoordsForTileRanges(e,n){const r={};for(const i of this._renderableTilesKeys){const a=this._tiles[i].tileID;if(!this._isWithinTileRanges(a,n))continue;const s=e.clone(),o=t.bk();if(a.canonical.z===e.canonical.z){const n=e.canonical.x-a.canonical.x+e.wrap*(1<<e.canonical.z),r=e.canonical.y-a.canonical.y;t.c7(o,0,t.a5,t.a5,0,0,1),t.O(o,o,[n*t.a5,r*t.a5,0])}else if(a.canonical.z>e.canonical.z){const n=a.canonical.z-e.canonical.z,r=a.canonical.x-(a.canonical.x>>n<<n)+e.wrap*(1<<a.canonical.z),i=a.canonical.y-(a.canonical.y>>n<<n),s=e.canonical.x-(a.canonical.x>>n),l=e.canonical.y-(a.canonical.y>>n),c=t.a5>>n;t.c7(o,0,c,c,0,0,1),t.O(o,o,[-r*c+s*t.a5,-i*c+l*t.a5,0])}else{const n=e.canonical.z-a.canonical.z,r=e.canonical.x-(e.canonical.x>>n<<n)+e.wrap*(1<<e.canonical.z),i=e.canonical.y-(e.canonical.y>>n<<n),s=(e.canonical.x>>n)-a.canonical.x,l=(e.canonical.y>>n)-a.canonical.y,c=t.a5<<n;t.c7(o,0,c,c,0,0,1),t.O(o,o,[r*t.a5+s*c,i*t.a5+l*c,0])}s.terrainRttPosMatrix32f=new Float32Array(o),r[i]=s}return r}getSourceTile(e,t){const n=this.tileManager._source;let r=e.overscaledZ-this.deltaZoom;if(r>n.maxzoom&&(r=n.maxzoom),r<n.minzoom)return;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let i=this.findTileInCaches(this._sourceTileCache[e.key]);if(!(null==i?void 0:i.dem)&&t)for(;r>=n.minzoom&&!(null==i?void 0:i.dem);)i=this.findTileInCaches(e.scaledTo(r--).key);return i}findTileInCaches(e){let t=this.tileManager.getTileByID(e);return t||(t=this.tileManager._outOfViewCache.getByKey(e),t)}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,t){const n=t[e.canonical.z];return!!n&&(e.wrap>n.minWrap||e.wrap<n.maxWrap||e.canonical.x>=n.minTileXWrapped&&e.canonical.x<=n.maxTileXWrapped&&e.canonical.y>=n.minTileY&&e.canonical.y<=n.maxTileY)}}class rs{constructor(e,t,n){this._meshCache={},this.painter=e,this.tileManager=new ns(t),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,r,i=t.a5){var a;if(!(n>=0&&n<i&&r>=0&&r<i))return 0;const s=this.getTerrainData(e),o=null===(a=s.tile)||void 0===a?void 0:a.dem;if(!o)return 0;const l=t.cD([],[n/i*t.a5,r/i*t.a5],s.u_terrain_matrix),c=[l[0]*o.dim,l[1]*o.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return o.get(u,h)*(1-d)*(1-p)+o.get(u+1,h)*d*(1-p)+o.get(u,h+1)*(1-d)*p+o.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,n){if(!t.cE(n,e.wrap()))return 0;const{tileID:r,mercatorX:i,mercatorY:a}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(r,i%t.a5,a%t.a5,t.a5)}getElevationForLngLat(e,t){const n=Ee(t,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let r=0;for(const i of n)i.canonical.z>r&&(r=Math.min(i.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(e,r)}getElevation(e,n,r,i=t.a5){return this.getDEMElevation(e,n,r,i)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,n=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new t.T(e,n,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new t.T(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ar([])}const n=this.tileManager.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const e=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new t.T(e,n.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),n.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const r=n&&n.toString()+n.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.tileManager.getSource().maxzoom;let i=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?i=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=e.canonical.x-(e.canonical.x>>i<<i),s=e.canonical.y-(e.canonical.y>>i<<i),o=t.cF(new Float64Array(16),[1/(t.a5<<i),1/(t.a5<<i),0]);t.O(o,o,[a*t.a5,s*t.a5,0]),this._demMatrixCache[e.key]={matrix:o,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,r=n.width/devicePixelRatio,i=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===r&&this._fbo.height===i||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new t.T(n.context,{width:r,height:i,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new t.T(n.context,{width:r,height:i,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(r,i,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,r,i))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,a=0;t<this._coordsTextureSize;t++)for(let e=0;e<this._coordsTextureSize;e++,a+=4)n[a+0]=255&e,n[a+1]=255&t,n[a+2]=e>>8<<4|t>>8,n[a+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),i=new t.T(e,r,e.gl.RGBA,{premultiply:!1});return i.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=i,i}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),r=this.painter.context,i=r.gl,a=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),o=Math.round(this.painter.height/devicePixelRatio);r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),i.readPixels(a,o-s-1,1,1,i.RGBA,i.UNSIGNED_BYTE,n),r.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.tileManager.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.a9((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),n=this.painter.context,r=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,t),n.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(e){var n;const r=(null===(n=this.painter.style.projection)||void 0===n?void 0:n.transitionState)>0,i=r&&0===e.canonical.y,a=r&&e.canonical.y===(1<<e.canonical.z)-1,s=`m_${i?"n":""}_${a?"s":""}`;if(this._meshCache[s])return this._meshCache[s];const o=this.painter.context,l=new t.cG,c=new t.aY,u=this.meshSize,h=t.a5/u,d=u*u;for(let t=0;t<=u;t++)for(let e=0;e<=u;e++)l.emplaceBack(e*h,t*h,0);for(let t=0;t<d;t+=u+1)for(let e=0;e<u;e++)c.emplaceBack(e+t,u+e+t+1,u+e+t+2),c.emplaceBack(e+t,u+e+t+2,e+t+1);const p=l.length,f=p+(u+1),m=(u+1)*u,g=i?t.br:0,y=i?0:1,_=a?t.bs:t.a5,v=a?0:1;for(let t=0;t<=u;t++)l.emplaceBack(t*h,g,y);for(let t=0;t<=u;t++)l.emplaceBack(t*h,_,v);for(let t=0;t<u;t++)c.emplaceBack(m+t,f+t,f+t+1),c.emplaceBack(m+t,f+t+1,m+t+1),c.emplaceBack(0+t,p+t+1,p+t),c.emplaceBack(0+t,0+t+1,p+t+1);const x=l.length,b=x+2*(u+1);for(const S of[0,1])for(let e=0;e<=u;e++)for(const n of[0,1])l.emplaceBack(S*t.a5,e*h,n);for(let t=0;t<2*u;t+=2)c.emplaceBack(x+t,x+t+1,x+t+3),c.emplaceBack(x+t,x+t+3,x+t+2),c.emplaceBack(b+t,b+t+3,b+t+1),c.emplaceBack(b+t,b+t+2,b+t+3);const w=new Nt(o.createVertexBuffer(l,ts.members),o.createIndexBuffer(c),t.aX.simpleSegment(0,0,l.length,c.length));return this._meshCache[s]=w,w}getMeshFrameDelta(e){return 2*Math.PI*t.bE/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var r;if(!t.cE(n,e.wrap()))return 0;const{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(e,n);return null!==(r=this.getMinMaxElevation(i).minElevation)&&void 0!==r?r:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return t&&t.dem&&(n.minElevation=t.dem.min*this.exaggeration,n.maxElevation=t.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,n){const r=t.a9.fromLngLat(e.wrap()),i=(1<<n)*t.a5,a=r.x*i,s=r.y*i,o=Math.floor(a/t.a5),l=Math.floor(s/t.a5);return{tileID:new t.a2(n,0,n,o,l),mercatorX:a,mercatorY:s}}}class is{constructor(e,t,n){this._context=e,this._size=t,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),r=new t.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return r.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(r.texture),{id:e,fbo:n,texture:r,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(t=>e.id!==t),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(e=>!e.inUse)}}const as={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ss{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new is(e.context,30,t.tileManager.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter(n=>!e._layers[n].isHidden(t)),this._coordsAscending={};for(const n in e.tileManagers){this._coordsAscending[n]={};const t=e.tileManagers[n].getVisibleCoordinates(),r=e.tileManagers[n].getSource(),i=r instanceof te?r.terrainTileRanges:null;for(const e of t){const t=this.terrain.tileManager.getTerrainCoords(e,i);for(const e in t)this._coordsAscending[n][e]||(this._coordsAscending[n][e]=[]),this._coordsAscending[n][e].push(t[e])}}this._coordsAscendingStr={};for(const n of e._order){const t=e._layers[n],r=t.source;if(as[t.type]&&!this._coordsAscendingStr[r]){this._coordsAscendingStr[r]={};for(const e in this._coordsAscending[r])this._coordsAscendingStr[r][e]=this._coordsAscending[r][e].map(e=>e.key).sort().join()}}for(const n of this._renderableTiles)for(const e in this._coordsAscendingStr){const t=this._coordsAscendingStr[e][n.tileID.key];t&&t!==n.rttCoords[e]&&(n.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const r=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),i=e.type,a=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(as[i]&&(this._prevType&&as[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(as[this._prevType]||as[i]&&s){this._prevType=i;const e=this._stacks.length-1,n=this._stacks[e]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(Gi(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[e]){const t=this.pool.getObjectForId(i.rtt[e].id);if(t.stamp===i.rtt[e].stamp){this.pool.useObject(t);continue}}const s=this.pool.getOrCreateFreeObject();this.pool.useObject(s),this.pool.stampObject(s),i.rtt[e]={id:s.id,stamp:s.stamp},a.context.bindFramebuffer.set(s.fbo.framebuffer),a.context.clear({color:t.bp.transparent,stencil:0}),a.currentStencilSource=void 0;for(let e=0;e<n.length;e++){const t=a.style._layers[n[e]],o=t.source?this._coordsAscending[t.source][i.tileID.key]:[i.tileID];a.context.viewport.set([0,0,s.fbo.width,s.fbo.height]),a._renderTileClippingMasks(t,o,!0),a.renderLayer(a,a.style.tileManagers[t.source],t,o,r),t.source&&(i.rttCoords[t.source]=this._coordsAscendingStr[t.source][i.tileID.key])}}return Gi(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects(),as[i]}return!1}}const os={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ls=n,cs={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Ka,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},us={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class hs{constructor(e,n,r=!1){this.mousedown=e=>{this.startMove(e,u.mousePos(this.element,e)),u.addEventListener(window,"mousemove",this.mousemove),u.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,u.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHandler.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=u.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),u.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=u.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const i=new wa;this._rotatePitchHandler=new ga({clickTolerance:3,move:(e,i)=>{const a=n.getBoundingClientRect(),s=new t.P((a.bottom-a.top)/2,(a.right-a.left)/2);return{bearingDelta:t.cy(new t.P(e.x,i.y),i,s),pitchDelta:r?-.5*(i.y-e.y):void 0}},moveStateManager:i,enable:!0,assignEvents:()=>{}}),this.map=e,u.addEventListener(n,"mousedown",this.mousedown),u.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),u.addEventListener(n,"touchcancel",this.reset)}startMove(e,t){this._rotatePitchHandler.dragStart(e,t),u.disableDrag()}move(e,t){const n=this.map,{bearingDelta:r,pitchDelta:i}=this._rotatePitchHandler.dragMove(e,t)||{};r&&n.setBearing(n.getBearing()+r),i&&n.setPitch(n.getPitch()+i)}off(){const e=this.element;u.removeEventListener(e,"mousedown",this.mousedown),u.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend),u.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){u.enableDrag(),u.removeEventListener(window,"mousemove",this.mousemove),u.removeEventListener(window,"mouseup",this.mouseup),u.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),u.removeEventListener(window,"touchend",this.touchend)}}let ds;function ps(e,n,r,i=!1){if(i||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const a=new t.V(e.lng,e.lat);if(e=new t.V(e.lng,e.lat),n){const i=new t.V(e.lng-360,e.lat),a=new t.V(e.lng+360,e.lat),s=r.locationToScreenPoint(e).distSqr(n);r.locationToScreenPoint(i).distSqr(n)<s?e=i:r.locationToScreenPoint(a).distSqr(n)<s&&(e=a)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationToScreenPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e.lng!==a.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(e))?e:a}const fs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ms(e,t,n){const r=e.classList;for(const i in fs)r.remove(`maplibregl-${n}-anchor-${i}`);r.add(`maplibregl-${n}-anchor-${t}`)}class gs extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const t=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!t)&&this._map.once("render",this._update),this._lngLat=ps(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),u.setTransform(this._element,`${fs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${r} ${n}`),o.frameAsync(new AbortController,this._map._ownerWindow).then(()=>{this._updateOpacity(e&&"moveend"===e.type)}).catch(()=>{})},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=u.create("div");const n=u.createNS("http://www.w3.org/2000/svg","svg"),r=41,i=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${r}px`),n.setAttributeNS(null,"width",`${i}px`),n.setAttributeNS(null,"viewBox",`0 0 ${i} ${r}`);const a=u.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");const s=u.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const o=u.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"transform","translate(3.0, 29.0)"),o.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of l){const t=u.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),o.appendChild(t)}const c=u.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill",this._color);const h=u.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(h);const d=u.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=u.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=u.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=u.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=u.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=u.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),s.appendChild(o),s.appendChild(c),s.appendChild(d),s.appendChild(f),s.appendChild(m),n.appendChild(s),n.setAttributeNS(null,"height",r*this._scale+"px"),n.setAttributeNS(null,"width",i*this._scale+"px"),this._element.appendChild(n),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()}),ms(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),u.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,r=Math.abs(n)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,r;const i=null===(n=this._map)||void 0===n?void 0:n.terrain,a=this._map.transform.isLocationOccluded(this._lngLat);if(!i||a){const e=a?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const s=this._map,o=s.terrain.depthAtPoint(this._pos),l=s.terrain.getElevationForLngLat(this._lngLat,s.transform);if(s.transform.lngLatToCameraDepth(this._lngLat,l)-o<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/s.transform.pixelsPerMeter,u=Math.sin(s.getPitch()*Math.PI/180)*c,h=s.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),d=s.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(r=this._popup)||void 0===r?void 0:r.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return(void 0===this._opacity||void 0===e&&void 0===t)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const ys={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let _s=0,vs=!1;const xs={maxWidth:100,unit:"metric"};function bs(e,t,n){const r=n&&n.maxWidth||100,i=e._container.clientHeight/2,a=e._container.clientWidth/2,s=e.unproject([a-r/2,i]),o=e.unproject([a+r/2,i]),l=Math.round(e.project(o).x-e.project(s).x),c=Math.min(r,l,e._container.clientWidth),u=s.distanceTo(o);if(n&&"imperial"===n.unit){const n=3.2808*u;n>5280?ws(t,c,n/5280,e._getUIString("ScaleControl.Miles")):ws(t,c,n,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?ws(t,c,u/1852,e._getUIString("ScaleControl.NauticalMiles")):u>=1e3?ws(t,c,u/1e3,e._getUIString("ScaleControl.Kilometers")):ws(t,c,u,e._getUIString("ScaleControl.Meters"))}function ws(e,t,n,r){const i=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n);e.style.width=t*(i/n)+"px",e.innerHTML=`${i}&nbsp;${r}`}const Ss={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},ks=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ts(e){if(e){if("number"==typeof e){const n=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(n,n),"top-right":new t.P(-n,n),bottom:new t.P(0,-e),"bottom-left":new t.P(n,-n),"bottom-right":new t.P(-n,-n),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const n=t.P.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return Ts(new t.P(0,0))}const Cs=n;e.AJAXError=t.cJ,e.Event=t.l,e.Evented=t.E,e.LngLat=t.V,e.MercatorCoordinate=t.a9,e.Point=t.P,e.addProtocol=t.cK,e.config=t.c,e.removeProtocol=t.cL,e.AttributionControl=Qa,e.BoxZoomHandler=ha,e.CanvasSource=re,e.CooperativeGesturesHandler=Ga,e.DoubleClickZoomHandler=Oa,e.DragPanHandler=Ua,e.DragRotateHandler=qa,e.EdgeInsets=Vt,e.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){u.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=u.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);u.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=ee,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new t.V(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),a=t.e({bearing:i},this.options.fitBoundsOptions),s=Z.fromLngLat(n,r);this._map.fitBounds(s,a,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new t.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&vs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=u.create("button","maplibregl-ctrl-geolocate",this._container),u.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gs({element:this._dotElement}),this._circleElement=u.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{const n=(null==e?void 0:e[0])instanceof ResizeObserverEntry;e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))})}},this.options=t.e({},ys,e)}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,function*(e=!1){if(void 0!==ds&&!e)return ds;if(void 0===window.navigator.permissions)return ds=!!window.navigator.geolocation,ds;try{const e=yield window.navigator.permissions.query({name:"geolocation"});ds="denied"!==e.state}catch(t){ds=!!window.navigator.geolocation}return ds})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),u.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,_s=0,vs=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const e=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&e))return;const t=this._map.project(e),n=this._map.unproject([t.x+100,t.y]),r=e.distanceTo(n)/100,i=2*this._accuracy/r;this._circleElement.style.width=`${i.toFixed(2)}px`,this._circleElement.style.height=`${i.toFixed(2)}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_s--,vs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_s++,_s>1?(e={maximumAge:6e5,timeout:0},vs=!0):(e=this.options.positionOptions,vs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const t=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==t&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=u.create("button","maplibregl-ctrl-globe",this._container),u.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){u.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},e.Hash=Xi,e.ImageSource=te,e.KeyboardHandler=Ra,e.LngLatBounds=Z,e.LogoControl=Ja,e.Map=class extends Ya{get _ownerWindow(){var e,t;return(null===(t=null===(e=this._container)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||window}constructor(e){var n,r;t.cH.mark(t.cI.create);const i=Object.assign(Object.assign(Object.assign({},cs),e),{canvasContextAttributes:Object.assign(Object.assign({},cs.canvasContextAttributes),e.canvasContextAttributes)});if(null!=i.minZoom&&null!=i.maxZoom&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=i.minPitch&&null!=i.maxPitch&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=i.minPitch&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=i.maxPitch&&i.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const a=new Wt,s=new Qt;void 0!==i.minZoom&&a.setMinZoom(i.minZoom),void 0!==i.maxZoom&&a.setMaxZoom(i.maxZoom),void 0!==i.minPitch&&a.setMinPitch(i.minPitch),void 0!==i.maxPitch&&a.setMaxPitch(i.maxPitch),void 0!==i.renderWorldCopies&&a.setRenderWorldCopies(i.renderWorldCopies),null!==i.transformConstrain&&a.setConstrainOverride(i.transformConstrain),super(a,s,{bearingSnap:i.bearingSnap,zoomSnap:i.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new es,this._controls=[],this._mapId=t.af(),this._lostContextStyle={style:null,images:null},this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const t of Object.values(this.style._layers))if(t.type,t._listeners)for(const[e]of Object.entries(t._listeners));this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new t.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new t.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},i.canvasContextAttributes),this._trackResize=!0===i.trackResize,this._bearingSnap=i.bearingSnap,this._zoomSnap=i.zoomSnap,this._centerClampedToGround=i.centerClampedToGround,this._refreshExpiredTiles=!0===i.refreshExpiredTiles,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=!0===i.crossSourceCollisions,this._collectResourceTiming=!0===i.collectResourceTiming,this._locale=Object.assign(Object.assign({},os),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this._zoomLevelsToOverscale=i.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=i.transformCameraUpdate,this.transformConstrain=i.transformConstrain,this.cancelPendingTileRequestsWhileZooming=!0===i.cancelPendingTileRequestsWhileZooming,void 0!==i.reduceMotion&&(o.prefersReducedMotion=i.reduceMotion),this._imageQueueHandle=y.addThrottleControl(()=>this.isMoving()),this._requestManager=new _(i.transformRequest),this._container=this._resolveContainer(i.container),i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Xa(this,i),this._hash=i.hash&&new Xi("string"==typeof i.hash&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,elevation:i.elevation,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch,roll:i.roll}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,t.e({},i.fitBoundsOptions,{duration:0}))));const l="string"==typeof i.style||!("globe"===(null===(r=null===(n=i.style)||void 0===n?void 0:n.projection)||void 0===r?void 0:r.type));this.resize(null,l),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Qa("boolean"==typeof i.attributionControl?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new Ja,i.logoPosition),this.on("style.load",()=>{if(l||this._resizeTransform(),this.transform.unmodified){const e=t.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.l(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new t.l(`${e.dataType}dataloading`,e))}),this.on("dataabort",e=>{this.fire(new t.l("sourcedataabort",e))})}_getMapId(){return this._mapId}setGlobalStateProperty(e,t){return this.style.setGlobalStateProperty(e,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}coveringTiles(e){return Ee(this.transform,e)}calculateCameraOptionsFromTo(e,t,n,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLat(n,this.transform)),super.calculateCameraOptionsFromTo(e,t,n,r)}resize(e,n=!0){if(null!==this._lostContextStyle.style)return this;this._resizeInternal(n);const r=!this._moving;return r&&(this.stop(),this.fire(new t.l("movestart",e)).fire(new t.l("move",e))),this.fire(new t.l("resize",e)),r&&this.fire(new t.l("moveend",e)),this}_resizeInternal(e=!0){const[t,n]=this._containerDimensions(),r=this._getClampedPixelRatio(t,n);if(this._resizeCanvas(t,n,r),this.painter.resize(t,n,r),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const r=this._getClampedPixelRatio(t,n);this._resizeCanvas(t,n,r),this.painter.resize(t,n,r)}this._resizeTransform(e)}_resizeTransform(e=!0){var t;const[n,r]=this._containerDimensions();this.transform.resize(n,r,e),null===(t=this._requestedCameraState)||void 0===t||t.resize(n,r,e)}_getClampedPixelRatio(e,t){const{0:n,1:r}=this._maxCanvasSize,i=this.getPixelRatio(),a=e*i,s=t*i;return Math.min(a>n?n/a:1,s>r?r/s:1)*i}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(Z.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom){const n=this.transform.zoom,r=this._getTransformForUpdate();return r.setMinZoom(e),this._applyUpdatedTransform(r),this._update(),n!==this.transform.zoom&&this.fire(new t.l("zoomstart")).fire(new t.l("zoom")).fire(new t.l("zoomend")).fire(new t.l("movestart")).fire(new t.l("move")).fire(new t.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom){const n=this.transform.zoom,r=this._getTransformForUpdate();return r.setMaxZoom(e),this._applyUpdatedTransform(r),this._update(),n!==this.transform.zoom&&this.fire(new t.l("zoomstart")).fire(new t.l("zoom")).fire(new t.l("zoomend")).fire(new t.l("movestart")).fire(new t.l("move")).fire(new t.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch){const n=this.transform.pitch,r=this._getTransformForUpdate();return r.setMinPitch(e),this._applyUpdatedTransform(r),this._update(),n!==this.transform.pitch&&this.fire(new t.l("pitchstart")).fire(new t.l("pitch")).fire(new t.l("pitchend")).fire(new t.l("movestart")).fire(new t.l("move")).fire(new t.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch){const n=this.transform.pitch,r=this._getTransformForUpdate();return r.setMaxPitch(e),this._applyUpdatedTransform(r),this._update(),n!==this.transform.pitch&&this.fire(new t.l("pitchstart")).fire(new t.l("pitch")).fire(new t.l("pitchend")).fire(new t.l("movestart")).fire(new t.l("move")).fire(new t.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}setTransformConstrain(e){return this.transform.setConstrainOverride(e),this._update()}project(e){return this.transform.locationToScreenPoint(t.V.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let r=!1;const i=i=>{const a=t.filter(e=>this.getLayer(e)),s=0!==a.length?this.queryRenderedFeatures(i.point,{layers:a}):[];s.length?r||(r=!0,n.call(this,new aa(e,this,i.originalEvent,{features:s}))):r=!1};return{layers:t,listener:n,delegates:{mousemove:i,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const i=i=>{const a=t.filter(e=>this.getLayer(e));(0!==a.length?this.queryRenderedFeatures(i.point,{layers:a}):[]).length?r=!0:r&&(r=!1,n.call(this,new aa(e,this,i.originalEvent)))},a=t=>{r&&(r=!1,n.call(this,new aa(e,this,t.originalEvent)))};return{layers:t,listener:n,delegates:{mousemove:i,mouseout:a}}}{const r=e=>{const r=t.filter(e=>this.getLayer(e)),i=0!==r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layers:t,listener:n,delegates:{[e]:r}}}}_saveDelegatedListener(e,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(t)}_removeDelegatedListener(e,t,n){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const r=this._delegatedListeners[e];for(let i=0;i<r.length;i++){const e=r[i];if(e.listener===n&&e.layers.length===t.length&&e.layers.every(e=>t.includes(e))){for(const t in e.delegates)this.off(t,e.delegates[t]);return void r.splice(i,1)}}}on(e,t,n){if(void 0===n)return super.on(e,t);const r="string"==typeof t?[t]:t,i=this._createDelegatedListener(e,r,n);this._saveDelegatedListener(e,i);for(const a in i.delegates)this.on(a,i.delegates[a]);return{unsubscribe:()=>{this._removeDelegatedListener(e,r,n)}}}once(e,t,n){if(void 0===n)return super.once(e,t);const r="string"==typeof t?[t]:t,i=this._createDelegatedListener(e,r,n);for(const a in i.delegates){const t=i.delegates[a];i.delegates[a]=(...i)=>{this._removeDelegatedListener(e,r,n),t(...i)}}this._saveDelegatedListener(e,i);for(const a in i.delegates)this.once(a,i.delegates[a]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._removeDelegatedListener(e,"string"==typeof t?[t]:t,n),this)}queryRenderedFeatures(e,n){if(!this.style)return[];let r;const i=e instanceof t.P||Array.isArray(e),a=i?e:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(i?{}:e)||{},a instanceof t.P||"number"==typeof a[0])r=[t.P.convert(a)];else{const e=t.P.convert(a[0]),n=t.P.convert(a[1]);r=[e,new t.P(n.x,e.y),n,new t.P(e.x,n.y),e]}return this.style.queryRenderedFeatures(r,n,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,n){return!1!==(n=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){var n,r;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(e,t));const i=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new jn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,i):this.style.loadJSON(e,t,i),this):(null===(r=null===(n=this.style)||void 0===n?void 0:n.projection)||void 0===r||r.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new jn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const r=this._requestManager.transformRequest(e,"Style");t.j(r,new AbortController).then(e=>{this._updateDiff(e.data,n)}).catch(e=>{e&&this.fire(new t.k(e))})}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e,n)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style.tileManagers[e];if(void 0!==n)return n.loaded();this.fire(new t.k(new Error(`There is no tile manager with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const n=this.style.tileManagers[e.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&n.reload();for(const r in this.style._layers){const n=this.style._layers[r];"hillshade"===n.type&&n.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===n.type&&n.source===e.source&&t.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new rs(this.painter,n,e),this.painter.renderToTexture=new ss(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=t=>{var n;"style"===t.dataType?this.terrain.tileManager.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(n=t.source)||void 0===n?void 0:n.type)?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.tileManagers;for(const t of Object.values(e))if(!t.areTilesLoaded())return!1;return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,t,n){if(n){const r=this.getSource(n);if(!r)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);r.calculateTileZoom=ke(Math.max(1,e),Math.max(1,t))}else for(const r in this.style.tileManagers)this.style.tileManagers[r].getSource().calculateTileZoom=ke(Math.max(1,e),Math.max(1,t));return this._update(!0),this}refreshTiles(e,n){const r=this.style.tileManagers[e];if(!r)throw new Error(`There is no tile manager with ID "${e}", cannot refresh tile`);void 0===n?r.reload(!0):r.refreshTiles(n.map(e=>new t.ac(e.z,e.x,e.y)))}addImage(e,n,r={}){const{pixelRatio:i=1,sdf:a=!1,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=r;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||t.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:o,data:d}=n,p=n;return this.style.addImage(e,{data:new t.R({width:r,height:o},new Uint8Array(d)),pixelRatio:i,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:r,height:d,data:p}=o.getImageData(n);this.style.addImage(e,{data:new t.R({width:r,height:d},p),pixelRatio:i,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0})}}updateImage(e,n){const r=this.style.getImage(e);if(!r)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=n instanceof HTMLImageElement||t.b(n)?o.getImageData(n):n,{width:a,height:s,data:l}=i;if(void 0===a||void 0===s)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==r.data.width||s!==r.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||t.b(n));return r.data.replace(l,c),this.style.updateImage(e,r),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return y.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,r={}){return this.style.setPaintProperty(e,t,n,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,r={}){return this.style.setLayoutProperty(e,t,n,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,n,e=>{e||this._update(!0)}),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,e=>{e||this._update(!0)}),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(e,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupResizeObserver(){var e;let t=!1;const n=Wi(e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())},50),r=null!==(e=this._ownerWindow.ResizeObserver)&&void 0!==e?e:ResizeObserver;this._resizeObserver=new r(e=>{t?n(e):t=!0}),this._resizeObserver.observe(this._container)}_resolveContainer(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`Container '${e}' not found.`);return t}if(e instanceof HTMLElement)return e;if(e&&"object"==typeof e&&1===e.nodeType)return e;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=u.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=u.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),r=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],r);const i=this._controlContainer=u.create("div","maplibregl-control-container",e),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{a[e]=u.create("div",`maplibregl-ctrl-${e} `,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,n){this._canvas.width=Math.floor(n*e),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",n=>{t={requestedAttributes:e},n&&(t.statusMessage=n.statusMessage,t.type=n.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!n){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new Zi(n,this.transform),h.testSupport(n)}migrateProjection(e,n){super.migrateProjection(e,n),this.painter.transform=e,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var n,r,i,a,s;const o=this._idleTriggered?this._fadeDuration:0,l=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=c();this.style.zoomHistory.update(e,n);const r=new t.H(e,{now:n,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),i=r.crossFadingFactor();1===i&&i===this._crossFadingFactor||(u=!0,this._crossFadingFactor=i),this.style.update(r)}const h=(null===(r=this.style.projection)||void 0===r?void 0:r.transitionState)>0!==l;null===(i=this.style.projection)||void 0===i||i.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(a=this.style.projection)||void 0===a?void 0:a.transitionState,null===(s=this.style.projection)||void 0===s?void 0:s.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,o,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cH.mark(t.cI.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,t.cH.mark(t.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),y.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==n?void 0:n.loseContext)&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),u.remove(this._canvasContainer),u.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cH.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frame(this._frameRequest,e=>{t.cH.frame(e),this._frameRequest=null;try{this._render(e)}catch(n){if(!t.Z(n)&&n.message!==oi)throw n}},()=>{},this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return ls}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},e.MapMouseEvent=aa,e.MapTouchEvent=sa,e.MapWheelEvent=oa,e.Marker=gs,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,t)=>{const n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute("aria-label",n)},this.options=t.e({},us,e),this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),u.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),u.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=u.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){u.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=u.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},e.Popup=class extends t.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=u.create("div","maplibregl-popup",this._map.getContainer()),this._tip=u.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ps(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const t=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const r=Ts(this.options.offset);if(!n){const e=this._container.offsetWidth,c=this._container.offsetHeight,u=(i=this.options.padding)?{top:null!==(a=i.top)&&void 0!==a?a:0,right:null!==(s=i.right)&&void 0!==s?s:0,bottom:null!==(o=i.bottom)&&void 0!==o?o:0,left:null!==(l=i.left)&&void 0!==l?l:0}:{top:0,right:0,bottom:0,left:0};let h;h=t.y+r.bottom.y<c+u.top?["top"]:t.y>this._map.transform.height-c-u.bottom?["bottom"]:[],t.x<e/2+u.left?h.push("left"):t.x>this._map.transform.width-e/2-u.right&&h.push("right"),n=0===h.length?"bottom":h.join("-")}var i,a,s,o,l;let c=t.add(r[n]);this.options.subpixelPositioning||(c=c.round()),u.setTransform(this._container,`${fs[n]} translate(${c.x}px,${c.y}px)`),ms(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Ss),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.V.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=u.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}setPadding(e){this.options.padding=e,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=u.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ks);e&&e.focus()}},e.RasterDEMTileSource=K,e.RasterTileSource=Y,e.ScaleControl=class{constructor(e){this._onMove=()=>{bs(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,bs(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xs),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){u.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=Fa,e.Style=jn,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=u.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=u.create("button","maplibregl-ctrl-terrain",this._container),u.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){u.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=za,e.TwoFingersTouchRotateHandler=Ma,e.TwoFingersTouchZoomHandler=Ia,e.TwoFingersTouchZoomRotateHandler=$a,e.VectorTileSource=X,e.VideoSource=ne,e.addSourceType=(e,n)=>t._(void 0,void 0,void 0,function*(){if(ae(e))throw new Error(`A source type called "${e}" already exists.`);var t;t=n,ie[e]=t}),e.clearPrewarmedResources=function(){const e=j;e&&e.isPreloaded()&&1===e.numActive()&&(e.release(R),j=null)},e.createTileMesh=un,e.getMaxParallelImageRequests=function(){return t.c.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return ce().getRTLTextPluginStatus()},e.getVersion=function(){return Cs},e.getWorkerCount=function(){return L.workerCount},e.getWorkerUrl=function(){return t.c.WORKER_URL},e.importScriptInWorkers=function(e){return V().broadcast("IS",e)},e.isTimeFrozen=function(){return l.isFrozen()},e.now=c,e.prewarm=function(){O().acquire(R)},e.restoreNow=function(){l.restoreNow()},e.setMaxParallelImageRequests=function(e){t.c.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setNow=function(e){l.setNow(e)},e.setRTLTextPlugin=function(e,t){return ce().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){L.workerCount=e},e.setWorkerUrl=function(e){t.c.WORKER_URL=e}}),e}();const RE=l(DE.exports);class LE{static setup(e={}){LE.options=e}static get(){return LE.options||{}}static clear(){LE.options={},LE.errorCallback=null}static onError(e){LE.errorCallback=e}static sendError(e){LE.errorCallback&&e&&LE.errorCallback(e)}}LE.errorCallback=null,LE.defaultOptions={live:!1,logLevel:"error",host:"https://api.radar.io",version:"v1",debug:!1};Error;RE.Map;RE.Marker;RE.Popup;const NE=()=>{const{customer:e,addAddress:t,deleteAddress:r,updateAddress:i}=Mp(),[a,o]=s.useState(!1),[l,c]=s.useState(null),[u,h]=s.useState(""),[d,p]=s.useState(!1),[f,m]=s.useState({first_name:"",last_name:"",address_1:"",address_2:"",city:"",province:"",postal_code:"",country_code:"za",phone:""}),g=()=>{m({first_name:e?.first_name||"",last_name:e?.last_name||"",address_1:"",address_2:"",city:"",province:"",postal_code:"",country_code:"za",phone:e?.phone||""}),h(""),o(!1),c(null)};return n.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsx("h2",{className:"text-2xl font-serif font-bold",children:"Address Book"}),!a&&n.jsxs("button",{onClick:()=>{g(),o(!0)},className:"flex items-center gap-2 text-primary font-bold uppercase text-xs tracking-widest hover:underline",children:[n.jsx(nE,{size:16})," Add New"]})]}),a?n.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-100 animate-fade-in",children:[n.jsxs("div",{className:"flex justify-between mb-4",children:[n.jsx("h3",{className:"font-bold",children:l?"Edit Address":"New Address"}),n.jsx("button",{onClick:g,children:n.jsx(vE,{size:20,className:"text-gray-400 hover:text-red-500"})})]}),void 0,n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h(""),p(!0);try{l?await i(l,f):await t(f),g()}catch(fP){h(fP.message||"Failed to save address")}finally{p(!1)}},className:"space-y-4",children:[u&&n.jsx("p",{className:"text-red-500 text-sm",children:u}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx("input",{placeholder:"First Name",required:!0,className:"border p-3 rounded-lg w-full",value:f.first_name,onChange:e=>m({...f,first_name:e.target.value})}),n.jsx("input",{placeholder:"Last Name",required:!0,className:"border p-3 rounded-lg w-full",value:f.last_name,onChange:e=>m({...f,last_name:e.target.value})})]}),n.jsx("input",{placeholder:"Address Line 1",required:!0,className:"border p-3 rounded-lg w-full",value:f.address_1,onChange:e=>m({...f,address_1:e.target.value})}),n.jsx("input",{placeholder:"Address Line 2 (Optional)",className:"border p-3 rounded-lg w-full",value:f.address_2,onChange:e=>m({...f,address_2:e.target.value})}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx("input",{placeholder:"City",required:!0,className:"border p-3 rounded-lg w-full",value:f.city,onChange:e=>m({...f,city:e.target.value})}),n.jsx("input",{placeholder:"Postal Code",required:!0,className:"border p-3 rounded-lg w-full",value:f.postal_code,onChange:e=>m({...f,postal_code:e.target.value})})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx("input",{placeholder:"Province",className:"border p-3 rounded-lg w-full",value:f.province,onChange:e=>m({...f,province:e.target.value})}),n.jsx("input",{placeholder:"Phone",className:"border p-3 rounded-lg w-full",value:f.phone,onChange:e=>m({...f,phone:e.target.value})})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx("button",{type:"submit",disabled:d,className:"bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-opacity-90 disabled:opacity-50",children:d?"Saving...":"Save Address"}),n.jsx("button",{type:"button",onClick:g,className:"px-6 py-2 rounded-lg font-bold text-gray-500 hover:bg-gray-200",children:"Cancel"})]})]})]}):n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e?.shipping_addresses?.map(e=>n.jsxs("div",{className:"border border-gray-100 rounded-xl p-6 relative group hover:shadow-md transition-all bg-white",children:[n.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx("button",{onClick:()=>{return m({first_name:(t=e).first_name||"",last_name:t.last_name||"",address_1:t.address_1||"",address_2:t.address_2||"",city:t.city||"",province:t.province||"",postal_code:t.postal_code||"",country_code:t.country_code||"za",phone:t.phone||""}),c(t.id),void o(!0);var t},className:"p-1 hover:text-blue-500",children:n.jsx(eE,{size:16})}),n.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this address?"))try{await r(e)}catch(fP){}})(e.id),className:"p-1 hover:text-red-500",children:n.jsx(mE,{size:16})})]}),n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx(YC,{className:"text-primary mt-1",size:20}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-bold text-gray-900",children:[e.first_name," ",e.last_name]}),n.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:[e.address_1,n.jsx("br",{}),e.address_2&&n.jsxs(n.Fragment,{children:[e.address_2,n.jsx("br",{})]}),e.city,", ",e.province," ",e.postal_code,n.jsx("br",{}),e.country_code?.toUpperCase()]}),e.phone&&n.jsx("p",{className:"text-gray-500 text-xs mt-2",children:e.phone})]})]})]},e.id)),(!e?.shipping_addresses||0===e.shipping_addresses.length)&&n.jsx("div",{className:"col-span-full text-center py-8 text-gray-500 italic",children:"No addresses saved yet."})]})]})},jE=()=>{const{customer:e,isLoading:t,logout:r,updateCustomer:i}=Mp(),[a,o]=s.useState("dashboard"),[l,c]=s.useState(!0),[u,h]=s.useState([]);s.useEffect(()=>{e&&"orders"===a&&d()},[e,a]);const d=async()=>{try{const{orders:e}=await bp.customers.listOrders();h(e)}catch(fP){}};if(t)return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-light-beige",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})});if(!e)return n.jsx("div",{className:"min-h-screen bg-light-beige pt-32 pb-20 px-4",children:l?n.jsx(AE,{toggleView:()=>c(!1)}):n.jsx(zE,{toggleView:()=>c(!0)})});const p=[{id:"dashboard",label:"Dashboard",icon:$C},{id:"orders",label:"Orders",icon:cE},{id:"addresses",label:"Addresses",icon:VC},{id:"details",label:"Account Details",icon:_E}];return n.jsxs("div",{className:"bg-[#f9f9f9] min-h-screen pt-24",children:[n.jsxs("div",{className:"py-16 text-center bg-white shadow-sm border-b border-gray-100 mb-12",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold mb-2",children:"My Account"}),n.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-widest font-medium",children:"Radiance Dashboard  Est. 2026"})]}),n.jsx("div",{className:"container mx-auto px-4 pb-20",children:n.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[n.jsx("div",{className:"lg:w-1/4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden sticky top-28",children:[n.jsx("div",{className:"p-6 border-b border-gray-50 bg-gray-50/30",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center text-primary font-bold text-xl",children:e.first_name?.[0]||e.email[0].toUpperCase()}),n.jsxs("div",{className:"overflow-hidden",children:[n.jsxs("p",{className:"text-sm font-bold text-gray-900 leading-tight truncate",children:[e.first_name," ",e.last_name]}),n.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.email})]})]})}),n.jsxs("div",{className:"p-2",children:[p.map(e=>n.jsxs("button",{onClick:()=>o(e.id),className:`w-full text-left flex items-center gap-3 px-4 py-3.5 text-sm font-semibold rounded-xl transition-all\n                                            ${a===e.id?"text-primary bg-primary/5 shadow-sm":"text-gray-500 hover:bg-gray-50"}\n                                        `,children:[n.jsx(e.icon,{size:18,className:a===e.id?"text-primary":"text-gray-400"}),e.label]},e.id)),n.jsxs("button",{onClick:r,className:"w-full text-left flex items-center gap-3 px-4 py-3.5 text-sm font-semibold text-red-500 hover:bg-red-50 rounded-xl transition-all mt-4",children:[n.jsx(WC,{size:18}),"Log Out"]})]})]})}),n.jsxs("div",{className:"lg:w-3/4",children:["dashboard"===a&&n.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100 animate-fade-in",children:[n.jsxs("h2",{className:"text-2xl font-serif font-bold mb-6",children:["Welcome Back, ",e.first_name||"Guest","!"]}),n.jsxs("p",{className:"text-gray-600 leading-relaxed mb-8",children:["From your dashboard, you can seamlessly manage your skincare journey. Track your",n.jsx("span",{className:"text-primary font-bold cursor-pointer hover:underline mx-1",onClick:()=>o("orders"),children:"recent orders"}),", update your ",n.jsx("span",{className:"text-primary font-bold cursor-pointer hover:underline mx-1",onClick:()=>o("addresses"),children:"shipping details"}),", and personalize your ",n.jsx("span",{className:"text-primary font-bold cursor-pointer hover:underline mx-1",onClick:()=>o("details"),children:"account security"}),"."]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{onClick:()=>o("orders"),className:"p-6 bg-light-beige/50 rounded-2xl border border-gray-100 flex items-center gap-4 group cursor-pointer hover:bg-light-beige transition-colors",children:[n.jsx("div",{className:"w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:n.jsx(cE,{size:24})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-1",children:"Recent Activity"}),n.jsx("p",{className:"font-bold text-gray-900",children:"View Orders"})]})]}),n.jsxs("div",{onClick:()=>o("details"),className:"p-6 bg-light-beige/50 rounded-2xl border border-gray-100 flex items-center gap-4 group cursor-pointer hover:bg-light-beige transition-colors",children:[n.jsx("div",{className:"w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:n.jsx(_E,{size:24})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-1",children:"My Profile"}),n.jsx("p",{className:"font-bold text-gray-900",children:"Edit Details"})]})]})]})]}),"orders"===a&&n.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100 min-h-[400px] animate-fade-in",children:[n.jsx("h2",{className:"text-2xl font-serif font-bold mb-8",children:"Order History"}),u.length>0?n.jsx("div",{className:"space-y-4",children:u.map(e=>n.jsxs("div",{className:"border border-gray-100 p-4 rounded-xl flex justify-between items-center bg-white hover:shadow-sm transition-shadow",children:[n.jsxs("div",{children:[n.jsxs("p",{className:"font-bold text-sm",children:["Order #",e.display_id]}),n.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-primary",children:["R ",(e.total/100).toFixed(2)]}),n.jsx("span",{className:"text-[10px] uppercase font-bold px-2 py-0.5 rounded-full "+("completed"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:e.status})]})]},e.id))}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-6 text-orange-200",children:n.jsx(cE,{size:40})}),n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No orders found"}),n.jsx("p",{className:"text-gray-500 text-sm mb-8",children:"It seems you haven't started your skincare journey with us yet."}),n.jsx("a",{href:"/shop",className:"inline-block bg-primary text-white px-10 py-4 rounded-xl text-sm font-bold uppercase tracking-widest hover:bg-dark-green transition-all shadow-lg shadow-primary/20",children:"Start Shopping"})]})]}),"addresses"===a&&n.jsx("div",{className:"animate-fade-in",children:n.jsx(NE,{})}),"details"===a&&n.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100 animate-fade-in",children:[n.jsx("h2",{className:"text-2xl font-serif font-bold mb-6",children:"Account Details"}),n.jsx("p",{className:"text-gray-500 text-sm mb-8",children:"Update your personal information and security settings below."}),n.jsx(FE,{customer:e})]})]})]})})]})},FE=({customer:e})=>{const{updateCustomer:t}=Mp(),[r,i]=s.useState(!1),[a,o]=s.useState(null),[l,c]=s.useState({first_name:e.first_name||"",last_name:e.last_name||"",phone:e.phone||"",password:"",password_confirm:""}),u=e=>{c({...l,[e.target.name]:e.target.value})};return n.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o(null),i(!0),l.password&&l.password!==l.password_confirm)return o({type:"error",text:"Passwords do not match."}),void i(!1);try{const e={first_name:l.first_name,last_name:l.last_name,phone:l.phone};l.password&&(e.password=l.password),await t(e),o({type:"success",text:"Account details updated successfully."}),c(e=>({...e,password:"",password_confirm:""}))}catch(n){o({type:"error",text:"Failed to update account details. Please try again."})}finally{i(!1)}},className:"space-y-6 max-w-2xl",children:[a&&n.jsx("div",{className:"p-4 rounded-xl text-sm font-medium "+("success"===a.type?"bg-green-50 text-green-600 border border-green-100":"bg-red-50 text-red-600 border border-red-100"),children:a.text}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"First Name"}),n.jsx("input",{type:"text",name:"first_name",value:l.first_name,onChange:u,className:"w-full border border-gray-200 bg-white p-3.5 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"Last Name"}),n.jsx("input",{type:"text",name:"last_name",value:l.last_name,onChange:u,className:"w-full border border-gray-200 bg-white p-3.5 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"Email"}),n.jsx("input",{type:"email",disabled:!0,value:e.email,className:"w-full border border-gray-100 bg-gray-50 text-gray-500 p-3.5 rounded-xl cursor-not-allowed"}),n.jsx("p",{className:"text-[10px] text-gray-400 mt-1.5 italic",children:"Email address cannot be changed directly."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"Phone"}),n.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:u,className:"w-full border border-gray-200 bg-white p-3.5 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),n.jsxs("div",{className:"border-t border-gray-100 pt-8 mt-8",children:[n.jsx("h3",{className:"text-lg font-bold font-serif mb-4",children:"Change Password"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"New Password"}),n.jsx("input",{type:"password",name:"password",value:l.password,onChange:u,placeholder:"Leave blank to keep current",className:"w-full border border-gray-200 bg-white p-3.5 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold uppercase text-gray-600 block mb-2",children:"Confirm Password"}),n.jsx("input",{type:"password",name:"password_confirm",value:l.password_confirm,onChange:u,placeholder:"Confirm new password",className:"w-full border border-gray-200 bg-white p-3.5 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]})]})]}),n.jsx("div",{className:"pt-4",children:n.jsx("button",{type:"submit",disabled:r,className:"bg-primary text-white px-8 py-3.5 rounded-xl font-bold uppercase tracking-widest text-sm hover:bg-dark-green transition-all shadow-lg shadow-primary/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Updating..."]}):"Save Changes"})})]})},OE=()=>{const[e,t]=s.useState({name:"",email:"",subject:"",message:""}),[r,i]=s.useState({type:"idle",message:null}),a=n=>{t({...e,[n.target.name]:n.target.value})};return n.jsxs("div",{className:"bg-white",children:[n.jsx("section",{className:"bg-light-beige py-20 border-b border-gray-100",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsx("span",{className:"text-primary font-bold tracking-widest uppercase text-xs mb-4 block",children:"Connect With Us"}),n.jsx("h1",{className:"text-5xl font-serif font-bold text-gray-900 mb-6",children:"Contact Us"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto leading-relaxed",children:"Have a question about our products or your routine? We're here to help you achieve your best skin yet."})]})}),n.jsx("div",{className:"container mx-auto px-6 py-24",children:n.jsxs("div",{className:"flex flex-col lg:flex-row gap-16",children:[n.jsxs("div",{className:"lg:w-1/3 space-y-12",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-serif font-bold text-gray-900 mb-8 border-b border-gray-100 pb-2",children:"Get In Touch"}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-primary flex-shrink-0",children:n.jsx(YC,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-900 mb-1",children:"Visit Our Hub"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Ethiopia Cres, Cosmo City, Roodepoort, 2188, South Africa"})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-secondary flex-shrink-0",children:n.jsx(XC,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-900 mb-1",children:"Email Support"}),n.jsx("p",{className:"text-sm text-gray-600",children:"hygienhub@gmail.com"})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-full flex items-center justify-center text-purple-600 flex-shrink-0",children:n.jsx(tE,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-900 mb-1",children:"Call Us"}),n.jsx("p",{className:"text-sm text-gray-600",children:"+(27) - 479 - 7830"})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center text-orange-600 flex-shrink-0",children:n.jsx(DC,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-900 mb-1",children:"Hours"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Mon - Fri: 11am - 7pm"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Sat - Sun: 10am - 4pm"})]})]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-900 mb-4 uppercase tracking-widest text-xs",children:"Follow Us"}),n.jsx("div",{className:"flex gap-3",children:[LC,qC,yE,xE].map((e,t)=>n.jsx("a",{href:"#",className:"w-10 h-10 border border-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:bg-primary hover:text-white hover:border-primary transition-all shadow-sm",children:n.jsx(e,{size:18})},t))})]})]}),n.jsxs("div",{className:"lg:w-2/3 bg-gray-50 p-8 md:p-12 rounded-sm shadow-sm border border-gray-100",children:[n.jsx("h2",{className:"text-3xl font-serif font-bold text-gray-900 mb-8",children:"Send a Message"}),n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),i({type:"loading",message:null}),setTimeout(()=>{i({type:"success",message:"Thank you! Your message has been sent successfully."}),t({name:"",email:"",subject:"",message:""})},1500)},className:"space-y-6",children:[r.message&&n.jsx("div",{className:"p-4 rounded-sm text-sm font-medium "+("success"===r.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:r.message}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Your Name"}),n.jsx("input",{type:"text",name:"name",value:e.name,onChange:a,className:"w-full px-4 py-3 bg-white border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-300",placeholder:"Full Name",required:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Your Email"}),n.jsx("input",{type:"email",name:"email",value:e.email,onChange:a,className:"w-full px-4 py-3 bg-white border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-300",placeholder:"email@example.com",required:!0})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Subject"}),n.jsx("input",{type:"text",name:"subject",value:e.subject,onChange:a,className:"w-full px-4 py-3 bg-white border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-300",placeholder:"How can we help?"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Message"}),n.jsx("textarea",{name:"message",rows:5,value:e.message,onChange:a,className:"w-full px-4 py-3 bg-white border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-300",placeholder:"Tell us more about your inquiry...",required:!0})]}),n.jsx("button",{type:"submit",disabled:"loading"===r.type,className:"w-full md:w-auto px-12 py-4 bg-primary text-white font-bold uppercase tracking-widest hover:bg-secondary transition-all shadow-md disabled:opacity-50 flex items-center justify-center gap-3",children:"loading"===r.type?"Sending...":n.jsxs(n.Fragment,{children:["Send Message ",n.jsx(aE,{size:18})]})})]})]})]})}),n.jsx("section",{className:"w-full h-[500px] bg-gray-100 grayscale hover:grayscale-0 transition-all duration-700",children:n.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3585.3570558843544!2d27.923444999999997!3d-26.0218709!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1e959d89be5b0e25%3A0x36e8c8e22370922b!2sEthiopia%20Cres%2C%20Cosmo%20City%2C%20Roodepoort%2C%202188!5e0!3m2!1sen!2sza!4v1770148987215!5m2!1sen!2sza",width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",title:"Hygiene Hub Location"})})]})},BE=()=>{const e=u(),{cart:t,isLoading:r,error:i,updateItem:a,removeItem:s}=Cp(),o=async(e,t)=>{try{await a(e,t)}catch(fP){}},l=e=>(e/100).toFixed(2);if(r&&!t)return n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(HC,{className:"w-8 h-8 animate-spin mx-auto text-primary mb-4"}),n.jsx("p",{className:"text-gray-500",children:"Loading your cart..."})]})});if(i)return n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsxs("p",{className:"text-red-500 mb-4",children:["Error: ",i]}),n.jsx(h,{to:"/shop",className:"text-primary hover:underline",children:"Return to Shop"})]})});const c=t?.items||[],d=t?.subtotal||0;return n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-10 text-center",children:"Your Cart"}),c.length>0?n.jsxs("div",{className:"flex flex-col lg:flex-row gap-12",children:[n.jsxs("div",{className:"flex-1 space-y-6",children:[c.map(e=>n.jsxs("div",{className:"flex gap-4 p-4 border border-gray-100 rounded-sm hover:shadow-sm transition-shadow",children:[n.jsx("div",{className:"w-24 h-24 bg-gray-100 flex-shrink-0",children:n.jsx("img",{src:e.thumbnail||"/images/logo.png",alt:e.title,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),n.jsx("p",{className:"text-sm text-gray-500",children:e.variant.title})]}),n.jsxs("p",{className:"font-semibold text-gray-900",children:["R",l(e.unit_price)]})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center border border-gray-200 rounded-sm",children:[n.jsx("button",{onClick:()=>o(e.id,e.quantity-1),disabled:r,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-50 text-gray-600 disabled:opacity-50",children:n.jsx(QC,{size:14})}),n.jsx("span",{className:"w-8 text-center text-sm font-medium",children:e.quantity}),n.jsx("button",{onClick:()=>o(e.id,e.quantity+1),disabled:r,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-50 text-gray-600 disabled:opacity-50",children:n.jsx(nE,{size:14})})]}),n.jsx("button",{onClick:()=>(async e=>{try{await s(e)}catch(fP){}})(e.id),disabled:r,className:"text-gray-400 hover:text-red-500 transition-colors disabled:opacity-50",children:n.jsx(mE,{size:18})})]})]})]},e.id)),n.jsx(h,{to:"/shop",className:"inline-block text-sm text-primary hover:underline mt-4",children:" Continue Shopping"})]}),n.jsx("div",{className:"lg:w-96 flex-shrink-0",children:n.jsxs("div",{className:"bg-light-beige p-6 rounded-sm border border-green-50 sticky top-28",children:[n.jsx("h2",{className:"text-lg font-serif font-bold mb-6",children:"Order Summary"}),n.jsxs("div",{className:"space-y-4 text-sm mb-6",children:[n.jsxs("div",{className:"flex justify-between text-gray-600",children:[n.jsx("span",{children:"Subtotal"}),n.jsxs("span",{children:["R",l(d)]})]}),n.jsxs("div",{className:"flex justify-between text-gray-600",children:[n.jsx("span",{children:"Shipping"}),n.jsx("span",{children:"Calculated at checkout"})]}),n.jsxs("div",{className:"border-t border-gray-200 pt-4 flex justify-between font-bold text-lg text-gray-900",children:[n.jsx("span",{children:"Total"}),n.jsxs("span",{children:["R",l(t?.total||d)]})]})]}),n.jsx("button",{onClick:()=>e("/checkout"),disabled:r||0===c.length,className:"w-full bg-primary text-white font-bold uppercase tracking-wider py-4 hover:bg-dark-green transition-colors shadow-md mb-4 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r?n.jsx(HC,{className:"w-5 h-5 animate-spin"}):n.jsxs(n.Fragment,{children:["Checkout ",n.jsx(TC,{size:18})]})}),n.jsx("p",{className:"text-xs text-center text-gray-500",children:"Secure checkout powered by Medusa"})]})})]}):n.jsxs("div",{className:"text-center py-20 bg-gray-50 rounded-lg",children:[n.jsx(cE,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),n.jsx("h2",{className:"text-2xl font-serif font-bold text-gray-400 mb-4",children:"Your cart is empty"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Looks like you haven't added anything yet."}),n.jsx(h,{to:"/shop",className:"inline-block px-8 py-3 bg-primary text-white font-bold uppercase tracking-wider hover:bg-secondary transition-colors",children:"Start Shopping"})]})]})})};function VE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function UE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qE(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,YE(r.key),r)}}function $E(e,t,n){return t&&qE(e.prototype,t),n&&qE(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function GE(e,t,n){return(t=YE(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function HE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HE(Object(n),!0).forEach(function(t){GE(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HE(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function WE(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function XE(e){return function(e){if(Array.isArray(e))return VE(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||QE(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function YE(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function KE(e){return(KE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function QE(e,t){if(e){if("string"==typeof e)return VE(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?VE(e,t):void 0}}var JE={cookieTestUrl:"https://legacy-staging.paystack.co/test-iframe/start.html",publishableKey:"uFmz/uE/SDT6GupOrSEXIZXGByjQ0zFkPyc9LqKHFqnTI0WPN3JS5kQPo/j9or0TOXlqMQj2lzHn/UGsQT4XeQ==",publicKey:"-----BEGIN PUBLIC KEY-----\r\nMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALhZs/7hP0g0+hrqTq0hFyGVxgco0NMx\r\nZD8nPS6ihxap0yNFjzdyUuZED6P4/aK9Ezl5ajEI9pcx5/1BrEE+F3kCAwEAAQ==\r\n-----END PUBLIC KEY-----",applePayVersion:6,applePayValidateSessionPath:"applepay/validate-session/",applePayChargePath:"applepay/charge"};ZE(ZE({},JE),{},{checkoutUrl:"http://localhost:8081/",paymentBaseUrl:"https://legacy-staging.paystack.co/",paystackApiUrl:"https://studio-api.paystack.co/",siteUrl:"https://paystack.com",pusherKey:"1c7b262ee18455815893",pusherUrl:"http://localhost:8081/static/vendor/pusher.min.js"});var eI=ZE(ZE({},JE),{},{checkoutUrl:"https://checkout-studio.paystack.com/",paymentBaseUrl:"https://legacy-staging.paystack.co/",paystackApiUrl:"https://studio-api.paystack.co/",siteUrl:"https://beta.paystack.com",pusherKey:"1c7b262ee18455815893",pusherUrl:"https://checkout-studio.paystack.com/static/vendor/pusher.min.js"}),tI=ZE(ZE({},JE),{},{checkoutUrl:"https://checkout.paystack.com/",paymentBaseUrl:"https://standard.paystack.co/",paystackApiUrl:"https://api.paystack.co/",siteUrl:"https://paystack.com",pusherKey:"8e4b9b7ca3418bd5cdc8",pusherUrl:"https://checkout.paystack.com/static/vendor/pusher.min.js"})||eI;function nI(e,t){var n=[];return Object.keys(e).forEach(function(r){var i=t?"".concat(t,"[").concat(r,"]"):r,a=e[i];n.push(null!==a&&"object"===("undefined"==typeof v?"undefined":KE(v))?nI(a,i):"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(a)))}),n.join("&")}function rI(){return document.currentScript||(e=document.getElementsByTagName("script"))[e.length-1];var e}function iI(){var e=[],t=rI();if(t){var n=Array.prototype.slice.call(t.attributes);e=Object.keys(n).filter(function(e){var t=n[e].nodeName;return t&&t.indexOf("data")>-1}).map(function(e){return n[e].nodeName})}return e}var aI='\n  <svg id="inline-button-wordmark--white" width="137" height="13" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M.037 5.095l1.075-.135c-.011-.774-.025-1.944-.013-2.149C1.19 1.364 2.38.134 3.81.013 3.9.006 3.99.002 4.077 0a2.947 2.947 0 0 1 2.046.76c.574.509.95 1.26 1.008 2.007.015.192.01 1.491.01 2.257l1.096.163L8.2 11.44 4.093 12 0 11.346l.037-6.251zm4.106-.514l1.724.256c-.007-.933-.05-2.295-.26-2.654-.319-.545-.846-.867-1.443-.88h-.063c-.607.008-1.138.322-1.458.864-.222.378-.266 1.66-.265 2.637l1.765-.223zM18.228 10.108c-.576 0-1.064-.072-1.464-.216a2.864 2.864 0 0 1-.972-.6 2.552 2.552 0 0 1-.588-.864 4.067 4.067 0 0 1-.252-1.044h1.008c.032.256.088.5.168.732.08.224.204.424.372.6.168.168.388.304.66.408.28.096.636.144 1.068.144.28 0 .536-.036.768-.108.24-.08.448-.192.624-.336.176-.144.312-.316.408-.516.104-.2.156-.42.156-.66 0-.24-.032-.448-.096-.624a1.02 1.02 0 0 0-.336-.468 1.885 1.885 0 0 0-.636-.324 6.4 6.4 0 0 0-1.008-.228 8.79 8.79 0 0 1-1.212-.276 3.246 3.246 0 0 1-.9-.432 1.982 1.982 0 0 1-.564-.672c-.128-.272-.192-.6-.192-.984 0-.328.068-.632.204-.912.136-.288.324-.536.564-.744.248-.208.54-.372.876-.492.336-.12.708-.18 1.116-.18.864 0 1.548.204 2.052.612.512.4.812.984.9 1.752h-.936c-.104-.544-.316-.932-.636-1.164-.32-.24-.78-.36-1.38-.36-.592 0-1.04.132-1.344.396a1.255 1.255 0 0 0-.444.996c0 .208.024.396.072.564.056.16.156.3.3.42.152.12.36.228.624.324a6.72 6.72 0 0 0 1.068.228c.48.072.9.168 1.26.288.36.12.664.276.912.468s.432.428.552.708c.128.28.192.624.192 1.032 0 .36-.076.696-.228 1.008a2.472 2.472 0 0 1-.612.804c-.264.224-.58.4-.948.528-.36.128-.752.192-1.176.192zM25.355 10.108c-.44 0-.848-.076-1.224-.228a2.916 2.916 0 0 1-.96-.636 2.966 2.966 0 0 1-.636-1.008 3.77 3.77 0 0 1-.216-1.308v-.096c0-.472.072-.904.216-1.296.144-.4.344-.74.6-1.02.264-.288.576-.508.936-.66.36-.16.756-.24 1.188-.24.36 0 .708.06 1.044.18.344.112.648.292.912.54.264.248.472.572.624.972.16.392.24.868.24 1.428v.324h-4.728c.024.72.204 1.272.54 1.656.336.376.828.564 1.476.564.984 0 1.54-.364 1.668-1.092h.996c-.112.632-.408 1.112-.888 1.44-.48.32-1.076.48-1.788.48zm1.704-3.852c-.048-.648-.232-1.112-.552-1.392-.312-.28-.728-.42-1.248-.42-.512 0-.932.164-1.26.492-.32.32-.524.76-.612 1.32h3.672zM32.091 10.108c-.44 0-.848-.072-1.224-.216a3.054 3.054 0 0 1-.972-.636 3.12 3.12 0 0 1-.648-1.008 3.626 3.626 0 0 1-.228-1.32v-.096c0-.48.08-.916.24-1.308.16-.4.376-.74.648-1.02.28-.28.604-.496.972-.648.376-.16.772-.24 1.188-.24.328 0 .644.04.948.12.312.08.588.208.828.384.248.168.456.392.624.672.168.28.276.62.324 1.02h-.984c-.08-.496-.284-.848-.612-1.056-.32-.208-.696-.312-1.128-.312a1.93 1.93 0 0 0-.804.168c-.24.112-.452.272-.636.48a2.23 2.23 0 0 0-.42.744 2.991 2.991 0 0 0-.156.996v.096c0 .776.188 1.364.564 1.764.384.392.88.588 1.488.588.224 0 .436-.032.636-.096a1.651 1.651 0 0 0 .96-.768c.112-.192.18-.416.204-.672h.924a2.595 2.595 0 0 1-.276.948 2.386 2.386 0 0 1-.576.744c-.24.208-.52.372-.84.492-.32.12-.668.18-1.044.18zM38.335 10.108a2.83 2.83 0 0 1-.876-.132 1.724 1.724 0 0 1-.684-.42 2.145 2.145 0 0 1-.456-.756c-.112-.304-.168-.672-.168-1.104V3.724h.996v3.924c0 .552.116.956.348 1.212.24.256.608.384 1.104.384.224 0 .44-.036.648-.108.208-.072.392-.18.552-.324.16-.144.288-.324.384-.54.096-.216.144-.464.144-.744V3.724h.996V10h-.996v-.996c-.144.296-.388.556-.732.78-.336.216-.756.324-1.26.324zM43.216 3.724h.996v1.128c.2-.352.452-.64.756-.864.312-.232.748-.356 1.308-.372v.936a4.461 4.461 0 0 0-.852.12 1.647 1.647 0 0 0-.66.324 1.472 1.472 0 0 0-.408.612c-.096.248-.144.564-.144.948V10h-.996V3.724zM50 10.108c-.44 0-.848-.076-1.224-.228a2.916 2.916 0 0 1-.96-.636 2.966 2.966 0 0 1-.636-1.008 3.77 3.77 0 0 1-.216-1.308v-.096c0-.472.072-.904.216-1.296.144-.4.344-.74.6-1.02.264-.288.576-.508.936-.66.36-.16.756-.24 1.188-.24.36 0 .708.06 1.044.18.344.112.648.292.912.54.264.248.472.572.624.972.16.392.24.868.24 1.428v.324h-4.728c.024.72.204 1.272.54 1.656.336.376.828.564 1.476.564.984 0 1.54-.364 1.668-1.092h.996c-.112.632-.408 1.112-.888 1.44-.48.32-1.076.48-1.788.48zm1.704-3.852c-.048-.648-.232-1.112-.552-1.392-.312-.28-.728-.42-1.248-.42-.512 0-.932.164-1.26.492-.32.32-.524.76-.612 1.32h3.672zM56.496 10.108c-.408 0-.788-.068-1.14-.204a2.683 2.683 0 0 1-.9-.612 3.01 3.01 0 0 1-.588-.984 4.01 4.01 0 0 1-.204-1.32v-.096c0-.48.072-.92.216-1.32.144-.4.344-.744.6-1.032.256-.296.564-.524.924-.684.36-.16.756-.24 1.188-.24.528 0 .956.112 1.284.336.328.216.584.476.768.78V.724h.996V10h-.996V8.92c-.088.152-.208.3-.36.444a2.792 2.792 0 0 1-.516.384 2.874 2.874 0 0 1-.6.252c-.216.072-.44.108-.672.108zm.108-.828c.288 0 .56-.048.816-.144.256-.096.476-.24.66-.432.184-.2.328-.448.432-.744.112-.304.168-.656.168-1.056v-.096c0-.808-.18-1.404-.54-1.788-.352-.384-.836-.576-1.452-.576-.624 0-1.112.208-1.464.624-.352.416-.528 1.008-.528 1.776v.096c0 .392.048.736.144 1.032.104.296.24.54.408.732.176.192.38.336.612.432.232.096.48.144.744.144zM67.712 10.108c-.512 0-.948-.112-1.308-.336a2.38 2.38 0 0 1-.816-.804V10h-.996V.724h.996V4.78a1.92 1.92 0 0 1 .348-.432c.152-.144.32-.268.504-.372.192-.112.396-.2.612-.264.216-.064.436-.096.66-.096.408 0 .788.072 1.14.216.352.144.652.352.9.624.256.272.456.604.6.996.144.392.216.832.216 1.32v.096c0 .48-.068.92-.204 1.32a3.103 3.103 0 0 1-.576 1.02 2.583 2.583 0 0 1-.9.672 2.937 2.937 0 0 1-1.176.228zm-.096-.828c.624 0 1.1-.2 1.428-.6.328-.408.492-.996.492-1.764V6.82c0-.4-.052-.748-.156-1.044a2.095 2.095 0 0 0-.42-.732 1.53 1.53 0 0 0-.612-.444 1.798 1.798 0 0 0-.744-.156c-.288 0-.56.048-.816.144a1.71 1.71 0 0 0-.648.444c-.184.192-.328.44-.432.744a3.152 3.152 0 0 0-.156 1.044v.096c0 .8.192 1.396.576 1.788.384.384.88.576 1.488.576zM73.63 9.352l-2.46-5.628h1.068l1.92 4.5 1.74-4.5h1.02l-3.468 8.46h-1.008l1.188-2.832zM87.127 3.669A3.138 3.138 0 0 0 86.1 2.95a3.09 3.09 0 0 0-1.228-.25c-.448 0-.848.086-1.187.26a2.199 2.199 0 0 0-.662.497v-.191a.387.387 0 0 0-.214-.348.323.323 0 0 0-.14-.03h-1.315a.314.314 0 0 0-.254.116.377.377 0 0 0-.1.262v8.97c0 .1.034.188.1.258a.34.34 0 0 0 .254.103h1.341a.342.342 0 0 0 .244-.103.336.336 0 0 0 .11-.259v-3.06c.178.202.417.357.702.464.35.134.72.203 1.093.203.43 0 .848-.082 1.242-.248a3.124 3.124 0 0 0 1.04-.724c.305-.326.545-.709.707-1.128a3.93 3.93 0 0 0 .263-1.477c0-.54-.086-1.037-.263-1.477a3.387 3.387 0 0 0-.706-1.12zm-1.204 3.24c-.073.19-.18.362-.315.51a1.415 1.415 0 0 1-1.065.466c-.2.001-.4-.04-.584-.12a1.484 1.484 0 0 1-.49-.346 1.593 1.593 0 0 1-.32-.51 1.738 1.738 0 0 1-.115-.63c0-.224.04-.435.115-.631a1.532 1.532 0 0 1 .804-.846c.185-.086.386-.13.59-.129.215 0 .414.044.593.13.177.083.338.199.474.341a1.622 1.622 0 0 1 .425 1.135c0 .225-.037.436-.112.63zM95.298 2.89h-1.33a.339.339 0 0 0-.246.11.384.384 0 0 0-.108.266v.166a1.856 1.856 0 0 0-.602-.472 2.525 2.525 0 0 0-1.166-.258 3.227 3.227 0 0 0-2.284.964 3.554 3.554 0 0 0-.734 1.123 3.827 3.827 0 0 0-.275 1.477c0 .54.092 1.037.275 1.477.184.434.427.817.728 1.128a3.146 3.146 0 0 0 2.277.973c.437 0 .834-.088 1.173-.259.25-.13.456-.287.608-.471v.177a.34.34 0 0 0 .11.259.341.341 0 0 0 .244.104h1.33a.324.324 0 0 0 .25-.105.349.349 0 0 0 .102-.258V3.267a.377.377 0 0 0-.1-.262.325.325 0 0 0-.252-.115zM93.502 6.9a1.55 1.55 0 0 1-.312.511c-.136.143-.296.26-.473.344-.178.085-.38.129-.596.129-.207 0-.407-.044-.59-.13a1.501 1.501 0 0 1-.791-.855 1.766 1.766 0 0 1-.112-.62c0-.225.038-.436.112-.632.075-.193.181-.364.314-.504.137-.143.3-.26.478-.342.182-.085.382-.129.59-.129.215 0 .417.044.595.13.178.085.338.2.473.341a1.623 1.623 0 0 1 .424 1.135c0 .215-.037.424-.112.622zM108.567 6.094a2.265 2.265 0 0 0-.654-.402c-.247-.101-.509-.181-.785-.235l-1.014-.204c-.26-.05-.441-.117-.543-.203a.328.328 0 0 1-.136-.264c0-.11.063-.2.189-.282.137-.086.329-.13.566-.13.26 0 .518.053.757.157.243.106.471.226.67.36.295.187.546.162.727-.053l.487-.57a.543.543 0 0 0 .152-.357c0-.128-.064-.245-.185-.351-.207-.184-.533-.378-.971-.568-.437-.192-.987-.29-1.637-.29-.427 0-.82.058-1.168.172-.35.116-.65.276-.893.474-.245.204-.438.44-.57.713a2 2 0 0 0-.198.875c0 .56.167 1.017.496 1.358.328.333.766.56 1.304.67l1.054.232c.3.062.528.132.675.21.129.067.19.163.19.297 0 .12-.061.227-.188.324-.133.104-.342.155-.622.155a1.83 1.83 0 0 1-.831-.19 3.056 3.056 0 0 1-.678-.458.995.995 0 0 0-.307-.17c-.126-.037-.268.003-.431.13l-.583.461c-.169.145-.24.32-.209.522.029.194.19.394.491.62.269.193.614.368 1.029.518.415.151.901.229 1.453.229.444 0 .854-.058 1.215-.172.362-.119.681-.278.941-.48a2.056 2.056 0 0 0 .819-1.663c0-.319-.053-.6-.165-.836a1.843 1.843 0 0 0-.447-.6zM114.383 7.73a.363.363 0 0 0-.295-.192.55.55 0 0 0-.343.113c-.095.062-.198.11-.306.141a.75.75 0 0 1-.426.013.43.43 0 0 1-.181-.093.554.554 0 0 1-.143-.204.92.92 0 0 1-.059-.362v-2.46h1.731c.099 0 .188-.04.266-.117a.368.368 0 0 0 .112-.26V3.268a.369.369 0 0 0-.115-.268.38.38 0 0 0-.263-.109h-1.732V1.216a.354.354 0 0 0-.108-.27.347.347 0 0 0-.243-.104h-1.344a.36.36 0 0 0-.34.226.371.371 0 0 0-.027.148V2.89h-.767a.324.324 0 0 0-.255.115.385.385 0 0 0-.098.262V4.31a.4.4 0 0 0 .212.346c.044.021.092.032.14.03h.768v2.925c0 .39.069.726.2 1.003.132.274.305.504.514.676.217.178.465.31.731.388.27.084.551.126.833.126.385 0 .75-.061 1.094-.18a2.13 2.13 0 0 0 .861-.552c.152-.181.17-.381.046-.581l-.463-.76zM121.672 2.89h-1.329a.339.339 0 0 0-.244.11.39.39 0 0 0-.08.122.394.394 0 0 0-.027.144v.166a1.906 1.906 0 0 0-.605-.472c-.335-.173-.726-.258-1.168-.258-.42 0-.834.083-1.226.249a3.24 3.24 0 0 0-1.055.715 3.528 3.528 0 0 0-.734 1.123 3.79 3.79 0 0 0-.276 1.477c0 .54.092 1.037.275 1.477.184.434.428.817.729 1.128a3.138 3.138 0 0 0 2.273.973 2.59 2.59 0 0 0 1.175-.259c.255-.13.457-.287.612-.471v.177a.34.34 0 0 0 .108.259.343.343 0 0 0 .243.104h1.329a.335.335 0 0 0 .252-.105.364.364 0 0 0 .102-.258V3.267a.38.38 0 0 0-.1-.262.332.332 0 0 0-.115-.087.311.311 0 0 0-.139-.028zM119.876 6.9a1.534 1.534 0 0 1-.786.855 1.362 1.362 0 0 1-.594.129c-.207 0-.405-.044-.588-.13a1.516 1.516 0 0 1-.792-.855 1.757 1.757 0 0 1-.113-.62c0-.225.037-.436.112-.632.073-.187.179-.358.314-.504.138-.143.3-.26.479-.342.184-.086.385-.13.588-.129.217 0 .415.044.594.13.181.085.34.2.472.341.134.143.24.313.314.504a1.73 1.73 0 0 1 0 1.253zM128.978 7.64l-.763-.593c-.146-.118-.284-.15-.404-.1a.742.742 0 0 0-.279.205 2.527 2.527 0 0 1-.583.535c-.192.122-.444.183-.742.183-.219 0-.42-.04-.6-.122a1.423 1.423 0 0 1-.469-.342 1.575 1.575 0 0 1-.308-.51 1.751 1.751 0 0 1-.106-.617c0-.228.034-.438.106-.632.07-.192.173-.363.308-.503.135-.144.295-.26.472-.342.187-.088.391-.132.597-.13.298 0 .547.064.742.187.198.126.396.306.584.534.078.092.17.16.278.206.122.048.259.016.401-.101l.762-.594a.53.53 0 0 0 .201-.269.437.437 0 0 0-.034-.365 3.329 3.329 0 0 0-1.18-1.127c-.504-.291-1.108-.441-1.784-.441a3.519 3.519 0 0 0-2.51 1.033c-.322.322-.576.71-.747 1.137a3.68 3.68 0 0 0-.273 1.407c0 .495.093.968.273 1.402.173.424.427.808.747 1.128a3.527 3.527 0 0 0 2.51 1.034c.676 0 1.28-.149 1.784-.444a3.286 3.286 0 0 0 1.182-1.13.411.411 0 0 0 .055-.173.415.415 0 0 0-.023-.182.624.624 0 0 0-.197-.273zM136.06 9.045l-2.104-3.143 1.801-2.415c.094-.139.119-.272.075-.397-.031-.09-.116-.2-.334-.2h-1.425a.52.52 0 0 0-.234.058.482.482 0 0 0-.209.205L132.191 5.2h-.349V.363a.37.37 0 0 0-.099-.26.352.352 0 0 0-.253-.103h-1.332a.37.37 0 0 0-.337.22.346.346 0 0 0-.027.143V9.29c0 .103.038.193.11.259a.353.353 0 0 0 .254.104h1.333a.328.328 0 0 0 .251-.105.346.346 0 0 0 .075-.119.333.333 0 0 0 .024-.14V6.927h.386l1.571 2.446c.112.187.267.281.46.281h1.491c.226 0 .32-.11.358-.202.054-.13.038-.262-.047-.406zM102.863 2.89h-1.489a.389.389 0 0 0-.298.122.544.544 0 0 0-.13.249l-1.099 4.167h-.268l-1.182-4.167a.66.66 0 0 0-.113-.247.329.329 0 0 0-.264-.124h-1.544c-.199 0-.325.066-.372.193a.588.588 0 0 0-.002.37l1.887 5.865c.03.093.08.17.145.232a.388.388 0 0 0 .281.104h.798l-.066.19-.19.547a.872.872 0 0 1-.29.426.7.7 0 0 1-.442.148.956.956 0 0 1-.4-.09 1.842 1.842 0 0 1-.35-.209.62.62 0 0 0-.335-.115h-.016c-.13 0-.243.074-.334.216l-.474.708c-.193.304-.086.504.039.615.234.224.528.399.875.524.344.125.723.186 1.126.186.682 0 1.252-.187 1.689-.565.435-.376.756-.887.952-1.524l2.188-7.258c.05-.155.05-.284.005-.389-.037-.08-.125-.174-.327-.174z" fill="#ffffff"/>\n  </svg>\n',sI={height:"50px",width:"auto",borderRadius:"3px",padding:"10px",locale:"en",type:"pay"},oI=function(e){return e&&"object"===KE(e)?Object.keys(sI).reduce(function(t,n){return ZE(ZE({},t),{},GE({},n,e[n]||sI[n]))},{}):sI},lI=function(){return Number(parseFloat((arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/100).toFixed(2))},cI={headers:{accept:"application/json, text/plain, */*","accept-language":"en-GB,en-US;q=0.9,en;q=0.8","content-type":"application/x-www-form-urlencoded","sec-ch-ua-mobile":"?0","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrerPolicy:"no-referrer-when-downgrade",method:"POST",mode:"cors",credentials:"omit"};function uI(e){return Object.keys(e).reduce(function(t,n){var r=encodeURIComponent(n),i=encodeURIComponent(e[n]),a="".concat(r,"=").concat(i);return[].concat(XE(t),[a])},[]).join("&")}var hI=function(e){return{biannually:"BIANNUAL PLAN",annually:"ANNUAL PLAN"}[e]||"".concat(e.toUpperCase()," PLAN")},dI=function(){try{return window.location&&"https:"===window.location.protocol&&window.ApplePaySession&&window.ApplePaySession.supportsVersion(tI.applePayVersion)}catch(ZI){return!1}},pI=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return dI()&&e.includes("apple_pay")};function fI(e){var t=document.createElement("iframe");return t.setAttribute("frameBorder","0"),t.setAttribute("allowtransparency","true"),t.id=e,t.style.display="none",t}function mI(e){return e.querySelector("apple-pay-button")||e.querySelector("#apple-pay-button")}function gI(e){return document.querySelector("#".concat(e))}function yI(e,t,n){var r=t.channels,i=void 0===r?[]:r,a=t.styles,s=void 0===a?{}:a,o={applePay:!1};return new Promise(function(t,r){if(e)if(pI(i)){if(mI(e))return o.applePay=!0,void t(o);(a={container:e,integrity:"sha384-z/6BVHCcSypLSykOVpaT1PQWHOOgU45uOOlMkgi/bElX4yFqmChNMb7qiv80wFav"},l=a.container,c=a.integrity,new Promise(function(e,t){var n=document.createElement("script");n.src="https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js",n.crossOrigin="anonymous",c&&(n.integrity=c),n.addEventListener("load",function(){e(!0)}),n.addEventListener("error",function(){n.remove(),t(!1)}),l?l.appendChild(n):document.head.appendChild(n)})).then(function(){if(n&&1077497!==n&&window&&!Array.isArray(window.webpackJsonp))throw new Error("Incorrect data type for 'webpackJsonp', expected array, got ".concat(KE(window.webpackJsonp),". Switching to fallback apple pay button"));!function(e,t){var n,r,i,a,s,o=t.styles,l=t.theme,c=document.createElement("style"),u=(r=(n=o).height,i=n.width,a=n.borderRadius,s=n.padding,"\n  apple-pay-button {\n    --apple-pay-button-width: ".concat(i,";\n    --apple-pay-button-height: ").concat(r,";\n    --apple-pay-button-border-radius: ").concat(a,";\n    --apple-pay-button-padding: ").concat(s,";\n    --apple-pay-button-box-sizing: border-box;\n    width: ").concat(i,";\n  }\n"));c.type="text/css",c.styleSheet?c.styleSheet.cssText=u:c.appendChild(document.createTextNode(u)),e.appendChild(c);var h=document.createElement("apple-pay-button");h.setAttribute("buttonstyle","light"===l?"white":"black"),h.setAttribute("type",o.type),h.setAttribute("locale",o.locale),e.appendChild(h)}(e,{styles:oI(s.applePay),theme:s.theme}),o.applePay=!0,t(o)}).catch(function(){!function(e,t){var n,r,i,a,s,o,l,c=t.styles,u=t.theme,h=document.createElement("style"),d=(r=(n=c).height,i=n.width,a=n.borderRadius,s=n.padding,o=n.type,l=n.locale,"\n  @supports (-webkit-appearance: -apple-pay-button) { \n    .apple-pay-button {\n        display: inline-block;\n        -webkit-appearance: -apple-pay-button;\n        width: ".concat(i,";\n        height: ").concat(r,";\n        border-radius: ").concat(a,";\n        padding: ").concat(s,";\n        -apple-pay-button-type: ").concat(o,";\n        -webkit-locale: ").concat(l,";\n    }\n    .apple-pay-button-black {\n        -apple-pay-button-style: black;\n    }\n    .apple-pay-button-white {\n        -apple-pay-button-style: white;\n    }\n    .apple-pay-button-white-with-line {\n        -apple-pay-button-style: white-outline;\n    }\n  }\n\n  @supports not (-webkit-appearance: -apple-pay-button) {\n    .apple-pay-button {\n        display: inline-block;\n        background-size: 100% 60%;\n        background-repeat: no-repeat;\n        background-position: 50% 50%;\n        border-radius: 5px;\n        padding: 0px;\n        box-sizing: border-box;\n        min-width: 200px;\n        min-height: 32px;\n        max-height: 64px;\n    }\n    .apple-pay-button-black {\n        background-image: -webkit-named-image(apple-pay-logo-white);\n        background-color: black;\n    }\n    .apple-pay-button-white {\n        background-image: -webkit-named-image(apple-pay-logo-black);\n        background-color: white;\n    }\n    .apple-pay-button-white-with-line {\n        background-image: -webkit-named-image(apple-pay-logo-black);\n        background-color: white;\n        border: .5px solid black;\n    }\n  }\n"));h.type="text/css",h.styleSheet?h.styleSheet.cssText=d:h.appendChild(document.createTextNode(d)),e.appendChild(h);var p=document.createElement("button");p.classList.add("apple-pay-button","light"===u?"apple-pay-button-white":"apple-pay-button-black"),p.id="apple-pay-button";var f=document.createElement("span");f.classList.add("logo"),p.appendChild(f),e.appendChild(p)}(e,{styles:oI(s.applePay),theme:s.theme}),o.applePay=!0,t(o)})}else r("No wallet payment method is available on this device");else r("Container to mount elements was not provided");var a,l,c})}var _I="payment-request-button",vI="paystackpop-button",xI="pay-with-vault-button";function bI(e){var t=document.createElement("button");return t.id=vI,t.className="open-paystack-pop-button",t.innerText=e,t}function wI(e){return e.querySelector("#".concat(vI))}function SI(){var e=document.createElement("div");return e.id=_I,e}function kI(e){return e.querySelector("#".concat(_I))}function TI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement("div");n.className="vault-logo-container",n.innerHTML='\n<svg width="74" height="19" viewBox="0 0 74 19" fill="none" xmlns="http://www.w3.org/2000/svg" id="vault-logo">\n  <g clip-path="url(#clip0_9910_9664)">\n    <path\n      d="M32.1273 15.8163H28.9432C28.6448 15.8163 28.4481 15.6622 28.3497 15.3507L25.1886 6.20188C25.1165 6.01825 25.1296 5.85101 25.2214 5.70345C25.3132 5.55589 25.451 5.48047 25.6346 5.48047H27.9693C28.2513 5.48047 28.435 5.63787 28.5202 5.94611L30.6648 12.9077L32.5536 5.94611C32.6388 5.63459 32.829 5.48047 33.1274 5.48047H35.4195C35.6031 5.48047 35.7441 5.55589 35.8425 5.70345C35.9409 5.85101 35.954 6.01825 35.8851 6.20188L32.7241 15.3507C32.6257 15.6622 32.4257 15.8163 32.1305 15.8163H32.1273Z"\n      fill="#343C43" />\n    <path\n      d="M37.6361 14.5842C36.6097 13.5644 36.0981 12.2495 36.0981 10.6362C36.0981 9.02283 36.6097 7.71118 37.6361 6.69792C38.6624 5.68795 39.8757 5.17969 41.2759 5.17969C41.9416 5.17969 42.5384 5.31085 43.0696 5.57318C43.6008 5.83551 43.9943 6.16998 44.2468 6.57988V5.94373C44.2468 5.81584 44.2927 5.70763 44.3845 5.61581C44.4763 5.524 44.578 5.47809 44.6927 5.47809H46.8373C46.9652 5.47809 47.0701 5.524 47.1554 5.61581C47.2406 5.70763 47.2833 5.81584 47.2833 5.94373V15.3679C47.2833 15.4958 47.2406 15.6008 47.1554 15.686C47.0701 15.7713 46.9652 15.8139 46.8373 15.8139H44.6927C44.578 15.8139 44.4763 15.7713 44.3845 15.686C44.2927 15.6008 44.2468 15.4958 44.2468 15.3679V14.7088C43.991 15.1187 43.6008 15.4565 43.0696 15.7155C42.5384 15.9779 41.935 16.109 41.2562 16.109C39.8691 16.109 38.6624 15.6008 37.6361 14.581V14.5842ZM39.9151 8.79985C39.433 9.31795 39.1936 9.93443 39.1936 10.6558C39.1936 11.3772 39.433 11.997 39.9151 12.5118C40.3971 13.0299 40.9972 13.2857 41.7186 13.2857C42.44 13.2857 43.0401 13.0266 43.5221 12.5118C44.0041 11.997 44.2435 11.3772 44.2435 10.6558C44.2435 9.93443 44.0041 9.31467 43.5221 8.79985C43.0401 8.28502 42.44 8.02597 41.7186 8.02597C40.9972 8.02597 40.3938 8.28502 39.9151 8.79985Z"\n      fill="#343C43" />\n    <path\n      d="M51.6315 5.9016V11.2302C51.6315 11.9385 51.8086 12.4959 52.1627 12.9058C52.5169 13.3157 53.0415 13.5223 53.7334 13.5223C54.4253 13.5223 54.9401 13.319 55.3139 12.9058C55.6878 12.4959 55.878 11.9516 55.878 11.2728V5.9016C55.878 5.78683 55.9239 5.68845 56.0157 5.60319C56.1075 5.51794 56.2092 5.47531 56.3239 5.47531H58.4685C58.6095 5.47531 58.7242 5.52122 58.8095 5.61303C58.8948 5.70485 58.9374 5.81306 58.9374 5.94094V15.3652C58.9374 15.4931 58.8948 15.598 58.8095 15.6832C58.7242 15.7685 58.6128 15.8111 58.4685 15.8111H56.3239C56.196 15.8111 56.0911 15.7718 56.0058 15.6931C55.9206 15.6144 55.878 15.5127 55.878 15.3848V14.7257C55.1139 15.6472 54.081 16.1062 52.7792 16.1062C51.4774 16.1062 50.4707 15.7062 49.7132 14.9061C48.9557 14.106 48.5786 13.0501 48.5786 11.7319V5.89504C48.5786 5.78027 48.6278 5.68189 48.7262 5.59664C48.8246 5.51138 48.9295 5.46875 49.0442 5.46875H51.1658C51.2937 5.46875 51.4019 5.51138 51.4938 5.59664C51.5856 5.68189 51.6315 5.78027 51.6315 5.89504V5.9016Z"\n      fill="#343C43" />\n    <path\n      d="M62.9872 15.8148C62.0658 15.8148 61.387 15.582 60.9509 15.113C60.5115 14.6474 60.2917 14.0178 60.2917 13.2243V1.42267C60.2917 1.29478 60.3344 1.18657 60.4196 1.09475C60.5049 1.00294 60.6164 0.957031 60.7607 0.957031H62.8823C63.0233 0.957031 63.138 1.00294 63.2233 1.09475C63.3085 1.18657 63.3512 1.29478 63.3512 1.42267V12.6078C63.3512 12.8045 63.4069 12.9652 63.5217 13.0865C63.6332 13.2079 63.7906 13.2669 63.9873 13.2669H64.6464C64.9448 13.2669 65.0924 13.4144 65.0924 13.7129V15.2409C65.0924 15.6246 64.8956 15.8148 64.4989 15.8148H62.9905H62.9872Z"\n      fill="#343C43" />\n    <path\n      d="M66.722 12.7378V8.04861H65.3644C65.2365 8.04861 65.1316 8.00271 65.0463 7.91089C64.9611 7.81907 64.9185 7.71086 64.9185 7.58298V5.94997C64.9185 5.82208 64.9611 5.71387 65.0463 5.62206C65.1316 5.53024 65.2365 5.48433 65.3644 5.48433H66.722V2.74626C66.722 2.60526 66.7679 2.49049 66.8597 2.40523C66.9515 2.31997 67.0597 2.27734 67.1876 2.27734H69.3518C69.4666 2.27734 69.5683 2.31997 69.6601 2.40523C69.7519 2.49049 69.7978 2.60198 69.7978 2.74626V5.48433H72.7064C72.8343 5.48433 72.9458 5.53024 73.0474 5.62206C73.1458 5.71387 73.195 5.82208 73.195 5.94997V7.58298C73.195 7.69775 73.1458 7.80268 73.0474 7.90105C72.949 7.99943 72.8343 8.04861 72.7064 8.04861H69.7978V12.0164C69.7978 12.4689 69.9027 12.7804 70.1159 12.9509C70.329 13.1214 70.5684 13.2067 70.8373 13.2067C71.1193 13.2067 71.4308 13.1083 71.7718 12.9083C72.1555 12.6689 72.4441 12.6951 72.6408 12.9935L73.3852 14.1806C73.5557 14.4495 73.5327 14.7052 73.3229 14.9446C72.6146 15.6792 71.5948 16.0497 70.2667 16.0497C69.2764 16.0497 68.437 15.7742 67.7516 15.2234C67.0663 14.6725 66.722 13.8428 66.722 12.741V12.7378Z"\n      fill="#343C43" />\n    <path\n      d="M15.2266 0H4.43496C2.26089 0 0.5 1.76089 0.5 3.93496V14.7266C0.5 16.9006 2.26089 18.6615 4.43496 18.6615H15.2266C17.4006 18.6615 19.1615 16.9006 19.1615 14.7266V3.93496C19.1615 1.76089 17.4006 0 15.2266 0ZM15.079 12.2312L12.1442 14.6118C11.9114 14.8086 11.5507 14.6807 11.4949 14.379L10.8161 11.8934C10.7702 11.6934 10.8489 11.4868 11.0096 11.3589C11.4425 11.0113 11.7179 10.4801 11.7179 9.8833C11.7179 8.44048 10.098 7.37476 8.5765 8.40113C8.48468 8.46344 8.40598 8.54214 8.34368 8.63723C7.63539 9.68983 7.92723 10.7883 8.65192 11.3655C8.8126 11.4934 8.88474 11.6967 8.84211 11.8967L8.22891 14.3823C8.17317 14.6839 7.81246 14.8118 7.57964 14.6151L4.57924 12.2344C4.47431 12.1262 4.41856 11.9787 4.4284 11.8278L4.77271 6.69271C4.78582 6.49268 4.91371 6.31561 5.09734 6.23691L9.41924 4.03661C9.68157 3.9284 9.97341 3.9284 10.2357 4.03661L14.5576 6.23691C14.7445 6.31561 14.8691 6.49268 14.8855 6.69271L15.2299 11.8278C15.2397 11.9787 15.1839 12.1262 15.079 12.2344V12.2312Z"\n      fill="#343C43" />\n  </g>\n  <defs>\n    <clipPath id="clip0_9910_9664">\n      <rect width="73" height="18.6615" fill="white" transform="translate(0.5)" />\n    </clipPath>\n  </defs>\n</svg>\n',e.appendChild(n);var r=document.createElement("p");r.id="instruction",r.className="vault-instruction",r.innerHTML="Access your saved cards and bank details for faster, more secure payments",e.appendChild(r);var i=function(){var e=document.createElement("button");return e.className="pay-with-vault-button",e.id=xI,e.innerText="Pay with Vault",e}();e.appendChild(i);var a=document.createElement("div");if(a.className="vault-divider",a.innerHTML='<div id="vault-divider" class="vault-divider__container"><div class="vault-divider__line"></div></div><div class="vault-divider__text-container"><span class="vault-divider__text">or</span></div>',e.appendChild(a),t.canPayWithApplePay){var s=SI();e.appendChild(s)}if(t.hasOtherPaymentMethods){var o=bI("Use other payment methods");e.appendChild(o)}}function CI(e){return e.some(function(e){return"apple_pay"!==e})}var EI=[{value:"key",required:!0,types:["string"]},{value:"amount",required:!0,or:["plan","planCode"],types:["string","number"]},{value:"currency",required:!1,types:["string"]},{value:"email",required:!0,or:["customerCode"],types:["string"]},{value:"label",required:!1,types:["string"]},{value:"firstName",required:!1,types:["string"]},{value:"lastName",required:!1,types:["string"]},{value:"reference",required:!1,types:["string"]},{value:"phone",required:!1,types:["string"]},{value:"customerCode",required:!1,override:"email",types:["string"]},{value:"channels",required:!1,types:["array"]},{value:"paymentRequest",required:!1,types:["string","number"]},{value:"paymentPage",required:!1,types:["string"]},{value:"hash",required:!1,types:["string"]},{value:"container",required:!1,types:["string"]},{value:"metadata",required:!1,types:["object"]},{value:"subaccountCode",required:!1,types:["string"]},{value:"bearer",required:!1,types:["string"]},{value:"transactionCharge",required:!1,types:["string","number"]},{value:"planCode",required:!1,override:"amount",types:["string"]},{value:"subscriptionCount",required:!1,types:["number"]},{value:"planInterval",required:!1,types:["string"]},{value:"subscriptionLimit",required:!1,types:["number"]},{value:"subscriptionStartDate",required:!1,types:["string"]},{value:"accessCode",required:!1,types:["string"]},{value:"onError",required:!1,types:["function"]},{value:"onLoad",required:!1,types:["function"]},{value:"onSuccess",required:!1,types:["function"]},{value:"onCancel",required:!1,types:["function"]},{value:"callback",required:!1,types:["function"]},{value:"onClose",required:!1,types:["function"]},{value:"onBankTransferConfirmationPending",required:!1,types:["function"]},{value:"firstname",required:!1,types:["string"]},{value:"lastname",required:!1,types:["string"]},{value:"customer_code",required:!1,types:["string"]},{value:"payment_request",required:!1,types:["string","number"]},{value:"subaccount",required:!1,types:["string"]},{value:"transaction_charge",required:!1,types:["number","string"]},{value:"plan",required:!1,types:["string"]},{value:"quantity",required:!1,types:["number"]},{value:"interval",required:!1,types:["string"]},{value:"invoice_limit",required:!1,types:["number","string"]},{value:"start_date",required:!1,types:["string"]},{value:"payment_page",required:!1,types:["number","string"]},{value:"order_id",required:!1,types:["number"]},{value:"ref",required:!1,types:["string"]},{value:"card",required:!1,types:["string"]},{value:"bank",required:!1,types:["string"]},{value:"split",required:!1,types:["object"]},{value:"split_code",required:!1,types:["string"]},{value:"transaction_type",required:!1,types:["string"]},{value:"subscription",required:!1,types:["number"]},{value:"language",required:!1,types:["string"]},{value:"connect_account",required:!1,types:["string"]},{value:"connect_split",required:!1,types:["array"]}];function II(e){return(null==e?void 0:e.length)>500?e.split("?")[0]:e}var PI=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"],MI=window&&window.navigator&&(window.navigator.platform||window.navigator.userAgentData&&window.navigator.userAgentData.platform),AI=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.platform,n=e.userAgent,r=void 0===n?window&&window.navigator&&window.navigator.userAgent:n,i=t||MI;return PI.includes(i)||r.includes("Mac")&&"ontouchend"in document},zI={initializeLog:function(e){var t=e||{},n=t.attempts,r=t.authentication,i=t.errors,a=t.history;this.log={start_time:Math.round(Date.now()/1e3),time_spent:0,attempts:n||0,authentication:r,errors:i||0,success:!1,mobile:AI(),input:[],history:a||[]}},getTimeSpent:function(){var e=Math.round(Date.now()/1e3);return this.log.time_spent=e-this.log.start_time,this.log.time_spent},logAPIResponse:function(e,t){switch(e.status){case"success":return this.logApiSuccess(t);case"failed":return this.logApiError(e.message);default:return!1}},logValidationResponse:function(e){return this.log.history.push({type:"action",message:e,time:this.getTimeSpent()}),this.saveLog()},logAttempt:function(e){var t="Attempted to pay";return e&&(t+=" with ".concat(e)),this.log.attempts+=1,this.log.history.push({type:"action",message:t,time:this.getTimeSpent()}),this.saveLog()},logApiError:function(e){var t="Error";return e&&(t+=": ".concat(e)),this.log.errors+=1,this.log.history.push({type:"error",message:t,time:this.getTimeSpent()}),this.saveLog()},logApiSuccess:function(e){var t="Successfully paid";return e&&(t+=" with ".concat(e)),this.log.success=!0,this.log.history.push({type:"success",message:t,time:this.getTimeSpent()}),this.saveLog()},saveLog:function(){try{if(this.response)return function(e,t,n){var r="".concat(tI.paystackApiUrl,"transaction/update_log/").concat(e),i={Authorization:"Bearer ".concat(t)};return fetch(r,{method:"POST",body:JSON.stringify({payload:JSON.stringify(n)}),headers:i})}(this.id,this.response.merchant_key,this.log)}catch(ZI){}},saveIpAddress:function(){try{if(this.response)return function(e,t){var n="".concat(tI.paystackApiUrl,"transaction/set_ip/").concat(e),r={Authorization:"Bearer ".concat(t)};return fetch(n,{method:"POST",headers:r})}(this.id,this.response.merchant_key)}catch(ZI){}}},DI=["language","connect_account"],RI={requestInline:function(){var e=this,t=this.urlParameters,n=t.language,r=t.connect_account,i=WE(t,DI),a=ZE({"Content-Type":"application/json"},n&&{"Accept-Language":n});return(this.accessCode?fetch(new URL("transaction/verify_access_code/".concat(this.accessCode),tI.paystackApiUrl).toString(),{headers:a}):fetch(new URL("/checkout/request_inline",tI.paystackApiUrl).toString(),{method:"POST",body:JSON.stringify(i),headers:ZE(ZE({},a),r&&{"x-connect-account":r})})).then(function(e){return e.json()}).then(function(t){if(!1===t.status)throw new Error(t.message);return e.response=t.data,e.id=t.data.id,e.status=t.data.transaction_status,e.accessCode=t.data.access_code,e.log=null,Object.assign(e,zI),e.initializeLog(t.data.log),e.saveIpAddress(),t.data})}},LI=function(){function e(t){UE(this,e),function(e){function t(e,t){this.message=e,this.issues=t||[]}if(!e||"object"!==KE(e))throw new t("Transaction parameters should be a non-empty object");var n=e;if("accessCode"in n)return{accessCode:n.accessCode};Object.keys(n).forEach(function(e){void 0!==EI.find(function(t){return t.value===e})||delete n[e]});var r=Object.keys(n),i=[];if(EI.filter(function(e){return e.required}).forEach(function(e){var t=!n[e.value],r=e.or?e.or.some(function(e){return n[e]}):null;t&&!r&&i.push({message:"Required parameter missing: ".concat(e.value)})}),r.forEach(function(e){var t=n[e],r=EI.find(function(t){return t.value===e}),a=KE(t);"object"===a&&Array.isArray(t)&&(a="array"),r.types.indexOf(a)<=-1&&i.push({message:"Invalid parameter type: ".concat(e),validTypes:r.types})}),r.forEach(function(e){var t=EI.find(function(t){return t.value===e});t.override&&delete n[t.override]}),i.length)throw new t("Invalid transaction parameters",i)}(t),this.parameters=t,this.urlParameters=function(e){var t,n,r,i,a=ZE({},e);return a.metadata=e.metadata||{},a.metadata.referrer=(r=void 0===(n=(t=window.location).href)?"":n,i=t.ancestorOrigins,[r].concat(XE(void 0===i?[]:i)).map(II).join(",")),a.metadata=JSON.stringify(a.metadata),a.mode="popup",e.split&&"string"!=typeof e.split&&(a.split=JSON.stringify(a.split)),void 0!==a.card&&["false",!1].indexOf(a.card)>-1&&(a.channels=["bank"],delete a.card),void 0!==a.bank&&["false",!1].indexOf(a.bank)>-1&&(a.channels=["card"],delete a.bank),[{to:"firstname",from:"firstName"},{to:"lastname",from:"lastName"},{to:"customer_code",from:"customerCode"},{to:"payment_request",from:"paymentRequest"},{to:"subaccount",from:"subaccountCode"},{to:"transaction_charge",from:"transactionCharge"},{to:"plan",from:"planCode"},{to:"quantity",from:"subscriptionCount"},{to:"interval",from:"planInterval"},{to:"invoice_limit",from:"subscriptionLimit"},{to:"start_date",from:"subscriptionStartDate"},{to:"ref",from:"reference"}].forEach(function(e){a[e.from]&&(a[e.to]=a[e.from],delete a[e.from])}),Object.values(e).forEach(function(t,n){if("function"==typeof t){var r=Object.keys(e)[n];delete a[r]}}),a}(t),this.id=null,this.status=null,this.accessCode=t.accessCode||null,this.authorizationUrl=null,this.errors=[],this.response=null,this.isActive=!0;var n=t.onError,r=t.onLoad,i=t.onSuccess,a=t.onCancel,s=t.callback,o=t.onClose,l=t.onBankTransferConfirmationPending;this.callbacks={onError:n,onLoad:r,onSuccess:i,onCancel:a,onBankTransferConfirmationPending:l},this.deprecatedCallbacks={callback:s,onClose:o},Object.assign(this,RI)}return $E(e,[{key:"onSetupError",value:function(e){this.logError(e),this.callbacks.onError&&this.callbacks.onError(e)}},{key:"onLoad",value:function(e){var t=e.id,n=e.customer,r=e.accessCode;Object.assign(this,{id:t,customer:n,accessCode:r}),this.authorizationUrl="".concat(tI.checkoutUrl).concat(r),this.callbacks.onLoad&&this.callbacks.onLoad({id:t,customer:n,accessCode:r})}},{key:"onSuccess",value:function(e){this.isActive=!1,this.response=e,this.status=e.status,this.callbacks.onSuccess&&this.callbacks.onSuccess(e),this.deprecatedCallbacks.callback&&this.deprecatedCallbacks.callback(e)}},{key:"setStatus",value:function(e){this.status=e}},{key:"onCancel",value:function(){this.callbacks.onCancel&&this.callbacks.onCancel(),this.deprecatedCallbacks.onClose&&this.deprecatedCallbacks.onClose()}},{key:"cancel",value:function(){this.isActive=!1,this.onCancel()}},{key:"onBankTransferConfirmationPending",value:function(){this.cancel(),this.callbacks.onBankTransferConfirmationPending&&this.callbacks.onBankTransferConfirmationPending()}},{key:"logError",value:function(e){this.errors.push(e)}}]),e}(),NI=console?console.warn||console.log:function(){};function jI(e,t,n){NI('"'.concat(e,'" has been deprecated, please use "').concat(t,'". ').concat(n))}var FI,OI=["preload","inlineTransaction","transactionData"],BI=["container","styles","onElementsMount"];function VI(e,t){if(!e.length)return null;var n=e.filter(function(e){var n,r,i,a,s=!e.status||"abandoned"===e.status,o=(n=e.parameters,r=t,i=Object.keys(n).sort().join("")===Object.keys(r).sort().join(""),a=Object.values(n).sort().join("")===Object.values(r).sort().join(""),i&&a);return s&&o});return n.length?n[n.length-1]:null}function UI(e){var t=e.checkoutIframe,n=e.urlParameters;t&&n&&t.contentWindow.postMessage({type:"inline:url",path:"newTransaction",params:n},"*")}var qI="trackPaymentError";function $I(e){throw NI(e),new Error(e)}var GI,HI,ZI,WI,XI=function(){function e(t){var n,r;UE(this,e),this.id=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<5;n+=1)e+=t.charAt(Math.floor(62*Math.random()));return e}(),this.transactions=[],this.isOpen=!1,this.isLoaded=!1,this.isDeprecatedApi=t&&t.isDeprecatedApi,t&&t.isEmbed?this.isEmbed=!0:t&&t.isPaymentRequest&&(t.container&&gI(t.container)||$I("A container is required to mount the payment request button"),this.paymentRequestContainer=gI(t.container),this.paymentRequestTransaction=null),this.preCheckoutModal=null,this.backgroundIframe=function(e){var t=fI("inline-background-".concat(e));t.style.cssText="\n  z-index: 999999999999999;\n  background: transparent;\n  background: rgba(0, 0, 0, 0.75);    \n  border: 0px none transparent;\n  overflow-x: hidden;\n  overflow-y: hidden;\n  margin: 0;\n  padding: 0;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  transition: opacity 0.3s;\n  -webkit-transition: opacity 0.3s;\n  visibility: hidden;\n  display: none;\n",document.body.appendChild(t);var n=t.contentWindow.document;return n.open(),n.write('\n  <!DOCTYPE html>\n  <html lang="en">\n\n  <head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>Paystack Popup Loader</title>\n    <style>\n      .app-loader {\n        margin: 200px 0;\n        text-align: center;\n        color: white;\n      }      \n      @keyframes app-loader__spinner {\n        0% {\n          opacity: 1;\n        }\n        100% {\n          opacity: 0;\n        }\n      }\n      @-webkit-keyframes app-loader__spinner {\n        0% {\n          opacity: 1;\n        }\n        100% {\n          opacity: 0;\n        }\n      }\n      .app-loader__spinner {\n        position: relative;\n        display: inline-block;\n      }\n      .app-loader__spinner div {\n        left: 95px;\n        top: 35px;\n        position: absolute;\n        -webkit-animation: app-loader__spinner linear 1s infinite;\n        animation: app-loader__spinner linear 1s infinite;\n        background: white;\n        width: 10px;\n        height: 30px;\n        border-radius: 40%;\n        -webkit-transform-origin: 5px 65px;\n        transform-origin: 5px 65px;\n      }\n      .app-loader__spinner div:nth-child(1) {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n        -webkit-animation-delay: -0.916666666666667s;\n        animation-delay: -0.916666666666667s;\n      }\n      .app-loader__spinner div:nth-child(2) {\n        -webkit-transform: rotate(30deg);\n        transform: rotate(30deg);\n        -webkit-animation-delay: -0.833333333333333s;\n        animation-delay: -0.833333333333333s;\n      }\n      .app-loader__spinner div:nth-child(3) {\n        -webkit-transform: rotate(60deg);\n        transform: rotate(60deg);\n        -webkit-animation-delay: -0.75s;\n        animation-delay: -0.75s;\n      }\n      .app-loader__spinner div:nth-child(4) {\n        -webkit-transform: rotate(90deg);\n        transform: rotate(90deg);\n        -webkit-animation-delay: -0.666666666666667s;\n        animation-delay: -0.666666666666667s;\n      }\n      .app-loader__spinner div:nth-child(5) {\n        -webkit-transform: rotate(120deg);\n        transform: rotate(120deg);\n        -webkit-animation-delay: -0.583333333333333s;\n        animation-delay: -0.583333333333333s;\n      }\n      .app-loader__spinner div:nth-child(6) {\n        -webkit-transform: rotate(150deg);\n        transform: rotate(150deg);\n        -webkit-animation-delay: -0.5s;\n        animation-delay: -0.5s;\n      }\n      .app-loader__spinner div:nth-child(7) {\n        -webkit-transform: rotate(180deg);\n        transform: rotate(180deg);\n        -webkit-animation-delay: -0.416666666666667s;\n        animation-delay: -0.416666666666667s;\n      }\n      .app-loader__spinner div:nth-child(8) {\n        -webkit-transform: rotate(210deg);\n        transform: rotate(210deg);\n        -webkit-animation-delay: -0.333333333333333s;\n        animation-delay: -0.333333333333333s;\n      }\n      .app-loader__spinner div:nth-child(9) {\n        -webkit-transform: rotate(240deg);\n        transform: rotate(240deg);\n        -webkit-animation-delay: -0.25s;\n        animation-delay: -0.25s;\n      }\n      .app-loader__spinner div:nth-child(10) {\n        -webkit-transform: rotate(270deg);\n        transform: rotate(270deg);\n        -webkit-animation-delay: -0.166666666666667s;\n        animation-delay: -0.166666666666667s;\n      }\n      .app-loader__spinner div:nth-child(11) {\n        -webkit-transform: rotate(300deg);\n        transform: rotate(300deg);\n        -webkit-animation-delay: -0.083333333333333s;\n        animation-delay: -0.083333333333333s;\n      }\n      .app-loader__spinner div:nth-child(12) {\n        -webkit-transform: rotate(330deg);\n        transform: rotate(330deg);\n        -webkit-animation-delay: 0s;\n        animation-delay: 0s;\n      }\n      .app-loader__spinner {\n        width: 40px;\n        height: 40px;\n        -webkit-transform: translate(-20px, -20px) scale(0.2) translate(20px, 20px);\n        transform: translate(-20px, -20px) scale(0.2) translate(20px, 20px);\n      }\n    </style>\n  </head>\n\n  <body>\n    <div id="app-loader" class="app-loader">\n      <div id="spinner" class="app-loader__spinner">\n        <div></div><div></div><div></div><div></div><div></div><div></div><div>\n        </div><div></div><div></div><div></div><div></div><div></div>\n      </div>\n    </div>\n  </body>\n\n  </html>\n'),n.close(),t}(this.id),this.checkoutIframe=(n=this.id,(r=fI("inline-checkout-".concat(n))).src="".concat(tI.checkoutUrl,"popup"),r.style.cssText="\n  z-index: 999999999999999;\n  background: transparent;\n  border: 0px none transparent;\n  overflow-x: hidden;\n  overflow-y: hidden;\n  margin: 0;\n  padding: 0;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100%;\n  visibility: hidden;\n  display: none;\n  height: 100%;\n",r.setAttribute("allowpaymentrequest","true"),r.setAttribute("allow","payment; clipboard-read; clipboard-write"),document.body.appendChild(r),r),this.registerListeners()}return $E(e,[{key:"registerListeners",value:function(){var e=this;window.addEventListener("message",function(t){var n="".concat(t.origin,"/")===tI.checkoutUrl,r=e.checkoutIframe&&e.checkoutIframe.contentWindow===t.source,i=e.isEmbed;n||r?e.respondToEvent(t):i&&e.respondToEmbedEvents(t)})}},{key:"sendAnalyticsEventToCheckout",value:function(e,t){this.checkoutIframe.contentWindow.postMessage({type:"analytics",action:e,params:t},"*")}},{key:"checkout",value:function(e){this.activeTransaction()&&this.activeTransaction().cancel(),FI=this;var t=VI(this.transactions,e)||new LI(e);return new Promise(function(e,n){t.requestInline().then(function(n){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.platform,n=e.userAgent,r=void 0===n?window&&window.navigator&&window.navigator.userAgent:n,i=t||MI,a=r&&!!r.match(/Version\/[\d.]+.*Safari/),s=i&&/(Mac)/i.test(i);return AI()||s&&a}()&&pI(n.channels),i=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!(null===(e=n.link_config)||void 0===e||!e.enabled||null===(t=n.link_config)||void 0===t||!t.has_payment_instruments)}(n);i||r?(FI.preloadTransaction({inlineTransaction:t,transactionData:n}),FI.preCheckoutModal=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=document.querySelector("#pre-checkout-modal-".concat(e));if(r){if(wI(r)&&kI(r))return r;r.remove()}var i=document.createElement("div");i.classList.add("pre-checkout-modal"),i.id="pre-checkout-modal-".concat(e),i.style.zIndex=function(){var e=0;return Array.from(document.querySelectorAll("body *")).forEach(function(t){var n=window.getComputedStyle(t),r=parseFloat(n.zIndex);!Number.isNaN(r)&&r>e&&(e=r)}),e}()+1;var a=document.createElement("div");a.classList.add("pre-checkout-modal__content"),i.appendChild(a);var s=t||{},o=s.merchant_logo,l=s.merchant_name,c=s.email,u=s.amount,h=s.currency,d=s.label,p=s.channels,f=new Intl.NumberFormat("en",{style:"currency",currency:h,currencyDisplay:"code",maximumFractionDigits:2,minimumFractionDigits:0}).format(u/100),m=document.createElement("div");m.classList.add("payment-info"),m.innerHTML='<img class="merchant-logo" src="'.concat(o,'" alt="').concat(l,' Logo">\n    <div class="customer-info">\n      <div class="customer-email">').concat(d||c,'</div>\n      <div class="transaction-amount">Pay <span class="amount">').concat(f,"</span></div>\n    </div>"),a.appendChild(m),a.innerHTML+='\n  <button type="button" id="apple-pay-close-button">\n    <svg width="10" height="9" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path\n        d="M5.572 4.033L8.89.71a.4.4 0 0 0-.566-.566L5.003 3.459 1.681.145a.4.4 0 0 0-.566.566L4.44 4.033\n      1.115 7.354a.398.398 0 0 0 0 .566.4.4 0 0 0 .566 0l3.322-3.33 3.322 3.33a.4.4 0 0 0 .566-.566L5.57 4.033z"\n        fill="white"\n      />\n    </svg>\n  </button>\n';var g=document.createElement("div");g.classList.add("modal-wrapper"),n.canPayWithVault?TI(g,{canPayWithApplePay:n.canPayWithApplePay,hasOtherPaymentMethods:CI(p)}):function(e,t){var n=t.hasOtherPaymentMethods,r=document.createElement("div");r.innerHTML='\n  <svg width="51" height="32" viewBox="0 0 51 32" fill="none" xmlns="http://www.w3.org/2000/svg" id="apple-pay-mark--light">\n    <g>\n    <path d="M46.0162 0H4.98386C4.81297 0 4.64177 0 4.47118 0.000996555C4.32698 0.00202331 4.18311 0.00362383 4.03925 0.00754966C3.72548 0.0160355 3.40903 0.0345472 3.09919 0.0902335C2.7844 0.146886 2.49148 0.239294 2.20571 0.384791C1.92477 0.52766 1.66757 0.71453 1.44468 0.937516C1.22169 1.1605 1.03482 1.41728 0.891977 1.69852C0.74645 1.98429 0.653982 2.27731 0.597722 2.59234C0.541737 2.90227 0.523101 3.21866 0.514645 3.53209C0.51078 3.67596 0.509122 3.81982 0.508183 3.96366C0.507186 4.13461 0.507519 4.30545 0.507519 4.4767V27.5236C0.507519 27.6949 0.507186 27.8654 0.508183 28.0367C0.509122 28.1805 0.51078 28.3244 0.514645 28.4683C0.523101 28.7814 0.541737 29.0978 0.597722 29.4077C0.653982 29.7228 0.74645 30.0157 0.891977 30.3015C1.03482 30.5827 1.22169 30.8399 1.44468 31.0625C1.66757 31.2859 1.92477 31.4727 2.20571 31.6152C2.49148 31.7611 2.7844 31.8535 3.09919 31.9102C3.40903 31.9655 3.72548 31.9843 4.03925 31.9928C4.18311 31.9961 4.32698 31.998 4.47118 31.9987C4.64177 32 4.81297 32 4.98386 32H46.0162C46.1868 32 46.358 32 46.5286 31.9987C46.6724 31.998 46.8163 31.9961 46.9608 31.9928C47.2739 31.9843 47.5903 31.9655 47.9009 31.9102C48.2153 31.8535 48.5083 31.7611 48.7941 31.6152C49.0753 31.4727 49.3317 31.2859 49.5551 31.0625C49.7777 30.8399 49.9646 30.5827 50.1078 30.3015C50.2537 30.0157 50.346 29.7228 50.402 29.4077C50.458 29.0978 50.4762 28.7814 50.4847 28.4683C50.4886 28.3244 50.4906 28.1805 50.4912 28.0367C50.4925 27.8654 50.4926 27.6949 50.4926 27.5236V4.4767C50.4926 4.30545 50.4925 4.13461 50.4912 3.96366C50.4906 3.81982 50.4886 3.67596 50.4847 3.53209C50.4762 3.21866 50.458 2.90227 50.402 2.59234C50.346 2.27731 50.2537 1.98429 50.1078 1.69852C49.9646 1.41728 49.7777 1.1605 49.5551 0.937516C49.3317 0.71453 49.0753 0.52766 48.7941 0.384791C48.5083 0.239294 48.2153 0.146886 47.9009 0.0902335C47.5903 0.0345472 47.2739 0.0160355 46.9608 0.00754966C46.8163 0.00362383 46.6724 0.00202331 46.5286 0.000996555C46.358 0 46.1868 0 46.0162 0Z" fill="black"/>\n    <path d="M46.0162 1.06662L46.521 1.06759C46.6577 1.06855 46.7945 1.07003 46.932 1.07378C47.1711 1.08024 47.4509 1.09319 47.7117 1.13994C47.9384 1.18077 48.1285 1.24286 48.311 1.33575C48.4911 1.42728 48.6562 1.54723 48.8003 1.69113C48.9449 1.83599 49.065 2.0013 49.1578 2.18343C49.2501 2.36447 49.3118 2.55369 49.3524 2.78205C49.3991 3.04001 49.412 3.32055 49.4185 3.56121C49.4222 3.69704 49.424 3.83287 49.4247 3.97194C49.426 4.14012 49.4259 4.3082 49.4259 4.47671V27.5236C49.4259 27.6921 49.426 27.8599 49.4246 28.0317C49.424 28.1675 49.4222 28.3033 49.4185 28.4394C49.4119 28.6797 49.3991 28.9601 49.3519 29.2211C49.3118 29.4463 49.2502 29.6356 49.1573 29.8175C49.0648 29.9992 48.9449 30.1643 48.8009 30.3083C48.656 30.4532 48.4915 30.5728 48.3092 30.6652C48.1281 30.7576 47.9383 30.8197 47.7138 30.8601C47.4477 30.9075 47.1562 30.9205 46.9367 30.9265C46.7986 30.9296 46.6611 30.9315 46.5203 30.9321C46.3525 30.9334 46.1841 30.9334 46.0162 30.9334H4.98386C4.98162 30.9334 4.97945 30.9334 4.97718 30.9334C4.81127 30.9334 4.64503 30.9334 4.4761 30.9321C4.33836 30.9315 4.20093 30.9296 4.06805 30.9266C3.8435 30.9205 3.55181 30.9075 3.2879 30.8604C3.06151 30.8197 2.87171 30.7576 2.68822 30.664C2.50766 30.5724 2.34329 30.453 2.19831 30.3077C2.05444 30.1641 1.93488 29.9995 1.84245 29.8176C1.74992 29.6358 1.68801 29.446 1.64731 29.218C1.60025 28.9576 1.58733 28.6783 1.58087 28.4396C1.57718 28.303 1.57564 28.1664 1.57476 28.0305L1.5741 27.6295L1.57413 27.5236V4.47671L1.5741 4.37083L1.57473 3.97067C1.57564 3.83402 1.57718 3.6974 1.58087 3.56088C1.58733 3.32197 1.60025 3.04258 1.64769 2.77991C1.68804 2.55405 1.74992 2.36422 1.84293 2.18155C1.93464 2.001 2.05441 1.83617 2.19903 1.69158C2.34308 1.54747 2.50799 1.42767 2.6897 1.33527C2.87122 1.24283 3.06138 1.18077 3.28778 1.14003C3.54864 1.09316 3.82861 1.08024 4.06839 1.07375C4.20507 1.07003 4.34174 1.06855 4.4774 1.06762L4.98386 1.06662H46.0162Z" fill="white"/>\n    <path d="M14.1531 10.7629C14.5811 10.2276 14.8715 9.50886 14.7949 8.77435C14.1684 8.80551 13.4038 9.18768 12.9612 9.72342C12.5638 10.1822 12.212 10.9311 12.3037 11.6348C13.007 11.6958 13.7097 11.2832 14.1531 10.7629Z" fill="black"/>\n    <path d="M14.7869 11.7722C13.7655 11.7114 12.8972 12.3519 12.4094 12.3519C11.9214 12.3519 11.1745 11.8029 10.3667 11.8177C9.31521 11.8331 8.33959 12.4276 7.80602 13.3731C6.70857 15.2646 7.51641 18.0704 8.58362 19.611C9.10188 20.3731 9.72648 21.2123 10.5495 21.1822C11.3271 21.1517 11.6319 20.6787 12.5771 20.6787C13.5216 20.6787 13.7961 21.1822 14.6192 21.1669C15.4729 21.1516 16.0065 20.4044 16.5248 19.6415C17.1193 18.7727 17.3627 17.9338 17.378 17.8877C17.3627 17.8725 15.732 17.2469 15.7169 15.3711C15.7015 13.8004 16.9972 13.0534 17.0581 13.007C16.3265 11.9249 15.1832 11.8029 14.7869 11.7722Z" fill="black"/>\n    <path d="M23.68 9.64661C25.8999 9.64661 27.4457 11.1768 27.4457 13.4046C27.4457 15.6404 25.8681 17.1786 23.6244 17.1786H21.1665V21.0872H19.3907V9.64661H23.68V9.64661ZM21.1665 15.688H23.2041C24.7502 15.688 25.6302 14.8556 25.6302 13.4126C25.6302 11.9697 24.7502 11.1451 23.2121 11.1451H21.1665V15.688Z" fill="black"/>\n    <path d="M27.9097 18.7167C27.9097 17.2578 29.0276 16.3619 31.0098 16.2509L33.293 16.1162V15.474C33.293 14.5464 32.6666 13.9914 31.6203 13.9914C30.629 13.9914 30.0106 14.467 29.8601 15.2124H28.2428C28.3379 13.7059 29.6222 12.5959 31.6836 12.5959C33.7053 12.5959 34.9976 13.6663 34.9976 15.3392V21.0872H33.3563V19.7156H33.3169C32.8333 20.6433 31.7787 21.2299 30.6847 21.2299C29.0514 21.2299 27.9097 20.2151 27.9097 18.7167ZM33.293 17.9635V17.3055L31.2395 17.4323C30.2167 17.5037 29.6381 17.9556 29.6381 18.6691C29.6381 19.3985 30.2406 19.8742 31.1603 19.8742C32.3574 19.8742 33.293 19.0496 33.293 17.9635Z" fill="black"/>\n    <path d="M36.547 24.1556V22.768C36.6736 22.7997 36.959 22.7997 37.1018 22.7997C37.8946 22.7997 38.3228 22.4668 38.5843 21.6105C38.5843 21.5946 38.7351 21.1031 38.7351 21.0952L35.7224 12.7466H37.5774L39.6866 19.5333H39.7181L41.8273 12.7466H43.6349L40.5109 21.5232C39.7976 23.5451 38.973 24.1952 37.2447 24.1952C37.1018 24.1952 36.6736 24.1793 36.547 24.1556Z" fill="black"/>\n    </g>\n    <defs>\n    <clipPath id="clip0">\n    <rect width="49.9851" height="32" fill="white" transform="translate(0.507462)"/>\n    </clipPath>\n    </defs>\n  </svg>\n',e.appendChild(r);var i=document.createElement("p");i.id="apple-pay-description",i.innerHTML="Pay with Apple Pay to complete your purchase without filling a form",e.appendChild(i);var a=SI();if(e.appendChild(a),n){var s=bI("More payment options");e.appendChild(s)}}(g,{hasOtherPaymentMethods:CI(p)}),g.innerHTML=g.innerHTML+aI+'\n<svg id="inline-button-wordmark--grey" width="166" height="16" viewBox="0 0 166 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path\n  d="M0.564068 6.26985L1.86515 6.10375C1.85184 5.15143 1.83489 3.71187 1.84942 3.45964C1.95955 1.67927 3.39982 0.16589 5.13056 0.0170127C5.23949 0.00839996 5.34842 0.0034784 5.45371 0.00101762C6.36645 -0.0209585 7.25272 0.313716 7.93 0.936113C8.62472 1.56238 9.07979 2.4864 9.14999 3.4055C9.16815 3.64174 9.1621 5.24002 9.1621 6.18249L10.4886 6.38305L10.4438 14.0767L5.47308 14.7657L0.519287 13.961L0.564068 6.26985ZM5.53359 5.63743L7.62016 5.95241C7.61169 4.80446 7.55965 3.12867 7.30548 2.68696C6.91939 2.0164 6.28156 1.62021 5.55901 1.60421H5.48276C4.7481 1.61406 4.10543 2.0004 3.71813 2.66727C3.44944 3.13236 3.39619 4.70972 3.3974 5.91181L5.53359 5.63743ZM22.5808 12.4378C21.8836 12.4378 21.293 12.3492 20.8089 12.172C20.372 12.0088 19.9719 11.7577 19.6325 11.4338C19.3256 11.1331 19.0833 10.7712 18.9208 10.3707C18.7637 9.95815 18.6612 9.52621 18.6158 9.08621H19.8358C19.8745 9.40119 19.9423 9.70141 20.0391 9.98686C20.136 10.2625 20.286 10.5085 20.4894 10.7251C20.6927 10.9318 20.959 11.0991 21.2882 11.2271C21.6271 11.3452 22.0579 11.4043 22.5808 11.4043C22.9197 11.4043 23.2295 11.36 23.5103 11.2714C23.8008 11.173 24.0525 11.0351 24.2655 10.858C24.4785 10.6808 24.6431 10.4692 24.7593 10.2231C24.8852 9.97701 24.9481 9.70633 24.9481 9.41103C24.9481 9.11574 24.9094 8.85982 24.8319 8.64327C24.7536 8.41559 24.6125 8.21568 24.4253 8.06745C24.196 7.88594 23.9347 7.75064 23.6555 7.6688C23.257 7.54201 22.849 7.4482 22.4355 7.38828C21.9393 7.31041 21.4491 7.19693 20.9686 7.04869C20.5808 6.92967 20.2133 6.75038 19.8794 6.51716C19.5939 6.29685 19.3607 6.01432 19.1968 5.69034C19.0418 5.35567 18.9644 4.9521 18.9644 4.47963C18.9644 4.07607 19.0467 3.70203 19.2113 3.35752C19.3759 3.00317 19.6034 2.69803 19.8939 2.44211C20.194 2.18619 20.5475 1.98441 20.9541 1.83676C21.3608 1.68911 21.811 1.61529 22.3048 1.61529C23.3505 1.61529 24.1784 1.86629 24.7884 2.36829C25.4081 2.86044 25.7711 3.57899 25.8777 4.52393H24.7448C24.6189 3.8546 24.3624 3.37721 23.9751 3.09176C23.5878 2.79646 23.031 2.64882 22.3048 2.64882C21.5883 2.64882 21.0461 2.81123 20.6782 3.13605C20.5037 3.28606 20.3648 3.47417 20.2717 3.68635C20.1787 3.89853 20.1339 4.12931 20.1408 4.36152C20.1408 4.61744 20.1698 4.84875 20.2279 5.05546C20.2957 5.25232 20.4167 5.42457 20.591 5.57222C20.775 5.71987 21.0267 5.85275 21.3463 5.97087C21.7689 6.09987 22.2012 6.19369 22.6389 6.25139C23.2198 6.33998 23.7281 6.4581 24.1639 6.60575C24.5996 6.75339 24.9675 6.94533 25.2677 7.18157C25.5678 7.4178 25.7905 7.70818 25.9358 8.05268C26.0907 8.39719 26.1681 8.82045 26.1681 9.32245C26.1681 9.76539 26.0761 10.1788 25.8922 10.5627C25.7149 10.9408 25.4627 11.2775 25.1515 11.5519C24.8319 11.8275 24.4495 12.0441 24.0041 12.2016C23.5684 12.359 23.094 12.4378 22.5808 12.4378ZM31.2066 12.4378C30.6741 12.4378 30.1803 12.3443 29.7252 12.1573C29.2906 11.9775 28.8956 11.7115 28.5633 11.3747C28.2268 11.0185 27.965 10.5966 27.7936 10.1345C27.6136 9.61796 27.5251 9.07309 27.5321 8.52515V8.40704C27.5321 7.82629 27.6193 7.29476 27.7936 6.81245C27.9679 6.3203 28.2099 5.90196 28.5198 5.55746C28.8393 5.2031 29.2169 4.93242 29.6526 4.7454C30.0883 4.54854 30.5676 4.45011 31.0905 4.45011C31.5262 4.45011 31.9473 4.52393 32.354 4.67158C32.7704 4.80938 33.1383 5.03085 33.4578 5.33599C33.7773 5.64112 34.0291 6.03977 34.213 6.53192C34.4067 7.01424 34.5035 7.5999 34.5035 8.28892V8.68756H28.7812C28.8102 9.57345 29.0281 10.2526 29.4348 10.7251C29.8414 11.1877 30.4369 11.419 31.2212 11.419C32.4121 11.419 33.085 10.9712 33.24 10.0754H34.4454C34.3099 10.8531 33.9516 11.4436 33.3707 11.8472C32.7897 12.2409 32.0684 12.4378 31.2066 12.4378ZM33.269 7.69833C33.2109 6.90104 32.9882 6.33014 32.6009 5.98563C32.2233 5.64112 31.7198 5.46887 31.0905 5.46887C30.4708 5.46887 29.9624 5.67065 29.5655 6.07422C29.1782 6.46794 28.9313 7.00932 28.8248 7.69833H33.269ZM39.3593 12.4378C38.8267 12.4378 38.3329 12.3492 37.8779 12.172C37.4401 11.9901 37.0407 11.7245 36.7014 11.3895C36.3636 11.0315 36.0973 10.6103 35.9172 10.1493C35.7268 9.63002 35.6332 9.07925 35.6412 8.52515V8.40704C35.6412 7.81645 35.738 7.28 35.9317 6.79769C36.1253 6.30553 36.3868 5.8872 36.716 5.54269C37.0548 5.19818 37.447 4.93242 37.8924 4.7454C38.3475 4.54854 38.8267 4.45011 39.3302 4.45011C39.7272 4.45011 40.1097 4.49932 40.4776 4.59775C40.8552 4.69618 41.1893 4.85367 41.4797 5.07022C41.7799 5.27693 42.0316 5.55253 42.235 5.89704C42.4383 6.24155 42.569 6.65988 42.6271 7.15204H41.4362C41.3393 6.54177 41.0924 6.10867 40.6955 5.85275C40.3082 5.59683 39.8531 5.46887 39.3302 5.46887C38.995 5.46599 38.6632 5.53649 38.3571 5.67557C38.0667 5.81338 37.8101 6.01024 37.5874 6.26616C37.3615 6.53514 37.1889 6.84598 37.0791 7.18157C36.9484 7.57626 36.8845 7.99063 36.8902 8.40704V8.52515C36.8902 9.47994 37.1178 10.2034 37.5729 10.6956C38.0376 11.1779 38.6379 11.419 39.3738 11.419C39.6449 11.419 39.9015 11.3797 40.1436 11.3009C40.6361 11.1497 41.0523 10.8113 41.3055 10.356C41.441 10.1197 41.5233 9.84413 41.5524 9.52915H42.6707C42.6338 9.9361 42.5204 10.3321 42.3366 10.6956C42.1663 11.0447 41.9293 11.3559 41.6395 11.611C41.349 11.8669 41.0101 12.0687 40.6228 12.2163C40.2355 12.364 39.8144 12.4378 39.3593 12.4378ZM46.9164 12.4378C46.5568 12.4406 46.199 12.3858 45.8562 12.2754C45.5441 12.1717 45.2605 11.9947 45.0284 11.7586C44.7829 11.4908 44.595 11.1741 44.4765 10.8284C44.3409 10.4544 44.2731 10.0016 44.2731 9.47009V4.58299H45.4786V9.41103C45.4786 10.0902 45.619 10.5873 45.8998 10.9023C46.1903 11.2172 46.6356 11.3747 47.236 11.3747C47.5071 11.3747 47.7685 11.3304 48.0202 11.2419C48.272 11.1533 48.4947 11.0204 48.6883 10.8432C48.882 10.666 49.0369 10.4446 49.1531 10.1788C49.2693 9.91303 49.3274 9.6079 49.3274 9.26339V4.58299H50.5328V12.3049H49.3274V11.0794C49.1531 11.4436 48.8578 11.7635 48.4414 12.0391C48.0348 12.3049 47.5264 12.4378 46.9164 12.4378ZM52.8239 4.58299H54.0294V5.97087C54.2715 5.53777 54.5765 5.18342 54.9444 4.90781C55.322 4.62236 55.8497 4.46979 56.5275 4.45011V5.60175C56.1799 5.61707 55.8346 5.66652 55.4963 5.7494C55.2039 5.81939 54.9308 5.95567 54.6975 6.14804C54.4729 6.35252 54.303 6.6116 54.2037 6.90104C54.0875 7.20618 54.0294 7.59498 54.0294 8.06745V12.3049H52.8239V4.58299ZM61.0347 12.4378C60.5021 12.4378 60.0083 12.3443 59.5533 12.1573C59.1186 11.9775 58.7236 11.7115 58.3914 11.3747C58.0549 11.0185 57.793 10.5966 57.6216 10.1345C57.4416 9.61796 57.3531 9.07309 57.3602 8.52515V8.40704C57.3602 7.82629 57.4473 7.29476 57.6216 6.81245C57.7959 6.3203 58.038 5.90196 58.3478 5.55746C58.6673 5.2031 59.0449 4.93242 59.4806 4.7454C59.9164 4.54854 60.3956 4.45011 60.9185 4.45011C61.3542 4.45011 61.7754 4.52393 62.1821 4.67158C62.5984 4.80938 62.9663 5.03085 63.2859 5.33599C63.6054 5.64112 63.8571 6.03977 64.0411 6.53192C64.2347 7.01424 64.3316 7.5999 64.3316 8.28892V8.68756H58.6092C58.6383 9.57345 58.8561 10.2526 59.2628 10.7251C59.6695 11.1877 60.2649 11.419 61.0492 11.419C62.2401 11.419 62.9131 10.9712 63.068 10.0754H64.2735C64.1379 10.8531 63.7797 11.4436 63.1987 11.8472C62.6178 12.2409 61.8964 12.4378 61.0347 12.4378ZM63.097 7.69833C63.0389 6.90104 62.8162 6.33014 62.429 5.98563C62.0513 5.64112 61.5478 5.46887 60.9185 5.46887C60.2988 5.46887 59.7905 5.67065 59.3935 6.07422C59.0062 6.46794 58.7593 7.00932 58.6528 7.69833H63.097ZM68.8968 12.4378C68.403 12.4378 67.9431 12.3541 67.5171 12.1868C67.1072 12.0141 66.7365 11.7578 66.4278 11.4338C66.1165 11.0803 65.8749 10.6693 65.7161 10.2231C65.5451 9.69956 65.4617 9.15057 65.4692 8.59898V8.48086C65.4692 7.89027 65.5564 7.3489 65.7307 6.85675C65.905 6.36459 66.147 5.94134 66.4569 5.58698C66.7667 5.22279 67.1395 4.94226 67.5752 4.7454C68.0109 4.54854 68.4902 4.45011 69.013 4.45011C69.6521 4.45011 70.1701 4.58791 70.5671 4.86352C70.964 5.12928 71.2739 5.44918 71.4966 5.82322V0.891819H72.702V12.3049H71.4966V10.9761C71.3901 11.1631 71.2448 11.3452 71.0609 11.5224C70.8713 11.7038 70.6617 11.8623 70.4363 11.9949C70.2066 12.1258 69.963 12.2298 69.7102 12.3049C69.4487 12.3935 69.1776 12.4378 68.8968 12.4378ZM69.0275 11.419C69.3761 11.419 69.7053 11.36 70.0152 11.2419C70.325 11.1237 70.5913 10.9466 70.814 10.7103C71.0367 10.4642 71.2109 10.1591 71.3368 9.79492C71.4724 9.42088 71.5401 8.98778 71.5401 8.49562V8.37751C71.5401 7.38335 71.3223 6.65004 70.8866 6.17757C70.4606 5.7051 69.8748 5.46887 69.1292 5.46887C68.374 5.46887 67.7834 5.72479 67.3573 6.23663C66.9313 6.74847 66.7183 7.47686 66.7183 8.4218V8.53992C66.7183 9.02223 66.7764 9.44549 66.8926 9.80968C67.0184 10.1739 67.183 10.4741 67.3864 10.7103C67.5994 10.9466 67.8463 11.1237 68.1271 11.2419C68.4079 11.36 68.708 11.419 69.0275 11.419ZM82.4716 12.4378C81.852 12.4378 81.3243 12.3 80.8886 12.0244C80.485 11.7813 80.146 11.4417 79.901 11.0351V12.3049H78.6955V0.891819H79.901V5.88228C80.0153 5.68531 80.1572 5.50626 80.3221 5.35075C80.5061 5.17357 80.7094 5.02101 80.9321 4.89305C81.1645 4.75524 81.4114 4.64697 81.6729 4.56822C81.9343 4.48948 82.2005 4.45011 82.4716 4.45011C82.9655 4.45011 83.4254 4.53869 83.8514 4.71587C84.2774 4.89305 84.6405 5.14897 84.9407 5.48363C85.2505 5.8183 85.4926 6.22679 85.6669 6.7091C85.8411 7.19141 85.9283 7.73278 85.9283 8.33321V8.45133C85.9283 9.04192 85.846 9.58329 85.6814 10.0754C85.5295 10.535 85.2929 10.9609 84.9843 11.3304C84.6852 11.6839 84.3133 11.9662 83.895 12.1573C83.4445 12.3492 82.96 12.4447 82.4716 12.4378ZM82.3555 11.419C83.1107 11.419 83.6868 11.173 84.0838 10.6808C84.4808 10.1788 84.6793 9.45533 84.6793 8.51039V8.39227C84.6793 7.90012 84.6163 7.47194 84.4904 7.10775C84.3829 6.77559 84.2099 6.46915 83.9821 6.2071C83.7841 5.96487 83.5294 5.77704 83.2414 5.66081C82.9581 5.53232 82.6511 5.46687 82.3409 5.46887C81.9924 5.46887 81.6632 5.52793 81.3533 5.64604C81.0537 5.7638 80.7852 5.95084 80.569 6.19234C80.3464 6.42857 80.1721 6.73371 80.0462 7.10775C79.9127 7.52209 79.8488 7.95635 79.8574 8.39227V8.51039C79.8574 9.4947 80.0898 10.228 80.5545 10.7103C81.0193 11.1828 81.6196 11.419 82.3555 11.419ZM89.6342 11.5076L86.6569 4.58299H87.9495L90.2733 10.1197L92.3792 4.58299H93.6137L89.4164 14.9921H88.1964L89.6342 11.5076ZM105.97 4.51532C105.618 4.13844 105.195 3.83755 104.727 3.63067C104.257 3.42601 103.751 3.32132 103.241 3.32307C102.698 3.32307 102.214 3.42888 101.804 3.64297C101.501 3.7934 101.229 4.00091 101.003 4.25447V4.01947C101.003 3.93064 100.979 3.84347 100.933 3.76781C100.888 3.69214 100.822 3.631 100.744 3.59129C100.691 3.56626 100.633 3.55364 100.574 3.55438H98.9827C98.9241 3.55245 98.8658 3.56433 98.8125 3.58909C98.7592 3.61385 98.7122 3.65082 98.6753 3.69711C98.5956 3.78474 98.5523 3.90019 98.5542 4.01947V15.0561C98.5542 15.1791 98.5954 15.2874 98.6753 15.3735C98.715 15.4152 98.7629 15.4479 98.8158 15.4698C98.8688 15.4916 98.9256 15.502 98.9827 15.5002H100.606C100.661 15.5001 100.715 15.4889 100.766 15.4671C100.817 15.4453 100.863 15.4135 100.901 15.3735C100.945 15.3333 100.979 15.284 101.002 15.229C101.025 15.174 101.036 15.1146 101.034 15.0548V11.2898C101.25 11.5384 101.539 11.7291 101.884 11.8607C102.307 12.0256 102.755 12.1105 103.207 12.1105C103.727 12.1105 104.233 12.0096 104.71 11.8054C105.185 11.599 105.613 11.2958 105.969 10.9146C106.338 10.5135 106.628 10.0422 106.824 9.52669C107.044 8.94733 107.152 8.33033 107.143 7.70941C107.143 7.045 107.038 6.43349 106.824 5.89212C106.631 5.38011 106.341 4.91182 105.97 4.51409V4.51532ZM104.513 8.50178C104.424 8.73555 104.295 8.94718 104.131 9.12928C103.969 9.31219 103.77 9.45789 103.547 9.55674C103.325 9.65558 103.085 9.70531 102.842 9.70264C102.6 9.70387 102.358 9.65342 102.136 9.55499C101.911 9.4556 101.71 9.31074 101.542 9.12928C101.375 8.94704 101.244 8.73407 101.155 8.50178C101.062 8.25439 101.015 7.99155 101.016 7.72663C101.016 7.45102 101.064 7.19141 101.155 6.95026C101.332 6.48635 101.682 6.1122 102.128 5.90935C102.352 5.80353 102.595 5.7494 102.842 5.75063C103.103 5.75063 103.343 5.80476 103.56 5.91058C103.774 6.0127 103.969 6.15542 104.134 6.33014C104.476 6.71058 104.661 7.21105 104.648 7.72663C104.648 8.00347 104.603 8.26308 104.513 8.50178ZM115.859 3.55684H114.249C114.193 3.55751 114.138 3.56987 114.087 3.59315C114.036 3.61643 113.99 3.65013 113.952 3.69219C113.868 3.78 113.821 3.8973 113.821 4.01947V4.22371C113.62 3.9808 113.372 3.78302 113.092 3.64297C112.654 3.42397 112.17 3.31511 111.681 3.32553C111.166 3.32821 110.657 3.43439 110.183 3.63795C109.708 3.84151 109.278 4.13843 108.917 4.51162C108.537 4.91069 108.236 5.37962 108.029 5.89335C107.801 6.47081 107.687 7.08847 107.696 7.71064C107.696 8.37505 107.807 8.98655 108.029 9.52792C108.251 10.0619 108.545 10.5331 108.91 10.9158C109.265 11.2945 109.693 11.5958 110.167 11.8016C110.641 12.0074 111.15 12.1133 111.665 12.113C112.194 12.113 112.675 12.0047 113.085 11.7943C113.388 11.6343 113.637 11.4412 113.821 11.2148V11.4326C113.82 11.4923 113.831 11.5516 113.854 11.6066C113.877 11.6615 113.911 11.7109 113.954 11.7512C113.993 11.7915 114.038 11.8236 114.089 11.8456C114.14 11.8676 114.194 11.879 114.249 11.8792H115.859C115.916 11.8812 115.972 11.8706 116.024 11.8483C116.077 11.826 116.124 11.7925 116.162 11.75C116.203 11.7085 116.235 11.6589 116.256 11.6043C116.277 11.5497 116.287 11.4912 116.285 11.4326V4.0207C116.287 3.90142 116.244 3.78597 116.164 3.69834C116.127 3.65337 116.08 3.61736 116.027 3.5929C115.975 3.56844 115.917 3.55613 115.859 3.55684ZM113.685 8.4907C113.601 8.72324 113.473 8.9368 113.308 9.11943C113.143 9.29538 112.95 9.43933 112.735 9.54269C112.52 9.64727 112.275 9.70141 112.014 9.70141C111.764 9.70141 111.521 9.64727 111.3 9.54146C111.079 9.4398 110.881 9.29437 110.717 9.11372C110.552 8.93306 110.425 8.72082 110.343 8.48947C110.253 8.24551 110.207 7.98712 110.207 7.72663C110.207 7.44979 110.253 7.19018 110.343 6.94903C110.433 6.71156 110.562 6.50116 110.723 6.32891C110.888 6.15296 111.086 6.00901 111.301 5.90812C111.521 5.80353 111.764 5.7494 112.015 5.7494C112.275 5.7494 112.52 5.80353 112.735 5.90935C112.951 6.01393 113.144 6.15542 113.308 6.32891C113.65 6.70961 113.834 7.21001 113.821 7.7254C113.821 7.98993 113.776 8.24709 113.685 8.4907ZM131.919 7.49901C131.685 7.28955 131.417 7.12228 131.127 7.00439C130.828 6.88012 130.511 6.78169 130.177 6.71525L128.95 6.46425C128.635 6.40273 128.416 6.3203 128.293 6.21448C128.242 6.17732 128.201 6.12853 128.172 6.07209C128.144 6.01565 128.128 5.95315 128.128 5.88966C128.128 5.75432 128.204 5.64358 128.357 5.54269C128.523 5.43688 128.755 5.38274 129.042 5.38274C129.357 5.38274 129.669 5.44795 129.958 5.57591C130.252 5.70633 130.528 5.85398 130.769 6.01885C131.126 6.24893 131.43 6.21817 131.649 5.95364L132.238 5.25232C132.351 5.13393 132.416 4.97752 132.422 4.81307C132.422 4.65558 132.345 4.51162 132.198 4.3812C131.948 4.15481 131.553 3.91612 131.023 3.68234C130.494 3.44611 129.829 3.32553 129.042 3.32553C128.525 3.32553 128.049 3.39689 127.628 3.53716C127.205 3.67988 126.842 3.87674 126.547 4.12036C126.251 4.37136 126.017 4.66173 125.858 4.99763C125.699 5.33341 125.617 5.70154 125.618 6.07422C125.618 6.76324 125.82 7.32552 126.218 7.74509C126.615 8.15481 127.145 8.43411 127.796 8.56945L129.072 8.8549C129.435 8.93118 129.711 9.01731 129.889 9.11328C130.045 9.19572 130.119 9.31383 130.119 9.47871C130.119 9.62635 130.045 9.758 129.892 9.87735C129.731 10.0053 129.478 10.0681 129.139 10.0681C128.79 10.0717 128.445 9.99161 128.133 9.83429C127.836 9.68469 127.56 9.49515 127.312 9.27077C127.202 9.17922 127.076 9.1084 126.941 9.0616C126.788 9.01608 126.616 9.0653 126.419 9.22155L125.714 9.78876C125.509 9.96717 125.423 10.1825 125.461 10.431C125.496 10.6697 125.691 10.9158 126.055 11.1939C126.38 11.4313 126.798 11.6467 127.3 11.8312C127.803 12.017 128.391 12.113 129.059 12.113C129.596 12.113 130.092 12.0416 130.529 11.9013C130.967 11.7549 131.354 11.5593 131.668 11.3108C131.98 11.0724 132.231 10.7631 132.404 10.4077C132.576 10.0523 132.663 9.66076 132.659 9.26462C132.659 8.87212 132.595 8.52638 132.46 8.23601C132.331 7.95492 132.147 7.70366 131.919 7.49778V7.49901ZM138.958 9.51193C138.923 9.445 138.872 9.3882 138.809 9.34687C138.747 9.30555 138.675 9.28105 138.601 9.27569C138.451 9.27322 138.305 9.3222 138.186 9.41473C138.071 9.49101 137.946 9.55007 137.815 9.58821C137.649 9.64412 137.47 9.64967 137.3 9.60421C137.219 9.58443 137.144 9.54519 137.081 9.48978C137.005 9.42056 136.946 9.33472 136.908 9.23878C136.855 9.09669 136.83 8.94521 136.836 8.79338V5.76662H138.931C139.051 5.76662 139.159 5.71741 139.253 5.62267C139.295 5.58108 139.329 5.5314 139.352 5.4765C139.376 5.42159 139.388 5.36254 139.389 5.30276V4.02193C139.389 3.96024 139.377 3.89918 139.353 3.84249C139.329 3.78579 139.294 3.73465 139.25 3.69219C139.165 3.60724 139.05 3.55916 138.931 3.55807H136.835V1.49717C136.838 1.43555 136.827 1.37406 136.805 1.31679C136.782 1.25952 136.748 1.20777 136.704 1.16497C136.627 1.08454 136.521 1.03854 136.41 1.03701H134.784C134.695 1.03555 134.609 1.06135 134.535 1.11101C134.462 1.16066 134.405 1.23182 134.372 1.31507C134.349 1.37287 134.338 1.43484 134.339 1.49717V3.55684H133.411C133.353 3.55549 133.294 3.5675 133.241 3.59199C133.188 3.61647 133.14 3.65281 133.102 3.69834C133.025 3.78687 132.982 3.90193 132.984 4.0207V5.304C132.985 5.39177 133.01 5.47753 133.055 5.55238C133.1 5.62724 133.164 5.68846 133.24 5.72971C133.294 5.75555 133.352 5.76908 133.41 5.76662H134.339V9.36551C134.339 9.84536 134.423 10.2588 134.581 10.5996C134.741 10.9367 134.951 11.2197 135.204 11.4313C135.466 11.6503 135.766 11.8128 136.088 11.9087C136.415 12.0121 136.755 12.0638 137.096 12.0638C137.562 12.0638 138.004 11.9887 138.421 11.8423C138.817 11.7053 139.175 11.4722 139.463 11.1631C139.647 10.9404 139.668 10.6943 139.518 10.4483L138.958 9.51316V9.51193ZM147.78 3.55684H146.171C146.116 3.55785 146.061 3.57036 146.01 3.59363C145.959 3.6169 145.914 3.65043 145.876 3.69219C145.835 3.73558 145.802 3.78651 145.779 3.84229C145.758 3.89876 145.746 3.95885 145.747 4.01947V4.22371C145.544 3.98167 145.295 3.78409 145.014 3.64297C144.609 3.43011 144.136 3.32553 143.601 3.32553C143.092 3.32553 142.591 3.42765 142.117 3.6319C141.638 3.83631 141.204 4.13534 140.84 4.51162C140.46 4.9102 140.158 5.37925 139.952 5.89335C139.722 6.47038 139.608 7.08828 139.618 7.71064C139.618 8.37505 139.729 8.98655 139.95 9.52792C140.173 10.0619 140.468 10.5331 140.833 10.9158C141.188 11.2943 141.614 11.5956 142.087 11.8014C142.56 12.0072 143.069 12.1132 143.584 12.113C144.076 12.1217 144.563 12.0125 145.006 11.7943C145.314 11.6343 145.559 11.4412 145.747 11.2148V11.4326C145.745 11.4921 145.756 11.5513 145.778 11.6062C145.801 11.6612 145.834 11.7106 145.877 11.7512C145.916 11.7913 145.961 11.8232 146.012 11.8452C146.062 11.8671 146.116 11.8787 146.171 11.8792H147.78C147.837 11.8806 147.893 11.8699 147.946 11.8476C147.998 11.8254 148.046 11.7921 148.085 11.75C148.166 11.6649 148.21 11.5508 148.208 11.4326V4.0207C148.21 3.90149 148.167 3.78617 148.087 3.69834C148.049 3.65272 148.002 3.61618 147.948 3.59129C147.895 3.56679 147.838 3.555 147.78 3.55684ZM145.606 8.4907C145.437 8.95456 145.095 9.33232 144.655 9.54269C144.43 9.64997 144.184 9.70423 143.936 9.70141C143.685 9.70141 143.446 9.64727 143.224 9.54146C143.004 9.43906 142.806 9.2934 142.642 9.11285C142.477 8.9323 142.349 8.72044 142.266 8.48947C142.175 8.24565 142.129 7.98721 142.129 7.72663C142.129 7.44979 142.174 7.19018 142.264 6.94903C142.353 6.71894 142.481 6.50855 142.645 6.32891C142.812 6.15296 143.008 6.00901 143.224 5.90812C143.447 5.8023 143.69 5.74817 143.936 5.7494C144.199 5.7494 144.438 5.80353 144.655 5.90935C144.874 6.01393 145.066 6.15542 145.226 6.32891C145.388 6.50486 145.517 6.71402 145.606 6.94903C145.796 7.44486 145.796 7.99486 145.606 8.4907ZM156.622 9.40119L155.699 8.67157C155.522 8.52638 155.355 8.48701 155.21 8.54853C155.079 8.60436 154.964 8.69079 154.872 8.80076C154.673 9.05649 154.434 9.27863 154.167 9.45902C153.934 9.60913 153.629 9.68418 153.269 9.68418C153.004 9.68418 152.76 9.63496 152.542 9.53407C152.327 9.43495 152.134 9.2917 151.975 9.11328C151.812 8.93013 151.686 8.71715 151.602 8.48578C151.515 8.24262 151.471 7.98546 151.474 7.72663C151.474 7.4461 151.515 7.18772 151.602 6.94903C151.687 6.71279 151.811 6.50239 151.975 6.33014C152.138 6.15296 152.332 6.01024 152.546 5.90935C152.772 5.80107 153.019 5.74694 153.269 5.7494C153.629 5.7494 153.931 5.82814 154.167 5.97948C154.406 6.13451 154.646 6.35598 154.873 6.63651C154.968 6.7497 155.079 6.83337 155.21 6.88997C155.358 6.94903 155.523 6.90965 155.695 6.7657L156.618 6.03485C156.732 5.95424 156.817 5.83809 156.861 5.70387C156.886 5.63045 156.896 5.55227 156.889 5.47473C156.882 5.39719 156.858 5.32214 156.82 5.25478C156.464 4.67928 155.973 4.20275 155.391 3.86813C154.781 3.51009 154.05 3.32553 153.232 3.32553C152.668 3.32238 152.109 3.43311 151.588 3.65129C151.066 3.86947 150.593 4.19076 150.194 4.59652C149.805 4.99271 149.497 5.4701 149.29 5.99547C149.07 6.54494 148.957 7.13314 148.96 7.72663C148.96 8.33567 149.072 8.91765 149.29 9.45164C149.5 9.97332 149.807 10.4458 150.194 10.8395C150.593 11.2451 151.067 11.5663 151.588 11.7846C152.11 12.003 152.668 12.1142 153.232 12.1117C154.05 12.1117 154.781 11.9284 155.391 11.5654C155.976 11.232 156.468 10.7537 156.822 10.1751C156.86 10.1101 156.882 10.0374 156.889 9.96225C156.896 9.88643 156.886 9.80992 156.861 9.73832C156.813 9.60626 156.731 9.49007 156.622 9.40242V9.40119ZM165.194 11.1299L162.647 7.26277L164.827 4.29138C164.941 4.12036 164.971 3.95672 164.918 3.80292C164.88 3.69219 164.777 3.55684 164.514 3.55684H162.789C162.69 3.55775 162.593 3.58219 162.506 3.62821C162.398 3.68359 162.309 3.77173 162.253 3.88043L160.511 6.39904H160.089V0.447649C160.091 0.329229 160.048 0.214475 159.969 0.127748C159.929 0.0869473 159.881 0.0547186 159.828 0.0329554C159.776 0.0111921 159.719 0.000333517 159.663 0.00101762H158.051C157.964 0.00131009 157.88 0.0270233 157.807 0.0750545C157.735 0.123086 157.678 0.191382 157.643 0.271703C157.62 0.327334 157.608 0.387308 157.61 0.447649V11.4313C157.61 11.5581 157.656 11.6688 157.743 11.75C157.783 11.7911 157.831 11.8236 157.884 11.8456C157.937 11.8676 157.993 11.8786 158.051 11.878H159.664C159.721 11.8798 159.777 11.8692 159.83 11.8469C159.882 11.8246 159.929 11.7912 159.968 11.7488C160.007 11.7068 160.038 11.657 160.058 11.6024C160.08 11.5477 160.09 11.489 160.087 11.4301V8.52392H160.555L162.456 11.5335C162.592 11.7635 162.779 11.8792 163.013 11.8792H164.817C165.091 11.8792 165.205 11.7439 165.251 11.6307C165.316 11.4707 165.297 11.3083 165.194 11.1311V11.1299ZM125.015 3.55684H123.213C123.146 3.55424 123.079 3.56628 123.017 3.59218C122.954 3.61807 122.898 3.6572 122.852 3.70695C122.774 3.79331 122.72 3.89895 122.695 4.01332L121.365 9.14035H121.041L119.61 4.01332C119.586 3.90347 119.539 3.79998 119.473 3.70941C119.435 3.66072 119.386 3.62162 119.331 3.59516C119.276 3.5687 119.215 3.55559 119.154 3.55684H117.285C117.044 3.55684 116.892 3.63805 116.835 3.79431C116.786 3.94184 116.785 4.10149 116.832 4.24955L119.116 11.4658C119.152 11.5802 119.213 11.675 119.292 11.7512C119.337 11.7944 119.391 11.828 119.449 11.8499C119.507 11.8719 119.57 11.8818 119.632 11.8792H120.598L120.518 12.113L120.288 12.786C120.225 12.9927 120.103 13.1754 119.937 13.3101C119.784 13.4312 119.595 13.4954 119.402 13.4922C119.234 13.4914 119.069 13.4536 118.918 13.3815C118.768 13.312 118.625 13.2257 118.494 13.1243C118.375 13.0381 118.234 12.9889 118.089 12.9829H118.069C117.912 12.9829 117.775 13.0739 117.665 13.2486L117.091 14.1197C116.858 14.4938 116.987 14.7399 117.139 14.8764C117.422 15.152 117.778 15.3673 118.198 15.5211C118.614 15.6749 119.073 15.75 119.56 15.75C120.386 15.75 121.076 15.5199 121.605 15.0548C122.131 14.5922 122.52 13.9635 122.757 13.1797L125.405 4.24955C125.465 4.05884 125.465 3.90012 125.411 3.77093C125.366 3.6725 125.26 3.55684 125.015 3.55684Z"\n  fill="#838383"\n/>\n</svg>\n',a.appendChild(g);var y=document.createElement("style");return y.textContent='\n  .pre-checkout-modal {\n    display: none;\n    position: fixed;\n    z-index: 1;\n    left: 0;\n    top: 0;\n    width: 100vw;\n    height: 100%;\n    overflow: auto;\n    background-color: rgba(0, 0, 0, 0.75);\n    transition: all 0.2s ease;\n  }\n\n  .pre-checkout-modal.show {\n    display: block;\n  }\n\n  .pre-checkout-modal__content {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    margin-left: auto;\n    margin-right: auto;\n    background-color: #fefefe;\n    padding: 20px;\n    padding-bottom: max(30px, env(safe-area-inset-bottom));\n    width: 100%;\n    border-radius: 6px 6px 0 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    max-width: 350px;\n\n    box-sizing: border-box;\n    transform: translateY(238px);\n    transition: transform 0.3s cubic-bezier(.16,.81,.32,1);\n  }\n\n  .modal-wrapper {\n    width: 100%;\n  }\n\n  .payment-info {\n    position: relative;\n    padding-bottom: 15px;\n    border-bottom: solid 1px whitesmoke;\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    width: 100%;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu",\n      "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;\n  }\n\n  .customer-email {\n    color: #737373;\n    font-size: 13px;\n    line-height: 16px;\n  }\n\n  .customer-info {\n    flex: 1;\n    text-align: right;\n  }\n\n  .merchant-logo {\n    display: flex;\n    align-items: center;\n    height: 30px;\n  }\n  .transaction-amount {\n    margin-top: 5px;\n    font-size: 13px;\n    line-height: 16px;\n    color: #737373;\n  }\n\n  .amount {\n    color: #29b263;\n    font-weight: bold;\n  }\n\n  @media only screen and (min-width: 500px) {\n    .pre-checkout-modal__content {\n      bottom: 0;\n      top: 0;\n      margin: auto;\n      border-radius: 6px;\n      height: fit-content;\n    }\n  }\n\n  .pre-checkout-modal__content.show {\n    transform: translateY(0);\n    margin: 0 auto;\n    margin-top: 100px;\n  }\n\n  .pre-checkout-modal__content > * {\n    margin-top: 0;\n    margin-bottom: 40px;\n  }\n  .pre-checkout-modal__content > *:last-child {\n    margin-bottom: 0;\n  }\n\n  .pre-checkout-modal__content svg {\n    margin: auto;\n    width: 100%;\n  }\n\n  #inline-button-wordmark--white {\n    position: absolute;\n    bottom: -50px;\n    margin: auto;\n    left: 0;\n    right: 0;\n    width: fit-content;\n  }\n\n  #inline-button-wordmark--grey {\n    display: none;\n  }\n\n  .pre-checkout-modal__content #apple-pay-mark--light {\n    margin-bottom: 16px;\n  }\n\n  .pre-checkout-modal p {\n    -webkit-text-size-adjust: 100%;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    text-rendering: optimizeLegibility;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu",\n      "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;\n    color: #4E4E4E;\n    line-height: 140%;\n    font-size: 14px;\n    font-weight: 500;\n    margin: 0;\n    padding: 0 20px;\n    text-align: center;\n    letter-spacing: -0.3px;\n  }\n\n  .pre-checkout-modal button {\n    height: 42px;\n    width: 100%;\n    \n    box-sizing: border-box;\n    border-radius: 3px;\n    font-size: 14px;\n    line-height: 24px;\n    cursor: pointer;\n    -webkit-text-size-adjust: 100%;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    text-rendering: optimizeLegibility;\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu",\n      "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;\n  }\n\n  .pre-checkout-modal .open-paystack-pop-button {\n    background: #FAFAFA;\n    border: 1px solid #F2F3F3;\n    color: #4E4E4E;\n    font-weight: 500;\n  }\n\n  .pre-checkout-modal .open-paystack-pop-button:hover, \n  .pre-checkout-modal .open-paystack-pop-button:active, \n  .pre-checkout-modal .open-paystack-pop-button:focus {\n    background: #F2F3F3;\n  }\n\n  .pre-checkout-modal .pay-with-vault-button {\n    font-weight: 700;\n    background: #44b669;\n    background: linear-gradient(to bottom, #44b669 0%, #40ad57 100%);\n    border: solid 1px #49a861;\n    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);\n    outline: none;\n    color: white;\n    transition: all 300ms;\n  }\n\n  .pre-checkout-modal .vault-instruction {\n    color: #2f3d4d;\n    font-size: 14px;\n    letter-spacing: normal;\n    line-height: 1.4;\n    margin: 0 auto 24px;\n    padding: 0;\n  }\n  .vault-logo-container {\n    width: 74px;\n    height: 20px;\n    margin: 0 auto 24px\n  }\n  .vault-logo-container img {\n    height: 100%;\n    width: 100%;\n    border-radius: 8px;\n  }\n  .vault-divider {\n    margin-bottom: 16px;\n    margin-top: 24px;\n    position: relative;\n  }\n  .vault-divider__container {\n    align-items: center;\n    bottom: 0;\n    display: flex;\n    left: 0;\n    position: absolute;\n    right: 0;\n    top: 0;\n  }\n  .vault-divider__line {\n    border: 1px dashed #ccced0;\n    width: 100%;\n  }\n  .vault-divider__text-container {\n    display: flex;\n    justify-content: center;\n    position: relative;\n  }\n  .vault-divider__text {\n    background-color: #fff;\n    color: #999da1;\n    font-size: 14px;\n    font-weight: 500;\n    letter-spacing: -.3px;\n    line-height: 19.6px;\n    margin-bottom: 2px;\n    padding: 0 8px;\n  }\n\n  #payment-request-button {\n    width: 100%;\n    height: fit-content;\n    margin: 24px 0 16px 0;\n  }\n\n  #paystackpop-button {\n    padding: 0 16px;\n  }\n\n  #apple-pay-close-button {\n    position: absolute;\n    text-align: center;\n    top: 0;\n    right: -26px;\n    height: 16px;\n    width: 16px;\n    padding: 0;\n    display: inline-block;\n    z-index: 3;\n    border-radius: 50%;\n    background: transparent;\n    transition: all 300ms;\n    outline: none;\n    cursor: pointer;\n    border: none;\n  }\n\n  #apple-pay-close-button svg {\n    width: initial;\n  }\n  \n  #apple-pay-close-button:hover {\n    background-color: #e22b28;\n  }\n\n  @media only screen and (max-width: 500px) {\n    .pre-checkout-modal__content {\n      max-width: 500px;\n      border-radius: 0;\n      padding-bottom: 0;\n    }\n\n    .modal-wrapper {\n      padding: 0;\n    }\n\n    .vault-logo-container {\n      width: 74px;\n      height: 20px;\n    }\n\n    #inline-button-wordmark--white {\n      display: none\n    }\n    \n    #inline-button-wordmark--grey {\n      display: block;\n      width: 100%;\n      margin: 16px 0;\n      height: 13px;\n    }\n\n    #apple-pay-close-button {\n      display: none;\n    }\n  }\n',document.body.appendChild(y),document.body.appendChild(i),i}(FI.id,n,{canPayWithVault:i,canPayWithApplePay:r}),r?(FI.paymentRequestContainer=kI(FI.preCheckoutModal),yI(FI.paymentRequestContainer,{channels:n.channels,styles:{applePay:{width:"100%",type:"pay",height:"42px",padding:"15px",borderRadius:"5px"}}},n.merchant_id).then(function(){FI.registerPaymentRequestEventListeners()}).catch(function(){i?kI(FI.preCheckoutModal).remove():(FI.closePreCheckoutModal(),FI.animateCheckoutIn())}).finally(function(){e(t)})):e(t)):(FI.newTransaction({inlineTransaction:t,transactionData:n}),e(t))}).catch(function(e){t.onSetupError({status:!1,message:e.message}),n(e)})})}},{key:"openPreCheckoutModal",value:function(){var e;this.registerPreCheckoutModalEventListeners(),e=this.preCheckoutModal,new Promise(function(t,n){try{var r=e.querySelector(".pre-checkout-modal__content");e.classList.add("show"),setTimeout(function(){r.classList.add("show"),t(!0)},50)}catch(i){n(i)}})}},{key:"registerPreCheckoutModalEventListeners",value:function(){var e,t=this,n=!1,r=this.activeTransaction();document.addEventListener("touchstart",function(t){t.preventDefault(),n||(n=!0,e=setTimeout(function(){n=!1},125))},!0),document.addEventListener("touchend",function(t){t.target&&t.target.isSameNode(FI.preCheckoutModal)&&n&&(clearTimeout(e),FI.closePreCheckoutModal(),r&&r.cancel()),n=!1},!0);var i=wI(this.preCheckoutModal);i&&(i.onclick=function(){t.closePreCheckoutModal(),t.animateCheckoutIn()});var a=this.preCheckoutModal.querySelector("#".concat(xI));a&&(a.onclick=function(){t.closePreCheckoutModal(),t.animateCheckoutIn(),t.checkoutIframe.contentWindow.postMessage({type:"inline:pay-with-vault"},"*")}),this.preCheckoutModal.querySelector("#apple-pay-close-button").onclick=function(){t.sendAnalyticsEventToCheckout("trackCheckoutClosed"),t.closePreCheckoutModalAndCancelTransaction()}}},{key:"closePreCheckoutModal",value:function(e){var t,n;this.preCheckoutModal&&("failed"===e?(t=this.preCheckoutModal)&&(t.querySelector("#apple-pay-mark--light").innerHTML='<svg width="50" height="30" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="error-icon">\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="error" fill-rule="nonzero">\n            <path d="M9.14672,0.47855 L0.14829,15.47855 C-0.0403320234,15.7872042 -0.0475647902,16.1736607 0.129375884,16.4891566 C0.306316558,16.8046526 0.639843999,16.9999993 1.00157,17 L19.43546,17 C19.797186,16.9999993 20.1307134,16.8046526 20.3076541,16.4891566 C20.4845948,16.1736607 20.477362,15.7872042 20.28874,15.47855 L10.85328,0.47855 C10.671624,0.181297031 10.3483651,3.00996351e-06 10,3.00996351e-06 C9.6516349,3.00996351e-06 9.32837603,0.181297031 9.14672,0.47855 Z" id="Shape" fill="#FFAA22"></path>\n            <rect id="Rectangle-path" fill="#FFFFFF" x="9" y="6" width="2" height="5"></rect>\n            <rect id="Rectangle-path" fill="#FFFFFF" x="9" y="12" width="2" height="2"></rect>\n        </g>\n    </g>\n</svg>',t.querySelector("#apple-pay-description").textContent="An error occurred while paying with Apple Pay. Please try again or use another payment method."):((n=this.preCheckoutModal)&&(n.querySelector(".pre-checkout-modal__content").classList.remove("show"),n.classList.remove("show")),this.preCheckoutModal.remove(),this.preCheckoutModal=null))}},{key:"closePreCheckoutModalAndCancelTransaction",value:function(){this.preCheckoutModal&&(this.cancelTransaction(),this.checkoutIframe&&this.checkoutIframe.contentWindow&&this.checkoutIframe.contentWindow.postMessage("close","*"),this.closePreCheckoutModal())}},{key:"newTransaction",value:function(e){var t=e.preload,n=e.inlineTransaction,r=e.transactionData,i=WE(e,OI),a=this.paymentRequestContainer&&mI(this.paymentRequestContainer);if(this.activeTransaction()&&!a&&this.activeTransaction().cancel(),n&&r)return this.transactions.push(n),this.isDeprecatedApi||this.open({accessCode:r.access_code,language:n.urlParameters.language},t),n;var s=VI(this.transactions,n?n.parameters:i);if(s)return s.isActive=!0,this.isDeprecatedApi||this.open({accessCode:s.accessCode,language:s.urlParameters.language},t),s;var o=n||new LI(i),l=o.accessCode?{accessCode:o.accessCode,language:o.urlParameters.language}:o.urlParameters;return this.transactions.push(o),this.isDeprecatedApi||this.open(l,t),o}},{key:"preloadTransaction",value:function(e){var t=this;return this.newTransaction(ZE(ZE({},e),{},{preload:!0})),function(){return t.animateCheckoutIn()}}},{key:"paymentRequest",value:function(e){var t=e.container,n=e.styles,r=e.onElementsMount,i=WE(e,BI);return FI=this,new Promise(function(a,s){var o=document.querySelector("#".concat(e.loadPaystackCheckoutButton));if(dI()){FI.activeTransaction()&&FI.activeTransaction().cancel(),t&&gI(t)||$I("A container is required to mount the payment request button"),FI.paymentRequestContainer=gI(t);var l=VI(FI.transactions,i),c=l||new LI(i);c.requestInline().then(function(e){yI(FI.paymentRequestContainer,{channels:e.channels,styles:n},e.merchant_id).then(function(e){r&&r(e)}).catch(function(){r&&r(null)}).finally(function(){if(l?c.isActive=!0:FI.transactions.push(c),FI.registerPaymentRequestEventListeners(),o){var t=FI.preloadTransaction({inlineTransaction:c,transactionData:e});o.onclick=t}a(c)})}).catch(function(e){c.onSetupError({status:!1,message:e.message}),s(e)})}else{if(e&&e.loadPaystackCheckoutButton)if(o){var u=FI.preloadTransaction(i);o.onclick=u}else NI("This device does not support any payment request wallet options. Please consult our documentation at https://developers.paystack.co/docs/paystack-inline to see how to load alternative payment options using 'loadPaystackCheckoutButton'");r&&r(null);var h=FI.activeTransaction();a(h)}})}},{key:"registerApplePayEventListener",value:function(){var e=this;mI(this.paymentRequestContainer).onclick=function(){return e.startApplePay()}}},{key:"registerPaymentRequestEventListeners",value:function(){var e=this.activeTransaction();e&&pI(e.response.channels)?this.registerApplePayEventListener():function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(this.paymentRequestContainer)}},{key:"startApplePay",value:function(){var e,t,n,r=this,i="apple pay",a=this.activeTransaction();if(a){var s={channel:"apple_pay",paymentMethod:i,currency:a.currency,amount:a.amount},o={channel:"apple_pay",currency:a.currency,amount:a.amount,timeSpent:a.getTimeSpent()};try{a.logAttempt(i),this.sendAnalyticsEventToCheckout("trackPaymentAttempt",s);var l=(t=(e={currency:a.response.currency,amount:a.response.amount,merchantName:a.response.merchant_name,interval:a.response.plan_details&&a.response.plan_details.interval}).amount,n=e.interval,ZE({countryCode:"NG",currencyCode:e.currency,merchantCapabilities:["supports3DS","supportsCredit","supportsDebit"],supportedNetworks:["visa","masterCard"],requiredBillingContactFields:["postalAddress","name","phone","email"],total:{label:"".concat(e.merchantName," - Paystack"),type:"final",amount:String(lI(t))}},"string"==typeof n&&""!==n.trim()&&{lineItems:[{label:hI(n),amount:String(lI(t))}]})),c=new window.ApplePaySession(tI.applePayVersion,l);c.onvalidatemerchant=function(e){var t,n,r,i,s,o,l,u;(t={validationURL:e.validationURL,transactionId:a.id,merchantName:a.response.merchant_name},n=t.transactionId,r=t.validationURL,i=t.merchantName,o=void 0===(s=t.domainName)?window&&window.location&&window.location.hostname:s,l="".concat(tI.paymentBaseUrl).concat(tI.applePayValidateSessionPath),u=uI({transaction:n,sessionUrl:r,displayName:i,domainName:o}),fetch(l,ZE(ZE({},cI),{},{body:u})).then(function(e){return e.json()})).then(function(e){"success"!==e.status?a.onSetupError(e):c.completeMerchantValidation(e.data),a.logValidationResponse(e.message)}).catch(function(e){a.onSetupError(e)})},c.oncancel=function(){FI.preCheckoutModal||a.onCancel()},c.onpaymentauthorized=function(e){var t,n,s,l,u,h=e.payment;(t={transactionId:a.id,payment:h},n=t.transactionId,s=t.payment,l="".concat(tI.paymentBaseUrl).concat(tI.applePayChargePath),u=uI({transaction:n,paymentObject:JSON.stringify(s)}),fetch(l,ZE(ZE({},cI),{},{body:u})).then(function(e){return e.json()})).then(function(e){a.logAPIResponse(e,i),"success"===e.status?(c.completePayment(c.STATUS_SUCCESS),a.onSuccess(e),r.sendAnalyticsEventToCheckout("trackPaymentCompletion",o)):(c.completePayment(c.STATUS_FAILURE),a.onSetupError(e),r.sendAnalyticsEventToCheckout(qI,{channel:"apple_pay",message:e&&e.message||"Transaction attempt failed"})),FI.closePreCheckoutModal(e.status)}).catch(function(e){c.completePayment(c.STATUS_FAILURE),a.onSetupError(e),r.sendAnalyticsEventToCheckout(qI,{channel:"apple_pay",message:e&&e.message||"Error occurred"}),FI.closePreCheckoutModal("failed")})},c.begin()}catch(u){a.onSetupError(u)}}else $I("Could not initiate apple pay transaction")}},{key:"resumeTransaction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onSuccess,r=t.onCancel,i=t.onLoad,a=t.onError;return this.newTransaction({accessCode:e,onSuccess:n,onCancel:r,onLoad:i,onError:a})}},{key:"activeTransaction",value:function(){var e=this.transactions.filter(function(e){return e.isActive});return e.length?e[e.length-1]:null}},{key:"cancelTransaction",value:function(e){var t=this.transactions.find(function(t){return t.id===e})||this.activeTransaction();t&&(t.cancel(),this.close())}},{key:"respondToEvent",value:function(e){if(e){var t,n=this.activeTransaction();try{var r=e.data||e.message,i=r.event,a=r.data;if(i)switch(i){case"loaded:checkout":if(this.isLoaded=!0,n){var s=this.checkoutIframe,o=n.urlParameters,l=n.response;UI({checkoutIframe:s,urlParameters:l?{accessCode:l.access_code,language:null==o?void 0:o.language}:o})}break;case"loaded:transaction":(t=this.backgroundIframe.contentWindow.document)&&(t.getElementById("app-loader").style.display="none"),this.preCheckoutModal&&this.openPreCheckoutModal(),n.onLoad(a);break;case"error":"setup"===a.type?n.onSetupError(a):n.logError(a);break;case"cancel":case"close":this.close();var c=a&&a.status;c&&n.setStatus(c),!(this.paymentRequestContainer&&mI(this.paymentRequestContainer)&&!this.preCheckoutModal)&&(n.isActive=!1),n.onCancel();break;case"transfer:pending":this.close();var u=a&&a.status;u&&n.setStatus(u),n.onBankTransferConfirmationPending();break;case"success":this.close(),n.onSuccess(a)}}catch(h){}}}},{key:"respondToEmbedEvents",value:function(e){var t,n,r=this.activeTransaction(),i=e.data||e.message;if(i&&("string"==typeof i||i instanceof String)){var a={action:n=(t=i)&&"string"==typeof t?t.split(" ")[0]:null,data:n?t.split(" ").slice(2).join(" "):null};a&&"PaystackClose"===a.action&&a.data&&r.onSuccess(i),"PaystackTLSClose"===a.action&&r.cancel()}}},{key:"animateCheckoutIn",value:function(){var e,t=this;if(!this.isOpen){var n=this.checkoutIframe,r=this.backgroundIframe;(e={checkoutIframe:n,backgroundIframe:r},new Promise(function(t,n){e||n("No dom element provided");var r=e.checkoutIframe,i=e.backgroundIframe;r&&i||n("No dom element provided"),r.style.display="",r.style.visibility="visible",i.style.display="",i.style.visibility="visible",t()})).then(function(){t.checkoutIframe.contentWindow.postMessage("render","*")}),this.isOpen=!0}}},{key:"open",value:function(e,t){e&&(UI({checkoutIframe:this.checkoutIframe,urlParameters:e}),t||this.animateCheckoutIn())}},{key:"close",value:function(){var e=this;if(this.isOpen){var t,n=this.checkoutIframe,r=this.backgroundIframe;(t={checkoutIframe:n,backgroundIframe:r},new Promise(function(e,n){t||n("No dom element provided");var r=t.checkoutIframe,i=t.backgroundIframe;r&&i||n("No dom element provided"),i.style.opacity=0,r.style.display="none",r.style.visibility="hidden",setTimeout(function(){i.style.display="none",i.style.visibility="hidden",i.style.opacity=1,e()},300)})).then(function(){e.checkoutIframe.contentWindow.postMessage("close","*")}),this.isOpen=!1}}},{key:"isLoaded",value:function(){return this.isLoaded}}],[{key:"setup",value:function(t){var n=t&&t.container;FI||(FI=new e({isDeprecatedApi:!0,isEmbed:n})),jI("PaystackPop.setup()","new PaystackPop()","Please consult our documentation at https://developers.paystack.co/docs/paystack-inline");var r,i,a,s=FI.newTransaction(t,"deprecated"),o=s.urlParameters;if(n){var l="".concat(tI.siteUrl,"/assets/payment/production/inline.html?").concat(nI(o)),c=(r=FI.id,i=l,(a=fI("embed-checkout-".concat(r))).style.cssText="\n  background: transparent;\n  background: rgba(0,0,0,0);\n  border: 0px none transparent;\n  overflow-x: hidden;\n  overflow-y: hidden;\n  nmargin: 0;\n  padding: 0;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  visibility: hidden;\n  display: none;\n",a.src=i,a.id=r,a.name=r,a);!function(e,t){var n=document.getElementById(e);n.innerHTML="",n.removeAttribute("style"),n.className="paystack-embed-container",n.style.position="relative",n.style.width="100%",n.appendChild(t)}(t.container,c),c.onload=function(){var e;c.contentWindow.postMessage("PaystackOpen ".concat(FI.id),"*"),e=c,new Promise(function(t,n){e||n("No dom element provided"),e.style.display="",e.style.visibility="visible",t()})}}else s.openIframe=function(){jI("openIframe","open","Please consult our documentation at https://developers.paystack.co/docs/paystack-inline"),FI.open(o)};return s}}]),e}();if(GI=iI().length>0,HI=rI()&&"FORM"===rI().parentElement.tagName,GI&&HI){var YI,KI=(ZI={},WI=rI(),iI().forEach(function(e){var t=WI.getAttribute(e),n=e.split("data-")[1].replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});ZI[n]=t}),function(e){if(e.buttonId&&!document.getElementById(e.buttonId))throw new Error("Please make sure the buttonId is an element available in the DOM");var t=ZE({},e);t.buttonText=e.buttonText||"Pay",t.buttonVariant="normal",t.buttonWordmarkVariant="normal";var n=["normal","light"];return e.buttonVariant&&n.indexOf(e.buttonVariant)>-1&&(t.buttonVariant=e.buttonVariant),e.buttonWordmarkVariant&&n.indexOf(e.buttonWordmarkVariant)>-1&&(t.buttonWordmarkVariant=e.buttonWordmarkVariant),t}(ZI)),QI=rI().parentElement;FI||(FI=new XI),function(e){var t,n,r,i,a;if(e.id)(t=document.getElementById(e.id)).setAttribute("data-inline-id",e.id);else{var s=document.createElement("div");s.id="inline-button-".concat(e.inlineId),s.innerHTML=(a={normal:'\n  <svg id="inline-button-wordmark" width="137" height="13" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M.037 5.095l1.075-.135c-.011-.774-.025-1.944-.013-2.149C1.19 1.364 2.38.134 3.81.013 3.9.006 3.99.002 4.077 0a2.947 2.947 0 0 1 2.046.76c.574.509.95 1.26 1.008 2.007.015.192.01 1.491.01 2.257l1.096.163L8.2 11.44 4.093 12 0 11.346l.037-6.251zm4.106-.514l1.724.256c-.007-.933-.05-2.295-.26-2.654-.319-.545-.846-.867-1.443-.88h-.063c-.607.008-1.138.322-1.458.864-.222.378-.266 1.66-.265 2.637l1.765-.223zM18.228 10.108c-.576 0-1.064-.072-1.464-.216a2.864 2.864 0 0 1-.972-.6 2.552 2.552 0 0 1-.588-.864 4.067 4.067 0 0 1-.252-1.044h1.008c.032.256.088.5.168.732.08.224.204.424.372.6.168.168.388.304.66.408.28.096.636.144 1.068.144.28 0 .536-.036.768-.108.24-.08.448-.192.624-.336.176-.144.312-.316.408-.516.104-.2.156-.42.156-.66 0-.24-.032-.448-.096-.624a1.02 1.02 0 0 0-.336-.468 1.885 1.885 0 0 0-.636-.324 6.4 6.4 0 0 0-1.008-.228 8.79 8.79 0 0 1-1.212-.276 3.246 3.246 0 0 1-.9-.432 1.982 1.982 0 0 1-.564-.672c-.128-.272-.192-.6-.192-.984 0-.328.068-.632.204-.912.136-.288.324-.536.564-.744.248-.208.54-.372.876-.492.336-.12.708-.18 1.116-.18.864 0 1.548.204 2.052.612.512.4.812.984.9 1.752h-.936c-.104-.544-.316-.932-.636-1.164-.32-.24-.78-.36-1.38-.36-.592 0-1.04.132-1.344.396a1.255 1.255 0 0 0-.444.996c0 .208.024.396.072.564.056.16.156.3.3.42.152.12.36.228.624.324a6.72 6.72 0 0 0 1.068.228c.48.072.9.168 1.26.288.36.12.664.276.912.468s.432.428.552.708c.128.28.192.624.192 1.032 0 .36-.076.696-.228 1.008a2.472 2.472 0 0 1-.612.804c-.264.224-.58.4-.948.528-.36.128-.752.192-1.176.192zM25.355 10.108c-.44 0-.848-.076-1.224-.228a2.916 2.916 0 0 1-.96-.636 2.966 2.966 0 0 1-.636-1.008 3.77 3.77 0 0 1-.216-1.308v-.096c0-.472.072-.904.216-1.296.144-.4.344-.74.6-1.02.264-.288.576-.508.936-.66.36-.16.756-.24 1.188-.24.36 0 .708.06 1.044.18.344.112.648.292.912.54.264.248.472.572.624.972.16.392.24.868.24 1.428v.324h-4.728c.024.72.204 1.272.54 1.656.336.376.828.564 1.476.564.984 0 1.54-.364 1.668-1.092h.996c-.112.632-.408 1.112-.888 1.44-.48.32-1.076.48-1.788.48zm1.704-3.852c-.048-.648-.232-1.112-.552-1.392-.312-.28-.728-.42-1.248-.42-.512 0-.932.164-1.26.492-.32.32-.524.76-.612 1.32h3.672zM32.091 10.108c-.44 0-.848-.072-1.224-.216a3.054 3.054 0 0 1-.972-.636 3.12 3.12 0 0 1-.648-1.008 3.626 3.626 0 0 1-.228-1.32v-.096c0-.48.08-.916.24-1.308.16-.4.376-.74.648-1.02.28-.28.604-.496.972-.648.376-.16.772-.24 1.188-.24.328 0 .644.04.948.12.312.08.588.208.828.384.248.168.456.392.624.672.168.28.276.62.324 1.02h-.984c-.08-.496-.284-.848-.612-1.056-.32-.208-.696-.312-1.128-.312a1.93 1.93 0 0 0-.804.168c-.24.112-.452.272-.636.48a2.23 2.23 0 0 0-.42.744 2.991 2.991 0 0 0-.156.996v.096c0 .776.188 1.364.564 1.764.384.392.88.588 1.488.588.224 0 .436-.032.636-.096a1.651 1.651 0 0 0 .96-.768c.112-.192.18-.416.204-.672h.924a2.595 2.595 0 0 1-.276.948 2.386 2.386 0 0 1-.576.744c-.24.208-.52.372-.84.492-.32.12-.668.18-1.044.18zM38.335 10.108a2.83 2.83 0 0 1-.876-.132 1.724 1.724 0 0 1-.684-.42 2.145 2.145 0 0 1-.456-.756c-.112-.304-.168-.672-.168-1.104V3.724h.996v3.924c0 .552.116.956.348 1.212.24.256.608.384 1.104.384.224 0 .44-.036.648-.108.208-.072.392-.18.552-.324.16-.144.288-.324.384-.54.096-.216.144-.464.144-.744V3.724h.996V10h-.996v-.996c-.144.296-.388.556-.732.78-.336.216-.756.324-1.26.324zM43.216 3.724h.996v1.128c.2-.352.452-.64.756-.864.312-.232.748-.356 1.308-.372v.936a4.461 4.461 0 0 0-.852.12 1.647 1.647 0 0 0-.66.324 1.472 1.472 0 0 0-.408.612c-.096.248-.144.564-.144.948V10h-.996V3.724zM50 10.108c-.44 0-.848-.076-1.224-.228a2.916 2.916 0 0 1-.96-.636 2.966 2.966 0 0 1-.636-1.008 3.77 3.77 0 0 1-.216-1.308v-.096c0-.472.072-.904.216-1.296.144-.4.344-.74.6-1.02.264-.288.576-.508.936-.66.36-.16.756-.24 1.188-.24.36 0 .708.06 1.044.18.344.112.648.292.912.54.264.248.472.572.624.972.16.392.24.868.24 1.428v.324h-4.728c.024.72.204 1.272.54 1.656.336.376.828.564 1.476.564.984 0 1.54-.364 1.668-1.092h.996c-.112.632-.408 1.112-.888 1.44-.48.32-1.076.48-1.788.48zm1.704-3.852c-.048-.648-.232-1.112-.552-1.392-.312-.28-.728-.42-1.248-.42-.512 0-.932.164-1.26.492-.32.32-.524.76-.612 1.32h3.672zM56.496 10.108c-.408 0-.788-.068-1.14-.204a2.683 2.683 0 0 1-.9-.612 3.01 3.01 0 0 1-.588-.984 4.01 4.01 0 0 1-.204-1.32v-.096c0-.48.072-.92.216-1.32.144-.4.344-.744.6-1.032.256-.296.564-.524.924-.684.36-.16.756-.24 1.188-.24.528 0 .956.112 1.284.336.328.216.584.476.768.78V.724h.996V10h-.996V8.92c-.088.152-.208.3-.36.444a2.792 2.792 0 0 1-.516.384 2.874 2.874 0 0 1-.6.252c-.216.072-.44.108-.672.108zm.108-.828c.288 0 .56-.048.816-.144.256-.096.476-.24.66-.432.184-.2.328-.448.432-.744.112-.304.168-.656.168-1.056v-.096c0-.808-.18-1.404-.54-1.788-.352-.384-.836-.576-1.452-.576-.624 0-1.112.208-1.464.624-.352.416-.528 1.008-.528 1.776v.096c0 .392.048.736.144 1.032.104.296.24.54.408.732.176.192.38.336.612.432.232.096.48.144.744.144zM67.712 10.108c-.512 0-.948-.112-1.308-.336a2.38 2.38 0 0 1-.816-.804V10h-.996V.724h.996V4.78a1.92 1.92 0 0 1 .348-.432c.152-.144.32-.268.504-.372.192-.112.396-.2.612-.264.216-.064.436-.096.66-.096.408 0 .788.072 1.14.216.352.144.652.352.9.624.256.272.456.604.6.996.144.392.216.832.216 1.32v.096c0 .48-.068.92-.204 1.32a3.103 3.103 0 0 1-.576 1.02 2.583 2.583 0 0 1-.9.672 2.937 2.937 0 0 1-1.176.228zm-.096-.828c.624 0 1.1-.2 1.428-.6.328-.408.492-.996.492-1.764V6.82c0-.4-.052-.748-.156-1.044a2.095 2.095 0 0 0-.42-.732 1.53 1.53 0 0 0-.612-.444 1.798 1.798 0 0 0-.744-.156c-.288 0-.56.048-.816.144a1.71 1.71 0 0 0-.648.444c-.184.192-.328.44-.432.744a3.152 3.152 0 0 0-.156 1.044v.096c0 .8.192 1.396.576 1.788.384.384.88.576 1.488.576zM73.63 9.352l-2.46-5.628h1.068l1.92 4.5 1.74-4.5h1.02l-3.468 8.46h-1.008l1.188-2.832zM87.127 3.669A3.138 3.138 0 0 0 86.1 2.95a3.09 3.09 0 0 0-1.228-.25c-.448 0-.848.086-1.187.26a2.199 2.199 0 0 0-.662.497v-.191a.387.387 0 0 0-.214-.348.323.323 0 0 0-.14-.03h-1.315a.314.314 0 0 0-.254.116.377.377 0 0 0-.1.262v8.97c0 .1.034.188.1.258a.34.34 0 0 0 .254.103h1.341a.342.342 0 0 0 .244-.103.336.336 0 0 0 .11-.259v-3.06c.178.202.417.357.702.464.35.134.72.203 1.093.203.43 0 .848-.082 1.242-.248a3.124 3.124 0 0 0 1.04-.724c.305-.326.545-.709.707-1.128a3.93 3.93 0 0 0 .263-1.477c0-.54-.086-1.037-.263-1.477a3.387 3.387 0 0 0-.706-1.12zm-1.204 3.24c-.073.19-.18.362-.315.51a1.415 1.415 0 0 1-1.065.466c-.2.001-.4-.04-.584-.12a1.484 1.484 0 0 1-.49-.346 1.593 1.593 0 0 1-.32-.51 1.738 1.738 0 0 1-.115-.63c0-.224.04-.435.115-.631a1.532 1.532 0 0 1 .804-.846c.185-.086.386-.13.59-.129.215 0 .414.044.593.13.177.083.338.199.474.341a1.622 1.622 0 0 1 .425 1.135c0 .225-.037.436-.112.63zM95.298 2.89h-1.33a.339.339 0 0 0-.246.11.384.384 0 0 0-.108.266v.166a1.856 1.856 0 0 0-.602-.472 2.525 2.525 0 0 0-1.166-.258 3.227 3.227 0 0 0-2.284.964 3.554 3.554 0 0 0-.734 1.123 3.827 3.827 0 0 0-.275 1.477c0 .54.092 1.037.275 1.477.184.434.427.817.728 1.128a3.146 3.146 0 0 0 2.277.973c.437 0 .834-.088 1.173-.259.25-.13.456-.287.608-.471v.177a.34.34 0 0 0 .11.259.341.341 0 0 0 .244.104h1.33a.324.324 0 0 0 .25-.105.349.349 0 0 0 .102-.258V3.267a.377.377 0 0 0-.1-.262.325.325 0 0 0-.252-.115zM93.502 6.9a1.55 1.55 0 0 1-.312.511c-.136.143-.296.26-.473.344-.178.085-.38.129-.596.129-.207 0-.407-.044-.59-.13a1.501 1.501 0 0 1-.791-.855 1.766 1.766 0 0 1-.112-.62c0-.225.038-.436.112-.632.075-.193.181-.364.314-.504.137-.143.3-.26.478-.342.182-.085.382-.129.59-.129.215 0 .417.044.595.13.178.085.338.2.473.341a1.623 1.623 0 0 1 .424 1.135c0 .215-.037.424-.112.622zM108.567 6.094a2.265 2.265 0 0 0-.654-.402c-.247-.101-.509-.181-.785-.235l-1.014-.204c-.26-.05-.441-.117-.543-.203a.328.328 0 0 1-.136-.264c0-.11.063-.2.189-.282.137-.086.329-.13.566-.13.26 0 .518.053.757.157.243.106.471.226.67.36.295.187.546.162.727-.053l.487-.57a.543.543 0 0 0 .152-.357c0-.128-.064-.245-.185-.351-.207-.184-.533-.378-.971-.568-.437-.192-.987-.29-1.637-.29-.427 0-.82.058-1.168.172-.35.116-.65.276-.893.474-.245.204-.438.44-.57.713a2 2 0 0 0-.198.875c0 .56.167 1.017.496 1.358.328.333.766.56 1.304.67l1.054.232c.3.062.528.132.675.21.129.067.19.163.19.297 0 .12-.061.227-.188.324-.133.104-.342.155-.622.155a1.83 1.83 0 0 1-.831-.19 3.056 3.056 0 0 1-.678-.458.995.995 0 0 0-.307-.17c-.126-.037-.268.003-.431.13l-.583.461c-.169.145-.24.32-.209.522.029.194.19.394.491.62.269.193.614.368 1.029.518.415.151.901.229 1.453.229.444 0 .854-.058 1.215-.172.362-.119.681-.278.941-.48a2.056 2.056 0 0 0 .819-1.663c0-.319-.053-.6-.165-.836a1.843 1.843 0 0 0-.447-.6zM114.383 7.73a.363.363 0 0 0-.295-.192.55.55 0 0 0-.343.113c-.095.062-.198.11-.306.141a.75.75 0 0 1-.426.013.43.43 0 0 1-.181-.093.554.554 0 0 1-.143-.204.92.92 0 0 1-.059-.362v-2.46h1.731c.099 0 .188-.04.266-.117a.368.368 0 0 0 .112-.26V3.268a.369.369 0 0 0-.115-.268.38.38 0 0 0-.263-.109h-1.732V1.216a.354.354 0 0 0-.108-.27.347.347 0 0 0-.243-.104h-1.344a.36.36 0 0 0-.34.226.371.371 0 0 0-.027.148V2.89h-.767a.324.324 0 0 0-.255.115.385.385 0 0 0-.098.262V4.31a.4.4 0 0 0 .212.346c.044.021.092.032.14.03h.768v2.925c0 .39.069.726.2 1.003.132.274.305.504.514.676.217.178.465.31.731.388.27.084.551.126.833.126.385 0 .75-.061 1.094-.18a2.13 2.13 0 0 0 .861-.552c.152-.181.17-.381.046-.581l-.463-.76zM121.672 2.89h-1.329a.339.339 0 0 0-.244.11.39.39 0 0 0-.08.122.394.394 0 0 0-.027.144v.166a1.906 1.906 0 0 0-.605-.472c-.335-.173-.726-.258-1.168-.258-.42 0-.834.083-1.226.249a3.24 3.24 0 0 0-1.055.715 3.528 3.528 0 0 0-.734 1.123 3.79 3.79 0 0 0-.276 1.477c0 .54.092 1.037.275 1.477.184.434.428.817.729 1.128a3.138 3.138 0 0 0 2.273.973 2.59 2.59 0 0 0 1.175-.259c.255-.13.457-.287.612-.471v.177a.34.34 0 0 0 .108.259.343.343 0 0 0 .243.104h1.329a.335.335 0 0 0 .252-.105.364.364 0 0 0 .102-.258V3.267a.38.38 0 0 0-.1-.262.332.332 0 0 0-.115-.087.311.311 0 0 0-.139-.028zM119.876 6.9a1.534 1.534 0 0 1-.786.855 1.362 1.362 0 0 1-.594.129c-.207 0-.405-.044-.588-.13a1.516 1.516 0 0 1-.792-.855 1.757 1.757 0 0 1-.113-.62c0-.225.037-.436.112-.632.073-.187.179-.358.314-.504.138-.143.3-.26.479-.342.184-.086.385-.13.588-.129.217 0 .415.044.594.13.181.085.34.2.472.341.134.143.24.313.314.504a1.73 1.73 0 0 1 0 1.253zM128.978 7.64l-.763-.593c-.146-.118-.284-.15-.404-.1a.742.742 0 0 0-.279.205 2.527 2.527 0 0 1-.583.535c-.192.122-.444.183-.742.183-.219 0-.42-.04-.6-.122a1.423 1.423 0 0 1-.469-.342 1.575 1.575 0 0 1-.308-.51 1.751 1.751 0 0 1-.106-.617c0-.228.034-.438.106-.632.07-.192.173-.363.308-.503.135-.144.295-.26.472-.342.187-.088.391-.132.597-.13.298 0 .547.064.742.187.198.126.396.306.584.534.078.092.17.16.278.206.122.048.259.016.401-.101l.762-.594a.53.53 0 0 0 .201-.269.437.437 0 0 0-.034-.365 3.329 3.329 0 0 0-1.18-1.127c-.504-.291-1.108-.441-1.784-.441a3.519 3.519 0 0 0-2.51 1.033c-.322.322-.576.71-.747 1.137a3.68 3.68 0 0 0-.273 1.407c0 .495.093.968.273 1.402.173.424.427.808.747 1.128a3.527 3.527 0 0 0 2.51 1.034c.676 0 1.28-.149 1.784-.444a3.286 3.286 0 0 0 1.182-1.13.411.411 0 0 0 .055-.173.415.415 0 0 0-.023-.182.624.624 0 0 0-.197-.273zM136.06 9.045l-2.104-3.143 1.801-2.415c.094-.139.119-.272.075-.397-.031-.09-.116-.2-.334-.2h-1.425a.52.52 0 0 0-.234.058.482.482 0 0 0-.209.205L132.191 5.2h-.349V.363a.37.37 0 0 0-.099-.26.352.352 0 0 0-.253-.103h-1.332a.37.37 0 0 0-.337.22.346.346 0 0 0-.027.143V9.29c0 .103.038.193.11.259a.353.353 0 0 0 .254.104h1.333a.328.328 0 0 0 .251-.105.346.346 0 0 0 .075-.119.333.333 0 0 0 .024-.14V6.927h.386l1.571 2.446c.112.187.267.281.46.281h1.491c.226 0 .32-.11.358-.202.054-.13.038-.262-.047-.406zM102.863 2.89h-1.489a.389.389 0 0 0-.298.122.544.544 0 0 0-.13.249l-1.099 4.167h-.268l-1.182-4.167a.66.66 0 0 0-.113-.247.329.329 0 0 0-.264-.124h-1.544c-.199 0-.325.066-.372.193a.588.588 0 0 0-.002.37l1.887 5.865c.03.093.08.17.145.232a.388.388 0 0 0 .281.104h.798l-.066.19-.19.547a.872.872 0 0 1-.29.426.7.7 0 0 1-.442.148.956.956 0 0 1-.4-.09 1.842 1.842 0 0 1-.35-.209.62.62 0 0 0-.335-.115h-.016c-.13 0-.243.074-.334.216l-.474.708c-.193.304-.086.504.039.615.234.224.528.399.875.524.344.125.723.186 1.126.186.682 0 1.252-.187 1.689-.565.435-.376.756-.887.952-1.524l2.188-7.258c.05-.155.05-.284.005-.389-.037-.08-.125-.174-.327-.174z" fill="#011B33"/>\n    </svg>',light:aI},"\n    <style>\n      #inline-button-".concat((n=e).inlineId," {\n        position: relative;\n        text-align: center;\n        display: inline-block;\n      }\n      #inline-button-").concat(n.inlineId,"__trigger {\n        ").concat((r=n.variant||"normal",i={normal:"\n    background: linear-gradient(180deg,#44b669 0,#40ad57);\n    text-shadow: 1px 1px 1px rgba(0,0,0,.1);\n    color: #ffffff;\n  ",light:"\n    background: white;\n    text-shadow: none;\n    color: #011b33;\n  "},"".concat("\n    box-sizing: border-box;\n    display: inline-block;\n    line-height: 1;\n    white-space: nowrap;\n    margin: 0 0 10px;\n    text-align: center;\n    -webkit-appearance: none;\n    outline: none;\n    font-size: 14px;\n    font-weight: 600;\n    border-radius: 6px;\n    cursor: pointer;\n    padding: 16px 24px;\n    box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.15);\n    transition: all .3s ease;\n    border: none;\n    min-width: 190px;\n  ").concat(i[r])),"\n      }\n      #inline-button-").concat(n.inlineId,"__trigger:hover {\n        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);\n      }\n      #inline-button-").concat(n.inlineId,'__trigger:active {\n        transform: translateY(3px);\n      }\n    </style>\n    <button id="inline-button-').concat(n.inlineId,'__trigger" data-inline-id="').concat(n.inlineId,'">').concat(n.text||"Pay"," ").concat(n.currency||"NGN"," ").concat(n.amount,'</button>\n    <div id="inline-button-').concat(n.inlineId,'__wordmark">\n      ').concat(a[n.wordmarkVariant||"normal"],"\n    </div>\n  ")),e.parent.parentNode.insertBefore(s,e.parent.nextSibling),t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(l=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||QE(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(s.getElementsByTagName("button"),1)[0]}return t}({inlineId:FI.id,amount:KI.amount/100,currency:KI.currency,id:KI.buttonId,text:KI.buttonText,variant:KI.buttonVariant,wordmarkVariant:KI.buttonWordmarkVariant,parent:rI()}).addEventListener("click",function(e){e.preventDefault(),YI?FI.resumeTransaction(YI.accessCode):YI=FI.newTransaction(ZE(ZE({},KI),{},{onSuccess:function(e){var t,n,r,i,a,s;n=(t={type:"hidden",name:"reference",value:e.reference,parent:QI}).type,r=t.value,i=t.name,a=t.parent,(s=document.createElement("input")).type=n,s.value=r,s.name=i,a.appendChild(s),QI.submit()}}))})}var JI=function(){function e(){var e=new XI;this.pop=e}return e.prototype.isLoaded=function(){return this.pop.isLoaded()},e.prototype.newTransaction=function(e){return this.pop.newTransaction(e)},e.prototype.resumeTransaction=function(e){return this.pop.newTransaction(e)},e.prototype.cancelTransaction=function(e){return this.pop.cancelTransaction(e)},e.prototype.preloadTransaction=function(e){return this.pop.preloadTransaction(e)},e.prototype.checkout=function(e){return this.pop.checkout(e)},e.prototype.paymentRequest=function(e){return this.pop.paymentRequest(e)},e}();const eP=()=>{const e=u(),{cart:t,isLoading:r,error:i,updateAddress:a,shippingOptions:o,addShippingMethod:l,initiatePaymentSession:c,completeCart:h}=Cp(),[d,p]=s.useState(0),[f,m]=s.useState(!1),[g,y]=s.useState(null),[_,v]=s.useState({first_name:"",last_name:"",address_1:"",city:"",country_code:"za",postal_code:"",phone:"",province:""}),[x,b]=s.useState(""),w=s.useRef(null);s.useEffect(()=>{t&&b(t.email||"")},[t]),s.useEffect(()=>{w.current||(w.current=new JI)},[]);const S=e=>(e/100).toFixed(2);return r&&!t?n.jsx("div",{className:"pt-24 text-center",children:"Loading checkout..."}):t&&0!==t.items.length?n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsx("div",{className:"container mx-auto px-6 max-w-6xl",children:n.jsxs("div",{className:"flex flex-col lg:flex-row gap-12",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h1",{className:"text-3xl font-serif font-bold mb-8",children:"Checkout"}),n.jsxs("div",{className:"mb-8 "+(0!==d?"opacity-60 pointer-events-none":""),children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold "+(d>=0?"bg-primary text-white":"bg-gray-200"),children:"1"}),n.jsx("h2",{className:"text-xl font-bold",children:"Shipping Address"})]}),0===d&&n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(!0),y(null);try{await a(_),p(1)}catch(fP){y(fP.message||"Failed to save address")}finally{m(!1)}},className:"grid grid-cols-1 md:grid-cols-2 gap-4 pl-11",children:[n.jsx("input",{required:!0,placeholder:"First Name",className:"border p-3 rounded",value:_.first_name,onChange:e=>v({..._,first_name:e.target.value})}),n.jsx("input",{required:!0,placeholder:"Last Name",className:"border p-3 rounded",value:_.last_name,onChange:e=>v({..._,last_name:e.target.value})}),n.jsx("input",{required:!0,placeholder:"Address",className:"border p-3 rounded md:col-span-2",value:_.address_1,onChange:e=>v({..._,address_1:e.target.value})}),n.jsx("input",{required:!0,placeholder:"City",className:"border p-3 rounded",value:_.city,onChange:e=>v({..._,city:e.target.value})}),n.jsx("input",{required:!0,placeholder:"Postal Code",className:"border p-3 rounded",value:_.postal_code,onChange:e=>v({..._,postal_code:e.target.value})}),n.jsx("input",{required:!0,placeholder:"Province",className:"border p-3 rounded",value:_.province,onChange:e=>v({..._,province:e.target.value})}),n.jsx("input",{required:!0,placeholder:"Phone",className:"border p-3 rounded",value:_.phone,onChange:e=>v({..._,phone:e.target.value})}),n.jsx("button",{type:"submit",disabled:f,className:"bg-primary text-white py-3 rounded md:col-span-2 mt-2 hover:opacity-90 disabled:opacity-50",children:f?"Saving...":"Continue to Shipping"})]})]}),n.jsxs("div",{className:"mb-8 "+(1!==d?"opacity-60 pointer-events-none":""),children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold "+(d>=1?"bg-primary text-white":"bg-gray-200"),children:"2"}),n.jsx("h2",{className:"text-xl font-bold",children:"Shipping Method"})]}),1===d&&n.jsxs("div",{className:"pl-11 space-y-3",children:[0===o.length?n.jsx("p",{className:"text-red-500",children:"No shipping options available for this region."}):o.map(e=>n.jsxs("button",{onClick:()=>(async e=>{m(!0),y(null);try{await l(e),p(2)}catch(fP){y(fP.message||"Failed to select shipping method")}finally{m(!1)}})(e.id),className:"w-full flex justify-between p-4 border rounded hover:border-primary text-left",children:[n.jsx("span",{children:e.name}),n.jsxs("span",{className:"font-bold",children:["R",S(e.amount)]})]},e.id)),n.jsx("button",{onClick:()=>p(0),className:"text-sm underline text-gray-500 mt-2",children:"Back to Address"})]})]}),n.jsxs("div",{className:"mb-8 "+(2!==d?"opacity-60 pointer-events-none":""),children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold "+(d>=2?"bg-primary text-white":"bg-gray-200"),children:"3"}),n.jsx("h2",{className:"text-xl font-bold",children:"Payment"})]}),2===d&&n.jsxs("div",{className:"pl-11",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-sm font-bold mb-2",children:"Email Address"}),n.jsx("input",{type:"email",required:!0,value:x,onChange:e=>b(e.target.value),className:"w-full border p-3 rounded",placeholder:"receipt@email.com"})]}),n.jsx("div",{className:"p-4 bg-gray-50 rounded border mb-4",children:n.jsx("p",{className:"text-sm",children:"You will be redirected to Paystack to complete your payment securely."})}),g&&n.jsx("p",{className:"text-red-500 text-sm mb-4",children:g}),i&&n.jsx("p",{className:"text-red-500 text-sm mb-4",children:i}),n.jsx("button",{onClick:async()=>{if(x){m(!0),y(null);try{const t=await c(x),n=t.data?.paystackTxAccessCode;if(!n)throw new Error("Payment access code missing");w.current.resumeTransaction(n,{async onSuccess(){try{const t=await h();e("/order-success",{state:{order:t}})}catch(fP){y(fP.message||"Order completion failed"),m(!1)}},onError(e){y(e?.message||"Payment failed"),m(!1)},onClose(){m(!1)}})}catch(fP){y(fP.message||"Failed to initiate payment"),m(!1)}}else y("Please provide an email address")},disabled:f,className:"w-full bg-primary text-white py-4 rounded font-bold hover:bg-dark-green transition-colors disabled:opacity-50",children:f?"Processing...":`Pay R${S(t.total)}`}),n.jsx("button",{onClick:()=>p(1),className:"text-sm underline text-gray-500 mt-4",children:"Back to Shipping"})]})]})]}),n.jsx("div",{className:"w-full lg:w-96",children:n.jsxs("div",{className:"bg-gray-50 p-6 rounded sticky top-24",children:[n.jsx("h3",{className:"font-bold text-lg mb-4",children:"Order Summary"}),n.jsx("div",{className:"space-y-4 max-h-96 overflow-auto",children:t.items.map(e=>n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded overflow-hidden",children:e.thumbnail&&n.jsx("img",{src:e.thumbnail,alt:e.title,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:e.title}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Qty: ",e.quantity]})]}),n.jsxs("p",{className:"font-medium text-sm",children:["R",S(e.total)]})]},e.id))}),n.jsxs("div",{className:"border-t mt-4 pt-4 space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Subtotal"}),n.jsxs("span",{children:["R",S(t.subtotal)]})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Shipping"}),n.jsx("span",{children:"Calculated at next step"})]}),n.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[n.jsx("span",{children:"Total"}),n.jsxs("span",{children:["R",S(t.total)]})]})]})]})})]})})}):n.jsxs("div",{className:"pt-24 text-center",children:[n.jsx("p",{children:"Your cart is empty"}),n.jsx("button",{onClick:()=>e("/shop"),className:"text-primary mt-4",children:"Go to Shop"})]})},tP=()=>{const e=c(),t=u(),r=e.state?.order;if(f.useEffect(()=>{r||t("/")},[r,t]),!r)return null;const i=e=>(e/100).toFixed(2);return n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsx("div",{className:"container mx-auto px-6",children:n.jsxs("div",{className:"max-w-2xl mx-auto",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-4",children:n.jsx(AC,{className:"w-12 h-12 text-green-600"})}),n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:"Order Confirmed!"}),n.jsx("p",{className:"text-lg text-gray-600",children:"Thank you for your purchase. Your order has been received."})]}),n.jsxs("div",{className:"bg-light-beige border border-green-50 rounded-sm p-6 mb-8",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(JC,{className:"text-primary mt-1",size:20}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Order Number"}),n.jsx("p",{className:"font-semibold text-gray-900",children:r.display_id||r.id})]})]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(XC,{className:"text-primary mt-1",size:20}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Confirmation Sent To"}),n.jsx("p",{className:"font-semibold text-gray-900",children:r.email})]})]})]}),n.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[n.jsx("h3",{className:"font-serif font-bold text-gray-900 mb-4",children:"Order Summary"}),n.jsxs("div",{className:"space-y-3",children:[r.items?.map(e=>n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsxs("span",{className:"text-gray-700",children:[e.title,"  ",e.quantity]}),n.jsxs("span",{className:"font-semibold",children:["$",i(e.total)]})]},e.id)),n.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between font-bold text-lg",children:[n.jsx("span",{children:"Total Paid"}),n.jsxs("span",{className:"text-green-600",children:["$",i(r.total)]})]})]})]})]}),n.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-sm p-6 mb-8",children:[n.jsx("h3",{className:"font-bold text-blue-900 mb-3",children:"What's Next?"}),n.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-blue-500 mt-1",children:""}),n.jsx("span",{children:"You'll receive an order confirmation email shortly"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-blue-500 mt-1",children:""}),n.jsx("span",{children:"We'll notify you when your order ships"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-blue-500 mt-1",children:""}),n.jsx("span",{children:"Track your order status in your account"})]})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[n.jsx(h,{to:"/account",className:"flex-1 bg-primary text-white font-bold uppercase tracking-wider py-4 rounded-sm hover:bg-dark-green transition-colors text-center",children:"View Order Details"}),n.jsxs(h,{to:"/shop",className:"flex-1 bg-white border-2 border-primary text-primary font-bold uppercase tracking-wider py-4 rounded-sm hover:bg-light-beige transition-colors text-center flex items-center justify-center gap-2",children:["Continue Shopping",n.jsx(TC,{size:18})]})]}),n.jsxs("p",{className:"text-xs text-center text-gray-500 mt-8",children:["Need help? Contact us at ",n.jsx("a",{href:"mailto:hygienhub@gmail.com",className:"text-primary hover:underline",children:"hygienhub@gmail.com"})]})]})})})},nP=()=>n.jsxs("div",{className:"bg-white min-h-screen",children:[n.jsx("section",{className:"bg-light-beige py-20 border-b border-gray-100",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsx("span",{className:"text-secondary font-bold tracking-widest uppercase text-xs mb-4 block",children:"Your Favorites"}),n.jsx("h1",{className:"text-5xl font-serif font-bold text-gray-900 mb-6",children:"Wishlist"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto leading-relaxed",children:"Save the products you love and find them easily whenever you're ready to treat your skin."})]})}),n.jsxs("div",{className:"container mx-auto px-6 py-32",children:[n.jsxs("div",{className:"max-w-md mx-auto text-center space-y-8",children:[n.jsx("div",{className:"w-24 h-24 bg-gray-50 text-gray-300 rounded-full flex items-center justify-center mx-auto mb-8 border border-gray-100 animate-pulse-slow",children:n.jsx(BC,{size:40})}),n.jsx("h2",{className:"text-3xl font-serif font-bold text-gray-400",children:"Your wishlist is empty"}),n.jsx("p",{className:"text-gray-500 leading-relaxed",children:"Explore our collection and click the heart icon to save items you admire. Your radiance journey starts here."}),n.jsxs(h,{to:"/shop",className:"inline-flex items-center gap-3 px-10 py-4 bg-primary text-white font-bold uppercase tracking-widest hover:bg-secondary transition-all shadow-lg",children:["Start Exploring ",n.jsx(TC,{size:18})]})]}),n.jsxs("div",{className:"mt-32 border-t border-gray-100 pt-20",children:[n.jsxs("div",{className:"flex justify-between items-end mb-12",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-primary font-bold tracking-widest uppercase text-xs mb-2 block",children:"Curation"}),n.jsx("h3",{className:"text-3xl font-serif font-bold text-gray-900",children:"Recommended For You"})]}),n.jsxs(h,{to:"/shop",className:"text-sm font-bold uppercase tracking-widest text-gray-400 hover:text-primary transition-colors flex items-center gap-2",children:["View All ",n.jsx(TC,{size:16})]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[1,2,3,4].map(e=>n.jsxs("div",{className:"group cursor-pointer",children:[n.jsxs("div",{className:"bg-gray-50 aspect-[4/5] mb-4 overflow-hidden relative",children:[n.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-200",children:n.jsx(cE,{size:48})}),n.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-all"})]}),n.jsx("div",{className:"h-4 w-2/3 bg-gray-100 mb-2"}),n.jsx("div",{className:"h-4 w-1/3 bg-gray-50"})]},e))})]})]})]}),rP=[{question:"What shipping methods are available?",answer:"We offer standard shipping (5-7 business days), express shipping (2-3 business days), and same-day delivery for orders within Johannesburg metro area. Free shipping is available on all orders over R200."},{question:"How do I place an order?",answer:"Simply browse our products, add items to your cart, and proceed to checkout. You can pay using credit/debit cards, EFT, or popular payment methods. Once your order is confirmed, you'll receive a confirmation email with tracking details."},{question:"How long will it take to get my package?",answer:"Delivery times depend on your location and chosen shipping method. Standard delivery takes 5-7 business days, while express delivery arrives in 2-3 business days. Orders placed before 2 PM are processed the same day."},{question:"Where are your products sent from?",answer:"All orders are dispatched from our warehouse in Johannesburg, South Africa. We ship nationwide and use reliable courier partners to ensure your skincare products arrive safely."},{question:"What is your return and refund policy?",answer:"We accept returns within 30 days of purchase for unopened products in their original packaging. If you're unsatisfied with a product, contact our customer service team for a refund or exchange. Damaged items will be replaced free of charge."},{question:"Are your products suitable for sensitive skin?",answer:"Yes! All Hygiene Hub products are dermatologist-tested, hypoallergenic, and free from harsh chemicals. We recommend doing a patch test before first use. Check individual product pages for specific ingredient information."},{question:"How do I track my order?",answer:"Once your order ships, you'll receive an email with a tracking number and link. You can also log into your account and view your order status under 'My Orders'. For any tracking issues, contact our support team."},{question:"Can I change or cancel my order?",answer:"Orders can be modified or cancelled within 2 hours of placement. After this window, orders enter processing and cannot be changed. Contact us immediately at hygienhub@gmail.com if you need to make changes."}],iP=()=>{const[e,t]=s.useState(null);return n.jsxs("div",{className:"bg-white min-h-screen",children:[n.jsxs("div",{className:"py-16 text-center bg-light-beige mb-8 border-b border-green-50",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold mb-3 text-gray-900",children:"Frequently Asked Questions"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Find answers to common questions about our products and services"})]}),n.jsxs("div",{className:"container mx-auto px-6 pb-20",children:[n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-16",children:[{icon:gE,label:"Delivery Policy"},{icon:rE,label:"Returns & Refunds"},{icon:ZC,label:"Privacy Policy"},{icon:dE,label:"How To Order"},{icon:NC,label:"Payment & Taxes"}].map((e,t)=>n.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg flex flex-col items-center text-center hover:bg-light-beige transition-all cursor-pointer group hover:shadow-md",children:[n.jsx("div",{className:"mb-4 text-gray-600 group-hover:text-primary transition-colors",children:n.jsx(e.icon,{size:32,strokeWidth:1.5})}),n.jsx("h4",{className:"font-bold text-xs uppercase tracking-wide",children:e.label})]},t))}),n.jsxs("div",{className:"mb-12 max-w-3xl mx-auto text-center",children:[n.jsx("h2",{className:"text-2xl font-serif font-bold mb-4 text-gray-900",children:"How Can We Help You?"}),n.jsx("p",{className:"text-gray-600 leading-relaxed",children:"At Hygiene Hub Skincare, we're committed to providing you with the best shopping experience. Below you'll find answers to our most commonly asked questions. If you can't find what you're looking for, please don't hesitate to contact our friendly customer support team."})]}),n.jsx("div",{className:"space-y-4 max-w-3xl mx-auto",children:rP.map((r,i)=>n.jsxs("div",{className:"border rounded-lg overflow-hidden transition-all "+(e===i?"border-primary shadow-md":"border-gray-200 hover:border-gray-300"),children:[n.jsxs("button",{onClick:()=>{var n;t(e===(n=i)?null:n)},className:"w-full flex justify-between items-center p-5 text-left bg-white hover:bg-gray-50 transition-colors",children:[n.jsx("h4",{className:"font-medium "+(e===i?"text-primary":"text-gray-900"),children:r.question}),e===i?n.jsx(PC,{size:20,className:"text-primary flex-shrink-0"}):n.jsx(IC,{size:20,className:"text-gray-400 flex-shrink-0"})]}),e===i&&n.jsx("div",{className:"px-5 pb-5 text-gray-600 text-sm leading-relaxed bg-gray-50 border-t border-gray-100",children:r.answer})]},i))}),n.jsxs("div",{className:"mt-16 text-center bg-light-beige p-10 rounded-lg max-w-3xl mx-auto",children:[n.jsx("h3",{className:"text-xl font-serif font-bold mb-3 text-gray-900",children:"Still Have Questions?"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Our customer support team is here to help you with any queries."}),n.jsx("a",{href:"/contact",className:"inline-block px-8 py-3 bg-primary text-white font-bold uppercase tracking-wider hover:bg-dark-green transition-colors",children:"Contact Us"})]})]})]})},aP=()=>n.jsxs("div",{className:"container mx-auto px-4 py-20 flex flex-col items-center justify-center text-center",children:[n.jsx("div",{className:"max-w-md w-full mb-8 relative",children:n.jsx("img",{src:"https://cdni.iconscout.com/illustration/premium/thumb/woman-applying-cosmetic-cream-on-face-2974917-2477348.png",alt:"Illustration",className:"w-full h-auto opacity-80"})}),n.jsx("h1",{className:"text-[120px] font-serif font-bold text-[#344054] leading-none mb-4",children:"404"}),n.jsx("h2",{className:"text-2xl font-bold uppercase tracking-widest mb-4",children:"Page Not Found"}),n.jsx("p",{className:"text-gray-500 mb-8 max-w-lg",children:"We're sorry  something has gone wrong on our end."}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx(h,{to:"/",className:"bg-[#f2f4f7] text-gray-700 px-8 py-3 text-xs font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors",children:"Back To Homepage"}),n.jsx(h,{to:"/shop",className:"bg-[#f2f4f7] text-gray-700 px-8 py-3 text-xs font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors",children:"Continue Shopping"})]})]}),sP=()=>n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6 max-w-4xl",children:[n.jsxs("div",{className:"mb-12 text-center text-center",children:[n.jsx("span",{className:"text-primary font-bold tracking-widest uppercase text-xs mb-4 block",children:"Delivery"}),n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:"Shipping & Delivery"}),n.jsx("div",{className:"w-20 h-1 bg-primary mx-auto mt-6"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-16 text-center",children:[n.jsxs("div",{className:"p-8 bg-gray-50 border border-gray-100 rounded-sm",children:[n.jsx(gE,{className:"mx-auto text-primary mb-4",size:32}),n.jsx("h4",{className:"font-bold mb-2",children:"South Africa Shipping"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Free on orders over R1000. Flat rate of R100 for all other orders."})]}),n.jsxs("div",{className:"p-8 bg-gray-50 border border-gray-100 rounded-sm text-center",children:[n.jsx(OC,{className:"mx-auto text-secondary mb-4",size:32}),n.jsx("h4",{className:"font-bold mb-2",children:"International Shipping"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Calculated at checkout. Available to most countries worldwide."})]})]}),n.jsxs("div",{className:"prose prose-gray max-w-none text-gray-600 space-y-8",children:[n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(DC,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"Processing Times"})]}),n.jsx("p",{children:"All orders are processed within 1-2 business days. Orders placed on weekends or holidays will be processed on the next business day. You will receive a shipment confirmation email with your tracking number once your order has shipped."})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(oE,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"Safe & Secure Delivery"})]}),n.jsx("p",{children:"We partner with leading couriers to ensure your skincare essentials arrive safely. All packages are insured and require a signature upon delivery for your peace of mind."})]})]})]})}),oP=()=>n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6 max-w-4xl",children:[n.jsxs("div",{className:"mb-12 text-center text-center",children:[n.jsx("span",{className:"text-secondary font-bold tracking-widest uppercase text-xs mb-4 block",children:"Satisfaction"}),n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:"Returns & Exchanges"}),n.jsx("div",{className:"w-20 h-1 bg-secondary mx-auto mt-6"})]}),n.jsx("div",{className:"bg-light-beige p-8 mb-16 rounded-sm text-center",children:n.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[n.jsx(rE,{className:"mx-auto text-secondary mb-4",size:40}),n.jsx("h3",{className:"text-2xl font-serif font-bold",children:"30-Day Happiness Guarantee"}),n.jsx("p",{className:"text-gray-600",children:"If you're not completely satisfied with your purchase, we offer a 30-day money-back guarantee. We're here to help you find the perfect routine."})]})}),n.jsxs("div",{className:"prose prose-gray max-w-none text-gray-600 space-y-12",children:[n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-serif font-bold text-gray-900 mb-6 border-b border-gray-100 pb-2",children:"Return Process"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"w-10 h-10 bg-gray-100 flex items-center justify-center font-bold rounded-full",children:"1"}),n.jsx("h4",{className:"font-bold text-gray-900",children:"Contact Us"}),n.jsx("p",{className:"text-sm",children:"Email our team at hygienhub@gmail.com with your order number."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"w-10 h-10 bg-gray-100 flex items-center justify-center font-bold rounded-full",children:"2"}),n.jsx("h4",{className:"font-bold text-gray-900",children:"Pack Items"}),n.jsx("p",{className:"text-sm",children:"Carefully package the items you wish to return in their original packaging."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"w-10 h-10 bg-gray-100 flex items-center justify-center font-bold rounded-full",children:"3"}),n.jsx("h4",{className:"font-bold text-gray-900",children:"Ship Back"}),n.jsx("p",{className:"text-sm",children:"Use our pre-paid label (for ZA orders) to send the package back to us."})]})]})]}),n.jsxs("section",{className:"bg-gray-50 p-8 rounded-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(oE,{className:"text-secondary"}),n.jsx("h2",{className:"text-xl font-serif font-bold m-0",children:"Eligibility"})]}),n.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-sm",children:[n.jsx("li",{children:"Items must be returned within 30 days of purchase."}),n.jsx("li",{children:"Products must have at least 50% of the contents remaining."}),n.jsx("li",{children:"Original components and packaging must be included."})]})]})]})]})}),lP=()=>n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6 max-w-4xl",children:[n.jsxs("div",{className:"mb-12 text-center",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:"Privacy Policy"}),n.jsx("p",{className:"text-gray-500",children:"Last updated: February 5, 2026"}),n.jsx("div",{className:"w-20 h-1 bg-primary mx-auto mt-6"})]}),n.jsxs("div",{className:"prose prose-green max-w-none text-gray-600 space-y-8",children:[n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(oE,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"Information We Collect"})]}),n.jsx("p",{children:"At Hygiene Hub Skincare, we collect information to provide better services to all our users. This includes information you provide (like your name, email, and shipping address) and information we get from your use of our services (like device information and location)."})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(ZC,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"How We Use Information"})]}),n.jsx("p",{children:"We use the information we collect to provide, maintain, and improve our services, to develop new ones, and to protect Hygiene Hub and our users. We also use this information to offer you tailored contentlike giving you more relevant search results and ads."})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(RC,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"Information Security"})]}),n.jsx("p",{children:"We work hard to protect Hygiene Hub and our users from unauthorized access to or unauthorized alteration, disclosure, or destruction of information we hold. In particular:"}),n.jsxs("ul",{className:"list-disc pl-6 space-y-2 mt-4",children:[n.jsx("li",{children:"We encrypt many of our services using SSL."}),n.jsx("li",{children:"We review our information collection, storage, and processing practices."}),n.jsx("li",{children:"We restrict access to personal information to Hygiene Hub employees."})]})]}),n.jsxs("section",{className:"bg-light-beige p-8 rounded-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(NC,{className:"text-primary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"Contact Us"})]}),n.jsxs("p",{children:["If you have any questions about this Privacy Policy, please contact us at:",n.jsx("br",{}),n.jsx("strong",{children:"Email:"})," hygienhub@gmail.com",n.jsx("br",{}),n.jsx("strong",{children:"Address:"})," Ethiopia Cres, Cosmo City, Roodepoort, 2188, South Africa"]})]})]})]})}),cP=()=>n.jsx("div",{className:"bg-white min-h-screen pt-24 pb-12",children:n.jsxs("div",{className:"container mx-auto px-6 max-w-4xl",children:[n.jsxs("div",{className:"mb-12 text-center",children:[n.jsx("h1",{className:"text-4xl font-serif font-bold text-gray-900 mb-4",children:"Terms of Service"}),n.jsx("p",{className:"text-gray-500",children:"Last updated: February 5, 2026"}),n.jsx("div",{className:"w-20 h-1 bg-secondary mx-auto mt-6"})]}),n.jsxs("div",{className:"prose prose-gray max-w-none text-gray-600 space-y-8",children:[n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(FC,{className:"text-secondary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"1. Terms"})]}),n.jsx("p",{children:"By accessing this website, you are agreeing to be bound by these terms of service, all applicable laws and regulations, and agree that you are responsible for compliance with any applicable local laws. If you do not agree with any of these terms, you are prohibited from using or accessing this site."})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(UC,{className:"text-secondary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"2. Use License"})]}),n.jsx("p",{children:"Permission is granted to temporarily download one copy of the materials (information or software) on Hygiene Hub Skincare's website for personal, non-commercial transitory viewing only."})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(MC,{className:"text-secondary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"3. Disclaimer"})]}),n.jsx("p",{children:"The materials on Hygiene Hub Skincare's website are provided on an 'as is' basis. Hygiene Hub Skincare makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties including, without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights."})]}),n.jsxs("section",{className:"bg-gray-50 p-8 rounded-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4 text-gray-900",children:[n.jsx(rE,{className:"text-secondary"}),n.jsx("h2",{className:"text-2xl font-serif font-bold m-0",children:"4. Modifications"})]}),n.jsx("p",{children:"Hygiene Hub Skincare may revise these terms of service for its website at any time without notice. By using this website you are agreeing to be bound by the then current version of these terms of service."})]})]})]})}),uP=()=>{const[e,t]=s.useState("");return n.jsxs("div",{className:"bg-white min-h-screen",children:[n.jsx("section",{className:"bg-light-beige py-20 border-b border-gray-100",children:n.jsxs("div",{className:"container mx-auto px-6 text-center",children:[n.jsx("span",{className:"text-orange-600 font-bold tracking-widest uppercase text-xs mb-4 block",children:"Order Status"}),n.jsx("h1",{className:"text-5xl font-serif font-bold text-gray-900 mb-6",children:"Track Your Order"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto leading-relaxed",children:"Stay updated on your skin's transformation. Enter your order details below to see its journey to your door."})]})}),n.jsx("div",{className:"container mx-auto px-6 py-24",children:n.jsxs("div",{className:"max-w-2xl mx-auto",children:[n.jsxs("div",{className:"bg-gray-50 p-8 md:p-12 border border-gray-100 shadow-sm relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 p-4 text-gray-200",children:n.jsx(gE,{size:120,className:"opacity-10 translate-x-12 translate-y-4"})}),n.jsxs("form",{onSubmit:t=>{t.preventDefault(),alert(`Tracking functionality for order ${e} is coming soon! Our integration with local couriers is being finalized.`)},className:"space-y-8 relative z-10",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Order ID"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"text",className:"w-full pl-4 pr-12 py-4 bg-white border border-gray-200 focus:border-secondary focus:ring-1 focus:ring-secondary outline-none transition-all placeholder:text-gray-300 shadow-sm",placeholder:"e.g. #12345",value:e,onChange:e=>t(e.target.value),required:!0}),n.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-300",children:n.jsx(iE,{size:20})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Email Address"}),n.jsx("input",{type:"email",className:"w-full px-4 py-4 bg-white border border-gray-200 focus:border-secondary focus:ring-1 focus:ring-secondary outline-none transition-all placeholder:text-gray-300 shadow-sm",placeholder:"email@example.com",required:!0}),n.jsx("p",{className:"text-[10px] text-gray-400 mt-2 italic",children:"Please use the same email address as when the order was placed."})]})]}),n.jsxs("button",{type:"submit",className:"w-full bg-gray-900 text-white font-bold uppercase tracking-widest py-4 hover:bg-secondary transition-all shadow-lg flex items-center justify-center gap-3 group",children:["Track My Package ",n.jsx(TC,{size:18,className:"group-hover:translate-x-1 transition-transform"})]})]})]}),n.jsxs("div",{className:"mt-12 grid grid-cols-1 md:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"flex gap-4 p-6 border border-gray-100 rounded-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-50 text-secondary rounded-full flex items-center justify-center flex-shrink-0",children:n.jsx(zC,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-sm mb-1",children:"Need Help?"}),n.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Can't find your order number? Check your confirmation email or contact our support."}),n.jsx(h,{to:"/contact",className:"text-primary text-[10px] font-bold uppercase tracking-widest mt-2 block hover:underline",children:"Contact Support"})]})]}),n.jsxs("div",{className:"flex gap-4 p-6 border border-gray-100 rounded-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-green-50 text-primary rounded-full flex items-center justify-center flex-shrink-0",children:n.jsx(JC,{size:20})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-sm mb-1",children:"Shipping Policy"}),n.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Typical orders arrive within 3-5 business days. Learn more about our delivery times."}),n.jsx(h,{to:"/shipping",className:"text-primary text-[10px] font-bold uppercase tracking-widest mt-2 block hover:underline",children:"Read Policy"})]})]})]})]})})]})},hP=new i,dP=()=>n.jsx(a,{client:hP,children:n.jsx(hC,{children:n.jsx(Pp,{children:n.jsx(Tp,{children:n.jsxs(m,{children:[n.jsx(yC,{}),n.jsxs("div",{className:"flex flex-col min-h-screen text-gray-800 font-sans",children:[n.jsx(wE,{}),n.jsx("main",{className:"flex-grow",children:n.jsxs(g,{children:[n.jsx(y,{path:"/",element:n.jsx(EE,{})}),n.jsx(y,{path:"/about",element:n.jsx(IE,{})}),n.jsx(y,{path:"/shop",element:n.jsx(PE,{})}),n.jsx(y,{path:"/collections",element:n.jsx(kE,{})}),n.jsx(y,{path:"/collections/:id",element:n.jsx(CE,{})}),n.jsx(y,{path:"/products/:handle",element:n.jsx(ME,{})}),n.jsx(y,{path:"/account",element:n.jsx(jE,{})}),n.jsx(y,{path:"/contact",element:n.jsx(OE,{})}),n.jsx(y,{path:"/cart",element:n.jsx(BE,{})}),n.jsx(y,{path:"/checkout",element:n.jsx(eP,{})}),n.jsx(y,{path:"/order-success",element:n.jsx(tP,{})}),n.jsx(y,{path:"/wishlist",element:n.jsx(nP,{})}),n.jsx(y,{path:"/faq",element:n.jsx(iP,{})}),n.jsx(y,{path:"/track-order",element:n.jsx(uP,{})}),n.jsx(y,{path:"/shipping",element:n.jsx(sP,{})}),n.jsx(y,{path:"/returns",element:n.jsx(oP,{})}),n.jsx(y,{path:"/privacy",element:n.jsx(lP,{})}),n.jsx(y,{path:"/terms",element:n.jsx(cP,{})}),n.jsx(y,{path:"*",element:n.jsx(aP,{})})]})}),n.jsx(SE,{})]})]})})})})}),pP=document.getElementById("root");if(!pP)throw new Error("Could not find root element to mount to");!function(e){const t={...e};__(t,"react"),Cy("react",{version:s.version}),Fb(t)}({dsn:"https://47deb315a0b0fa11d5455f361db32bb4@o4510834843844608.ingest.us.sentry.io/4510834858328064",sendDefaultPii:!0,integrations:[aC(),$T()],tracesSampleRate:1,tracePropagationTargets:["localhost",/^http:\/\/localhost:9000\/api/],replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1,enableLogs:!0}),gC.initialize("G-XXXXXXXXXX");_p.createRoot(pP).render(n.jsx(f.StrictMode,{children:n.jsx(dP,{})}));
